!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("webapp-core"),require("Hammer"),require("Desmos"),require("Chart")):"function"==typeof define&&define.amd?define("GeoPlot",["webapp-core","Hammer","Desmos","Chart"],t):"object"==typeof exports?exports.GeoPlot=t(require("webapp-core"),require("Hammer"),require("Desmos"),require("Chart")):e.GeoPlot=t(e["webapp-core"],e.Hammer,e.Desmos,e.Chart)}(self,(function(__WEBPACK_EXTERNAL_MODULE__3892__,__WEBPACK_EXTERNAL_MODULE__4396__,__WEBPACK_EXTERNAL_MODULE__1431__,__WEBPACK_EXTERNAL_MODULE__2370__){return(()=>{var __webpack_modules__={554:()=>{__defineTemplate("ActionBar",(e=>{e.beginChild("div").class((e=>e.className)).visible((e=>e.visible)).set("enabled",(e=>e.enabled)).class("context-mode",(e=>e.selectionManager&&e.selectionManager.isActive)).beginChild("ul").set("class","nav main").if((e=>null!=e.icon),(e=>e.beginChild("li").set("class","icon").template("Icon",(e=>e.icon)).endChild())).if((e=>"menu"==e.mainAction),(e=>e.beginChild("li").set("class","main-action menu").on("click",(e=>e.showNavigationMenu())).behavoir("ripple").beginChild("i").set("class","icon fas fa-bars").endChild().endChild())).if((e=>"back"==e.mainAction),(e=>e.beginChild("li").set("class","main-action back").on("click",(e=>e.back())).behavoir("ripple").beginChild("i").set("class","icon fas fa-chevron-left").endChild().endChild())).if((e=>null!=e.content),(e=>e.beginChild("li").set("class","main-content").content((e=>e.content)).endChild()),(e=>e.if((e=>null!=e.title),(e=>e.beginChild("li").set("class","main-content title").text((e=>e.title)).endChild())))).foreach((e=>e.actions),(e=>e.beginChild("li").set("class","action-item").class((e=>e.name)).content((e=>e)).endChild())).endChild().beginChild("ul").set("class","nav context").beginChild("li").set("class","main-action close").on("click",(e=>e.selectionManager?e.selectionManager.close():null)).behavoir("ripple").beginChild("i").set("class","icon fas fa-times").endChild().endChild().if((e=>null!=e.selectionManager),(e=>e.beginChild("li").set("class","title").text((e=>e.selectionManager.selectionText)).endChild().foreach((e=>e.selectionManager.actions),(e=>e.beginChild("li").set("class","action-item").class((e=>e.name)).content((e=>e)).endChild())))).endChild().endChild().content((e=>e.navigationMenu))}))},1179:()=>{__defineTemplate("ActionIcon",(e=>{e.beginChild("button").set("type","button").set("class","action button-text").set("tooltip",(e=>e.tooltip)).on("click",(e=>e.executeAsync())).class((e=>e.className)).visible((e=>e.visible)).set("enabled",(e=>e.enabled)).behavoir("ripple").template("Icon",(e=>e.content)).endChild()})),__defineTemplate("ActionLink",(e=>{e.beginChild("button").set("type","button").set("class","action button-text").on("click",(e=>e.executeAsync())).class((e=>e.className)).visible((e=>e.visible)).set("enabled",(e=>e.enabled)).behavoir("ripple").content((e=>e.content)).endChild()})),__defineTemplate("ActionButton",(e=>{e.beginChild("button").set("type","button").set("class","action button").on("click",(e=>e.executeAsync())).class((e=>e.className)).visible((e=>e.visible)).set("enabled",(e=>e.enabled)).behavoir("ripple").content((e=>e.content)).endChild()}))},6574:()=>{__defineTemplate("Attach",(e=>{e.beginChild("div").class((e=>e.className)).visible((e=>e.visible)).set("enabled",(e=>e.enabled)).behavoir("attach").endChild()}))},245:()=>{__defineTemplate("DefaultCheckBox",(e=>{e.beginChild("label").beginChild("input").set("type","checkbox").value((e=>e.editValue)).focus((e=>e.hasFocus)).class((e=>e.className)).visible((e=>e.visible)).set("enabled",(e=>e.enabled)).set("id",(e=>e.uid)).endChild().beginChild("span").text((e=>e.label)).endChild().endChild()})),__defineTemplate("Switch",(e=>{e.beginChild("div").set("class","switch").class((e=>e.className)).visible((e=>e.visible)).set("enabled",(e=>e.enabled)).set("id",(e=>e.uid)).class("selected",(e=>e.editValue)).beginChild("div").set("class","checkbox-container").beginChild("div").set("class","unselected-half").on("click",(e=>e.editValue=!1)).endChild().beginChild("div").set("class","selected-half").on("click",(e=>e.editValue=!0)).endChild().beginChild("div").set("class","switch-button").endChild().endChild().if((e=>null!=e.label),(e=>e.beginChild("label").text((e=>e.label)).endChild())).endChild()})),__defineTemplate("CheckBox",(e=>{e.beginChild("div").set("class","checkbox").class((e=>e.className)).visible((e=>e.visible)).set("enabled",(e=>e.enabled)).set("id",(e=>e.uid)).on("click",(e=>e.toggle())).class("selected",(e=>e.editValue)).beginChild("div").set("class","checkbox-container").beginChild("i").set("class","fas fa-check").endChild().endChild().if((e=>null!=e.label),(e=>e.beginChild("label").text((e=>e.label)).endChild())).endChild()}))},9714:()=>{__defineTemplate("BottomSheet",(e=>{e.beginChild("div").class((e=>e.className)).visible((e=>e.visible)).set("enabled",(e=>e.enabled)).class((e=>e.status)).behavoir("attach").if((e=>e.isShowOpener),(e=>e.beginChild("button").set("type","button").set("class","opener button-text").on("click",(e=>e.toggle())).beginChild("i").set("class","fas fa-caret-up").endChild().endChild())).content((e=>e.content)).endChild()}))},4117:()=>{__defineTemplate("ConsoleView",(e=>{e.beginChild("div").class((e=>e.className)).visible((e=>e.visible)).beginChild("div").set("class","toolbar").beginChild("button").set("type","button").on("click",(e=>e.hide())).text("Hide").endChild().beginChild("button").set("type","button").on("click",(e=>e.clear())).text("Clear").endChild().endChild().beginChild("div").set("class","body").foreach((e=>e.root.items),(e=>e.content((e=>e)))).endChild().endChild()})),__defineTemplate("ConsoleMessageView",(e=>{e.beginChild("div").set("class","console-item console-message").class((e=>e.type)).if((e=>null!=e.content),(e=>e.foreach((e=>e.content),(e=>e.beginChild("span").text((e=>e)).endChild())))).endChild()})),__defineTemplate("ConsoleGroupView",(e=>{e.beginChild("div").set("class","console-item console-group").beginChild("header").template("ConsoleMessageView",(e=>e)).endChild().beginChild("section").foreach((e=>e.items),(e=>e.content((e=>e)))).endChild().endChild()}))},1906:()=>{__defineTemplate("Container",(e=>{e.beginChild("div").class((e=>e.className)).visible((e=>e.visible)).set("enabled",(e=>e.enabled)).behavoir("attach").if((e=>null!=e.title),(e=>e.beginChild("header").beginChild("label").text((e=>e.title)).endChild().endChild())).beginChild("div").set("class","content").class("expanded",(e=>e.isExpanded)).class("expandible",(e=>e.canExpand)).if((e=>e.canExpand),(e=>e.beginChild("div").set("class","content-wrapper").content((e=>e.content),!0).endChild().if((e=>e.isOverflow),(e=>e.beginChild("a").set("class","base-button expand-collapse").on("click",(e=>e.toggleExpand())).visible((e=>e.canExpand)).behavoir("ripple").beginChild("i").set("class","fas fa-angle-down").endChild().endChild()))),(e=>e.content((e=>e.content),!0))).endChild().endChild()}))},751:()=>{__defineTemplate("ContentView",(e=>{e.content((e=>e.content))})),__defineTemplate("ContentViewNested",(e=>{e.beginChild("div").class((e=>e.className)).visible((e=>e.visible)).set("enabled",(e=>e.enabled)).class((e=>e.status)).behavoir("attach").content((e=>e.content)).endChild()}))},926:()=>{__defineTemplate("ContextMenu",(e=>{e.beginChild("ul").class((e=>e.className)).foreach((e=>e.actions),(e=>e.beginChild("li").content((e=>e)).endChild())).endChild()}))},939:()=>{__defineTemplate("CounterView",(e=>{e.beginChild("div").set("class","action").class((e=>e.className)).visible((e=>e.visible)).set("enabled",(e=>e.enabled)).beginChild("label").set("class","title").text((e=>e.title)).endChild().beginChild("span").set("class","value").text((e=>e.content)).endChild().endChild()}))},3325:()=>{__defineTemplate("DateEditor",(e=>{e.beginChild("input").behavoir("attach").set("type","date").value((e=>e.editValue)).focus((e=>e.hasFocus)).class((e=>e.className)).visible((e=>e.visible)).set("enabled",(e=>e.enabled)).set("id",(e=>e.uid)).set("placeholder",(e=>e.placeholder)).endChild()}))},7501:()=>{__defineTemplate("DateEditorCombo",(e=>{e.beginChild("div").class((e=>e.className)).visible((e=>e.visible)).set("enabled",(e=>e.enabled)).beginChild("select").set("class","input-element day").value((e=>e.selectedDay)).beginChild("option").set("value","").text((e=>WebApp.Format.text("day-label"))).endChild().foreach((e=>e.days),(e=>e.beginChild("option").set("value",(e=>e)).text((e=>e)).endChild())).endChild().beginChild("select").set("class","input-element month").value((e=>e.selectedMonth)).beginChild("option").set("value","").text((e=>WebApp.Format.text("month-label"))).endChild().foreach((e=>e.months),(e=>e.beginChild("option").set("value",(e=>e.number)).text((e=>e.name)).endChild())).endChild().beginChild("select").set("class","input-element year").value((e=>e.selectedYear)).beginChild("option").set("value","").text((e=>WebApp.Format.text("year-label"))).endChild().foreach((e=>e.years),(e=>e.beginChild("option").set("value",(e=>e)).text((e=>e)).endChild())).endChild().endChild()}))},4212:()=>{__defineTemplate("Drawer",(e=>{e.beginChild("div").set("class","drawer-container").class((e=>e.status)).beginChild("div").set("class","drawer").behavoir("gesture").if((e=>null!=e.header),(e=>e.beginChild("header").content((e=>e.header)).endChild())).foreach((e=>e.groups),(e=>e.if((e=>e.actions.count>0),(e=>e.beginChild("section").if((e=>null!=e.label),(e=>e.beginChild("label").text((e=>e.label)).endChild())).beginChild("div").set("class","menu").foreach((e=>e.actions),(e=>e.content((e=>e)))).endChild().endChild())))).endChild().behavoir("attach").endChild()}))},3006:()=>{__defineTemplate("FileUploadView",(e=>{e.beginChild("div").class((e=>e.className)).visible((e=>e.visible)).set("enabled",(e=>e.enabled)).class((e=>e.status)).beginChild("div").set("class","content").beginChild("div").set("class","header").beginChild("button").set("type","button").set("class","select button-text").on("click",(e=>e.select())).text((e=>e.text)).set("enabled",(e=>"selected"==e.status||"empty"==e.status)).endChild().endChild().beginChild("div").set("class","progress").beginChild("div").set("class","bar").style("width",(e=>100*e.progress+"%")).endChild().beginChild("div").set("class","text").text((e=>e.progressText)).endChild().endChild().endChild().endChild()}))},9337:()=>{__defineTemplate("HeadedContentView",(e=>{e.beginChild("div").class((e=>e.className)).visible((e=>e.visible)).beginChild("header").content((e=>e.header)).endChild().beginChild("div").set("class","content").content((e=>e.content)).endChild().endChild()}))},8679:()=>{__defineTemplate("Html",(e=>{e.beginChild("div").class((e=>e.className)).visible((e=>e.visible)).set("enabled",(e=>e.enabled)).html((e=>e.content)).endChild()})),__defineTemplate("HtmlNode",(e=>{e.appendChild(e.model.content)}))},3123:()=>{__defineTemplate("Icon",(e=>{e.if((e=>null!=e),(e=>e.if((e=>"fas "==e.substr(0,4)||"fab "==e.substr(0,4)||"far "==e.substr(0,4)||"fal "==e.substr(0,4)||"fad "==e.substr(0,4)),(e=>e.beginChild("i").set("class","icon").class((e=>e)).endChild()),(e=>e.beginChild("img").set("class","icon").set("src",(e=>e)).endChild()))))}))},5700:()=>{__defineTemplate("IconTextView",(e=>{e.beginChild("div").class((e=>e.className)).visible((e=>e.visible)).set("enabled",(e=>e.enabled)).class((e=>e.status)).if((e=>null!=e.icon),(e=>e.template("Icon",(e=>e.icon)))).if((e=>null!=e.text),(e=>e.beginChild("span").set("class","text").text((e=>e.text)).endChild())).if((e=>null!=e.badge),(e=>e.beginChild("span").set("class","badge").text((e=>e.badge)).endChild())).endChild()})),__defineTemplate("IconTextViewInline",(e=>{e.class((e=>e.status)).if((e=>null!=e.icon),(e=>e.template("Icon",(e=>e.icon)))).if((e=>null!=e.text),(e=>e.beginChild("span").set("class","text").text((e=>e.text)).endChild())).if((e=>null!=e.badge),(e=>e.beginChild("span").set("class","badge").text((e=>e.badge)).endChild()))}))},7598:()=>{__defineTemplate("ImageInline",(e=>{e.beginChild("img").class((e=>e.className)).set("src",(e=>e.content)).visible((e=>e.visible)).set("enabled",(e=>e.enabled)).endChild()})),__defineTemplate("Image",(e=>{e.beginChild("div").set("class","image-container").visible((e=>e.visible)).set("enabled",(e=>e.enabled)).beginChild("img").class((e=>e.className)).set("src",(e=>e.content)).endChild().endChild()}))},3999:()=>{__defineTemplate("ItemSelectorList",(e=>{e.beginChild("div").set("class","items-view").class((e=>e.className)).foreach((e=>e.items),(e=>e.content((e=>e)))).endChild()}))},7641:()=>{__defineTemplate("ItemView",(e=>{e.beginChild("div").class((e=>e.className)).visible((e=>e.visible)).class((e=>e.status)).class("activable",(e=>e.canOpen)).class("compact",(e=>!(e.mainActions&&e.mainActions.length>0))).if((e=>e.mainActions&&e.mainActions.length>0),(e=>e.beginChild("div").set("class","body-container").template("ItemViewBody",(e=>e)).endChild().beginChild("div").set("class","main-actions").foreach((e=>e.mainActions),(e=>e.content((e=>e)))).endChild()),(e=>e.template("ItemViewBody",(e=>e)))).endChild()})),__defineTemplate("ItemViewBody",(e=>{e.class("with-menu",(e=>e.hasActions)).beginChild("div").on("click",(e=>e.open())).class("body",(e=>!0)).if((e=>e.content.count<=1),(e=>e.content((e=>e.content.get(0)),!0)),(e=>e.foreach((e=>e.content),(e=>e.content((e=>e)))))).endChild().if((e=>e.canOpen),(e=>e.beginChild("i").set("class","open-icon fas fa-angle-right").endChild())).if((e=>e.hasActions),(e=>e.beginChild("a").set("class","menu").on("click",(e=>e.showMenu())).beginChild("i").set("class","fas fa-ellipsis-v").endChild().endChild()))}))},4581:()=>{__defineTemplate("ItemsEditor",(e=>{e.beginChild("div").class((e=>e.className)).visible((e=>e.visible)).set("enabled",(e=>e.enabled)).foreach((e=>e.content),(e=>e.beginChild("div").set("class","list-item").content((e=>e),!0).endChild())).if((e=>e.canAdd),(e=>e.beginChild("div").set("class","add-item").content((e=>e.addAction)).endChild())).endChild()}))},6506:()=>{__defineTemplate("ItemsView",(e=>{e.beginChild("div").class((e=>e.className)).visible((e=>e.visible)).set("enabled",(e=>e.enabled)).foreach((e=>e.content),(e=>e.content((e=>e)))).if((e=>0==e.content.count&&null!=e.emptyView),(e=>e.content((e=>e.emptyView)))).endChild()})),__defineTemplate("ItemsViewWrapped",(e=>{e.beginChild("div").class((e=>e.className)).visible((e=>e.visible)).set("enabled",(e=>e.enabled)).beginChild("div").set("class","wrapper").foreach((e=>e.content),(e=>e.content((e=>e)))).if((e=>0==e.content.count&&null!=e.emptyView),(e=>e.content((e=>e.emptyView)))).endChild().endChild()})),__defineTemplate("ItemsViewForm",(e=>{e.beginChild("form").class((e=>e.className)).visible((e=>e.visible)).set("enabled",(e=>e.enabled)).foreach((e=>e.content),(e=>e.content((e=>e)))).if((e=>0==e.content.count&&null!=e.emptyView),(e=>e.content((e=>e.emptyView)))).endChild()}))},6228:()=>{__defineTemplate("ListView",(e=>{e.beginChild("div").class((e=>e.className)).visible((e=>e.visible)).set("enabled",(e=>e.enabled)).behavoir("scroll-check").class((e=>e.status)).foreach((e=>e.header),(t=>t.beginChild("header").set("class","header-item").content((e=>e)).endChild().if((t=>WebApp.injectProxy(t,"$parent",e.model).showSeparator),(e=>e.beginChild("div").set("class","separator").endChild())))).if((e=>0==e.content.count&&null!=e.emptyView&&"loaded"==e.status),(e=>e.content((e=>e.emptyView)))).foreach((e=>e.content),(t=>t.beginChild("div").set("class","list-item").content((e=>e),!0).endChild().if((t=>WebApp.injectProxy(t,"$parent",e.model).showSeparator),(e=>e.beginChild("div").set("class","separator").endChild())))).foreach((e=>e.footer),(t=>t.beginChild("footer").set("class","footer-item").content((e=>e)).endChild().if((t=>WebApp.injectProxy(t,"$parent",e.model).showSeparator),(e=>e.beginChild("div").set("class","separator").endChild())))).beginChild("div").set("class","loading-item").beginChild("i").set("class","fas fa-circle-notch fa-spin fa-3x fa-fw").endChild().endChild().endChild()})),__defineTemplate("ListViewInline",(e=>{e.beginChild("div").set("class","list-view-inline").class((e=>e.className)).visible((e=>e.visible)).set("enabled",(e=>e.enabled)).behavoir("scroll-check").class((e=>e.status)).if((e=>e.header.count>0),(e=>e.foreach((e=>e.header),(e=>e.content((e=>e)))).if((e=>e.showSeparator),(e=>e.beginChild("div").set("class","separator").endChild())))).if((e=>0==e.content.count&&null!=e.emptyView&&"loaded"==e.status),(e=>e.content((e=>e.emptyView)))).foreach((e=>e.content),(t=>t.content((e=>e)).if((t=>WebApp.injectProxy(t,"$parent",e.model).showSeparator),(e=>e.beginChild("div").set("class","separator").endChild())))).if((e=>e.footer.count>0),(e=>e.foreach((e=>e.footer),(e=>e.content((e=>e)))).if((e=>e.showSeparator),(e=>e.beginChild("div").set("class","separator").endChild())))).beginChild("div").set("class","loading-item").beginChild("i").set("class","fas fa-circle-notch fa-spin fa-3x fa-fw").endChild().endChild().endChild()}))},4726:()=>{__defineTemplate("LocationView",(e=>{e.beginChild("div").class((e=>e.className)).visible((e=>e.visible)).set("enabled",(e=>e.enabled)).beginChild("address").if((e=>null!=e.content.name),(e=>e.beginChild("label").text((e=>e.content.name)).endChild())).beginChild("span").text((e=>e.content.address)).endChild().endChild().beginChild("img").set("src",(e=>e.map)).on("click",(e=>e.showMap())).endChild().endChild()}))},1368:()=>{__defineTemplate("MediaEditor",(e=>{e.beginChild("div").class((e=>e.className)).visible((e=>e.visible)).beginChild("div").set("class","media-container").on("click",(e=>e.showMenu())).content((e=>e.mediaView)).endChild().content((e=>e.fileUpload)).endChild()}))},163:()=>{__defineTemplate("MediaView",(e=>{e.content((e=>e.activeView))}))},6932:()=>{__defineTemplate("MessageBox",(e=>{e.beginChild("div").class((e=>e.className)).beginChild("h5").set("class","title").text((e=>e.title)).endChild().beginChild("div").set("class","body").if((e=>null!=e.icon),(e=>e.template("Icon",(e=>e.icon)))).beginChild("div").set("class","text").text((e=>e.message)).endChild().endChild().beginChild("div").set("class","actions").foreach((e=>e.actions),(e=>e.content((e=>e)))).endChild().endChild()}))},3356:()=>{__defineTemplate("MultiItemPicker",(e=>{e.beginChild("div").class((e=>e.className)).visible((e=>e.visible)).set("enabled",(e=>e.enabled)).class((e=>e.status)).beginChild("div").set("class","items-container").beginChild("i").set("class","loading-item fas fa-circle-notch fa-spin fa-fw").endChild().foreach((e=>e.items),(e=>e.content((e=>e)))).endChild().content((e=>e.selectAction)).endChild()}))},8958:()=>{__defineTemplate("NavBar",(e=>{e.beginChild("div").class((e=>e.className)).visible((e=>e.visible)).set("enabled",(e=>e.enabled)).beginChild("nav").set("class","nav").foreach((e=>e.content),(e=>e.beginChild("button").set("class","button-text").class((e=>e.status)).on("click",(e=>e.select())).visible((e=>e.visible)).behavoir("ripple").content((e=>e)).endChild())).endChild().endChild()}))},2547:()=>{__defineTemplate("OperationView",(e=>{e.beginChild("div").set("class","operation-view").template("Spinner",(e=>e)).beginChild("div").set("class","text").beginChild("span").text((e=>e.message)).endChild().endChild().endChild()}))},5471:()=>{__defineTemplate("SlidePageHost",(e=>{e.beginChild("div").set("class","slide-page-host").class((e=>e.activeTransaction)).beginChild("div").set("class","page-container").class((e=>e.pageViews[0].className)).content((e=>e.pageViews[0].content)).endChild().beginChild("div").set("class","page-container").class((e=>e.pageViews[1].className)).content((e=>e.pageViews[1].content)).endChild().endChild()})),__defineTemplate("SinglePageHost",(e=>{e.beginChild("div").set("class","single-page-host").content((e=>e.current.view)).endChild()}))},5142:()=>{__defineTemplate("PermissionRequestItemView",(e=>{e.beginChild("div").class((e=>e.className)).beginChild("div").set("class","item-content").beginChild("div").set("class","main").content((e=>e.switchView)).endChild().beginChild("span").set("class","right bold uppercase").text((e=>WebApp.Format.action("permission-why"))).on("click",(e=>e.isShowInfo=!0)).class("hidden",(e=>e.isShowInfo)).endChild().endChild().beginChild("div").set("class","info-message on-surface-smaller").text((e=>WebApp.Format.message(e.request.description))).class("hidden",(e=>!e.isShowInfo)).endChild().endChild()}))},1556:()=>{__defineTemplate("PopUpContent",(e=>{e.beginChild("div").class((e=>e.className)).beginChild("h5").set("class","title").text((e=>e.title)).endChild().beginChild("div").set("class","body").content((e=>e.contentView)).endChild().beginChild("div").set("class","actions").foreach((e=>e.actions),(e=>e.content((e=>e)))).endChild().endChild()}))},7760:()=>{__defineTemplate("ProgressView",(e=>{e.beginChild("div").class((e=>e.className)).visible((e=>e.visible)).set("enabled",(e=>e.enabled)).class("visible",(e=>e.visible)).beginChild("i").set("class","spinner fas fa-circle-notch fa-spin fa-3x fa-fw").endChild().endChild()}))},8777:()=>{__defineTemplate("PropertyView",(e=>{e.beginChild("div").set("class","action").class((e=>e.className)).visible((e=>e.visible)).set("enabled",(e=>e.enabled)).if((e=>e.showLabel&&null!=e.label),(e=>e.beginChild("label").set("for",(e=>e.editor.uid)).text((e=>e.label)).endChild())).if((e=>e.readonly),(e=>e.beginChild("div").set("class","display-value").text((e=>e.editor.displayValue)).endChild()),(e=>e.content((e=>e.editor)).if((e=>null!=e.error),(e=>e.beginChild("span").set("class","error").text((e=>e.error)).endChild())))).endChild()}))},7183:()=>{__defineTemplate("RemovableItemView",(e=>{e.beginChild("div").class((e=>e.className)).visible((e=>e.visible)).class((e=>e.status)).beginChild("div").set("class","content").content((e=>e.content)).endChild().beginChild("button").set("type","button").set("class","remove button-text").set("href","#!").on("click",(e=>e.removeAsync())).beginChild("i").set("class","fas fa-times").endChild().endChild().endChild()}))},9857:()=>{__defineTemplate("SearchView",(e=>{e.if((e=>e.isExpanded),(e=>e.beginChild("div").set("class","search-container").class((e=>e.className)).visible((e=>e.visible)).class((e=>e.status)).beginChild("input").set("type","text").focus((e=>e.hasFocus)).set("enabled",(e=>e.enabled)).value((e=>e.searchText)).set("placeholder",(e=>e.tooltip)).endChild().beginChild("i").set("class","loading-item fas fa-circle-notch fa-spin fa-fw").endChild().endChild()),(e=>e.template("ActionIcon",(e=>e))))}))},3818:()=>{__defineTemplate("SectionEditor",(e=>{e.beginChild("div").class((e=>e.className)).visible((e=>e.visible)).set("enabled",(e=>e.enabled)).content((e=>e.navBar)).if((e=>e.navBar.selectedItem&&e.navBar.selectedItem.content&&null!=e.navBar.selectedItem.content.editor),(e=>e.content((e=>e.navBar.selectedItem.content.editor)))).endChild()}))},7575:()=>{__defineTemplate("SectionsView",(e=>{e.beginChild("div").class((e=>e.className)).visible((e=>e.visible)).set("enabled",(e=>e.enabled)).foreach((e=>e.content),(e=>e.beginChild("section").beginChild("h5").set("class","header").content((e=>e.header)).endChild().beginChild("div").set("class","content").content((e=>e.content)).endChild().endChild())).endChild()}))},4182:()=>{__defineTemplate("SelectableItemView",(e=>{e.beginChild("div").class((e=>e.className)).visible((e=>e.visible)).set("enabled",(e=>e.enabled)).on("click",(e=>e.toggle())).class("selected",(e=>e.isSelected)).class("checkbox",(e=>!0)).beginChild("div").set("class","checkbox-container").value((e=>e.isSelected)).beginChild("i").set("class","fas fa-check").endChild().endChild().content((e=>e.content)).endChild()})),__defineTemplate("SelectableItemViewText",(e=>{e.beginChild("div").class((e=>e.className)).on("click",(e=>e.toggle())).class("selected",(e=>e.isSelected)).content((e=>e.content),!0).endChild()}))},6948:()=>{__defineTemplate("SimpleItemView",(e=>{e.beginChild("div").class((e=>e.className)).visible((e=>e.visible)).class((e=>e.status)).template("Icon",(e=>e.icon)).beginChild("div").set("class","details").beginChild("h6").text((e=>e.text)).endChild().if((e=>null!=e.subText),(e=>e.beginChild("div").set("class","sub-text").text((e=>e.subText)).endChild())).endChild().endChild()}))},940:()=>{__defineTemplate("SingleItemPicker",(e=>{e.beginChild("div").class((e=>e.className)).visible((e=>e.visible)).set("enabled",(e=>e.enabled)).class((e=>e.status)).beginChild("div").set("class","items-container").beginChild("i").set("class","loading-item fas fa-circle-notch fa-spin fa-fw").endChild().content((e=>e.contentView)).endChild().if((e=>null!=e.editValue),(e=>e.content((e=>e.clearAction)))).content((e=>e.selectAction)).endChild()}))},9307:()=>{__defineTemplate("SelectEditor",(e=>{e.beginChild("select").set("class","input-element").focus((e=>e.hasFocus)).class((e=>e.className)).visible((e=>e.visible)).set("enabled",(e=>e.enabled)).set("id",(e=>e.uid)).behavoir("attach").if((e=>null!=e.placeholder),(e=>e.beginChild("option").set("value","").text((e=>e.placeholder)).endChild())).foreach((e=>e.items),(e=>e.beginChild("option").text((e=>e.content)).endChild())).endChild()})),__defineTemplate("SingleItemSelectorButton",(e=>{e.beginChild("button").set("type","button").class((e=>e.className)).visible((e=>e.visible)).set("enabled",(e=>e.enabled)).on("click",(e=>e.selectAsync())).beginChild("span").text((e=>e.selectedItemText)).endChild().beginChild("i").set("class","fas fa-caret-down").endChild().endChild()}))},1977:()=>{__defineTemplate("SnackBar",(e=>{e.beginChild("div").set("class","snack-bar-container").class((e=>e.status)).beginChild("div").class((e=>e.className)).beginChild("div").set("class","content").on("click",(e=>e.hide(null))).content((e=>e.content)).endChild().if((e=>null!=e.action),(e=>e.content((e=>e.action)))).endChild().endChild()}))},5395:()=>{__defineTemplate("Spinner",(e=>{e.beginChild("div").set("class","spinner-container").beginChild("i").set("class","spinner fas fa-circle-notch fa-spin fa-3x fa-fw").endChild().endChild()}))},8350:()=>{__defineTemplate("TextEditor",(e=>{e.beginChild("input").behavoir("attach").set("class","input-element").set("type","text").value((e=>e.editValue)).focus((e=>e.hasFocus)).class((e=>e.className)).visible((e=>e.visible)).set("enabled",(e=>e.enabled)).set("id",(e=>e.uid)).set("placeholder",(e=>e.placeholder)).set("maxlength",(e=>e.maxLength)).endChild()})),__defineTemplate("NumberEditor",(e=>{e.beginChild("input").behavoir("attach").set("class","input-element").set("inputmode","decimal").set("type","text").set("pattern",(e=>WebApp.Format.text("decimal-input"))).set("lang",(e=>WebApp.App.language)).value((e=>e.editValue)).focus((e=>e.hasFocus)).class((e=>e.className)).visible((e=>e.visible)).set("enabled",(e=>e.enabled)).set("id",(e=>e.uid)).set("placeholder",(e=>e.placeholder)).endChild()})),__defineTemplate("TimeEditor",(e=>{e.beginChild("input").behavoir("attach").set("class","input-element").set("type","time").set("lang",(e=>WebApp.App.language)).value((e=>e.editValue)).focus((e=>e.hasFocus)).class((e=>e.className)).visible((e=>e.visible)).set("enabled",(e=>e.enabled)).set("id",(e=>e.uid)).set("placeholder",(e=>e.placeholder)).set("min","00:00").set("max","24:00").endChild()})),__defineTemplate("PasswordEditor",(e=>{e.beginChild("input").behavoir("attach").set("class","input-element").set("type","password").value((e=>e.editValue)).focus((e=>e.hasFocus)).class((e=>e.className)).visible((e=>e.visible)).set("enabled",(e=>e.enabled)).set("id",(e=>e.uid)).set("placeholder",(e=>e.placeholder)).set("maxlength",(e=>e.maxLength)).endChild()})),__defineTemplate("TextEditorMultiLine",(e=>{e.beginChild("textarea").set("class","input-element").behavoir("attach").value((e=>e.editValue)).focus((e=>e.hasFocus)).class((e=>e.className)).visible((e=>e.visible)).set("enabled",(e=>e.enabled)).set("id",(e=>e.uid)).set("rows",(e=>e.lineCount)).set("placeholder",(e=>e.placeholder)).set("maxlength",(e=>e.maxLength)).endChild()}))},1814:()=>{__defineTemplate("TextContent",(e=>{e.beginChild("span").class((e=>e.className)).visible((e=>e.visible)).set("enabled",(e=>e.enabled)).text((e=>e.content)).endChild()})),__defineTemplate("TextView",(e=>{e.beginChild("span").class((e=>e.className)).visible((e=>e.visible)).set("enabled",(e=>e.enabled)).text((e=>e.text)).endChild()})),__defineTemplate("Text",(e=>{e.beginChild("span").text((e=>e)).endChild()}))},5972:()=>{__defineTemplate("ToastContainer",(e=>{e.foreach((e=>e),(e=>e.content((e=>e))))})),__defineTemplate("Toast",(e=>{e.beginChild("div").class((e=>e.className)).if((e=>null!=e.icon),(e=>e.template("Icon",(e=>e.icon)))).beginChild("span").text((e=>e.message)).endChild().class("visible",(e=>e.visible)).endChild()}))},8164:()=>{__defineTemplate("VideoView",(e=>{e.beginChild("div").set("class","video-container").visible((e=>e.visible)).set("enabled",(e=>e.enabled)).class((e=>e.className)).beginChild("video").set("src",(e=>e.content)).behavoir("attach").endChild().endChild()})),__defineTemplate("VideoViewInline",(e=>{e.beginChild("video").visible((e=>e.visible)).set("enabled",(e=>e.enabled)).class((e=>e.className)).set("src",(e=>e.content)).behavoir("attach").endChild()}))},5996:()=>{__defineTemplate("WebView",(e=>{e.beginChild("iframe").class((e=>e.className)).visible((e=>e.visible)).set("enabled",(e=>e.enabled)).set("src",(e=>e.content)).behavoir("attach").endChild()}))},9095:()=>{__defineTemplate("WizardView",(e=>{e.beginChild("div").class((e=>e.className)).visible((e=>e.visible)).set("enabled",(e=>e.enabled)).beginChild("div").set("class","wizard-steps").beginChild("ul").foreach((e=>e.content),(t=>t.beginChild("li").text((e=>e.index+1)).class("active",(e=>e.isActive)).class("done",(t=>t.index<WebApp.injectProxy(t,"$parent",e.model).currentStepIndex)).endChild())).endChild().endChild().if((e=>null!=e.currentView),(e=>e.beginChild("h5").set("class","title").text((e=>e.currentView.title)).endChild().if((e=>null!=e.currentView.coverImage),(e=>e.beginChild("div").set("class","cover-image").template("Icon",(e=>e.currentView.coverImage)).endChild())).content((e=>e.currentView)))).beginChild("div").set("class","actions").content((e=>e.actions.next)).content((e=>e.actions.finish)).foreach((e=>e.currentView.actions),(e=>e.content((e=>e)))).endChild().endChild()}))},1923:(e,t,i)=>{"use strict";i.d(t,{gV:()=>s,K9:()=>n});var s=null;const n={}},1691:(e,t,i)=>{"use strict";i.d(t,{E:()=>s});var s,n=i(3163);!function(e){e.join=function(e,...t){let i="";for(const s of t)s&&(i.length>0&&(i+=e),i+=n.wI.getValue(s));return i},e.text=function(e,...t){return n.wI.getValue(e,{params:t})},e.title=function(e,...t){return n.wI.getValue(e,{params:t,usage:n.Fq.Title})},e.action=function(e,...t){return n.wI.getValue(e,{params:t,usage:n.Fq.Action})},e.tooltip=function(e,...t){return n.wI.getValue(e,{params:t,usage:n.Fq.Tooltip})},e.message=function(e,...t){return n.wI.getValue(e,{params:t,usage:n.Fq.Message})},e.numberWithCommas=function(e,t="."){return null==e||null==e?"":e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,t)},e.currency=function(e,t="â‚¬. "){return null==e||null==e?"":t+" "+e.toFixed(2)},e.replaceArgs=function(e,t){if(!e)return;let i;i="function"!=typeof t?e=>t[e]:t;let s=0,n="",a="";for(let r=0;r<e.length;r++){const o=e[r];switch(s){case 0:"{"==o?(a="",s=1):n+=o;break;case 1:"}"==o||":"==o||"="==o?(s=0,t&&(n+=i(a)),s=":"==o||"="==o?2:0):"?"!=o&&(a+=o);break;case 2:"}"==o&&(s=0)}}return n},e.replaceArgs2=function(e,t){if(!e)return e;let i;i="function"!=typeof t?e=>t[e]:t;let s="",n="",a=0;for(let t=0;t<e.length;t++){const r=e[t];switch(a){case 0:"$"==r?a=1:s+=r;break;case 1:"("==r?(a=2,n=""):(s+="$"+r,a=0);break;case 2:if(")"==r){const e=i(n);s+=JSON.stringify(e),a=0}else n+=r}}return s},e.linkify=function(e){if(!e)return"";let t,i,s,n;return i=/(\b(https?|ftp):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/gim,t=e.replace(i,'<a href="$1" target="_blank">$1</a>'),s=/(^|[^\/])(www\.[\S]+(\b|$))/gim,t=t.replace(s,'$1<a href="http://$2" target="_blank">$2</a>'),n=/(([a-zA-Z0-9\-\_\.])+@[a-zA-Z\_]+?(\.[a-zA-Z]{2,6})+)/gim,t=t.replace(n,'<a href="mailto:$1">$1</a>'),t}}(s||(s={}))},6615:(e,t,i)=>{"use strict";i.d(t,{e:()=>s});var s,n=i(1923);!function(e){e.getStringAsync=function(e){return n.K9.httpClient.requestAsync({url:e,method:"GET"})},e.postStringAsync=function(e,t){return n.K9.httpClient.requestAsync({url:e,method:"POST",data:t})},e.getJsonAsync=function(e){return n.K9.httpClient.requestAsync({url:e,method:"GET",responseType:"application/json"})},e.postJsonAsync=function(e,t){return n.K9.httpClient.requestAsync({url:e,method:"POST",responseType:"application/json",data:t})},e.postBinaryAsync=function(e,t,i){return n.K9.httpClient.requestAsync({url:e,method:"POST",responseType:"application/json",dataType:"application/octet-stream",data:t,onProgress:i})}}(s||(s={}))},2696:(e,t,i)=>{"use strict";i.d(t,{nq:()=>s,Ex:()=>n,HD:()=>a,mf:()=>r,Kn:()=>o});function s(e){return e&&"object"==typeof e&&"add"in e&&"get"in e&&"count"in e}function n(e){return s(e)&&"subscribe"in e}function a(e){return"string"==typeof e}function r(e){return"function"==typeof e}function o(e){return"object"==typeof e}},7985:(e,t,i)=>{"use strict";i.d(t,{S:()=>s});var s,n=i(1923);!function(e){var t,i;function s(e){return-1!=e.indexOf("://")}function a(e){if(!t){t="";const i=e.lastIndexOf("/");-1!=i&&(t=e.substr(0,i+1))}return t}function r(e){if(!i){i="";let t=e.indexOf("://");-1!=t&&(t=e.indexOf("/",t+4),-1!=t&&(i=e.substr(0,t+1)))}return i}e.absolute=function(e){return"./"==e.substr(0,2)||"~/"==e.substr(0,2)?r(document.URL)+n.gV.baseUrl.substr(1)+e.substr(2):"/"==e.substr(0,1)?r(document.URL)+e.substr(1):s(e)?e:a(document.URL)+e.substr(1)},e.isAbsolute=s,e.getRelativeSegment=a,e.getAbsoluteSegment=r}(s||(s={}))},81:(e,t,i)=>{"use strict";i.d(t,{k:()=>v});var s=i(2696),n=i(6196);class a{get current(){}moveNext(){return!1}reset(){}count(){return 0}}class r{_selector;_source;_foundItems;_current;constructor(e,t){this._selector=t,this._source=e,this._selector||(this._selector=e=>e),this.reset()}get current(){return this._current}moveNext(){for(;this._source.moveNext();){const e=this._selector(this._source.current);if(-1==this._foundItems.indexOf(e))return this._foundItems.push(e),this._current=e,!0}return!1}reset(){this._source.reset(),this._foundItems=[],this._current=void 0}}class o{_curIndex;_keyList;_value;constructor(e){this._keyList=Object.getOwnPropertyNames(e),this._value=e,this.reset()}get current(){return{key:this._keyList[this._curIndex],value:this._value[this._keyList[this._curIndex]]}}moveNext(){return this._curIndex++,this._curIndex<this._keyList.length}reset(){this._curIndex=-1}first(){return{key:this._keyList[0],value:this._value[this._keyList[0]]}}last(){return{key:this._keyList[this._keyList.length-1],value:this._value[this._keyList[this._keyList.length-1]]}}count(){return this._keyList.length}}class l{_curIndex;_value;constructor(e){this._value=e,this.reset()}get current(){return this._value[this._curIndex]}toArray(){return this._value}moveNext(){return this._curIndex++,this._curIndex<this._value.length}reset(){this._curIndex=-1}first(){return this._value[0]}last(){return this._value[this._value.length-1]}count(){return this._value.length}}class c{_curIndex;_value;constructor(e){this._value=e,this.reset()}get current(){return this._value.item(this._curIndex)}moveNext(){return this._curIndex++,this._curIndex<this._value.length}reset(){this._curIndex=-1}first(){return this._value.item(0)}last(){return this._value.item(this._value.length-1)}count(){return this._value.length}}class d{_selector;_source;_index;_curGroup;constructor(e,t){this._selector=t,this._source=e,this.reset()}get current(){return this._curGroup?.current}moveNext(){for(;;){for(;!this._curGroup;){if(!this._source.moveNext())return!1;this._curGroup=this._selector(this._source.current,this._index)?.getEnumerator()}if(this._curGroup){if(this._curGroup.moveNext())return this._index++,!0;this._curGroup=null}}}reset(){this._curGroup=null,this._index=-1,this._source.reset()}}class h{_selector;_source;_index;constructor(e,t){this._selector=t,this._source=e,this.reset()}get current(){return this._selector(this._source.current,this._index)}moveNext(){return this._index++,this._source.moveNext()}reset(){this._index=-1,this._source.reset()}}class u{_condition;_source;constructor(e,t){this._condition=t,this._source=e,this.reset()}get current(){return this._source.current}moveNext(){for(;this._source.moveNext();)if(this._condition(this._source.current))return!0;return!1}reset(){this._source.reset()}}class m{_source;_count;_skipped;constructor(e,t){this._count=t,this._source=e,this.reset()}get current(){return this._source.current}moveNext(){if(!this._skipped){let e=0;for(;e<this._count;){if(!this._source.moveNext())return!1;e++}this._skipped=!0}return this._source.moveNext()}reset(){this._source.reset(),this._skipped=!1}}class p{_source;_count;_taken;constructor(e,t){this._count=t,this._source=e,this.reset()}get current(){return this._source.current}moveNext(){return!(this._taken>=this._count)&&(!!this._source.moveNext()&&(this._taken++,!0))}reset(){this._source.reset(),this._taken=0}}class g{_source;_current;constructor(e){this._source=e}get current(){return this._current}moveNext(){const e=this._source.next();return!e.done&&(this._current=e.value,!0)}reset(){}}class f{_enumerator;constructor(e){this._enumerator=e}selectMany(e){return v(new d(this._enumerator,e))}select(e){return v(new h(this._enumerator,e))}ofType(e){return"prototype"in e?this.where((t=>t instanceof e)):this.where((t=>e(t)))}where(e){return v(new u(this._enumerator,e))}first(e){return e?this.where(e).first():this._enumerator.first?this._enumerator.first():(this._enumerator.reset(),this._enumerator.moveNext()?this._enumerator.current:void 0)}last(){if(this._enumerator.last)return this._enumerator.last();let e;for(this._enumerator.reset();this._enumerator.moveNext();)e=this._enumerator.current;return e}sum(e){if(e)return this.select(e).sum();let t=0;return this.foreach((e=>{t+=parseFloat(e)})),t}min(e){if(e)return this.select(e).min();let t=Number.POSITIVE_INFINITY;return this.foreach((e=>{const i=parseFloat(e);i<t&&(t=i)})),t}max(e){if(e)return this.select(e).max();let t=Number.NEGATIVE_INFINITY;return this.foreach((e=>{const i=parseFloat(e);i>t&&(t=i)})),t}avg(e){if(e)return this.select(e).avg();let t=0,i=0;return this.foreach((e=>{t+=parseFloat(e),i++})),i?t/i:NaN}count(e){if(e)return this.where(e).count();if(this._enumerator.count)return this._enumerator.count();this._enumerator.reset();let t=0;for(;this._enumerator.moveNext();)t++;return t}concat(e,t){let i="",s=0;return t||(t=e=>e.toString()),this.foreach((n=>{s>0&&(i+=e),i+=t(n),s++})),i}orderBy(e){const t=this.toArray();return t.sort(((t,i)=>e(t)-e(i))),v(t)}orderByDesc(e){const t=this.toArray();return t.sort(((t,i)=>{const s=e(t);return e(i)-s})),v(t)}distinct(e){return v(new r(this._enumerator,e))}groupBy(e,t){const i=[];if(t||(t=(e,t)=>e==t),"function"==typeof e){const s=e;this.foreach((e=>{const n=s(e);let a=v(i).first((e=>t(e.key,n)));a||(a={key:n,values:v(new l([]))},i.push(a)),a.values._enumerator.toArray().push(e)}))}return v(i)}indexOf(e){let t=0;for(this._enumerator.reset();this._enumerator.moveNext();){if(e(this._enumerator.current))return t;t++}}foreach(e){this._enumerator.reset();let t=0;for(;this._enumerator.moveNext();)e(this._enumerator.current,t),t++;return this}async foreachAsync(e,t=1){this._enumerator.reset();let i=0;for(;this._enumerator.moveNext();)await e(this._enumerator.current,i),i++;return this}any(e){return e?this.where(e).any():this._enumerator.moveNext()}contains(e,t){for(t||(t=(e,t)=>e==t),this._enumerator.reset();this._enumerator.moveNext();)if(t(this._enumerator.current,e))return!0;return!1}all(e){return!this.where((t=>!e(t))).any()}take(e){return v(new p(this._enumerator,e))}skip(e){return v(new m(this._enumerator,e))}replace(e,t){if(!(this._enumerator instanceof l))throw"Invalid enumerator, expected array";const i=this._enumerator.toArray();for(let t=0;t<i.length;t++)e(i[t])&&i[t]}toGenerator(){return function*(e){for(e._enumerator.reset();e._enumerator.moveNext();)yield e._enumerator.current}(this)}async toArrayAsync(e=1){if(this._enumerator.toArray)return this._enumerator.toArray();const t=[];let i=0;for(const s of this.toGenerator())t.push(s),i%e==0&&await(0,n.$)(0),i++;return t}toArray(){if(this._enumerator.toArray)return this._enumerator.toArray();const e=[];return this.foreach((t=>e.push(t))),e}toDictionary(e,t){t||(t=e=>e);const i={};return this.foreach((s=>i[e(s)]=t(s))),i}getEnumerator(){return this._enumerator}[Symbol.iterator](){return this._enumerator.reset(),{next:e=>({done:!this._enumerator.moveNext(),value:this._enumerator.current})}}}function v(e){let t;return t=e?Array.isArray(e)?new l(e):"getEnumerator"in e?e.getEnumerator():(0,s.nq)(e)?new l(e.toArray()):"item"in e?new c(e):"next"in e&&"function"==typeof e.next?new g(e):"current"in e&&"reset"in e&&"moveNext"in e?e:new o(e):new a,new f(t)}},168:(e,t,i)=>{"use strict";var s;i.d(t,{e:()=>s,M:()=>n});class n{static _tables={};static _currentConfig;static getKey(e){let t=e.language;return e.sector&&(t+="|"+e.sector),t}static get(e){e||(e=this._currentConfig);let t=n._tables[this.getKey(e)];return!t&&e.sector&&(t=n._tables[this.getKey({language:e.language})]),t}static add(e,t){const i=this.getKey(t),s=this._tables[i];if(s)for(const t in e)s[t]=e[t];else this._tables[i]=e}static get currentConfig(){return this._currentConfig}static set currentConfig(e){this._currentConfig=e,s=n.get()}}},3163:(e,t,i)=>{"use strict";i.d(t,{sZ:()=>s,Fq:()=>a,wI:()=>o});var s,n,a,r=i(168);!function(e){e[e.Singular=0]="Singular",e[e.Plural=1]="Plural"}(s||(s={})),function(e){e[e.Male=0]="Male",e[e.Female=1]="Female"}(n||(n={})),function(e){e[e.General=0]="General",e[e.Label=1]="Label",e[e.Column=2]="Column",e[e.Action=3]="Action",e[e.Message=4]="Message",e[e.Question=5]="Question",e[e.Title=6]="Title",e[e.Tooltip=7]="Tooltip"}(a||(a={}));var o=new class{format(e){return t=>{let i=e(t);return t&&(t.usage!==a.Column&&t.usage!==a.Label&&t.usage!==a.Action&&t.usage!==a.Title&&t.usage!==a.Question&&t.usage!==a.Tooltip&&t.usage!==a.Message||(i=i.substr(0,1).toUpperCase()+i.substr(1)),t.usage===a.Label&&(i+=":"),t.usage===a.Message&&(i+="."),t.usage===a.Question&&(i+="?")),i}}get(e){const t=r.e[e];return"string"==typeof t?o.simple(t):t}getValue(e,t){if("function"==typeof e){let i;return t&&(i=a[t]?{usage:t}:t),e(i)}return e&&r.e&&e in r.e?this.getValue(this.get(e),t):e}complex(e){return o.format((t=>{let i=0,n="",a="",r=null,o=0;t||(t={}),!t.gender&&t.params&&t.params.forEach((e=>{"function"==typeof e&&e({...t,params:[]})}));for(let l=0;l<e.length;l++){const c=e[l];switch(i){case 0:"{"==c?(a="",r=null,i=1):n+=c;break;case 1:if("}"==c){i=3,l--;break}":"==c?(r="",o=0,i=2):a+=c;break;case 2:"{"==c&&o++,"}"==c?(o--,o<0?(i=3,l--):r+=c):r+=c;break;case 3:let e;e=r?JSON.parse(r.trim()):{};let d=!0;for(;d;)d=!1,a.startsWith("*")&&(e.number=s.Plural,a=a.substr(1),d=!0),a.startsWith("!")&&(e.useArticle=!0,a=a.substr(1),d=!0),a.startsWith(".")&&(e.useArticleInd=!0,a=a.substr(1),d=!0);t.gender&&!e.gender&&(e.gender=t.gender),t.cardinality&&!e.cardinality&&(e.cardinality=t.cardinality),t.number&&!e.number&&(e.number=t.number),void 0!==t.useArticle&&void 0===e.useArticle&&(e.useArticle=t.useArticle);const h=parseInt(a);if(isNaN(h))n+=this.get(a)(e);else if(t.params&&h<t.params.length){const i=t.params[h];n+=this.getValue(i,e)}e.gender&&(t.gender=e.gender),i=0}}return n}))}adverb(e){return this.format((t=>t&&t.gender==n.Female?e.female:e.male))}appendArticle(e,t){let i=e;return"'"!=i.charAt(i.length-1)&&(i+=" "),i+t}adjective(e){return this.format((t=>{const i=t&&t.gender==n.Female?e.female:e.male,a=t&&(t.number==s.Plural||t.cardinality>1)?i.plural:i.singular;return t&&t.useArticle?this.appendArticle(a.detArticle,a.name):t&&t.useArticleInd?this.appendArticle(a.undetArticle,a.name):a.name}))}noun(e){return this.format((t=>{t||(t={}),e.gender&&(t.gender=e.gender);const i=t.number==s.Plural||t.cardinality>1?e.plural:e.singular;return t&&t.useArticle?this.appendArticle(i.detArticle,i.name):t&&t.useArticleInd?this.appendArticle(i.undetArticle,i.name):i.name}))}map(e){return t=>e(r.e)(t)}simple(e){return this.format((()=>e))}}},6196:(e,t,i)=>{"use strict";function s(e){return new Promise((t=>setTimeout(t,e)))}i.d(t,{$:()=>s})},2560:(e,t,i)=>{"use strict";i(1923),i(7985),i(81)},8349:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";var _Core_Global__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(1923),_Core_Helpers_Format__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(1691),_Core_Helpers_Http__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(6615),_Core_Linq__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(81),_Helpers_Loaders__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(2560);class DynamicPageManager{_struture;async createPageAsync(pageInfo){const curOperation=Services.operation.begin({message:"Loading page '"+pageInfo.name+"'..."}),clientPage=await this.getClientPageAsync(pageInfo.name,curOperation);clientPage.isLoded||await this.loadClientPageAsync(clientPage,curOperation);const result=eval(clientPage.action);let page;return result instanceof Promise&&(page=await result),null!=page&&(page.url=Format.replaceArgs(App.baseUrl+clientPage.url,pageInfo.args)),page.args=pageInfo.args,curOperation.end(),page}async loadComponentsAsync(e){const t=Services.operation.begin({message:"Loading page '"+e+"'..."}),i=await this.getClientPageAsync(e,t);i&&!i.isLoded&&await this.loadClientPageAsync(i,t),t.end()}async include(e){const t=await Http.getJsonAsync(e);if(t){if(t.include)for(const e of t.include)await this.include(e);if(t.components)for(const e in t.components)this._struture.components[e]=t.components[e];if(t.pages)for(const e in t.pages)this._struture.pages[e]=t.pages[e]}}async loadAppStructureAsync(e){this._struture||(this._struture={components:{},pages:{}},await this.include("~/app.json"))}async loadClientPageAsync(e,t){const i=[];e.isLoded=!0,e.scripts&&e.scripts.forEach((e=>i.push(new ScriptLoader(e)))),e.styles&&e.styles.forEach((e=>i.push(new StyleLoader(e)))),await Promise.all(linq(i).select((e=>e.loadAsync(t))).toArray())}async getClientPageAsync(e,t){await this.loadAppStructureAsync(t);const i={},s=this._struture.pages[e];return i.styles=[],i.scripts=[],i.action=s.action,i.url=s.url,this.includeClientPage(i,s.include),i}includeClientPage(e,t){t&&(t.components&&t.components.forEach((t=>this.includeClientPage(e,this._struture.components[t].include))),t.styles&&t.styles.forEach((t=>{-1==e.styles.indexOf(t)&&e.styles.push(t)})),t.scripts&&t.scripts.forEach((t=>{-1==e.scripts.indexOf(t)&&e.scripts.push(t)})))}}},7794:(e,t,i)=>{"use strict";i.d(t,{n:()=>n});var s=i(7337);class n{handleError(e,t,i){}runAsync(e){return s.Services.httpClient=new s.XHRHttpClient,this.baseUrl=e.baseUrl,Promise.resolve()}startupArgs;appName;baseUrl;isDev;language}},1055:(e,t,i)=>{"use strict";i.d(t,{z:()=>n});var s=i(117);class n{_onSelected;_element;_mouseDown;constructor(){for(var e in s.yh)this.addColor(s.yh[e][600]);this._mouseDown=e=>this.onMouseDown(e)}attachNode(e){this._element=e,document.body.appendChild(this._element)}async pick(){return await this.open(),new Promise((e=>this._onSelected=e))}addColor(e){this.colors.push({value:e,select:()=>{this._onSelected&&this._onSelected(e),this._onSelected=null,this.close()}})}async open(){if(!this.isOpened()){if(this.isOpened(!0),window.event){const e=window.event,t={x:e.pageX,y:e.pageY};this._element.style.left=t.x+"px",this._element.style.top=t.y-this._element.clientHeight+"px"}document.body.addEventListener("mousedown",this._mouseDown)}}close(){this.isOpened()&&(this.isOpened(!1),document.body.removeEventListener("mousedown",this._mouseDown))}onMouseDown(e){e.target.parentElement!=this._element&&(this._onSelected&&this._onSelected(void 0),this._onSelected=null,this.close())}isOpened=ko.observable(!1);colors=[];static instance=new n}},1310:(e,t,i)=>{"use strict";i.d(t,{X:()=>r});var s=i(306),n=i(6403),a=i(7337),r={name:"COVID-19",empty:{currentPositive:void 0,historicDeaths:{2015:void 0,2016:void 0,2017:void 0,2018:void 0,2019:void 0,2020:void 0},toatlTests:void 0,totalDeath:void 0,totalHealed:void 0,totalHospedalized:void 0,totalPositive:void 0,totalSevere:void 0,totalCaseTested:void 0,newICU:void 0,totalAntigenicPositive:void 0,totalAntigenicTests:void 0,totalMolecularPositive:void 0,totalMolecularTests:void 0},indicators:[{id:"totalPositive",name:$string("$(total-positive)"),colorLight:"#f44336",colorDark:"#b71c1c",validFor:["region","country","district"],showInFavorites:!0,compute:new n.mM((e=>e.totalPositive))},{id:"totalAntigenicPositive",name:$string("$(antigenic-positive)"),colorLight:"#f44336",colorDark:"#b71c1c",validFor:["region","country"],showInFavorites:!0,compute:new n.mM((e=>e.totalAntigenicPositive))},{id:"totalMolecularPositive",name:$string("$(molecular-positive)"),colorLight:"#f44336",colorDark:"#b71c1c",validFor:["region","country"],showInFavorites:!0,compute:new n.mM((e=>e.totalMolecularPositive))},{id:"currentPositive",name:$string("$(current-positive)"),validFor:["region","country"],colorLight:"#e91e63",colorDark:"#880e4f",showInFavorites:!0,compute:new n.mM((e=>e.currentPositive))},{id:"totalDeath",name:$string("$(death)"),validFor:["region","country"],colorLight:"#9c27b0",colorDark:"#4a148c",showInFavorites:!0,compute:new n.mM((e=>e.totalDeath))},{id:"totalSevere",name:$string("$(severe)"),validFor:["region","country"],colorLight:"#ff9800",colorDark:"#e65100",showInFavorites:!0,compute:new n.mM((e=>e.totalSevere))},{id:"newICU",name:$string("$(newICU)"),validFor:["region","country"],colorLight:"#ff9800",colorDark:"#e65100",showInFavorites:!0,compute:new n.mM((e=>e.newICU))},{id:"totalHospedalized",name:$string("$(hospedalized)"),validFor:["region","country"],colorLight:"#fdd835",colorDark:"#fbc02d",showInFavorites:!0,compute:new n.mM((e=>e.totalHospedalized))},{id:"totalHealed",name:$string("$(healed)"),validFor:["region","country"],colorLight:"#4caf50",colorDark:"#1b5e20",showInFavorites:!0,compute:new n.mM((e=>e.totalHealed))},{id:"toatlTests",name:$string("$(tested)"),validFor:["region","country"],colorLight:"#03a9f4",colorDark:"#01579b",showInFavorites:!0,compute:new n.mM((e=>e.toatlTests))},{id:"totalCaseTested",name:$string("$(caseTested)"),validFor:["region","country"],colorLight:"#03a9f4",colorDark:"#01579b",showInFavorites:!0,compute:new n.mM((e=>e.totalCaseTested))},{id:"totalMolecularTests",name:$string("$(molecularTests)"),validFor:["region","country"],colorLight:"#03a9f4",colorDark:"#01579b",showInFavorites:!0,compute:new n.mM((e=>e.totalMolecularTests))},{id:"totalAntigenicTests",name:$string("$(antigenicTests)"),validFor:["region","country"],colorLight:"#03a9f4",colorDark:"#01579b",showInFavorites:!0,compute:new n.mM((e=>e.totalAntigenicTests))},{id:"surface",name:$string("$(surface) ($(geo))"),validFor:["region","district"],colorLight:"#777",colorDark:"#222",showInFavorites:!1,compute:new n.YH(((e,t)=>(0,a.round)(t.surface,0)))},{id:"density",name:$string("$(density) ($(geo))"),validFor:["region","district"],colorLight:"#777",colorDark:"#222",showInFavorites:!1,compute:new n.YH(((e,t)=>(0,a.round)(t.demography.total/t.surface,0)))},{id:"death2020",name:$string("$(total-death) +60 (2020)*"),validFor:["details"],colorLight:"#9c27b0",colorDark:"#4a148c",showInFavorites:!0,compute:new n.mM((e=>e.historicDeaths?e.historicDeaths[2020]:void 0))},{id:"death2019",name:$string("$(total-death) +60 (2019)"),validFor:["region","district","details"],colorLight:"#9c27b0",colorDark:"#4a148c",showInFavorites:!0,compute:new n.mM((e=>e.historicDeaths?e.historicDeaths[2019]:void 0))},{id:"death2018",name:$string("$(total-death) +60 (2018)"),validFor:["region","district","details"],colorLight:"#9c27b0",colorDark:"#4a148c",showInFavorites:!1,compute:new n.mM((e=>e.historicDeaths?e.historicDeaths[2018]:void 0))},{id:"death2017",name:$string("$(total-death) +60 (2017)"),validFor:["region","district","details"],colorLight:"#9c27b0",colorDark:"#4a148c",showInFavorites:!1,compute:new n.mM((e=>e.historicDeaths?e.historicDeaths[2017]:void 0))},{id:"death-diff-2020-2019",name:$string("DIff. decessi 2020-19"),validFor:["details"],colorLight:"#f44336",colorDark:"#b71c1c",gradient:new s.o("#00c853","#bdbdbd","#ff1744"),canBeNegative:!0,compute:new n.Jx({death2019:new n.mM((e=>e.historicDeaths[2019])),death2020:new n.mM((e=>e.historicDeaths[2020]))},(e=>(0,a.isNaNOrNull)(e.death2020)||(0,a.isNaNOrNull)(e.death2019)?void 0:e.death2020-e.death2019))},{id:"population",name:$string("$(population) ($(geo))"),validFor:["region","district","details","country"],colorLight:"#777",colorDark:"#222",showInFavorites:!1,compute:new n.YH(((e,t)=>t.demography.total))},{id:"populationOld",name:$string("$(population) +65 ($(geo))"),validFor:["region","district","country"],colorLight:"#777",colorDark:"#222",showInFavorites:!1,compute:new n.YH(((e,t)=>t.demography.over65))}],factors:[{id:"none",name:$string("$(none)"),compute:new n.NI(((e,t,i)=>e)),format:e=>formatNumber(e),reference:(e,t)=>"N/A",description:$string("[indicator]")},{id:"population",validFor:["region","country","details","district"],name:$string("$(population)"),compute:new n.NI(((e,t,i)=>1e5*(0,a.divideNull)(e,i.demography.total))),format:e=>formatNumber(e),reference:(e,t)=>formatNumber(t.demography.total),description:$string("[indicator] $(every-100k)")},{id:"populationOld",validFor:["region","country","district"],name:$string("$(population) +65"),compute:new n.NI(((e,t,i)=>1e5*(0,a.divideNull)(e,i.demography.over65))),format:e=>formatNumber((0,a.round)(e,1)),reference:(e,t)=>formatNumber(t.demography.over65),description:$string("[indicator] $(every-100k) +65")},{id:"density",name:$string("$(density)"),validFor:["region","country","district"],compute:new n.NI(((e,t,i)=>1e5*(0,a.divideNull)(e,(0,a.divideNull)(i.demography.total,i.surface)))),format:e=>formatNumber((0,a.round)(e,1)),reference:(e,t)=>formatNumber((0,a.round)(t.demography.total/t.surface,1)),description:$string("[indicator] $(over-density)")},{id:"totalPositive",name:$string("$(total-positive)"),validFor:["region","country"],compute:new n.TC(((e,t)=>(0,a.isNaNOrNull)(e)?void 0:e/t*100),new n.mM((e=>e.totalPositive))),format:e=>(0,a.round)(e,1)+"%",reference:(e,t)=>formatNumber(e.totalPositive),description:$string("% [indicator] $(over-total-positive)")},{id:"currentPositive",name:$string("$(current-positive)"),validFor:["region","country"],compute:new n.TC(((e,t)=>(0,a.isNaNOrNull)(e)?void 0:e/t*100),new n.mM((e=>e.currentPositive))),format:e=>(0,a.round)(e,1)+"%",reference:(e,t)=>formatNumber(e.totalPositive),description:$string("% [indicator] $(over-current-positive)")},{id:"severe",name:$string("$(severe)"),validFor:["region","country"],compute:new n.TC(((e,t)=>(0,a.isNaNOrNull)(e)?void 0:e/t*100),new n.mM((e=>e.totalSevere))),format:e=>(0,a.round)(e,1)+"%",reference:(e,t)=>formatNumber(e.totalSevere),description:$string("% [indicator] $(over-severe)")},{id:"test",name:$string("$(tested)"),validFor:["region","country"],compute:new n.TC(((e,t)=>(0,a.isNaNOrNull)(e)?void 0:e/t*100),new n.mM((e=>e.toatlTests))),format:e=>(0,a.round)(e,1)+"%",reference:(e,t)=>formatNumber(e.toatlTests),description:$string("% [indicator] $(over-tested)")},{id:"caseTested",name:$string("$(caseTested)"),validFor:["region","country"],compute:new n.TC(((e,t)=>(0,a.isNaNOrNull)(e)?void 0:e/t*100),new n.mM((e=>e.totalCaseTested))),format:e=>(0,a.round)(e,1)+"%",reference:(e,t)=>formatNumber(e.totalCaseTested),description:$string("% [indicator] $(over-case-tested)")},{id:"death2019Perc",name:$string("$(total-death) +60 (2019)"),validFor:["details"],compute:new n.TC(((e,t)=>(0,a.isNaNOrNull)(e)?void 0:e/t*100),new n.mM((e=>e.historicDeaths[2019]))),format:e=>(0,a.isNaNOrNull)(e)?"N/A":(e>0?"+":"")+(0,a.round)(e,1)+"%",reference:(e,t)=>formatNumber(e.historicDeaths[2019]),description:$string("% [indicator] $(over-tested)")}]}},2407:(e,t,i)=>{"use strict";i.d(t,{k:()=>n});var s=i(7337);class n{_days;constructor(e){this._days=e.days}get days(){const e=this.startDay??0,t=this.endDay??this._days.length-1;return(0,s.linq)(this._days).skip(e).take(t-e+1)}get(e){return e="string"==typeof e?parseInt(e):e,this._days[(this.startDay??0)+e]}get count(){const e=this.startDay??0;return(this.endDay??this._days.length-1)-e+1}startDay;endDay}},4964:(e,t,i)=>{"use strict";i.d(t,{O:()=>n});var s=i(117),n={district:{label:{singular:$string("$(district)"),plural:$string("$(districts)")},mapGroup:"group_district",tab:"districtTab",areaType:s.Wh.District,validateId:e=>"d"==e[0].toLowerCase()},region:{label:{singular:$string("$(region)"),plural:$string("$(regions)")},mapGroup:"group_region",tab:"regionTab",areaType:s.Wh.Region,validateId:e=>"r"==e[0].toLowerCase()},country:{label:{singular:$string("$(italian)"),plural:$string("$(italians)")},mapGroup:"group_country",tab:"italyTab",areaType:s.Wh.Country,validateId:e=>"it"==e.toLowerCase()},details:{label:{singular:$string("$(area-details)"),plural:$string("$(area-details)")},mapGroup:"group_municipality",tab:"detailsTab",areaType:s.Wh.Municipality,validateId:e=>"m"==e[0].toLowerCase()}}},8280:()=>{window.ko&&(ko.bindingHandlers.attach={init:(e,t,i,s)=>{let n=ko.unwrap(t());if(!0!==n&&null!=n||(n=s.attachNode),"function"!=typeof n)throw"Supplied argument is not a function";setTimeout((()=>n.call(s,e)))}})},306:(e,t,i)=>{"use strict";i.d(t,{o:()=>n});var s=i(7337);class n{constructor(...e){e.length>0?"string"==typeof e[0]?this.colors=(0,s.linq)(e).select((e=>new a(e))).toArray():this.colors=e:this.colors=[]}valueAt(e){if(e<0)return this.colors[0];e>1&&this.colors[this.colors.length-1];const t=1/(this.colors.length-1),i=Math.floor(e/t),s=Math.ceil(e/t),n=(e-i*t)/t,r=this.colors[i],o=this.colors[s],l=new a;return l.r=r.r+(o.r-r.r)*n,l.g=r.g+(o.g-r.g)*n,l.b=r.b+(o.b-r.b)*n,l}colors}class a{constructor(e){e&&this.fromHex(e)}fromHex(e){4==e.length?(this.r=parseInt("0x"+e[1]+e[1])/255,this.g=parseInt("0x"+e[2]+e[2])/255,this.b=parseInt("0x"+e[3]+e[3])/255):(this.r=parseInt("0x"+e[1]+e[2])/255,this.g=parseInt("0x"+e[3]+e[4])/255,this.b=parseInt("0x"+e[5]+e[6])/255)}toString(){function e(e){let t=Math.round(255*e).toString(16);return 1==t.length?"0"+t:t}return"#"+e(this.r)+e(this.g)+e(this.b)}r=0;g=0;b=0}},2233:(e,t,i)=>{"use strict";function s(e){return e.substr(0,1).toUpperCase()+e.substr(1)}function n(e){let t=e.parentElement,i=t.querySelector(".section-content");t.classList.contains("closed")?(i.style.removeProperty("display"),t.classList.remove("closed")):(t.classList.add("closed"),setTimeout((()=>i.style.display="none"),300))}i.d(t,{E:()=>s,D:()=>n}),HTMLCanvasElement.prototype.toBlob||Object.defineProperty(HTMLCanvasElement.prototype,"toBlob",{value:function(e,t,i){let s=this;setTimeout((()=>{const n=atob(s.toDataURL(t,i).split(",")[1]),a=n.length,r=new Uint8Array(a);for(let e=0;e<a;e++)r[e]=n.charCodeAt(e);e(new Blob([r],{type:t||"image/png"}))}))}})},6403:(e,t,i)=>{"use strict";i.d(t,{YH:()=>n,mM:()=>a,Jx:()=>r,NI:()=>o,TC:()=>l,kN:()=>c});var s=i(7337);class n{_value;constructor(e){this._value=e}value(e,t,i,n,a){let r=this._value(e,a);if(i)for(var o in i)r=(0,s.sumNull)(r,-this.value(i[o],n[o],null,null,a));return r}}class a{_value;constructor(e){this._value=e}value(e,t,i,s,n){var a=this._value(e,n);if(t&&(a-=this._value(t,n)),i)for(var r in i)a-=this.value(i[r],s[r],null,null,n);return a}}class r{_value;_indicators;constructor(e,t){this._value=t,this._indicators=e}value(e,t,i,s,n){const a={};for(var r in this._indicators)a[r]=this._indicators[r].value(e,t,i,s,n);return this._value(a)}}class o{_value;constructor(e){this._value=e}value(e,t,i,n,a,r){let o;for(var l in e)o=(0,s.sumNull)(o,r.value(e[l],t[l],i[l],n[l],a));return this._value(o,e[0],a)}}class l{_value;_factor;constructor(e,t){this._value=e,this._factor=t}value(e,t,i,n,a,r){let o,l;for(var c in e)o=(0,s.sumNull)(o,r.value(e[c],t[c],i[c],n[c],a)),l=(0,s.sumNull)(l,this._factor.value(e[c],t[c],i[c],n[c],a));return this._value(o,l)}}class c{constructor(e,t,i){this.data=e,this.dataSet=t,this.geo=i}getDataAtDay(e,t){if(e<0)return;const i=this.data.get(e);if(i){const e=i.values[t];if(e)return e}return this.dataSet.empty}getFactorValue(e){const t=("string"==typeof e.areaOrId?e.areaOrId:e.areaOrId.id).toLowerCase();let i;i=Array.isArray(e.dayNumberOrGroup)?e.dayNumberOrGroup:[e.dayNumberOrGroup];let n=[],a=[],r=[],o=[];for(var l of i)if(n.push(this.getDataAtDay(l,t)),e.isDayDelta&&a.push(this.getDataAtDay(l-1,t)),e.execludedAreas){var c=[],d=[];for(var h of e.execludedAreas)c.push(this.getDataAtDay(l,h.toLowerCase())),e.isDayDelta&&d.push(this.getDataAtDay(l-1,h.toLowerCase()));r.push(c),o.push(d)}const u=(0,s.linq)(this.dataSet.factors).first((t=>t.id==e.factorId)),m=(0,s.linq)(this.dataSet.indicators).first((t=>t.id==e.indicatorId));return u.compute.value(n,a,r,o,this.geo.areas[t],m.compute)}getIndicatorValue(e){const t=("string"==typeof e.areaOrId?e.areaOrId:e.areaOrId.id).toLowerCase(),i=(0,s.linq)(this.dataSet.indicators).first((t=>t.id==e.indicatorId));let n,a,r,o=this.getDataAtDay(e.dayNumber,t);if(e.isDayDelta&&(n=this.getDataAtDay(e.dayNumber-1,t)),e.execludedAreas)for(var l of(a=[],r=[],e.execludedAreas))a.push(this.getDataAtDay(e.dayNumber,l.toLowerCase())),e.isDayDelta&&r.push(this.getDataAtDay(e.dayNumber-1,l.toLowerCase()));return i.compute.value(o,n,a,r,this.geo.areas[t])}getSerie(e){const t=[];let i=e.startDay+(e.isDelta?1:0);if(e.groupSize>1){let s=e.groupSize,n=[];this.data.days.skip(i).foreach((a=>{if(n.push(i),s--,0==s){const r={x:"date"==e.xAxis?new Date(a.date):i,y:this.getFactorValue({dayNumberOrGroup:e.isDelta?n:i,areaOrId:e.areaId,factorId:e.factorId,indicatorId:e.indicatorId,execludedAreas:e.exeludedAreaIds,isDayDelta:e.isDelta})};t.push(r),s=e.groupSize,n=[]}i++}))}else this.data.days.skip(i).foreach((s=>{const n={x:"date"==e.xAxis?new Date(s.date):i,y:this.getFactorValue({dayNumberOrGroup:i,areaOrId:e.areaId,factorId:e.factorId,indicatorId:e.indicatorId,execludedAreas:e.exeludedAreaIds,isDayDelta:e.isDelta})};t.push(n),i++}));return t}data;dataSet;geo}},9323:(e,t,i)=>{"use strict";i.d(t,{b:()=>F});var s=i(2370),n=i(1310),a=i(2407),r=i(4964),o=i(306),l=i(7337);class c{_closeTimeoutId;_element;_closeAfter;constructor(e,t){this.value=e,this._closeAfter=t}dontShowAgain(){}onActionExecuted(){}executeAction(){this.value.showAction&&this.value.showAction(),setTimeout((()=>this.startPulse())),this.onActionExecuted()}startPulse(){if(this._element=document.querySelector(this.value.elementSelector),!this._element)return;let e=(0,l.centerElement)(this._element);(0,l.addClass)(this._element,"pulse");let t=document.querySelector(".tip-container");e<t.clientTop+t.clientHeight&&this.isTransparent(!0)}stopPulse(){this._element&&((0,l.removeClass)(this._element,"pulse"),this.isTransparent(!1))}next(){}understood(){}onClose(){}close(){clearTimeout(this._closeTimeoutId),this.stopPulse(),this.isVisible(!1),this.onClose()}show(){this._closeTimeoutId&&clearTimeout(this._closeTimeoutId),this.isVisible(!0),this._closeAfter&&(this._closeTimeoutId=setTimeout((()=>this.close()),this._closeAfter))}value;isVisible=ko.observable(!1);isTransparent=ko.observable(!1)}class d{_getPreferences;_tips;constructor(e,t,i){this._getPreferences=t,this._tips=e,this.savePreferences=i}get preferences(){return this._getPreferences()}savePreferences(){}markAction(e,t){this.preferences.actions[e]++,this.savePreferences(),window.gtag&&(0,l.safeCall)((()=>gtag("event",e,{event_category:"GeoPlot",event_label:t,value:this.preferences.actions[e]})))}markTip(e,t){window.gtag&&(0,l.safeCall)((()=>gtag("event",t,{event_category:"GeoPlot/Tip",event_label:e})))}engageUser(){if(null!=this.preferences.showTips&&!this.preferences.showTips)return;const e=(0,l.linq)(this._tips).where((e=>e.value.showAfter>0&&0==this.preferences.actions[e.key])).first();this.showTip(e.key,{onClose:()=>this.engageUser(),timeout:e.value.showAfter})||this.engageUser()}showTip(e,t){if(null!=this.preferences.showTips&&!this.preferences.showTips)return!1;if((!t||!t.override)&&this.tip()&&this.tip().isVisible())return!1;if((!t||!t.force)&&this.preferences.actions[e])return!1;const i=this._tips[e],s=new c(i);s.onActionExecuted=()=>{this.markTip(e,"how")},s.dontShowAgain=()=>{this.preferences.showTips=!1,this.savePreferences(),s.close(),this.markTip(e,"dontShowAgain")},s.understood=()=>{this.preferences.actions[e]++,this.savePreferences(),s.close(),this.markTip(e,"understood")},s.onClose=()=>{t&&t.onClose&&t.onClose()};let n=(0,l.linq)(this._tips).where((e=>e.value.order>i.order&&0==this.preferences.actions[e.key])).first();return s.next=n?()=>{s.close(),this.preferences.actions[e]++,this.showTip(n.key),this.markTip(e,"next")}:null,this.tip(s),setTimeout((()=>s.show()),t&&t.timeout?1e3*t.timeout:0),!0}tip=ko.observable()}var h=i(6403),u={lessThanXSeconds:{one:"meno di un secondo",other:"meno di {{count}} secondi"},xSeconds:{one:"un secondo",other:"{{count}} secondi"},halfAMinute:"alcuni secondi",lessThanXMinutes:{one:"meno di un minuto",other:"meno di {{count}} minuti"},xMinutes:{one:"un minuto",other:"{{count}} minuti"},aboutXHours:{one:"circa un'ora",other:"circa {{count}} ore"},xHours:{one:"un'ora",other:"{{count}} ore"},xDays:{one:"un giorno",other:"{{count}} giorni"},aboutXWeeks:{one:"circa una settimana",other:"circa {{count}} settimane"},xWeeks:{one:"una settimana",other:"{{count}} settimane"},aboutXMonths:{one:"circa un mese",other:"circa {{count}} mesi"},xMonths:{one:"un mese",other:"{{count}} mesi"},aboutXYears:{one:"circa un anno",other:"circa {{count}} anni"},xYears:{one:"un anno",other:"{{count}} anni"},overXYears:{one:"piÃ¹ di un anno",other:"piÃ¹ di {{count}} anni"},almostXYears:{one:"quasi un anno",other:"quasi {{count}} anni"}};function m(e){return function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=t.width?String(t.width):e.defaultWidth,s=e.formats[i]||e.formats[e.defaultWidth];return s}}var p={date:m({formats:{full:"EEEE d MMMM y",long:"d MMMM y",medium:"d MMM y",short:"dd/MM/y"},defaultWidth:"full"}),time:m({formats:{full:"HH:mm:ss zzzz",long:"HH:mm:ss z",medium:"HH:mm:ss",short:"HH:mm"},defaultWidth:"full"}),dateTime:m({formats:{full:"{{date}} {{time}}",long:"{{date}} {{time}}",medium:"{{date}} {{time}}",short:"{{date}} {{time}}"},defaultWidth:"full"})};function g(e,t){if(t.length<e)throw new TypeError(e+" argument"+(e>1?"s":"")+" required, but only "+t.length+" present")}function f(e){g(1,arguments);var t=Object.prototype.toString.call(e);return e instanceof Date||"object"==typeof e&&"[object Date]"===t?new Date(e.getTime()):"number"==typeof e||"[object Number]"===t?new Date(e):("string"!=typeof e&&"[object String]"!==t||"undefined"==typeof console||(console.warn("Starting with v2.0.0-beta.1 date-fns doesn't accept strings as date arguments. Please use `parseISO` to parse strings. See: https://git.io/fjule"),console.warn((new Error).stack)),new Date(NaN))}function v(e){if(null===e||!0===e||!1===e)return NaN;var t=Number(e);return isNaN(t)?t:t<0?Math.ceil(t):Math.floor(t)}function y(e,t){g(1,arguments);var i=t||{},s=i.locale,n=s&&s.options&&s.options.weekStartsOn,a=null==n?0:v(n),r=null==i.weekStartsOn?a:v(i.weekStartsOn);if(!(r>=0&&r<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");var o=f(e),l=o.getUTCDay(),c=(l<r?7:0)+l-r;return o.setUTCDate(o.getUTCDate()-c),o.setUTCHours(0,0,0,0),o}function b(e,t,i){g(2,arguments);var s=y(e,i),n=y(t,i);return s.getTime()===n.getTime()}var _=["domenica","lunedÃ¬","martedÃ¬","mercoledÃ¬","giovedÃ¬","venerdÃ¬","sabato"];function w(e){return"'"+_[e]+" alle' p"}var C={lastWeek:function(e,t,i){var s=e.getUTCDay();return b(e,t,i)?w(s):function(e){return 0===e?"'domenica scorsa alle' p":"'"+_[e]+" scorso alle' p"}(s)},yesterday:"'ieri alle' p",today:"'oggi alle' p",tomorrow:"'domani alle' p",nextWeek:function(e,t,i){var s=e.getUTCDay();return b(e,t,i)?w(s):function(e){return 0===e?"'domenica prossima alle' p":"'"+_[e]+" prossimo alle' p"}(s)},other:"P"};function A(e){return function(t,i){var s,n=i||{};if("formatting"===(n.context?String(n.context):"standalone")&&e.formattingValues){var a=e.defaultFormattingWidth||e.defaultWidth,r=n.width?String(n.width):a;s=e.formattingValues[r]||e.formattingValues[a]}else{var o=e.defaultWidth,l=n.width?String(n.width):e.defaultWidth;s=e.values[l]||e.values[o]}return s[e.argumentCallback?e.argumentCallback(t):t]}}function x(e){return function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=t.match(e.matchPattern);if(!s)return null;var n=s[0],a=t.match(e.parsePattern);if(!a)return null;var r=e.valueCallback?e.valueCallback(a[0]):a[0];r=i.valueCallback?i.valueCallback(r):r;var o=t.slice(n.length);return{value:r,rest:o}}}function I(e){return function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=i.width,n=s&&e.matchPatterns[s]||e.matchPatterns[e.defaultMatchWidth],a=t.match(n);if(!a)return null;var r,o=a[0],l=s&&e.parsePatterns[s]||e.parsePatterns[e.defaultParseWidth],c=Array.isArray(l)?V(l,(function(e){return e.test(o)})):S(l,(function(e){return e.test(o)}));r=e.valueCallback?e.valueCallback(c):c,r=i.valueCallback?i.valueCallback(r):r;var d=t.slice(o.length);return{value:r,rest:d}}}function S(e,t){for(var i in e)if(e.hasOwnProperty(i)&&t(e[i]))return i}function V(e,t){for(var i=0;i<e.length;i++)if(t(e[i]))return i}const E={code:"it",formatDistance:function(e,t,i){var s;return i=i||{},s="string"==typeof u[e]?u[e]:1===t?u[e].one:u[e].other.replace("{{count}}",t),i.addSuffix?i.comparison>0?"tra "+s:s+" fa":s},formatLong:p,formatRelative:function(e,t,i,s){var n=C[e];return"function"==typeof n?n(t,i,s):n},localize:{ordinalNumber:function(e){return Number(e)+"Âº"},era:A({values:{narrow:["aC","dC"],abbreviated:["a.C.","d.C."],wide:["avanti Cristo","dopo Cristo"]},defaultWidth:"wide"}),quarter:A({values:{narrow:["1","2","3","4"],abbreviated:["T1","T2","T3","T4"],wide:["1Âº trimestre","2Âº trimestre","3Âº trimestre","4Âº trimestre"]},defaultWidth:"wide",argumentCallback:function(e){return Number(e)-1}}),month:A({values:{narrow:["G","F","M","A","M","G","L","A","S","O","N","D"],abbreviated:["gen","feb","mar","apr","mag","giu","lug","ago","set","ott","nov","dic"],wide:["gennaio","febbraio","marzo","aprile","maggio","giugno","luglio","agosto","settembre","ottobre","novembre","dicembre"]},defaultWidth:"wide"}),day:A({values:{narrow:["D","L","M","M","G","V","S"],short:["dom","lun","mar","mer","gio","ven","sab"],abbreviated:["dom","lun","mar","mer","gio","ven","sab"],wide:["domenica","lunedÃ¬","martedÃ¬","mercoledÃ¬","giovedÃ¬","venerdÃ¬","sabato"]},defaultWidth:"wide"}),dayPeriod:A({values:{narrow:{am:"m.",pm:"p.",midnight:"mezzanotte",noon:"mezzogiorno",morning:"mattina",afternoon:"pomeriggio",evening:"sera",night:"notte"},abbreviated:{am:"AM",pm:"PM",midnight:"mezzanotte",noon:"mezzogiorno",morning:"mattina",afternoon:"pomeriggio",evening:"sera",night:"notte"},wide:{am:"AM",pm:"PM",midnight:"mezzanotte",noon:"mezzogiorno",morning:"mattina",afternoon:"pomeriggio",evening:"sera",night:"notte"}},defaultWidth:"wide",formattingValues:{narrow:{am:"m.",pm:"p.",midnight:"mezzanotte",noon:"mezzogiorno",morning:"di mattina",afternoon:"del pomeriggio",evening:"di sera",night:"di notte"},abbreviated:{am:"AM",pm:"PM",midnight:"mezzanotte",noon:"mezzogiorno",morning:"di mattina",afternoon:"del pomeriggio",evening:"di sera",night:"di notte"},wide:{am:"AM",pm:"PM",midnight:"mezzanotte",noon:"mezzogiorno",morning:"di mattina",afternoon:"del pomeriggio",evening:"di sera",night:"di notte"}},defaultFormattingWidth:"wide"})},match:{ordinalNumber:x({matchPattern:/^(\d+)(Âº)?/i,parsePattern:/\d+/i,valueCallback:function(e){return parseInt(e,10)}}),era:I({matchPatterns:{narrow:/^(aC|dC)/i,abbreviated:/^(a\.?\s?C\.?|a\.?\s?e\.?\s?v\.?|d\.?\s?C\.?|e\.?\s?v\.?)/i,wide:/^(avanti Cristo|avanti Era Volgare|dopo Cristo|Era Volgare)/i},defaultMatchWidth:"wide",parsePatterns:{any:[/^a/i,/^(d|e)/i]},defaultParseWidth:"any"}),quarter:I({matchPatterns:{narrow:/^[1234]/i,abbreviated:/^t[1234]/i,wide:/^[1234](Âº)? trimestre/i},defaultMatchWidth:"wide",parsePatterns:{any:[/1/i,/2/i,/3/i,/4/i]},defaultParseWidth:"any",valueCallback:function(e){return e+1}}),month:I({matchPatterns:{narrow:/^[gfmalsond]/i,abbreviated:/^(gen|feb|mar|apr|mag|giu|lug|ago|set|ott|nov|dic)/i,wide:/^(gennaio|febbraio|marzo|aprile|maggio|giugno|luglio|agosto|settembre|ottobre|novembre|dicembre)/i},defaultMatchWidth:"wide",parsePatterns:{narrow:[/^g/i,/^f/i,/^m/i,/^a/i,/^m/i,/^g/i,/^l/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ge/i,/^f/i,/^mar/i,/^ap/i,/^mag/i,/^gi/i,/^l/i,/^ag/i,/^s/i,/^o/i,/^n/i,/^d/i]},defaultParseWidth:"any"}),day:I({matchPatterns:{narrow:/^[dlmgvs]/i,short:/^(do|lu|ma|me|gi|ve|sa)/i,abbreviated:/^(dom|lun|mar|mer|gio|ven|sab)/i,wide:/^(domenica|luned[i|Ã¬]|marted[i|Ã¬]|mercoled[i|Ã¬]|gioved[i|Ã¬]|venerd[i|Ã¬]|sabato)/i},defaultMatchWidth:"wide",parsePatterns:{narrow:[/^d/i,/^l/i,/^m/i,/^m/i,/^g/i,/^v/i,/^s/i],any:[/^d/i,/^l/i,/^ma/i,/^me/i,/^g/i,/^v/i,/^s/i]},defaultParseWidth:"any"}),dayPeriod:I({matchPatterns:{narrow:/^(a|m\.|p|mezzanotte|mezzogiorno|(di|del) (mattina|pomeriggio|sera|notte))/i,any:/^([ap]\.?\s?m\.?|mezzanotte|mezzogiorno|(di|del) (mattina|pomeriggio|sera|notte))/i},defaultMatchWidth:"any",parsePatterns:{any:{am:/^a/i,pm:/^p/i,midnight:/^mezza/i,noon:/^mezzo/i,morning:/mattina/i,afternoon:/pomeriggio/i,evening:/sera/i,night:/notte/i}},defaultParseWidth:"any"})},options:{weekStartsOn:1,firstWeekContainsDate:4}};var k={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}};const T=function(e,t,i){var s,n=k[e];return s="string"==typeof n?n:1===t?n.one:n.other.replace("{{count}}",t.toString()),null!=i&&i.addSuffix?i.comparison&&i.comparison>0?"in "+s:s+" ago":s};var N={date:m({formats:{full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},defaultWidth:"full"}),time:m({formats:{full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},defaultWidth:"full"}),dateTime:m({formats:{full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},defaultWidth:"full"})};var P={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"};const D={code:"en-US",formatDistance:T,formatLong:N,formatRelative:function(e,t,i,s){return P[e]},localize:{ordinalNumber:function(e,t){var i=Number(e),s=i%100;if(s>20||s<10)switch(s%10){case 1:return i+"st";case 2:return i+"nd";case 3:return i+"rd"}return i+"th"},era:A({values:{narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},defaultWidth:"wide"}),quarter:A({values:{narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},defaultWidth:"wide",argumentCallback:function(e){return e-1}}),month:A({values:{narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},defaultWidth:"wide"}),day:A({values:{narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},defaultWidth:"wide"}),dayPeriod:A({values:{narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},defaultWidth:"wide",formattingValues:{narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},defaultFormattingWidth:"wide"})},match:{ordinalNumber:x({matchPattern:/^(\d+)(th|st|nd|rd)?/i,parsePattern:/\d+/i,valueCallback:function(e){return parseInt(e,10)}}),era:I({matchPatterns:{narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},defaultMatchWidth:"wide",parsePatterns:{any:[/^b/i,/^(a|c)/i]},defaultParseWidth:"any"}),quarter:I({matchPatterns:{narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},defaultMatchWidth:"wide",parsePatterns:{any:[/1/i,/2/i,/3/i,/4/i]},defaultParseWidth:"any",valueCallback:function(e){return e+1}}),month:I({matchPatterns:{narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},defaultMatchWidth:"wide",parsePatterns:{narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},defaultParseWidth:"any"}),day:I({matchPatterns:{narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},defaultMatchWidth:"wide",parsePatterns:{narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},defaultParseWidth:"any"}),dayPeriod:I({matchPatterns:{narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},defaultMatchWidth:"any",parsePatterns:{any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},defaultParseWidth:"any"})},options:{weekStartsOn:0,firstWeekContainsDate:1}};class L{select(){}indicator;value=ko.observable()}class ${select(){}value;data=ko.observable();factor=ko.observable();indicator=ko.observable();reference=ko.observable();indicators=ko.observable()}class F{_mainData;_mainGeo;_detailsData;_detailsGeo;_selectedArea;Ã¹;_chart;_daysData;_topAreasVisible=!1;_mapSvg;_execludedArea=new Map;_dataSet=n.X;_keepState=!1;_debugMode=!1;_preferences;_calculator;_tips={areaSelected:{order:0,featureName:"Zone",html:"Puoi vedere i dati relativi ad una particolare area selezionadoli sulla mappa.",elementSelector:".card-map .center-align",showAfter:3,showAction:()=>{this.viewMode("region"),this.selectedArea=this._calculator.geo.areas.r10}},indicatorSelected:{order:1,featureName:"Indicatori",html:"Puoi vedere il grafico associato all'indicatore, facendo click sull'indicatore.",elementSelector:".indicators .summary-field",showAfter:15,showAction:()=>{this.currentArea()||this._tips.areaSelected.showAction(),this.selectedIndicator((0,l.linq)(this._dataSet.indicators).first((e=>"totalDeath"==e.id)))}},dayChanged:{order:2,featureName:"Cronologia",html:"Puoi vedere gli indicatori dei giorni precedenti muovendo la slide.",elementSelector:".day input[type=range]",showAfter:20,showAction:()=>{this.dayNumber(5)}},indicatorChanged:{order:3,featureName:"Indicatori",html:"Puoi cambiare l'indicatore scegliendolo dal filtro nell'elenco.",elementSelector:".filter-indicator",showAfter:0},viewChanged:{order:4,featureName:"Zone",html:"Puoi vedere gli indicatori a livello regionale, nazionale o provinciale.",elementSelector:"#areaTabs",showAfter:0,showAction:()=>{this.viewMode("district")}},topAreasOpened:{order:5,featureName:"Zone",html:"Puo vedere le zone piÃ¹ colpite di un qualsiasi indicatore scelto.",elementSelector:"#topCases .card-title",showAfter:20,showAction:()=>{"country"==this.viewMode()&&this.viewMode("region"),M.Collapsible.getInstance(document.getElementById("topCases")).open(0)}},deltaSelected:{order:5.5,featureName:"Indicatori",html:"Puoi vedere l'incremento giornaliero dell'indicatore anzichÃ¨ il valore totale.",elementSelector:".day-delta",showAfter:20,showAction:()=>{this.currentArea()||this._tips.areaSelected.showAction(),this.isDayDelta(!0)}},factorChanged:{order:6,featureName:"Indicatori",html:"Puoi mettere in relazione qualsiasi indicatore a numerosi parametri (es. % Positivi su Tamponi).",elementSelector:".filter-factor",showAfter:30,showAction:()=>{this.currentArea()||this._tips.areaSelected.showAction(),this.selectedIndicator((0,l.linq)(this._dataSet.indicators).first((e=>"totalPositive"==e.id))),this.selectedFactor((0,l.linq)(this._dataSet.factors).first((e=>"population"==e.id)))}},groupChanged:{order:7,featureName:"Grafico",html:"Puo raggruppare i dati del grafico in gruppi da 1 a 7 giorni. Puoi anche scegliere la data d'inizio.",elementSelector:".row-chart-group .select-wrapper",showAfter:30,showAction:()=>{this.currentArea()||this._tips.areaSelected.showAction();var e=document.querySelector(".chart-options");e.classList.contains("closed")&&e.classList.remove("closed"),this.groupSize(2),M.FormSelect.init(document.querySelectorAll(".row-chart-group select"))}},chartActionExecuted:{order:8,featureName:"Grafico",html:"Puoi portare il grafico a schermo interno, copiarlo, o copiare la serie numerico e incollarla in excel.",elementSelector:".chart .actions",showAfter:30},scaleChanged:{order:9,featureName:"Grafico",html:"Puoi cambiare da scala logaritmica a scala lineare.",elementSelector:".log-scale",showAfter:210,showAction:()=>{this.isLogScale(!0)}},maxFactorChanged:{order:10,featureName:"Mappa",html:"Puoi cambiare il riferimento rispetto al quale la mappa viene colorata. Normalmente Ã¨ in base al valore massimo che si ha avuto globalmente.",elementSelector:".max-factor",showAfter:60,showAction:()=>{this.currentArea()||this._tips.areaSelected.showAction(),this.selectedIndicator((0,l.linq)(this._dataSet.indicators).first((e=>"totalPositive"==e.id))),this.autoMaxFactor(!1),this.maxFactor(1e3)}},regionExcluded:{order:11,featureName:"Mappa",html:"Nella vista nazionale puoi escludere dagli indicatori il valore di una o piÃ¹ regioni cliccando sulla mappa.",elementSelector:".card-map .center-align",showAfter:0,showAction:()=>{"country"!=this.viewMode()&&this.viewMode("country"),this._execludedArea.set("R8",this._calculator.geo.areas.r8),this.updateIndicator()}}};_specialDates={current:{date:void 0,color:"#000",width:.5,label:"Giorno corrente"},dpcm8:{date:new Date(2020,2,7),color:"#000",dash:[5,5],width:1,visible:!0,label:"DPCM 8 Marzo (italia zona rossa)"},dpcm9:{date:new Date(2020,2,9),color:"#000",dash:[5,5],width:1,visible:!0,label:"DPCM 9 Marzo (italia zona rossa)"},dpcm11:{date:new Date(2020,2,11),color:"#000",dash:[5,5],width:1,visible:!0,label:"DPCM 11 Marzo (chiusura attivitÃ )"},mds20:{date:new Date(2020,2,20),color:"#070",dash:[5,5],width:1,visible:!1,label:"MDS 20 Marzo (chiura parchi, motoria nelle vicinane)"},dpcm22:{date:new Date(2020,2,21),color:"#000",dash:[5,5],width:1,visible:!0,label:"DPCM 22 Marzo (chiusura ulteriore attivitÃ )"},dpcm25:{date:new Date(2020,2,24),color:"#000",dash:[5,5],width:1,visible:!0,label:"DPCM 25 Marzo (maggiori sanzioni)"}};_dataRanges=[{id:0,name:"$(all)"},{id:0,name:"1Â° $(wave)",endDay:new Date(2020,7,31)},{id:0,name:"2Â° $(wave)",startDay:new Date(2020,8,1)}];constructor(e){this._mainData=new a.k(e.data),this._mainGeo=e.geo,this._debugMode=e.debugMode,this._calculator=new h.kN(this._mainData,this._dataSet,this._mainGeo),this.dataRange.subscribe((e=>{const t=e=>this._mainData.days.indexOf((t=>(0,l.parseDate)(t.date).getTime()>=e.getTime()));this._mainData.startDay=void 0,this._mainData.endDay=void 0,this._mainData.startDay=e.startDay?t(e.startDay):void 0,this._mainData.endDay=e.endDay?t(e.endDay):void 0,this.updateDays(),this.dayNumber(this._mainData.count-1)})),this.dayNumber.subscribe((e=>{e!=this._calculator.data.count-1&&this.tipManager.markAction("dayChanged"),this.updateDayData(),this._specialDates.current.date=new Date(this._calculator.data.get(e).date),this.updateChart()})),this._mapSvg=document.getElementsByTagName("svg").item(0),this._mapSvg.addEventListener("click",(e=>this.onMapClick(e,!1))),this._mapSvg.addEventListener("dblclick",(e=>this.onMapClick(e,!0))),this.updateDays();M.Tabs.init(document.getElementById("areaTabs")).options.onShow=e=>{this.setViewMode(e.dataset.viewMode)};const t=M.Collapsible.init(document.getElementById("topCases"));t.options.onOpenStart=()=>{this._daysData||this.updateTopAreas(),this._topAreasVisible=!0,this.tipManager.markAction("topAreasOpened")},t.options.onCloseEnd=()=>{this._topAreasVisible=!1},this.indicators=ko.computed((()=>(0,l.linq)(this._dataSet.indicators).where((e=>!e.validFor||-1!=e.validFor.indexOf(this.viewMode()))).toArray())),this.factors=ko.computed((()=>(0,l.linq)(this._dataSet.factors).where((e=>!e.validFor||-1!=e.validFor.indexOf(this.viewMode()))).toArray())),this.detailsArea.subscribe((e=>{this.updateDetailsArea()})),this.selectedIndicator.subscribe((e=>{e&&(this.updateIndicator(),"totalPositive"!=e.id&&this.tipManager.markAction("indicatorChanged",e.id))})),this.selectedFactor.subscribe((e=>{e&&(this.updateIndicator(),"none"!=e.id&&this.tipManager.markAction("factorChanged",e.id),setTimeout((()=>M.FormSelect.init(document.querySelectorAll(".row-chart-group select")))))})),this.autoMaxFactor.subscribe((e=>{e&&(this.updateMaxFactor(),this.updateMap()),this.updateUrl()})),this.maxFactor.subscribe((e=>{this.autoMaxFactor()||(this.updateMap(),this.tipManager.markAction("maxFactorChanged",e.toString())),this.updateUrl()})),this.baseFactor.subscribe((e=>{this.autoMaxFactor()||this.updateMap(),this.updateUrl()})),this.isDayDelta.subscribe((e=>{this.computeStartDayForGroup(),this.updateIndicator(),e&&this.tipManager.markAction("deltaSelected")})),this.isLogScale.subscribe((e=>{this.updateChart(),this.updateUrl(),e&&this.tipManager.markAction("scaleChanged")})),this.isZoomChart.subscribe((e=>{this.updateChart()})),this.groupSize.subscribe((e=>{this.computeStartDayForGroup(),this.updateChart(),this.updateUrl(),e>1&&this.tipManager.markAction("groupChanged",e.toString())})),this.startDay.subscribe((e=>{this.updateChart(),this.updateUrl()}));const i=new URLSearchParams(window.location.search),s=i.get("state");let n;this._keepState="true"==i.get("keepState"),this.loadPreferences(),this.tipManager=new d(this._tips,(()=>this._preferences),(()=>this.savePreferences())),this.tipManager.engageUser(),n=s&&this._keepState?JSON.parse(atob(s)):{},setTimeout((()=>this.loadState(n)),0),this._debugMode||window.addEventListener("beforeunload",(()=>this.savePreferences()))}isDefaultState(e){return e.day&&e.day!=this._calculator.data.count-1||e.view&&"region"!=e.view||e.area||e.indicator&&"totalPositive"!=e.indicator||e.factor&&"none"!=e.factor||e.maxFactor||e.dayDelta||e.logScale||e.showEnvData||e.dateRangeId,!(e.groupSize&&1!=e.groupSize||null!=e.startDay&&0!=e.startDay||e.excludedArea||e.detailsArea)}loadState(e){e.view||(e.view="region");if(M.Tabs.getInstance(document.getElementById("areaTabs")).select(r.O[e.view].tab),document.body.scrollTop=0,e.dateRangeId?this.dataRange((0,l.linq)(this.dataRanges).first((t=>t.id==e.dateRangeId))):this.dataRange(this.dataRanges[0]),null!=e.logScale&&this.isLogScale(e.logScale),e.groupSize&&this.groupSize(e.groupSize),null!=e.startDay&&this.startDay(e.startDay),null!=e.dayDelta&&this.isDayDelta(e.dayDelta),null!=e.showEnvData&&this.isShowEnvData(e.showEnvData),e.maxFactor&&(this.autoMaxFactor(!1),this.maxFactor(e.maxFactor)),this.dayNumber(null!=e.day?e.day:this._calculator.data.count-1),e.excludedArea){this._execludedArea.clear();for(let t of e.excludedArea)this._execludedArea.set(t,this._calculator.geo.areas[t.toLowerCase()])}e.indicator&&this.selectedIndicator((0,l.linq)(this._dataSet.indicators).first((t=>t.id==e.indicator))),e.factor&&this.selectedFactor((0,l.linq)(this._dataSet.factors).first((t=>t.id==e.factor))),e.area&&(this.selectedArea=this._calculator.geo.areas[e.area.toLowerCase()]),e.detailsArea&&this.detailsArea(this._calculator.geo.areas[e.detailsArea])}saveStata(){return{view:"region"==this.viewMode()?void 0:this.viewMode(),indicator:this.selectedIndicator()?this.selectedIndicator().id:void 0,factor:this.selectedFactor()?this.selectedFactor().id:void 0,dayDelta:!!this.isDayDelta()||void 0,maxFactor:this.autoMaxFactor()?void 0:this.maxFactor(),day:this.dayNumber()==this._calculator.data.count-1?void 0:this.dayNumber(),area:this.selectedArea?this.selectedArea.id:void 0,groupSize:1==this.groupSize()?void 0:this.groupSize(),startDay:0==this.startDay()?void 0:this.startDay(),logScale:!!this.isLogScale()||void 0,excludedArea:this._execludedArea.size>0?(0,l.linq)(this._execludedArea.keys()).toArray():void 0,showEnvData:!!this.isShowEnvData()||void 0,detailsArea:this.detailsArea()?this.detailsArea().id:void 0,dateRangeId:this.dataRange().id}}loadPreferences(){let e=localStorage.getItem("preferences");if(e){try{this._preferences=JSON.parse(e)}catch{}this._preferences&&1==this._preferences.version||(this._preferences=this.getDefaultPreferences(),this._preferences.isFirstView=!1,this._preferences.showTips=!1,this.savePreferences())}else this._preferences=this.getDefaultPreferences()}getDefaultPreferences(){return{isFirstView:!0,showTips:!0,version:1,actions:{areaSelected:0,indicatorSelected:0,indicatorChanged:0,dayChanged:0,viewChanged:0,chartActionExecuted:0,factorChanged:0,groupChanged:0,maxFactorChanged:0,scaleChanged:0,topAreasOpened:0,deltaSelected:0,regionExcluded:0}}}savePreferences(){this._preferences.isFirstView=!1,localStorage.setItem("preferences",JSON.stringify(this._preferences))}toggleChartZoom(){this._preferences.actions.chartActionExecuted++,this.isZoomChart(!this.isZoomChart())}async copyMap(){const e=document.querySelector("svg.map"),t=e.outerHTML,i=new Blob([t],{type:"image/svg+xml"});if(navigator.clipboard&&navigator.clipboard.write){const t=document.createElement("img");t.style.width=e.clientWidth+"px",t.style.height=e.clientHeight+"px",t.onload=function(){const i=document.createElement("canvas");i.width=e.clientWidth,i.height=e.clientHeight;const s=i.getContext("2d");s.fillStyle="white",s.fillRect(0,0,i.width,i.height),s.drawImage(t,0,0),i.toBlob((async e=>{let t=new ClipboardItem({[e.type]:e});await navigator.clipboard.write([t]),M.toast({html:$string("$(msg-map-copied)")})}))},t.src=window.URL.createObjectURL(i)}else{const e=document.createElement("a");e.href=window.URL.createObjectURL(i),e.target="_blan",e.download="map.svg",e.click(),M.toast({html:$string("$(msg-no-copy)")})}}copyChart(){this._chart.canvas.toBlob((async e=>{if(navigator.clipboard&&navigator.clipboard.write){let t=new ClipboardItem({[e.type]:e});await navigator.clipboard.write([t]),M.toast({html:$string("$(msg-chart-copied)")})}else{const t=window.URL.createObjectURL(e),i=document.createElement("a");i.href=t,i.target="_blan",i.download=this._chart.options.plugins.title.text+".png",i.click(),M.toast({html:$string("$(msg-no-copy)")})}})),this.tipManager.markAction("chartActionExecuted","copy")}async copySerie(){const e=this._chart.data.datasets[0].data;let t="";for(let i=0;i<e.length;i++)i>0&&(t+="\n"),t+=(0,l.formatDate)(e[i].x,$string("$(date-format)"))+"\t"+i+"\t"+(0,l.round)(e[i].y,1);(0,l.copyText)(t),M.toast({html:$string("$(msg-serie-copied)")}),this.tipManager.markAction("chartActionExecuted","copySerie")}async copySerieForStudio(){let e={type:"serie",version:1,color:this.selectedIndicator().colorLight,serie:{type:"geoplot",areaId:this.selectedArea.id,indicatorId:this.selectedIndicator().id,xAxis:"dayNumber",exeludedAreaIds:(0,l.linq)(this._execludedArea.keys()).toArray(),factorId:this.selectedFactor().id,groupSize:this.groupSize(),isDelta:this.isDayDelta(),startDay:this.startDay(),range:{start:this._calculator.data.startDay,end:this._calculator.data.endDay}},title:this.factorDescription()};e.values=this._calculator.getSerie(e.serie),(0,l.copyText)(JSON.stringify(e)),M.toast({html:$string("$(msg-serie-copied-studio)")}),this.tipManager.markAction("chartActionExecuted","copySerieForStudio")}play(){this.dayNumber()==this._calculator.data.count-1&&this.dayNumber(0),this.isPlaying(!0),this.nextFrame()}pause(){this.isPlaying(!1)}setViewMode(e,t=!1){if(t){M.Tabs.getInstance(document.getElementById("areaTabs")).select(r.O[e].tab)}"details"==e?this._detailsGeo&&this._detailsData&&(this._calculator.geo=this._detailsGeo,this._calculator.data=this._detailsData):(this._calculator.geo=this._mainGeo,this._calculator.data=this._mainData),this.totalDays(this._calculator.data.count-1),"region"!=e&&this.tipManager.markAction("viewChanged",e),this.viewMode(e);const i=document.getElementById("group_district");"district"==e||"details"==e?i.style.removeProperty("display"):i.style.display="none",this.selectedArea=null,this._chart=null,this._execludedArea.clear(),this.clearMap(),this.updateMaxFactor(),this.updateDayData(),"country"==this.viewMode()?(this.selectedArea=this._calculator.geo.areas.it,this.tipManager.showTip("regionExcluded",{timeout:5})):this._topAreasVisible?this.updateTopAreas():this._daysData=void 0,setTimeout((()=>M.FormSelect.init(document.querySelectorAll(".row-indicator select"))))}get selectedArea(){return this._selectedArea}set selectedArea(e){if(e!=this._selectedArea){if(this._selectedArea){const e=document.getElementById(this._selectedArea.id.toUpperCase());e&&e.classList.remove("selected")}if(this._selectedArea=e,this._selectedArea){const e=document.getElementById(this._selectedArea.id.toUpperCase());if(e){e.classList.add("selected");const t=e.parentElement;e.remove(),t.appendChild(e)}}this.changeArea()}}getFactorValue(e,t){return this._calculator.getFactorValue({dayNumberOrGroup:e,areaOrId:t,factorId:this.selectedFactor().id,indicatorId:this.selectedIndicator().id,isDayDelta:this.isDayDelta(),execludedAreas:(0,l.linq)(this._execludedArea.keys()).toArray()})}getIndicatorValue(e,t,i){return this._calculator.getIndicatorValue({dayNumber:e,areaOrId:t,indicatorId:i,isDayDelta:this.isDayDelta(),execludedAreas:(0,l.linq)(this._execludedArea.keys()).toArray()})}computeStartDayForGroup(){const e=(this._calculator.data.count-this.startDay())%this.groupSize();if(0!=e){const t=this.groupSize()-e;this.startDay()-t>=0?this.startDay(this.startDay()-t):this.startDay()+e<this._calculator.data.count-1&&this.startDay(this.startDay()+e),M.FormSelect.init(document.querySelectorAll(".row-chart-group select"))}}onMapClick(e,t){const i=e.target.parentElement.id,s=this._calculator.geo.areas[i.toLowerCase()];s&&(t?"region"!=this.viewMode()&&"district"!=this.viewMode()||this.detailsArea(s):("country"==this.viewMode()?(this._execludedArea.has(i)?this._execludedArea.delete(i):(this._execludedArea.set(i,s),M.toast({html:$string("$(msg-region-ex)").replace("[region]",s.name)})),this.updateIndicator()):this.selectedArea=s,this.tipManager.markAction("areaSelected",s.name)))}top;nextFrame(){this.isPlaying()&&(this.dayNumber()>=this._calculator.data.count-1?this.pause():this.dayNumber(parseInt(this.dayNumber().toString())+1),setTimeout((()=>this.nextFrame()),200))}changeArea(){if(null==this._selectedArea)this.currentArea(null);else{var e=!this.currentArea();const t=new $;t.value=this._selectedArea,this.updateArea(t),this.currentArea(t),this.updateFactorDescription(),this.updateAreaIndicators(),this.updateChart(),e&&(M.FormSelect.init(document.querySelectorAll(".row-chart-group select")),M.Tooltip.init(document.querySelectorAll(".row-chart-group .tooltipped")))}this.updateUrl()}updateAreaIndicators(){if(!this.currentArea())return;if(!this.currentArea().indicators()){const e=[];for(let t of this.indicators()){if(!1===t.showInFavorites)continue;let i=new L;i.indicator=t,i.select=()=>{this.tipManager.markAction("indicatorSelected",i.indicator.id),this.selectedIndicator(t),setTimeout((()=>M.FormSelect.init(document.querySelectorAll(".row-indicator select"))))},e.push(i)}this.currentArea().indicators(e)}const e=this.currentArea().value.id.toLowerCase();for(let t of this.currentArea().indicators())t.value(this.getIndicatorValue(this.dayNumber(),e,t.indicator.id))}updateFactorDescription(){let e="";if(this.isDayDelta()&&(e="$(new) "),e+=this.selectedFactor().description.replace("[indicator]",this.selectedIndicator().name),this.currentArea()&&(e+=" - "+this.currentArea().value.name),this._execludedArea.size>0){e+=" - $(except) (";let t=0;for(let i of this._execludedArea.keys())t>0&&(e+=", "),e+=this._execludedArea.get(i).name,t++;e+=")"}this.factorDescription($string(e))}updateIndicator(){this.selectedIndicator()&&this.selectedFactor()&&(this.updateFactorDescription(),this.updateMaxFactor(),this.updateDayData(),this.updateChart(),this.updateUrl(),this._topAreasVisible&&this.updateTopAreas())}updateMaxFactor(){if(!this.selectedFactor()||!this.selectedIndicator()||!this.autoMaxFactor())return;let e=Number.NEGATIVE_INFINITY,t=r.O[this.viewMode()],i=[];this._calculator.data.days.foreach(((s,n)=>{for(let a in s.values){if(!t.validateId(a))continue;if(!this._calculator.geo.areas[a])continue;const s=Math.abs(this.getFactorValue(n,a));!(0,l.isNaNOrNull)(s)&&s!=Number.POSITIVE_INFINITY&&s>e&&(e=s),0!=s&&i.push(s)}})),this.maxFactor(parseFloat(e.toFixed(1)))}initChart(){const e=document.querySelector("#areaGraph"),t={id:"lines",afterDraw:e=>{const t=e.data.datasets[0].data;if(!t||0==t.length)return;const i=e.scales.xAxes,s=e.ctx;for(let t in this._specialDates){let n=this._specialDates[t];if(!n.date||!1===n.visible)continue;let a=i.getPixelForValue(n.date.getTime());s.lineWidth=n.width||1,s.beginPath(),s.moveTo(a,e.chartArea.top),s.lineTo(a,e.chartArea.bottom),s.strokeStyle=n.color||"#000",n.dash?s.setLineDash(n.dash):s.setLineDash([]),n.dashOffset&&(s.lineDashOffset=n.dashOffset),s.stroke()}}};this._chart=new s.Chart(e,{plugins:[{id:"bk",beforeDraw:function(e,t,i){var s=e.ctx;s.fillStyle="white",s.fillRect(0,0,e.width,e.height)}},t],type:"line",data:{datasets:[{fill:"origin",data:[],borderWidth:1}]},options:{maintainAspectRatio:!1,plugins:{title:{display:!1},legend:{display:!0,position:"bottom"},tooltip:{callbacks:{label:e=>(0,l.round)(e.parsed.y,1)}}},scales:{xAxes:{type:"time",adapters:{date:{locale:"it-IT"==$language?E:D}},time:{unit:"day",tooltipFormat:"dd/MMM"}}}}})}updateDays(){const e=[];this._calculator.data.days.foreach(((t,i)=>e.push({number:i,value:new Date(t.date),text:(0,l.formatDate)(t.date,$string("$(date-format-short)"))}))),this.days(e),this.totalDays(this._calculator.data.count-1)}updateChart(){if(!this.selectedIndicator()||!this.currentArea()||!this.selectedFactor())return;null==this._chart&&this.initChart();const e=this.currentArea().value;this._chart.data.datasets[0].label=this.factorDescription(),this._chart.options.plugins.title.text=this._chart.data.datasets[0].label,this.isLogScale()?this._chart.options.scales.y.type="logarithmic":this._chart.options.scales.y.type="linear",this._chart.options.scales.y.min=0,this._chart.data.datasets[0].borderColor=this.selectedIndicator().colorDark,this._chart.data.datasets[0].backgroundColor=this.selectedIndicator().colorLight;const t=this._calculator.getSerie({type:"geoplot",areaId:e.id,indicatorId:this.selectedIndicator().id,xAxis:"date",startDay:this.startDay(),exeludedAreaIds:(0,l.linq)(this._execludedArea.keys()).toArray(),factorId:this.selectedFactor().id,groupSize:this.groupSize(),isDelta:this.isDayDelta()}),i=(0,l.linq)(t).select((e=>e.y)).where((e=>!isNaN(e))).orderBy((e=>e)).toArray();this._chart.options.scales.y.min=i[2],this._chart.options.scales.y.max=i[i.length-3],this._chart.data.datasets[0].data=t,this._chart.update()}updateArea(e,t){if(!e||!this.selectedIndicator()||!this.selectedFactor())return;null==t&&(t=this.dayNumber());const i=e.value.id.toLowerCase(),s=e.value;e.data(this._calculator.getDataAtDay(t,i)),e.indicator(this.getIndicatorValue(t,i,this.selectedIndicator().id)),e.factor(this.getFactorValue(t,s)),e.reference(this.selectedFactor().reference(e.data(),s))}async updateDetailsArea(){const e=document.querySelector(".details-map");if(this.detailsArea()){await this.detailsLoading.waitFor(),this.detailsLoading.reset();try{this.setViewMode("details",!0),await(0,l.delayAsync)(0),e.innerHTML="<span class = 'loading'><i class ='material-icons'>loop</i></span>",document.getSelection().empty();const i=JSON.parse(await(await fetch(l.App.baseUrl+"AreaData/"+this.detailsArea().id)).text()),s=await(await fetch(l.App.baseUrl+"AreaMap/"+this.detailsArea().id)).text();e.innerHTML=s;var t=document.querySelector(".details-map svg");t.addEventListener("click",(e=>this.onMapClick(e,!1))),t.querySelector("#group_municipality").classList.add("active"),this._detailsData=new a.k(i.data),this._detailsGeo=i.geo,this.setViewMode("details",!0)}finally{this.detailsLoading.set()}}else this.setViewMode("region"),e.innerHTML=""}updateTopAreas(){this._daysData=[],this._calculator.data.days.foreach(((e,t)=>{const i={},s=r.O[this.viewMode()].validateId;i.topAreas=(0,l.linq)(e.values).select((e=>({factor:this.getFactorValue(t,e.key),value:e}))).where((e=>!(0,l.isNaNOrNull)(e.factor))).orderByDesc((e=>e.factor)).where((e=>s(e.value.key))).select((e=>{const i=new $;return i.value=this._calculator.geo.areas[e.value.key.toLowerCase()],i.select=()=>this.selectedArea=i.value,this.updateArea(i,t),i})).take(25).toArray(),this._daysData.push(i)})),this.topAreas(this._daysData[this.dayNumber()].topAreas)}updateDayData(){const e=this._calculator.data.get(this.dayNumber());e?(this.currentData((0,l.formatDate)(e.date,$string("$(date-format)"))),this.updateMap(),this.updateArea(this.currentArea()),this.updateAreaIndicators(),this._daysData&&this._topAreasVisible&&this.topAreas(this._daysData[this.dayNumber()].topAreas),this.updateUrl()):console.warn("No day data: "+this.dayNumber())}updateUrl(){if(!this._keepState)return;const e=this.saveStata();let t=l.App.baseUrl+"Overview";this.isDefaultState(e)||(t+="?state="+encodeURIComponent(btoa(JSON.stringify(e)))+"&keepState=true"),history.replaceState(null,null,t)}clearMap(){const e=this._calculator.data.get(this.dayNumber());if(e&&e.values)for(const t in e.values){const e=document.getElementById(t.toUpperCase());e&&e.style.removeProperty("fill")}else console.warn("No day data: "+this.dayNumber())}updateMap(){if(this.selectedIndicator()&&this.selectedFactor())if("country"!=this.viewMode()){const t=this._calculator.data.get(this.dayNumber());var e=this.selectedIndicator();const i=e.gradient?e.gradient:new o.o("#fff",e.colorDark);for(const s in t.values){const t=document.getElementById(s.toUpperCase());if(t){const n=this._calculator.geo.areas[s];if(n.type!=r.O[this.viewMode()].areaType)continue;let a=this.getFactorValue(this.dayNumber(),n);if(a==Number.POSITIVE_INFINITY&&(a=NaN),a=e.canBeNegative?.5+(a-this.baseFactor())/(2*this.maxFactor()):(a-this.baseFactor())/this.maxFactor(),a=Math.min(1,Math.max(0,a)),(0,l.isNaNOrNull)(a))t.classList.contains("valid")&&t.classList.remove("valid"),t.style.removeProperty("fill");else{let s;t.classList.contains("valid")||t.classList.add("valid"),s=e.canBeNegative?(0,l.discretize)(a,20):(0,l.discretize)((0,l.exponential)(a),20),t.style.fill=i.valueAt(s).toString()}}}}else"details"!=this.viewMode()&&(0,l.linq)(document.querySelectorAll(".main-map g.region")).foreach((e=>{this._execludedArea.has(e.id)?e.style.fill="#444":e.style.fill="#FFF"}))}get dataRanges(){return this._dataRanges}dayNumber=ko.observable(0);totalDays=ko.observable(0);detailsLoading=new l.Signal(!0);detailsArea=ko.observable();currentData=ko.observable();currentArea=ko.observable();topAreas=ko.observable();viewMode=ko.observable("district");selectedIndicator=ko.observable();selectedFactor=ko.observable();autoMaxFactor=ko.observable(!0);maxFactor=ko.observable();baseFactor=ko.observable(0);isPlaying=ko.observable(!1);isLogScale=ko.observable(!1);isDayDelta=ko.observable(!1);isZoomChart=ko.observable(!1);isShowEnvData=ko.observable(!1);groupSize=ko.observable(1);startDay=ko.observable(0);dataRange=ko.observable();days=ko.observable();tipManager;isNoFactorSelected=ko.computed((()=>this.selectedFactor()&&"none"==this.selectedFactor().id));groupDays=[1,2,3,4,5,6,7];factorDescription=ko.observable();indicators;factors}},1794:(e,t,i)=>{"use strict";i.d(t,{O:()=>bi,q:()=>_i});var s,n=i(7337);!function(e){e.saveState=async function(e,t){let i=await n.Http.postJsonAsync("~/SaveState/"+e,t);if(!i.isSuccess)throw i.error;return i.data},e.loadState=async function(e){let t=await n.Http.getJsonAsync("~/LoadState/"+e);if(!t.isSuccess)throw t.error;return t.data},e.loadStudioData=async function(){return await n.Http.getJsonAsync("~/StudioData")}}(s||(s={}));var a=i(168),r=i(3163);a.M.add({"msg-upgrading":"aggiornamento alla nuova versione",confirm:"conferma",yes:"si",no:"no",close:"chiudi","day-label":"[Giorno]","month-label":"[Mese]","year-label":"[Anno]","msg-specify-value":r.wI.complex("specificare un valore per '{0}'"),"msg-insert-greater-than":r.wI.complex("inserire un valore maggiore o uguale a {0}"),"msg-invalid-email":"email non valida","msg-insert-less-than":r.wI.complex("inserire un valore minore o uguale a {0}")},{language:"IT"});var o,l=i(1923),c=i(81);!function(e){e[e.Global=0]="Global",e[e.Local=1]="Local"}(o||(o={}));var d,h=i(1691),u=i(6615),m=i(7985);function p(e){return e.toUpperCase()===e}function g(e,t){let i="";for(let s=0;s<t;s++)i+=e;return i}function f(e,t,i){if(null!=e)return e.length>=t?e:g(i,t-e.length)+e}!function(e){e[e.Milliseconds=0]="Milliseconds",e[e.Seconds=1]="Seconds",e[e.Minutes=2]="Minutes",e[e.Hours=3]="Hours",e[e.Days=4]="Days"}(d||(d={}));class v{constructor(e=0){this.ticks=e}get totalDays(){return this.ticks/864e5}get totalHours(){return this.ticks/36e5}get totalMinutes(){return this.ticks/6e4}get totalSeconds(){return this.ticks/1e3}get totalMilliseconds(){return this.ticks}get days(){return Math.floor(this.ticks/864e5)}get hours(){return Math.floor(this.ticks/36e5)%24}get minutes(){return Math.floor(this.ticks/6e4)%60}get seconds(){return Math.floor(this.ticks/1e3)%60}get milliseconds(){return this.ticks%1e3}format(e){return h.E.replaceArgs(e,(e=>v.formatArgument(this,e)))}toString(){return this.format("{hh}:{mm}:{ss}")}static zero(){return new v(0)}static fromMilliseconds(e){return new v(e)}static fromSeconds(e){return new v(1e3*e)}static fromMinutes(e){return new v(1e3*e*60)}static fromHours(e){return new v(1e3*e*60*60)}static fromDays(e){return new v(1e3*e*60*60*24)}static create(e=0,t=0,i=0,s=0,n=0){return new v(1e3*e*60*60*24+1e3*t*60*60+1e3*i*60+1e3*s+n)}static formatArgument(e,t){switch(t){case"d":return e.days.toString();case"dd":return f(e.days.toString(),2,"0");case"h":return e.hours.toString();case"hh":return f(e.hours.toString(),2,"0");case"m":return e.minutes.toString();case"mm":return f(e.minutes.toString(),2,"0");case"s":return e.seconds.toString();case"ss":return f(e.seconds.toString(),2,"0");case"f":return(e.milliseconds/100).toString();case"ff":return(e.milliseconds/10).toString();case"fff":return e.milliseconds.toString()}return t}ticks}const y=["LunedÃ¬","MartedÃ¬","MercoledÃ¬","GiovedÃ¬","VenerdÃ¬","Sabato","Domenica"],b=["Gennaio","Febbraio","Marzo","Aprile","Maggio","Giugno","Luglio","Agosto","Settembre","Ottobre","Novembre","Dicembre"];function _(e){return e instanceof Date?e:new Date(e)}function w(e,t){return e=_(e),h.E.replaceArgs(h.E.text(t),(t=>function(e,t){switch(e=_(e),t){case"D":return e.getDate().toString();case"DD":return f(e.getDate().toString(),2,"0");case"W":return y[(e.getDay()+6)%7].substr(0,3);case"WW":return y[(e.getDay()+6)%7];case"M":return e.getMonth().toString();case"MM":return f((e.getMonth()+1).toString(),2,"0");case"MMM":return b[e.getMonth()].substr(0,3);case"MMMM":return b[e.getMonth()];case"YY":return e.getFullYear().toString().substr(2);case"YYYY":return e.getFullYear().toString();case"h":return e.getHours().toString();case"hh":return f(e.getHours().toString(),2,"0");case"m":return e.getMinutes().toString();case"mm":return f(e.getMinutes().toString(),2,"0");case"s":return e.getSeconds().toString();case"ss":return f(e.getSeconds().toString(),2,"0");case"f":return(e.getMilliseconds()/100).toString();case"ff":return(e.getMilliseconds()/10).toString();case"fff":return e.getMilliseconds().toString()}return t}(e,t)))}Error;class C{constructor(e){this.node=e}get childNodes(){return(0,c.k)(this.node.childNodes).select((e=>new C(e)))}descendsFrom(e){let t=this.node;for(;null!=t;){if(t==e)return!0;t=t.parentNode}return!1}hasClass(e){return"classList"in this.node&&this.node.classList.contains(e)}get discendants(){return(0,c.k)(function*e(t){for(const t of this.node.childNodes){yield new C(t);for(const i of e(t))yield i}}(this.node))}get parentNodesOrSelf(){return(0,c.k)(function*(e){let t=e;for(;null!=t;)yield new C(t),t=t.parentNode}(this.node))}get parentNodes(){return this.parentNodesOrSelf.skip(1)}get name(){return this.node.nodeName}node}function A(e,t){return function(e){return new C(e)}(e).parentNodes.where((e=>e.hasClass(t))).select((e=>e.node)).first()}const x={};var I,S,V=i(6196),E=i(2696);function k(e,t){if(!Array.isArray(e)||!Array.isArray(t))return!1;if(e.length!=t.length)return!1;for(let i=0;i<e.length;i++)if(!N(e[i],t[i]))return!1;return!0}function T(e){return null==e||Array.isArray(e)&&0==e.length}function N(e,t){return Array.isArray(e)||Array.isArray(t)?k(e,t):e==t}function P(e,t,i){return Object.getOwnPropertyDescriptor(e,t)?L(e,t):(D(e,t,i),i)}function D(e,t,i){"@"==t.substr(0,1)?Object.defineProperty(e,t,{writable:!0,enumerable:!1,value:i}):Object.defineProperty(e,t,{value:i})}function L(e,t,i){if(!e)return i;const s=e[t];return null==s?i:s}function $(e,t,i){if("@"==t.substr(0,1)){Object.getOwnPropertyDescriptor(e,t)?e[t]=i:D(e,t,i)}else e[t]=i}function F(e){if(!e)return;let t=e["@typeName"];if(!t){if(t=typeof e,"function"==t)return function(e){let t=e.name;if(!t){const i=/function\s([^(]{1,})\(/.exec(e.toString());t=i&&i.length>1?i[1].trim():""}return t}(e);if("object"==t){const t=e.constructor;if(t)return F(t)}}return t}function O(e){let t;return t=(0,E.mf)(e)?e.prototype:Object.getPrototypeOf(e),Object.getPrototypeOf(t).constructor}function G(e){if((0,E.HD)(e)){const t=e.split(".");let i=self;return t.forEach((e=>{if(i=i[e],!i)return null})),i}return e.constructor}function W(e,t){$(e,"@typeName",t)}class q{_handlers;constructor(e,t){this.get=e,this.name=t}get(){throw"Not implemented"}set(e){}notifyChanged(){const e=this.get();z(this._handlers,(t=>t(e,void 0)))}subscribe(e){this._handlers||(this._handlers=[]);return-1==this._handlers.indexOf(e)&&this._handlers.push(e),e}unsubscribe(e){if(!this._handlers)return;const t=this._handlers.indexOf(e);-1!=t&&this._handlers.splice(t,1)}name;isReadOnly=!0}class B{_handlers;_descriptor;constructor(e,t){this._descriptor=e,this.name=t}get(){return this._descriptor.get?this._descriptor.get():this._descriptor.value}set(e){const t=this.get();this._descriptor.set?this._descriptor.set(e):this._descriptor.value=e,t!=e&&this._handlers&&z(this._handlers,(i=>i(e,t)))}notifyChanged(){const e=this.get();z(this._handlers,(t=>t(e,void 0)))}subscribe(e){this._handlers||(this._handlers=[]);return-1==this._handlers.indexOf(e)&&this._handlers.push(e),e}unsubscribe(e){if(!this._handlers)return;const t=this._handlers.indexOf(e);-1!=t&&this._handlers.splice(t,1)}name}!function(e){function t(e,t,i){let s=Object.getOwnPropertyDescriptor(e,t);s||(console.warn("'",t,"' not defined in ",F(e)),s={}),i||(i=new B(s,t));return P(e,"@props",{})[t]=i,Object.defineProperty(e,t,{get:()=>i.get(),set:e=>i.set(e)}),i}function i(e,t){if(function(e,t){return t in e}(e,"@props")){const i=e["@props"][t];if(i)return i}}function s(e){return e&&"object"==typeof e&&"function"==typeof e.get&&0==e.get.length&&"function"==typeof e.set&&1==e.set.length}function n(e){return e instanceof B||e instanceof q}e.converter=function(e,t,i,s){let n;return{get:()=>(null==n&&(n=i(e[t])),n),set:i=>{n=i,s&&(e[t]=s(i))},name:t}},e.create=t,e.createAll=function(e){return Object.getOwnPropertyNames(e).forEach((i=>{if("_"==i[0]||"$"==i[0])return;const s=Object.getOwnPropertyDescriptor(e,i);s&&!s.writable||t(e,i)})),e},e.get=i,e.getOrCreate=function(e,s,n){const a=i(e,s);return a||t(e,s,n)},e.isProperty=s,e.isObservableProperty=n,e.bind=function(e,t,i){let a;s(t)?(n(t)&&t.subscribe((t=>{i?e.set(i.convertTo(t)):e.set(t)})),e.subscribe((e=>{i?t.set(i.convertFrom(e)):t.set(e)})),a=t.get()):a=t,i?e.set(i.convertTo(a)):e.set(a)}}(I||(I={}));class U{_bindings=[];_modelBinders=[];_depBinders=[];constructor(e){this.model=e}register(e){this._modelBinders.push(e)}registerDependant(e){this._depBinders.push(e)}unregisterDependant(e){const t=this._depBinders.indexOf(e);-1!=t&&this._depBinders.splice(t,1)}getBindValue(e){return"function"==typeof e?e(this.model):e}bind(e,t){if("function"==typeof e){const i={value:e,action:t,subscriptions:[],lastValue:void 0};this._bindings.push(i),i.value(this.createProxy(this.model,((e,t)=>(this.subscribe(e,t,i),!0))));const s=i.value(this.model);i.action(s,void 0,!1),i.lastValue=s}else t(e,void 0,!1)}unsubscribe(e,t){e.subscriptions.forEach((e=>{(0,E.Ex)(e.source)?e.source.unsubscribe(e.handler):e.property.unsubscribe(e.handler)})),t&&e.lastValue&&(e.action(null,e.lastValue,!0,!0),e.lastValue=null),e.subscriptions=[]}subscribe(e,t,i){for(let s=0;s<i.subscriptions.length;s++){const n=i.subscriptions[s];if(n.source==e&&n.property.name==t)return}if((0,E.Ex)(e)){const t={onChanged:()=>{const e=i.value(this.model);e!=i.lastValue&&(i.action(e,i.lastValue,!0),i.lastValue=e)}};e.subscribe(t),i.subscriptions.push({source:e,property:null,handler:t})}else{const s=Object.getOwnPropertyDescriptor(e,t);if(!s||!s.writable&&!s.set)return void console.warn("Property ",t," for object ",e," not exists or is not writeable.");const n=I.getOrCreate(e,t),a=(e,t)=>{const s=i.value(this.model);s!=i.lastValue&&(this.unsubscribe(i,!1),i.value(this.createProxy(this.model,((e,t)=>(this.subscribe(e,t,i),!0)))),i.action(s,i.lastValue,!0),i.lastValue=s)};n.subscribe(a),i.subscriptions.push({source:e,property:n,handler:a})}}getBindingProperty(e){if("function"!=typeof e)return null;let t;return e(this.createProxy(this.model,((e,i)=>(t={obj:e,propName:i},!0)))),t&&t.obj?I.getOrCreate(t.obj,t.propName):void 0}createProxy(e,t){if(!e||"object"!=typeof e)return e;const i=[],s={};if((0,E.Ex)(e)){const n=s;i.push("count"),n._innerProxies={},n.get=i=>(i in n._innerProxies||(t(e,i.toString())?n._innerProxies[i]=this.createProxy(e.get(i),t):n._innerProxies[i]=e.get(i)),n._innerProxies[i])}else for(const t in e)i.push(t);for(const n of i){let i,a,r=!1;Object.defineProperty(s,n,{get:()=>(r||(i=t(e,n)?this.createProxy(e[n],t):e[n],r=!0),i),set:s=>{a!=s&&(i=t(e,n)?this.createProxy(s,t):s,a=s,r=!0)}})}return s}cleanBindings(e){this._bindings.forEach((t=>this.unsubscribe(t,e))),this._modelBinders.forEach((t=>t.cleanBindings(e))),this._depBinders.forEach((t=>t.cleanBindings(e))),this._modelBinders=[],this._bindings=[],this._depBinders=[]}updateModel(e){this.model=e,z(this._bindings,(t=>{const i=t.value(e);t.lastValue!=i&&(t.action(i,t.lastValue,!0),t.lastValue=i)})),z(this._modelBinders,(t=>t.updateModel(e)))}model}function z(e,t){if(e&&0!=e.length)for(let i=e.length-1;i>=0;i--)t(e[i])}class R{_computedBinder;prop(e){return I.getOrCreate(this,e)}static bindValue(e){return I.isProperty(e)?e.get():e}bindConfig(e,t,i,s){this.bind(e,t&&e in t?t[e]:void 0,i,s)}bindConfigString(e,t,i,s){this.bindString(e,t&&e in t?t[e]:void 0,i,s)}computed(e,t){return I.create(this,e,this.createComputed(t,e))}createComputed(e,t){this._computedBinder||(this._computedBinder=new U(this));const i=new q((()=>e(this)),t);return this._computedBinder.bind(e,(()=>i.notifyChanged())),i}bind(e,t,i,s){const n=I.getOrCreate(this,e);s&&n.subscribe(s),void 0!==t&&I.bind(n,t,i)}bindString(e,t,i,s){return this.bind(e,t,{convertTo:e=>r.wI.getValue(e,i),convertFrom:e=>e},s)}apply(e){return e(this),this}}!function(e){e[e.None=0]="None",e[e.Circle=1]="Circle"}(S||(S={}));function H(e){return e&&"object"==typeof e&&"editAsync"in e&&"function"==typeof e.editAsync}function j(e){return e&&"object"==typeof e&&"function"==typeof e.activateAsync&&0==e.activateAsync.length}function X(e){return e&&"object"==typeof e&&"isSelected"in e&&"select"in e&&"function"==typeof e.select}function Y(e){return e&&"object"==typeof e&&"function"==typeof e.loadAsync&&0==e.loadAsync.length}function K(e){return e&&"object"==typeof e&&"function"==typeof e.validateAsync&&e.validateAsync.length<2}function J(e){return e&&"object"==typeof e&&"nodes"in e}var Z={};const Q={};window.__defineTemplate=function(e,t){Q[e]=t};class ee extends U{_endElement;_startElement;_lastElement;_childCount=0;_updateCount=0;_updateNode=null;constructor(e,t,i){super(e),this.parent=i,this.element=t,t.namespaceURI&&"http://www.w3.org/1999/xhtml"!=t.namespaceURI&&(this.namespace=t.namespaceURI)}beginTemplate(e,t,i="after",s){const n=new ee(e,this.element,this);return n._lastElement=this._lastElement,n.begin(t,i,s),"explicit"==this.inlineMode&&(n.isInline=this.isInline,n.inlineMode="inherit"),n}endTemplate(e){e.end(),e.element==this.element&&(this._lastElement=e._lastElement)}beginUpdate(){0==this._updateCount&&this.element.parentNode&&(this._updateNode=document.createTextNode(""),this.element.parentNode.replaceChild(this._updateNode,this.element)),this._updateCount++}endUpdate(){this._updateCount--,0==this._updateCount&&this._updateNode&&(this._updateNode.parentNode.replaceChild(this.element,this._updateNode),this._updateNode=null)}begin(e,t,i){return this._startElement=i?document.createComment("begin-"+i):document.createTextNode(""),e?"after"==t?e.nextSibling?e.parentNode.insertBefore(this._startElement,e.nextSibling):e.parentNode.appendChild(this._startElement):"before"==t?e.parentNode.insertBefore(this._startElement,e):"inside"==t&&e.appendChild(this._startElement):this.appendChild(this._startElement),this._lastElement=this._startElement,this}end(){if(!this._endElement)return this._startElement.nodeType==Node.COMMENT_NODE?this._endElement=document.createComment(this._startElement.textContent.replace("begin-","end-")):this._endElement=document.createTextNode(""),this.appendChild(this._endElement),this}clear(e=!1){this._childCount=0,this._endElement||(console.warn("Missing end element: "+this.model),this.end());let t=this._endElement;for(;;){let i=!0;t!=this._startElement&&t!=this._endElement||e||(i=!1);const s=t.previousSibling;if(i&&i&&t.parentNode.removeChild(t),t==this._startElement)break;t=s}return e?(this._endElement=null,this._startElement=null,this._lastElement=null):this._lastElement=this._startElement,this.cleanBindings(!0),this}appendChild(e){return this._lastElement&&this._lastElement.parentNode?this._lastElement.nextSibling?this._lastElement.parentNode.insertBefore(e,this._lastElement.nextSibling):this._lastElement.parentNode.appendChild(e):this.element.appendChild(e),this._lastElement=e,this}foreach(e,t){const i=this.getBindValue(e);return Array.isArray(i)||!i?this.foreachArray(e,t):this.foreachList(e,t),this}foreachList(e,t){let i=[];const s=this.loadTemplate(t),n=document.createTextNode("");this.appendChild(n);const a={onClear:()=>{i.forEach((e=>e.clear(!0))),i=[]},onItemRemoved:(e,t,s)=>{"replace"!=s&&"clear"!=s&&(i[t].clear(!0),i.splice(t,1))},onItemSwap:(e,t)=>{},onItemReplaced:(e,t,s)=>{i[s].updateModel(e)},onItemAdded:(e,t,a)=>{if("replace"==a)return;let r;t==i.length?(r=0==t?this.beginTemplate(e,n,"after",this.createMarker(e)):this.beginTemplate(e,i[t-1]._endElement,"after",this.createMarker(e)),i.push(r)):(r=this.beginTemplate(e,i[t]._startElement,"before",this.createMarker(e)),i.splice(t,0,r)),r.index=t,s(r),this.endTemplate(r)}};return this.bind(e,((e,t,i,s)=>{if(!s){if(this.beginUpdate(),i&&a.onClear(),t&&t.unsubscribe(a),e){e.subscribe(a);for(let t=0;t<e.count;t++)a.onItemAdded(e.get(t),t,"add")}this.endUpdate()}})),this}foreachArray(e,t){let i=[];const s=this.loadTemplate(t),n=document.createTextNode("");return this.appendChild(n),this.bind(e,((e,t,a,r)=>{r||(a&&(i.forEach((e=>e.clear())),i=[]),e&&(this._lastElement=n,this.beginUpdate(),e.forEach((e=>{const t=this.beginTemplate(e);t.index=i.length,s(t),this.endTemplate(t),i.push(t)})),this.endUpdate()))})),this}if(e,t,i){const s=this.beginTemplate(this.model);return this.register(s),this.bind(e,((e,n,a,r)=>{r||(a&&s.clear(),e?s.template(t):i&&s.template(i))})),this.endTemplate(s),this}replaceContent(e){if(this.isInline)throw"'replaceContent' not supported in inline elements";this.clear();for(const t of e)this.appendChild(t)}extractContent(){const e=[];for(const t of(0,c.k)(this.element.childNodes))t!=this._startElement&&t!=this._endElement&&e.push(t);return e}content(e,t=!1){const i=this.beginTemplate(void 0,void 0,void 0,this.createMarker(e));return i.isInline=t,i.inlineMode="explicit",this.bind(e,((e,t,s,n)=>{if(!n){if(this.beginUpdate(),!i.isInline&&J(e)&&e.nodes&&!0===e.isCacheEnabled)i.replaceContent(e.nodes);else{if(t&&e&&t.template==e.template)i.updateModel(e);else if(s&&i.clear(),e){const t=this.templateFor(e);if(!t)throw"Template '"+e.template+"' not found.";i.updateModel(e),t(i)}J(e)&&!0===e.isCacheEnabled&&(e.nodes=this.extractContent())}this.endUpdate()}})),this.endTemplate(i),this}templateFor(e){if("string"==typeof e||"number"==typeof e)return this.loadTemplate("Text");if("object"==typeof e&&"template"in e)return this.loadTemplate(e.template);throw"cannot determine template for model"}loadTemplate(e){if("string"==typeof e){const t=Q[e];return t||console.error("Template ",e," not found."),t}return e}template(e,t){const i=this.loadTemplate(e);if(t){const e=this.beginTemplate(void 0,void 0,void 0,this.createMarker(t,"template"));this.bind(t,((t,s,n,a)=>{a||(e.updateModel(t),n||i(e))})),this.endTemplate(e)}else i(this);return this}exec(e){return e(this),this}beginChild(e,t){if(this.isInline&&this._childCount>0)throw"In inline mode you must have a single root element for your template";const i=this.isInline&&e.toUpperCase()==this.element.tagName?this.element:this.createElement(e,t),s=new te(this.model,i,this);return i==this.element&&(s._lastElement=this._lastElement),this.register(s),this._childCount++,s}child(e,t,i){const s=new ee(this.model,this.createElement(e,i),this);return this.register(s),"function"==typeof t?t(s):s.attribs(t),this.appendChild(s.element),this}set(e,t){return this.bind(t,(t=>{null!=t?t instanceof Promise?t.then((t=>this.element.setAttribute(e,t))):this.element.setAttribute(e,t):this.element.removeAttribute(e)})),this}on(e,t){return this.element.addEventListener(e,(e=>t(this.model,e))),this}class(e,t){if(t){const i=e?e.split(" "):[];this.bind(t,(e=>{e?i.forEach((e=>this.element.classList.add(e))):i.forEach((e=>this.element.classList.remove(e)))}))}else this.bind(e,((e,t)=>{t&&t.split(" ").forEach((e=>this.element.classList.remove(e))),e&&e.split(" ").forEach((e=>this.element.classList.add(e)))}));return this}visible(e){return this.bind(e,((e,t,i,s)=>{s||(e?(this.element.classList.add("visible"),this.element.classList.remove("hidden")):(this.element.classList.add("hidden"),this.element.classList.remove("visible")))})),this}text(e){const t=document.createTextNode("");return this.appendChild(t),this.bind(e,(e=>t.textContent=e)),this}html(e){return this.bind(e,(e=>this.element.innerHTML=e)),this}focus(e){const t=this.getBindingProperty(e);return t&&(this.element.addEventListener("focus",(e=>t.set(!0))),this.element.addEventListener("focusout",(e=>t.set(!1)))),this.bind(e,(e=>{e&&document.activeElement!=this.element&&this.element.focus()})),this}value(e){const t=this.element,i=this.getBindingProperty(e);return i&&("INPUT"==t.tagName||"TEXTAREA"==t.tagName?"checkbox"==t.type||"radio"==t.type?t.addEventListener("change",(e=>{i.set(t.checked)})):(t.addEventListener("keyup",(e=>{i.set(t.value)})),t.addEventListener("change",(e=>{i.set(t.value)}))):"SELECT"==t.tagName&&t.addEventListener("change",(e=>{i.set(t.value)}))),"INPUT"!=t.tagName&&"TEXTAREA"!=t.tagName&&"SELECT"!=t.tagName||("checkbox"==t.type||"radio"==t.type?this.bind(e,(e=>t.checked=e)):this.bind(e,(e=>t.value=e||null))),this}style(e,t){return this.bind(t,(t=>this.element.style[e]=t)),this}behavoir(e){return"string"==typeof e?Z[e]().attach(this.element,this.model):e.attach(this.element,this.model),this}styles(e){for(const t in e)this.bind(e[t],(e=>this.element.style[t]=e));return this}attribs(e){for(const t in e)this.set(t,e[t]);return this}debugger(){return this}createElement(e,t){return t||(t=this.namespace),t?document.createElementNS(t,e):document.createElement(e)}createMarker(e,t=""){}namespace=null;element=null;parent=null;isInline=!1;inlineMode="never";index=0}class te extends ee{constructor(e,t,i){super(e,t,i)}endChild(){return this.parent.element!=this.element?this.parent.appendChild(this.element):this._lastElement&&(this.parent._lastElement=this._lastElement),this.parent}}class ie{_items=[];_handlers;constructor(e,t){this._items=e||[],this.equalityComparer=t}add(e){return this._items.push(e),this.invoke((t=>t.onItemAdded?t.onItemAdded(e,this._items.length-1,"add"):void 0)),this.invoke((e=>e.onChanged?e.onChanged():void 0)),e}addRange(e){for(const t of e)this._items.push(t),this.invoke((e=>e.onItemAdded?e.onItemAdded(t,this._items.length-1,"add"):void 0));this.invoke((e=>e.onChanged?e.onChanged():void 0))}insert(e,t){return this._items.splice(e,0,t),this.invoke((i=>i.onItemAdded?i.onItemAdded(t,e,"insert"):void 0)),this.invoke((e=>e.onChanged?e.onChanged():void 0)),t}remove(e){const t=this.indexOf(e);-1!=t&&this.removeAt(t)}removeWhen(e){for(let t=this._items.length-1;t>=0;t--)e(this._items[t])&&this.removeAt(t)}removeRange(e,t){const i=this._items.splice(e,t);let s=!1;for(let t=i.length-1;t>=0;t--)this.invoke((s=>s.onItemRemoved?s.onItemRemoved(i[t],e+t,"remove"):void 0)),s=!0;return s&&this.invoke((e=>e.onChanged?e.onChanged():void 0)),i}removeAt(e){const t=this._items.splice(e,1)[0];return this.invoke((i=>i.onItemRemoved?i.onItemRemoved(t,e,"remove"):void 0)),this.invoke((e=>e.onChanged?e.onChanged():void 0)),t}clear(){if(0!=this._items.length){for(let e=this._items.length-1;e>=0;e--)this.invoke((t=>t.onItemRemoved?t.onItemRemoved(this._items[e],e,"clear"):void 0));this._items.splice(0,this._items.length),this.invoke((e=>e.onClear?e.onClear():void 0)),this.invoke((e=>e.onChanged?e.onChanged():void 0))}}contains(e){return-1!=this.indexOf(e)}indexOf(e){if(this.equalityComparer){for(let t=0;t<this._items.length;t++)if(this.equalityComparer(e,this._items[t]))return t;return-1}return this._items.indexOf(e)}*[Symbol.iterator](){for(const e of this._items)yield e}toArray(){return this._items}get(e){return this._items[e]}set(e,t){const i=this._items[e];i!=t&&(this.invoke((t=>t.onItemRemoved?t.onItemRemoved(i,e,"replace"):void 0)),this._items[e]=t,this.invoke((i=>i.onItemAdded?i.onItemAdded(t,e,"replace"):void 0)),this.invoke((s=>s.onItemReplaced?s.onItemReplaced(t,i,e):void 0)),this.invoke((e=>e.onChanged?e.onChanged():void 0)))}swap(e,t){const i=this._items[t];this._items[t]=this._items[e],this._items[e]=i,this.invoke((i=>i.onItemSwap?i.onItemSwap(e,t):void 0)),this.invoke((e=>e.onChanged?e.onChanged():void 0))}subscribe(e){this._handlers||(this._handlers=[]);return-1==this._handlers.indexOf(e)&&this._handlers.push(e),e}unsubscribe(e){if(!this._handlers)return;const t=this._handlers.indexOf(e);-1!=t&&this._handlers.splice(t,1)}forEach(e){let t=0;for(const i of this)e(i,t),t++}invoke(e){this._handlers&&this._handlers.forEach((t=>e(t)))}get first(){return this._items[0]}get last(){return this._items[this._items.length-1]}get count(){return this._items.length}toJSON(){return this._items}equalityComparer}function se(e,t){return new ie(e,t)}i(2547);class ne extends R{constructor(e){super(),this.bindConfig("template",e),this.template||(this.template=F(this)),e&&e.parentView&&(this.parentView=e.parentView),this.debugTypeName()}debugTypeName(){const e=this.constructor.name;this.constructor["@typeName"]||console.warn("Type '"+e+"' is not registered.")}template=null;parentView=null;element}function ae(e){return isNaN(e)||null===e}W(ne,"View");class re extends ne{_progress;_type;constructor(e){super(e),this.bindConfig("message",e),e.type?this._type=e.type:this._type=o.Global,this.parentOperation=e.parentOperation}end(){l.K9.operation.end(this)}get type(){return this._type}get progress(){return this._progress}set progress(e){this._progress=e,this._progress?(console.log(this.getProgressDescription(this._progress)),this._progress.message&&(this.message=h.E.text(this._progress.message))):this.message=void 0}addSubOperation(e){this.subOperations.add(e)}removeSubOperation(e){this.subOperations.remove(e)}getProgressDescription(e){let t="Progress: ";return e.message&&(t+="'"+e.message+"'"),null!=e.current&&null!=e.totCount&&(t+=" - "+e.current+"/"+e.totCount+" ("+function(e,t){if(!ae(e))return Math.round(e*Math.pow(10,t))/Math.pow(10,t)}(100/e.totCount*e.current,1)+"%)"),t}subOperations=function(e){return new ie(e)}();message=null;parentOperation=null}function oe(e){let t=0,i="";for(let s=0;s<e.length;s++){const n=e.charAt(s);switch(t){case 0:i+=n.toLowerCase(),p(n)&&"-"!=n||(t=1);break;case 1:p(n)&&"-"!=n&&(i+="-",t=0),i+=n.toLowerCase()}}return i}W(re,"OperationView");class le extends ne{constructor(e){super(e),this.bindConfig("enabled",e),this.bindConfig("visible",e),e&&(e.styles&&(this.styles=e.styles),e.name&&(this.name=e.name)),this.prop("styles").subscribe((()=>this.buildStyles())),this.buildStyles()}addStyle(e){-1==this.styles.indexOf(e)&&(this.styles.push(e),this.buildStyles())}removeStyle(e){const t=this.styles.indexOf(e);-1!=t&&(this.styles.splice(t,1),this.buildStyles())}buildStyles(){let e="",t=G(this);for(;t!=le;){e+=oe(F(t))+" ",t=O(t)}this.name&&(e+=oe(this.name)+" "),this.styles&&(e+=this.styles.join(" ")),this.className=e.trim()}get debugName(){return F(this)+": "+this.name}enabled=!0;visible=!0;styles=[];name=null;nodes=null;isCacheEnabled=!1;className;status=""}W(le,"ViewComponent");class ce extends le{constructor(e){super(e),this.bindConfig("content",e,null,(()=>this.onContentChanged())),this.bindConfig("contentTemplate",e),this.contentTemplate&&(this.template=e=>e.template(e.model.contentTemplate,e.model.content))}onContentChanged(){var e;(e=this.content)&&"object"==typeof e&&"parentView"in e&&"template"in e&&(this.content.parentView=this)}content=null;contentTemplate=null}W(ce,"ContentView");i(926);class de extends R{_menuContainer;_clickHandler;constructor(e){super(),e&&e.actions&&e.actions.forEach((e=>this.addAction(e))),this._menuContainer=document.createElement("DIV"),this._menuContainer.className="popup-container",this._clickHandler=this.onClick.bind(this)}addAction(e){this.actions.add(me.fromAction(e))}async showAsync(e,t){const i={x:0,y:0};!e&&t&&(t instanceof MouseEvent?(e=t.srcElement,i.x=t.offsetX,i.y=t.offsetY):(i.x=t.touches[0].clientX,i.y=t.touches[0].clientY));if(new ee(this,this._menuContainer).template("ContextMenu",(e=>e)),document.body.appendChild(this._menuContainer),await(0,V.$)(0),window.addEventListener("pointerdown",this._clickHandler),e){let t=e,s=e;for(;t;)t==s&&(i.y+=t.offsetTop,i.x+=t.offsetLeft,s=t.offsetParent),i.y-=t.scrollTop,i.x-=t.scrollLeft,t=t.parentElement}let s="",n="";i.x+this._menuContainer.clientWidth>document.body.clientWidth?(i.x-=this._menuContainer.clientWidth,s="right"):s="left",i.y+this._menuContainer.clientHeight>document.body.clientHeight?(i.y-=this._menuContainer.clientHeight,n="bottom"):n="top",this._menuContainer.style.top=i.y+"px",this._menuContainer.style.left=i.x+"px",this._menuContainer.style.transformOrigin=s+" "+n,await(0,V.$)(0),this._menuContainer.classList.add("visible")}hide(){this._menuContainer.classList.remove("visible"),window.removeEventListener("pointerdown",this._clickHandler),setTimeout((()=>document.body.removeChild(this._menuContainer)),500)}onClick(e){setTimeout((()=>this.hide()),200)}actions=se();className="context-menu"}W(de,"ContextMenu");i(5700),i(3123);class he extends le{constructor(e){super(e),this.bindConfig("icon",e),this.bindConfigString("text",e),this.bindConfigString("badge",e)}icon=null;text=null;badge=null}W(he,"IconTextView");var ue;i(1179);!function(e){e[e.None=0]="None",e[e.Parallel=1]="Parallel",e[e.Serial=2]="Serial"}(ue||(ue={}));class me extends ce{constructor(e){super({template:"ActionLink",...e}),this.bindConfigString("tooltip",e,r.Fq.Tooltip),this.bindConfig("operation",e),this.bindConfig("canAggregate",e),e&&(e.executeAsync&&(this.executeWorkAsync=()=>e.executeAsync(this)),e.subActions&&e.subActions.forEach((e=>this.subActions.add(new me(e)))))}async executeAsync(){window.event&&window.event.stopPropagation(),l.K9.analytics&&l.K9.analytics.action(this.name);const e=l.K9.operation.begin({message:"Executing "+this.name,type:this.operation});this.status="executing";try{if(await this.executeWorkAsync(),this.subActions.count>0){const e=new de;this.subActions.forEach((t=>e.actions.add(t))),e.showAsync(window.event.srcElement)}}catch(e){throw l.gV.handleError(this,e),e}finally{this.status="",e.end()}}executeWorkAsync(){return Promise.resolve()}static fromAction(e,t){const i=e=>({name:e.name,operation:e.operation,styles:e.styles,template:"ActionLink",subActions:e.subActions?(0,c.k)(e.subActions).select((e=>i(e))).toArray():void 0,content:new he({template:"IconTextViewInline",text:h.E.action(e.displayName??e.name),icon:e.icon,badge:e.badge}),executeAsync:e.executeAsync,...t}),s=new me(i(e));return e.canExecute&&I.converter(s,"visible",(()=>e.canExecute())),s}static fromItemAction(e,t,i){const s=new me({name:e.name,operation:e.operation,styles:e.styles,content:new he({template:"IconTextViewInline",text:h.E.action(e.displayName??e.name),icon:e.icon,badge:e.badge}),executeAsync:()=>e.executeAsync(t()),...i});return e.canExecute&&s.bind("visible",s.createComputed((()=>e.canExecute(t())))),s}static fromActionIcon(e,t){const i=new me({name:e.name,styles:e.styles,operation:e.operation,template:"ActionIcon",content:e.icon,tooltip:e.displayName??e.name,executeAsync:e.executeAsync,...t});return e.canExecute&&i.bind("visible",i.createComputed((()=>e.canExecute()))),i}tooltip=null;operation=o.Global;canAggregate=ue.None;subActions=se()}W(me,"ActionView");class pe extends R{constructor(){super(),this.selectedItems.subscribe({onChanged:()=>{this.updateView(),0==this.selectedItems.count&&this.close()}})}close(){this.isActive=!1;for(var e=this.selectedItems.count-1;e>=0;e--)this.selectedItems.get(e).isSelected=!1;this.selectedItems.clear(),this.actions.clear(),this.updateView()}open(){this.isActive=!0}addAction(e){const t=me.fromItemAction(e,(()=>this.selectedItems.toArray()));return this.actions.add(t),t}updateView(){this.selectionText=r.wI.getValue("selection-count",{params:[this.selectedItems.count.toString()],cardinality:this.selectedItems.count})}selectedItems=se();actions=se();selectionText=null;isActive=!1}class ge{attach(e,t){"attach"in t&&setTimeout((()=>t.attach(e)))}detach(e,t){}static instance=new ge}class fe{attach(e){e.addEventListener("pointerdown",this.onClick,{passive:!0}),e.classList.add("ripple")}detach(e){e.removeEventListener("pointerdown",this.onClick)}async onClick(e){const t=e.currentTarget;t.classList.remove("activated"),await(0,V.$)(0),t.classList.add("activated"),await(0,V.$)(500),t.classList.contains("activated")&&t.classList.remove("activated")}static instance=new fe}class ve{async attach(e,t){await(0,V.$)(0);const i=e.classList.contains("scroll")||e.classList.contains("scroll-v")?e:A(e,"scroll");let s=!1;function n(){t.isScrollCheckActive&&!s&&(s=!0,requestAnimationFrame((()=>{let a=!1;if(i!=document.scrollingElement){let t=e;for(a=!1;null!=t;){if(t==i){a=!0;break}t=t.parentNode}}else a=!0;a?t.onScroll({offsetTop:i.scrollTop,offsetBottom:i.scrollHeight-(i.scrollTop+i.clientHeight),pageBottom:(i.scrollHeight-(i.scrollTop+i.clientHeight))/i.clientHeight,pageTop:i.scrollTop/i.clientHeight,totPages:i.scrollHeight/i.clientHeight}):i.removeEventListener("scroll",n),s=!1})))}null!=i&&(i==document.scrollingElement?window.addEventListener("scroll",n,{passive:!0}):i.addEventListener("scroll",n,{passive:!0}))}detach(e,t){}static instance=new ve}class ye{attach(e){e.addEventListener("click",this.onClick)}detach(e){e.removeEventListener("click",this.onClick)}onClick(e){"vibrate"in navigator&&navigator.vibrate(50)}static instance=new ye}i(5395);W(class extends ce{constructor(){super({template:"ContentViewNested",content:new ne({template:"Spinner"})}),this.status="hide";new ee(this,document.body).content(this)}attach(e){this.element=e,e.addEventListener("mousedown",(e=>e.preventDefault()),{passive:!0}),e.addEventListener("touchstart",(e=>e.preventDefault()),{passive:!0}),"hide"==this.status&&(this.element.style.display="none")}async showAsync(e){this.element&&this.element.style.removeProperty("display"),this.status="showing",e&&(this.content=e),await(0,V.$)(0),"showing"==this.status&&(this.status="show")}async hideAsync(){this.content=new ne({template:"Spinner"}),this.status="hiding",await(0,V.$)(500),"hiding"==this.status&&(this.status="hide",this.element&&(this.element.style.display="none"))}},"Blocker");W(class extends ne{_parentHost;constructor(e){super({template:"SinglePageHost",...e}),this._parentHost=window.parent.WebApp.app.pageHost}get(e){return this._parentHost.get(e)}clearAsync(){return this.current=null,Promise.resolve()}goBackAsync(){return this._parentHost.goBackAsync()}goForwardAsync(){return this._parentHost.goForwardAsync()}bringFrontAsync(e){return e==this.current?Promise.resolve():this._parentHost.bringFrontAsync(e)}loadAsync(e,t){return this.current?this._parentHost.loadAsync(e,t):(e.host=this,this.current=e,e.loadAsync(),e.status="active",Promise.resolve(e))}find(e){if(this.current){if((0,E.HD)(e)&&e==F(this.current))return this.current;if(G(this.current)==e)return this.current}return this._parentHost.find(e)}async goToAsync(e){return this._parentHost.currentIndex=e,Promise.resolve()}get canGoBack(){return this._parentHost.canGoBack}get currentIndex(){return this._parentHost.currentIndex}set currentIndex(e){this._parentHost.currentIndex=e}get pageCount(){return this._parentHost.pageCount}current},"SelfHostedPageHost");class be extends R{constructor(e){super(),this.bindConfig("url",e),this.bindConfigString("title",e),this.bindConfigString("subTitle",e),this.bindConfig("view",e),e&&e.name&&(this.name=e.name)}getState(){return{}}setState(e){}handleError(e,t){l.gV.handleError(e,t)}async loadAsync(){if("notloaded"==this.status||"error"==this.status){const e=l.K9.operation.begin({message:"Loading page: "+(this.title?this.title:this.url?this.url:F(this))});this.status="loading";try{await this.loadWorkAsync()}catch(e){this.status="error",l.gV.handleError(this,e)}finally{e.end(),this.status="loaded"}}}loadWorkAsync(){return Promise.resolve()}refreshAsync(){return Promise.resolve()}async closeAsync(e){return"goBackAsync"in this.host&&await this.host.goBackAsync(),this.status="closed",!0}url=null;host=null;view=null;title=null;subTitle=null;name=null;status="notloaded";args=null}W(be,"Page");i(6506);class _e extends ce{_updateCount=0;constructor(e){super({content:se(),...e}),this.content.subscribe({onItemAdded:e=>{0==this._updateCount&&this.onItemAdded(e)},onItemRemoved:e=>{0==this._updateCount&&this.onItemRemoved(e)}}),this.bindConfig("emptyView",e)}initItems(){this.content&&this.content.toArray().forEach((e=>this.onItemAdded(e)))}beginUpdate(){this._updateCount++}endUpdate(){this._updateCount--}onItemAdded(e){}onItemRemoved(e){}emptyView=null}W(_e,"ItemsView");class we extends _e{constructor(e){super({template:"ItemsView",...e}),e?.viewContent&&(Array.isArray(e.viewContent)?e.viewContent.forEach((e=>this.addView(e))):this.addView(e.viewContent))}loadAsync(){return async function(e){const t=(0,c.k)(e).ofType((e=>Y(e))).select((e=>e.loadAsync())).toArray();return await Promise.all(t)}(this.content)}clear(){this.content.clear()}addView(e){return this.content.add(e),e}removeView(e){this.content.remove(e)}replaceView(e,t){let i;i=(0,E.HD)(e)?(0,c.k)(this.content).indexOf((t=>"name"in t&&t.name==e)):this.content.indexOf(e),-1!=i&&this.content.set(i,t)}onItemAdded(e){e&&(e.parentView=this)}onItemRemoved(e){e&&e.parentView==this&&(e.parentView=null)}}W(we,"Panel");class Ce extends be{_viewItems=[];_resultResolve;constructor(e){super(e),this.view=new we({name:oe(F(this)),styles:["vertical","activity","page","relative"]}),this.name&&this.view.styles.push(this.name)}get result(){return new Promise((e=>this._resultResolve=e))}activateAsync(){return Promise.resolve()}deactivateAsync(e){return Promise.resolve()}async closeAsync(e){const t=await super.closeAsync(e);return this._resultResolve&&this._resultResolve(e),t}loadWorkAsync(){return this.createAsync()}createAsync(){return Promise.resolve()}static isActivity(e){return function(e,t){if(!e)return;let i=G(e);for(;null!=i;){if(i==t)return!0;i=O(i)}return!1}(e,Ce)}}W(Ce,"Activity");i(5471);W(class extends ne{_activeViewIndex=0;_pageStack;_currentIndex;_hideTimerId;constructor(e){super(e),this.pageViews=[{content:null,className:null},{content:null,className:null}],this.clearAsync(),e&&e.defaultTransaction&&(this.defaultTransaction=e.defaultTransaction)}clearAsync(){this._pageStack=[],this._currentIndex=-1,this._activeViewIndex=0,this.pageViews[0].content=null,this.pageViews[0].className="immediate next",this.pageViews[1].content=null,this.pageViews[1].className="immediate prev"}async goBackAsync(){this._currentIndex>0&&await this.goToAsync(this._currentIndex-1)}async goForwardAsync(){this._currentIndex>0&&await this.goToAsync(this._currentIndex+1)}async bringFrontAsync(e){const t=(0,c.k)(this._pageStack).indexOf((t=>t.page==e));-1!=t&&await e.host.goToAsync(t)}async loadAsync(e,t){if(this.current==e)return await e.refreshAsync(),e;this.cancelHidePrev();const i=l.K9.operation.begin("Hosting new page");try{for(this.current&&Ce.isActivity(this.current)&&await this.current.deactivateAsync("replace"),"clear"==t?.loadMode&&(this._currentIndex=-1),"replace"==t?.loadMode&&this.currentIndex>=0&&this._currentIndex--;this._pageStack.length>this._currentIndex+1;)this._pageStack.splice(this._pageStack.length-1,1);this._pageStack.push({page:e,options:t}),t&&t.transaction?this.activeTransaction=t.transaction:this.activeTransaction=this.defaultTransaction,this._currentIndex++,e.host=this,e.view.parentView=this,this.pageViews[this.backIndex].className="immediate next",await(0,V.$)(0),await e.loadAsync(),this._currentIndex>0?(this.pageViews[this.backIndex].content=e.view,await(0,V.$)(0),this.pageViews[this.frontIndex].className="animate prev",this.pageViews[this.backIndex].className="animate active",this._activeViewIndex=this.backIndex,this.hidePrev()):(this.pageViews[this.frontIndex].content=e.view,this.pageViews[this.frontIndex].className="active"),e.status="active",Ce.isActivity(this.current)&&await this.current.activateAsync()}catch(e){l.gV.handleError(this,e)}finally{i.end()}return e}get(e){return this._pageStack[e].page}async goToAsync(e){if(e<0||e>=this._pageStack.length||e==this._currentIndex)return;this.cancelHidePrev();const t=l.K9.operation.begin("Going to "+e);try{Ce.isActivity(this.current)&&await this.current.deactivateAsync("replace"),this.current.status="hidden";const i=this._pageStack[this._currentIndex].options;i&&i.transaction?this.activeTransaction=i.transaction:this.activeTransaction=this.defaultTransaction,this._currentIndex=e,this.current.view.parentView==this&&(this.current.view.parentView=null),this.pageViews[this.backIndex].content=this._pageStack[this._currentIndex].page.view,this.pageViews[this.backIndex].className="immmediate prev",await(0,V.$)(0),this.pageViews[this.frontIndex].className="animate next",this.pageViews[this.backIndex].className="animate active",this._activeViewIndex=this.backIndex,this.current.status="active",Ce.isActivity(this.current)&&await this.current.activateAsync(),this.hidePrev()}catch(e){l.gV.handleError(this,e)}finally{t.end()}}cancelHidePrev(){this._hideTimerId&&(clearTimeout(this._hideTimerId),this._hideTimerId=null)}hidePrev(){this._hideTimerId=window.setTimeout((()=>{this._hideTimerId&&(this.pageViews[this.backIndex].className="prev hide")}),4e3)}onActivePageChanged(){}onTransactionEnd(){}find(e){let t;if(t="string"==typeof e?(0,c.k)(this._pageStack).first((t=>t.page.name==e)):(0,c.k)(this._pageStack).first((t=>Object.getPrototypeOf(t.page).constructor==e)),t)return t.page}get current(){return-1==this._currentIndex?void 0:this._pageStack[this._currentIndex].page}get canGoBack(){return this._currentIndex>0}get frontIndex(){return this._activeViewIndex}get backIndex(){return(this._activeViewIndex+1)%2}get currentIndex(){return this._currentIndex}set currentIndex(e){this._currentIndex!=e&&this.goToAsync(e)}get pageCount(){return this._pageStack.length}defaultTransaction="pop-up-down";activeTransaction="none";pageViews},"SlidePageHost");var Ae,xe,Ie,Se,Ve;i(8349),i(554),i(6574),i(245),i(9714),i(4117),i(1906),i(751),i(939),i(3325),i(7501),i(4212),i(3006),i(8679),i(7598),i(4581),i(7641),i(6228),i(4726),i(1368),i(163),i(6932),i(3356),i(8958),i(5142),i(1556),i(7760),i(8777),i(7183),i(9857),i(3818),i(7575),i(4182),i(6948),i(940),i(9307),i(1977),i(8350),i(1814),i(5972),i(8164),i(5996),i(9095);!function(e){e[e.SwipeLeft=0]="SwipeLeft"}(Ae||(Ae={}));class Ee{attach(e,t){("ontouchstart"in window||navigator.maxTouchPoints>0)&&e.addEventListener("selectstart",(e=>(e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),!1))),e.addEventListener("contextmenu",(e=>(e=>{e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation();const i=t.getContextActions();i&&new de({actions:i}).showAsync(null,e)})(e)))}detach(e){}static instance=new Ee}!function(e){e[e.Primary=0]="Primary",e[e.Secondary=1]="Secondary",e[e.Evidence=2]="Evidence"}(xe||(xe={})),function(e){e[e.Default=0]="Default",e[e.WebView=1]="WebView"}(Ie||(Ie={}));class ke extends le{constructor(e){super(e),this.bindConfig("mainAction",e),this.bindConfig("navigationMenu",e),this.bindConfigString("title",e,r.Fq.Title),this.bindConfig("icon",e),this.actions.subscribe({onItemAdded:this.onActionAdded.bind(this),onItemRemoved:this.onActionRemoved.bind(this)}),e&&(e.content&&(this.content=e.content),e.actions&&e.actions.forEach((e=>this.addAction(e))),e.onBack&&(this.back=e.onBack))}onActionRemoved(e){e&&e.parentView==this&&(e.parentView=null)}onActionAdded(e){e&&(e.parentView=this)}async showNavigationMenu(){this.navigationMenu&&this.navigationMenu.showAsync()}addAction(e){this.actions.add(me.fromActionIcon(e))}back(){}startSelection(){return this.selectionManager||(this.selectionManager=new pe),this.selectionManager.isActive=!0,this.selectionManager}actions=se();mainAction="none";navigationMenu=null;title=null;icon=null;content=null;selectionManager=null}W(ke,"ActionBar");class Te extends he{constructor(e){super(e),this.prop("status"),this.bindConfig("badge",e),this.bindConfig("behavoirs",e),this.bindConfig("content",e),e&&(this.name=e.name)}select(){throw"Not implemented"}name=null;status="";badge=null;behavoirs=[];content=null}class Ne extends _e{constructor(e){super(e),this.bindConfig("itemTemplate",e),this.bindConfig("itemBehavoirs",e),e&&(e.items&&e.items.forEach((e=>this.addItem(e))),e.onItemSelected&&(this.onSelectedItemChanged=(t,i)=>{Ne.prototype.onSelectedItemChanged.bind(this)(t,i),e.onItemSelected(t)})),this.bindConfig("selectedItem",e,{convertTo:e=>this.getItem(e),convertFrom:e=>e?e.name:void 0},this.onSelectedItemChanged)}getItem(e){return(0,c.k)(this.content).first((t=>t.name==e))}selectItem(e){this.selectedItem=this.getItem(e)}addItem(e){const t=this.createItem(e);return this.content.add(t),t}createItem(e){const t=new Te({template:this.prop("itemTemplate"),behavoirs:this.prop("itemBehavoirs"),...e});return t.parentView=this,t.select=()=>this.selectedItem=t,t}onSelectedItemChanged(e,t){t&&(t.status=""),e&&(e.status="active")}selectedItem=null;itemTemplate="IconTextView";itemBehavoirs=[]}W(Te,"NavBarItem"),W(Ne,"NavBar");class Me extends me{_lastSearchText=null;constructor(e){super({name:"search",template:"SearchView",content:"fas fa-search",tooltip:"Ricerca",...e}),this.bindConfig("isExpanded",e),this.bindConfig("searchText",e),this.prop("hasFocus").subscribe((e=>this.onFocusChanged(e))),e&&(e.poolInterval&&(this.poolInterval=e.poolInterval),e.searchAsync&&(this.doSearchAsync=e.searchAsync))}onFocusChanged(e){e&&(this._lastSearchText=this.searchText,this.poolSearchTextAsync())}async poolSearchTextAsync(){for(;this.hasFocus;)this.searchText!=this._lastSearchText&&(this._lastSearchText=this.searchText,await this.searchAsync(this._lastSearchText)),await(0,V.$)(this.poolInterval)}executeWorkAsync(){return this.isExpanded||(this.isExpanded=!0,this.hasFocus=!0),Promise.resolve()}async searchAsync(e){this.status="searching",await(0,V.$)(0);try{await this.doSearchAsync(e)}finally{this.status="loaded"}}doSearchAsync(e){return Promise.resolve()}clear(){this.searchText=""}close(){this.isExpanded=!1}searchText=null;isExpanded=!1;hasFocus=!1;poolInterval=200}W(Me,"SearchView"),function(e){e[e.Manual=1]="Manual",e[e.Tabs=2]="Tabs",e[e.BottomNav=3]="BottomNav"}(Se||(Se={})),function(e){e[e.Floating=1]="Floating",e[e.Button=2]="Button",e[e.FloatingFull=3]="FloatingFull"}(Ve||(Ve={}));class Pe extends Ce{_actionBar;_contentView;_floatingView;_isContentLoaded=!1;_navBar;_selector=Se.Tabs;_isDeactivating=!1;constructor(e){super({...e}),this.bindConfig("activeContent",e),e.providers&&(this.providers=e.providers),e.menu&&(this.menu=e.menu),e.selector&&(this._selector=e.selector),e.actions&&(this.actions=e.actions),this.prop("host").subscribe((()=>{"none"==this._actionBar?.mainAction&&this.host?.canGoBack&&(this._actionBar.mainAction="back")}))}async closeAsync(e){return await this.deactivateAsync("close"),await super.closeAsync(e)}activateAsync(){return this._isContentLoaded?this.activeContentProvider?.activateAsync?this.activeContentProvider?.activateAsync("refresh"):Promise.resolve():this.refreshAsync()}async deactivateAsync(e){if(!this._isDeactivating)try{this._isDeactivating=!0,this.activeContentProvider?.deactivateAsync&&await this.activeContentProvider.deactivateAsync(e)}finally{this._isDeactivating=!1}}refreshAsync(){return this.activeContentProvider?this.loadContentAsync(this.activeContentProvider,!0):this.loadActiveContentAsync(!0)}notifyContentChanged(e){this.loadContentAsync(e,!0)}startSelection(){return this._actionBar.startSelection()}loadActiveContentAsync(e){const t=(0,c.k)(this.providers).first((e=>e.info.name==this.activeContent));return this.loadContentAsync(t,e)}async loadWorkAsync(){await this.createAsync(),this.activeContentProvider&&(this.activeContent=this.activeContentProvider.info.name)}async loadContentAsync(e,t){const i=this.activeContentProvider!=e;if(!i&&!t)return;if(i&&this.activeContentProvider?.deactivateAsync&&this.activeContentProvider?.deactivateAsync("replace"),this.activeContentProvider=e,!t&&("notloaded"==this.status||"loading"==this.status||"closed"==this.status))return void console.debug("Skip loading content: "+e.info.name);const s=l.K9.operation.begin({message:"Loading content: "+e.info.name});try{const t=await e.getContentAsync(this);let i;if(this.title=this.formatTitle(h.E.title(t.title)),t.url&&(this.url=t.url),this._contentView.clear(),this._contentView.styles=function(...e){const t=[];for(const i of e)i&&t.push(...i);return t}(t.styles??this.contentStyle,["activity-content"]),this._contentView.name=e.info.name,this._contentView.buildStyles(),t.views&&t.views.forEach((e=>this._contentView.addView(e))),this._actionBar.actions.clear(),this._floatingView&&this._floatingView.clear(),t.actions&&t.actions.forEach((e=>{if(null==e.priority||e.priority==xe.Secondary)this._actionBar.actions.add(this.createActionView(e));else if(e.priority==xe.Primary)if(void 0===t.actionMode||t.actionMode!=Ve.Button)this._floatingView.visible=!0,this._floatingView.addView(this.createActionView(e,{styles:["floating",...e.styles??[]]})),t.actionMode==Ve.FloatingFull?this._floatingView.addStyle("full"):this._floatingView.removeStyle("full");else{this._floatingView.visible=!1;const t=me.fromAction(e,{template:"ActionButton"});i||(i=new we({name:"actions",styles:["vertical","margin-items-v"]}),this._contentView.addView(i)),i.addView(t)}})),t.searchAsync){const e=new Me({name:"search-expanded",isExpanded:!0,searchAsync:t.searchAsync});this._actionBar.actions.add(e)}this._floatingView.visible=this._floatingView.content.count>0,this.actions.forEach((e=>this._actionBar.actions.add(e))),await this._contentView.loadAsync(),e?.activateAsync&&await e.activateAsync("loading"),this.onContentChanged(e),this._isContentLoaded=!0}catch(e){this.handleError(this,e)}finally{s.end()}}getAction(e){return(0,c.k)(this._floatingView.content).first((t=>t instanceof me&&t.name==e))}formatTitle(e){return e}createAsync(){if(this.menu?this._actionBar=this.view.addView(new ke({title:this.prop("title"),mainAction:"menu",navigationMenu:this.menu})):this._actionBar=this.view.addView(new ke({onBack:()=>this.closeAsync(),title:this.prop("title"),mainAction:this.host.canGoBack?"back":"none"})),this.providers.length>1)if(this._selector==Se.Manual)this.prop("activeContent").subscribe((()=>this.loadActiveContentAsync(!1)));else{let e,t,i;switch(this._selector){case Se.Tabs:e="tab-view",t="TextView",i=["ripple"];break;case Se.BottomNav:e="bottom-nav",t="IconTextView",i=["ripple"]}this._navBar=new Ne({styles:[e],itemTemplate:t,onItemSelected:e=>this.loadContentAsync(e.content,!1),selectedItem:this.prop("activeContent"),itemBehavoirs:i,items:(0,c.k)(this.providers).select((e=>({name:e.info.name,icon:e.info.icon,text:e.info.displayName,content:e}))).toArray()})}return this._navBar&&this._selector==Se.Tabs&&this.view.addView(this._navBar),this._contentView=this.view.addView(new we({styles:this.contentStyle})),this._navBar&&this._selector==Se.BottomNav&&this.view.addView(this._navBar),this._floatingView=this.view.addView(new we({name:"floating-container",template:"ItemsViewWrapped",visible:!1,styles:this.floatingStyle})),1==this.providers.length&&(this.activeContentProvider=this.providers[0]),this.status="created",Promise.resolve()}createActionView(e,t){return me.fromAction(e,t)}onContentChanged(e){}get actionBar(){return this._actionBar}activeContent=null;activeContentProvider=null;providers=[];menu=null;actions=[];floatingStyle=["vertical","item-absolute","bottom","fill-h","center-items-h"];contentStyle=["vertical","scroll"]}W(Pe,"ContentActivity");class De{async loadItemsAsync(e,t){e.status="loading";const i=l.K9.operation.begin({message:"Loading items",type:o.Local});try{const s=await e.itemsSource.getItemsAsync(e.filter);e.clear(),s&&await async function(e,t,i){let s=0;for(const n of e)i(n,s),s%t==0&&await(0,V.$)(0),s++}(s,t,(t=>e.addItem(t)))}finally{i.end(),e.status="loaded"}}static instance=new De}class Le extends ce{constructor(e){super({template:"TextContent",...e})}}W(Le,"TextView");class $e extends _e{_isLoaded=!1;_itemViewMap=new Map;_listener;constructor(e){super({template:"ListView",styles:["default"],...e}),this.bindConfig("itemsSource",e),this.bindConfig("items",e),this.bindConfig("filter",e),this.bindConfig("selectionMode",e),e&&(e.itemsLoader&&(this.itemsLoader=e.itemsLoader),void 0!==e.showSeparator&&(this.showSeparator=e.showSeparator),e.createItemView&&(this.createItemViewWork=e.createItemView),e.header&&this.header.addRange(e.header),e.footer&&this.footer.addRange(e.footer)),e?.items||(this.items=se()),!this.itemsLoader&&this.itemsSource&&(this.itemsLoader=De.instance),e&&e.isAutoLoad&&this.loadAsync();const t={onClear:()=>{this.selectedItem=null,this._itemViewMap.clear(),this.content.clear()},onItemAdded:(e,t,i)=>{"replace"!=i&&this.content.insert(t,this.createItemView(e))},onItemRemoved:(e,t,i)=>{"remove"==i&&this.content.removeAt(t)},onItemReplaced:(e,t,i)=>this.content.set(i,this.createItemView(e)),onItemSwap:(e,t)=>this.content.swap(e,t)};this.prop("items").subscribe(((e,i)=>{if(null!=i&&i.unsubscribe(t),this.content.clear(),e){e.subscribe(t);for(const t of e)this.content.add(this.createItemView(t));this.status="loaded"}})),this.prop("items").notifyChanged(),this.prop("selectedItem").subscribe(((t,i)=>{"single"==this.selectionMode&&this.updateItemSelection(i,!1),"none"!=this.selectionMode&&(this.updateItemSelection(t,!0),e?.onSelectdItemChanged&&e.onSelectdItemChanged(t))})),e?.isListenerActive&&this.activateListener()}activateListener(){this.itemsSource?.typeName&&(this._listener||(this._listener={onItemAdded:e=>this.refreshAsync(),onItemRemoved:e=>{e.value&&this.items.removeWhen((t=>this.itemsSource.equals(this.itemsSource.getItemValue(t),e.value)))},onItemChanged:async e=>{const t=(0,c.k)(this.items).indexOf((t=>this.itemsSource.equals(this.itemsSource.getItemValue(t),e.value)));if(-1!=t){const i=await this.itemsSource.getItemByValueAsync(e.value);i&&this.items.set(t,i)}}}),l.K9.itemsObserver.register(this.itemsSource.typeName,this._listener))}deactivateListener(){this._listener&&l.K9.itemsObserver.unregister(this.itemsSource.typeName,this._listener)}updateItemSelection(e,t){const i=this.findItemView(e);X(i)&&(i.isSelected=t)}findItemView(e){return e?(0,c.k)(this._itemViewMap.entries()).where((t=>t[1]==e)).select((e=>e[0])).first():null}removeItem(e){this.items.remove(e)}addItem(e,t){return void 0!==t?(this.items.insert(t,e),this.content.get(t)):(this.items.add(e),this.content.last)}clear(){this.items.clear()}async loadAsync(){this._isLoaded||await this.refreshAsync()}async refreshAsync(){let e=this.selectedItem;this.itemsLoader&&(this.beginUpdate(),await this.itemsLoader.loadItemsAsync(this,25),!e&&this.selectedItem&&(e=this.selectedItem),this.endUpdate()),this._isLoaded=!0,e&&this.itemsSource?this.selectedItem=(0,c.k)(this.items).first((t=>this.itemsSource.itemComparer(t,e))):this.selectedItem=null}onItemRemoved(e){if(e){e.parentView==this&&(e.parentView=null);this._itemViewMap.get(e)==this.selectedItem&&(this.selectedItem=null),this._itemViewMap.delete(e)}}createItemView(e){const t=this.createItemViewWork(e);return"loading"!=this.status&&"loaded"!=this.status||!Y(t)||t.loadAsync(),t&&(t.parentView=this,this._itemViewMap.set(t,e),X(t)&&t.prop("isSelected").subscribe((t=>{t&&(this.selectedItem=e)}))),t}createItemViewWork(e){const t=l.K9.views[F(e)];return t?t(e):new Le({content:this.itemsSource?this.itemsSource.getItemText(e):e.toString()})}onScroll(e){this.itemsLoader&&"onScroll"in this.itemsLoader&&this.itemsLoader.onScroll(e)}get itemsCount(){return this.content.count}get isScrollCheckActive(){return this.itemsLoader&&"onScroll"in this.itemsLoader}header=se();footer=se();itemsSource=null;itemsLoader=null;items=null;selectedItem=null;status="";selectionMode="none";showSeparator=!1;filter=null}W($e,"ListView");class Fe{static create(e){let t=e.value;var i,s;return"string"==typeof t?t=new String(t):"number"==typeof t?t=new Number(t):"boolean"==typeof t?t=new Boolean(t):t instanceof Date&&(t=new Date(t.getTime())),e.item&&(e.item.valueOf=()=>e.value,e.value&&(e.item.toJSON=()=>e.value),e.text&&(e.item.toString=()=>e.text),e.type&&(e.item.$type=()=>e.type)),t&&(e.text&&(t.toString=()=>e.text),e.type&&(i=t,s=e.type,(0,E.Kn)(i)?$(i,"@typeName",s):$(Object.getPrototypeOf(i),"@typeName",s)),void 0!==e.item&&$(t,"@item",e.item),t.toJSON=()=>e.value?.toJSON?e.value.toJSON():e.value),t||e.item}static getText(e){if(null==e||null==e)return"";const t=this.getItem(e);return t!==e?t.toString():e.toString()}static getType(e){return F(e)}static getValue(e){if(e)return e.valueOf?e.valueOf():e}static getItem(e){if(!e)return;const t=L(e,"@item");return t||void 0}}class Oe{_typeName;_allowZero;constructor(e){e&&(e.getItemsAsync&&(this.getItemsAsync=e.getItemsAsync),void 0!==e.allowZero&&(this._allowZero=e.allowZero),e.getItemValue&&(this.getItemValue=(t,i)=>{if(!1===i)return e.getItemValue(t);if(!(t||0===t&&e.allowZero))return;const s=e.getItemValue(t);return null===s?null:Fe.create({type:this.typeName,value:s,text:this.getItemText(t),item:t})}),e.getItemText&&(this.getItemText=e.getItemText),e.getFilter&&(this.getFilter=e.getFilter),e.getItemByValueAsync&&(this.getItemByValueAsync=t=>{const i=Fe.getItem(t);return i?Promise.resolve(i):e.getItemByValueAsync(t)}),e.equals&&(this.equals=e.equals),this._typeName=e.typeName,this.displayName=e.displayName)}getItemsAsync(e){return Promise.resolve([])}getItemText(e){if(e)return e.toString()}getItemValue(e,t){return e}getFilter(e,t,i){return{}}async countAsync(e){return(await this.getItemsAsync(e)).length}getItemByValueAsync(e){const t=Fe.getItem(e);return t?Promise.resolve(t):Promise.resolve(e)}equals(e,t){return e==t||!(null==e||!e.valueOf||null==t||!t.valueOf)&&e.valueOf()==t.valueOf()}get itemComparer(){return(e,t)=>this.equals(this.getItemValue(e),this.getItemValue(t))}get typeName(){return this._typeName}get allowZero(){return this._allowZero}displayName}class Ge extends R{_hasMoreItems=!0;_container;constructor(e){super(),this.bindConfig("pageSize",e),e&&e.getFilter&&(this.getFilter=e.getFilter)}loadItemsAsync(e,t){return this._container=e,this._hasMoreItems=!0,this._container.clear(),this.loadNextPageAsync()}async loadNextPageAsync(){if(this.canLoadNextPage&&this._container.itemsSource){const e=this.getFilter(this._container.itemsCount,this.pageSize),t=l.K9.operation.begin({message:"Laoding items from "+this._container.itemsCount,type:o.Local});try{this._container.status="loading";const i=await this._container.itemsSource.getItemsAsync({...e,...this._container.filter});i&&0!=i.length?(i.forEach((e=>this._container.addItem(e))),this._hasMoreItems=i.length==this.pageSize):this._hasMoreItems=!1}finally{t.end(),this._container.status="loaded"}}}onScroll(e){e.pageBottom<1&&this.canLoadNextPage&&this.loadNextPageAsync()}getFilter(e,t){return{...this._container.filter,...this._container.itemsSource.getFilter(void 0,e,t)}}get canLoadNextPage(){return this._hasMoreItems&&"loading"!=this._container.status}pageSize=20;isScrollCheckActive=!0}class We extends Ce{_actionBar;_listView;_searchView;_emptyView;_lastItems;constructor(e){super(e),this.bindConfigString("tooltip",e),this.bindConfig("pageSize",e),this.bindConfig("noMatchingText",e),e&&(e.createItemView&&(this.createItemView=e.createItemView),e.searchAsync&&(this.searchWorkAsync=e.searchAsync),e.query&&(this.searchText=e.query),e.listStyles&&e.listStyles.forEach((e=>this.listStyles.push(e))))}refreshAsync(){return this._listView.refreshAsync()}async createAsync(){this._actionBar=this.view.addView(new ke({onBack:()=>this.closeAsync(),title:this.prop("title"),mainAction:"back"})),this._searchView=new Me({name:"search-expanded",tooltip:this.prop("tooltip"),isExpanded:!0,searchText:this.prop("searchText"),searchAsync:e=>this._listView.refreshAsync()}),this._actionBar.actions.add(this._searchView),this._emptyView=new he({styles:["empty-view"],visible:!1}),this._listView=this.view.addView(new $e({name:"content",styles:this.listStyles,template:"ListViewInline",header:[this._emptyView],itemsSource:new Oe({getItemsAsync:async()=>{const e=this.searchText,t=await this.searchWorkAsync(e);return e||(this._lastItems=t),this.updateView(t?.length>0,e),t}}),itemsLoader:this.pageSize?new Ge({getFilter:(e,t)=>this.getFilter(this.searchText,e,t),pageSize:this.pageSize}):void 0,createItemView:e=>this.createItemView(e),...this.configureListView()})),setTimeout((()=>this._searchView.hasFocus=!0),500),await this.refreshAsync()}updateView(e,t){e?this._emptyView.visible=!1:(this._emptyView.visible=!0,this.searchText?(this._emptyView.icon="far fa-sad-cry",this.noMatchingText&&(this._emptyView.text=h.E.text(this.noMatchingText,t))):(this._emptyView.icon="fas fa-microscope",this._emptyView.text=""))}configureListView(){return{}}createItemView(e){throw"Not Implemented"}searchWorkAsync(e,t,i){throw"Not Implemented"}getFilter(e,t,i){return{}}searchText=null;tooltip=null;pageSize=0;listStyles=["vertical","scroll","compact"];emptyView;noMatchingText=null}W(We,"SearchActivity");var qe=i(4396);class Be extends ce{_element;_margin=20;_isAnimating=0;constructor(e){super({template:"BottomSheet",...e}),this.bindConfig("headHeight",e),this.bindConfig("headSelector",e),this.bindConfig("isShowOpener",e)}attach(e){this._element=e;const t=new qe(e,{recognizers:[[qe.Pan,{direction:qe.DIRECTION_VERTICAL}]]});let i=0,s=this.status,n=0;switch(t.on("panstart",(t=>{s=this.status,this.status="moving",n=e.scrollTop,i=e.clientHeight})),t.on("panend",(t=>{e.clientHeight<this.headHeight-this._margin?this.close():"open"==s?t.deltaY>this._margin&&this._element.scrollTop<=0?this.head():this.open():e.clientHeight>this.headHeight+this._margin?this.open():this.head()})),t.on("panmove",(t=>{let a=t.deltaY;if("open"==s){const e=n-a;if(a<0)return void(this._element.scrollTop=e);if(e>=0)return void(this._element.scrollTop=e);this._element.scrollTop=0,a=-e}let r=i-a;const o=r;let l=!1;r<this._margin?r=0:r>e.parentNode.clientHeight-this._margin&&r<this._element.scrollHeight?(r=e.parentNode.clientHeight,l=!0):r>this._element.scrollHeight?r=this._element.scrollHeight:r>this.headHeight-this._margin&&r<this.headHeight+this._margin&&(r=this.headHeight),e.style.height=r+"px",this._element.scrollTop=o-r>0&&l?o-r:0})),this.status){case"head":this.head();break;case"open":this.open();break;case"close":this.close()}}async setHeightAsync(e){this._isAnimating++,1==this._isAnimating&&this._element.classList.add("animate"),await(0,V.$)(0),this._element.style.height=e.toString()+"px",await(0,V.$)(500),this._isAnimating--,0==this._isAnimating&&this._element.classList.remove("animate")}toggle(){"open"==this.status||"close"==this.status?this.head():this.open()}open(){this.status="open",this._element&&this.setHeightAsync(this._element.scrollHeight)}head(){if(this.status="head",this._element){if(this.headSelector){const e=this._element.querySelector(this.headSelector);e&&(this.headHeight=e.clientHeight,this.isShowOpener&&(this.headHeight+=this._element.querySelector(".opener").clientHeight))}this.setHeightAsync(this.headHeight)}}close(){this.status="close",this._element&&this.setHeightAsync(0)}isShowOpener=!1;headHeight=100;headSelector=null;status="close"}W(Be,"BottomSheet");class Ue extends ce{constructor(e){super(e),this.bindConfig("item",e),e&&e.removeAsync&&(this.removeWorkAsync=e.removeAsync)}async removeAsync(){this.status="removed",await(0,V.$)(150),await this.removeWorkAsync()}removeWorkAsync(){throw"Not supported"}item=null}W(Ue,"RemovableItemView");class ze extends ce{constructor(e){super(e),this.bindConfig("isSelected",e),this.bindConfig("item",e)}select(){this.isSelected=!0}toggle(){this.isSelected=!this.isSelected}isSelected=!1;item=null}W(ze,"SelectableItemView");class Re extends ce{_element;constructor(e){super({template:"Container",...e}),this.bindConfigString("title",e,r.Fq.Title),this.bindConfig("isExpanded",e),this.bindConfig("canExpand",e),this.prop("content").subscribe((()=>this.checkOverflow()))}attach(e){this._element=e,this.canExpand&&(this._element.addEventListener("resize",(()=>this.checkOverflow())),this.checkOverflow())}checkOverflow(){if(null!=this._element){const e=this._element.querySelector(".content-wrapper");null!=e&&(this.isOverflow=e.scrollHeight>e.clientHeight,this.isOverflow||(this.isExpanded=!0))}}onContentChanged(){}toggleExpand(){this.isExpanded=!this.isExpanded}title="";isOverflow=!0;canExpand=!1;isExpanded=!0}W(Re,"Container");class He extends R{_host;constructor(e){super(),this.bindConfig("editor",e),this.bindConfig("value",e),this.bindConfig("styles",e),this.bindConfig("url",e),this.bindConfig("actions",e),this.bindConfig("savePriority",e),this.bindConfig("saveOnCommit",e),this.bindConfigString("title",e,r.Fq.Title),this.bindConfigString("saveLabel",e,r.Fq.Action),e&&e.saveItemAsync&&(this.saveItemAsync=e.saveItemAsync)}async getContentAsync(e){this._host=e,await this.editor.beginEditAsync(this.value);const t=new Re({name:"editor-container",title:this.title,content:this.editor.view});j(this.editor)&&setTimeout((()=>this.editor.activateAsync()),200);const i=[];return this.saveOnCommit?this.editor.prop("value").subscribe((e=>this.saveAsync())):i.push({name:"save",icon:"fas fa-save",displayName:this.saveLabel,operation:o.Global,priority:this.savePriority,executeAsync:()=>this.saveAsync()}),{views:[t],actions:[...this.actions,...i],styles:this.styles,title:this.title,url:this.url}}async saveItemAsync(e){return e}async saveAsync(){if(this.saveOnCommit){if(!this.editor.isValid)return}else if(!await this.editor.commitAsync(!0))return;const e=await this.saveItemAsync(this.editor.value);null!=e&&await this._host.closeAsync(e)}editor=null;title=null;url=null;value=null;saveLabel="Save";saveOnCommit=!1;savePriority=null;actions=[];styles=["vertical","scroll","fill-h","fit-items-h"];info={name:"item-edit",icon:"fas fa-edit",displayName:"Edit"}}class je extends ce{constructor(e){super({template:"WebView",...e})}attach(e){this.window=e.contentWindow}window}W(je,"WebView");class Xe extends be{constructor(e){super(e),this.view=new je,this.updateUrl(),this.prop("url").subscribe((()=>this.updateUrl()))}updateUrl(){this.view.content=m.S.absolute(h.E.replaceArgs(this.url,l.gV.startupArgs))}loadWorkAsync(){return this.view.window&&"complete"!=this.view.window.document.readyState?new Promise(((e,t)=>{this.view.window.addEventListener("load",(function t(i){this.view.window.removeEventListener("load",t),e()})),this.view.window.addEventListener("error",(function e(i){this.view.window.removeEventListener("error",e),t()}))})):Promise.resolve()}refreshAsync(){return this.view.window?new Promise(((e,t)=>{this.view.window.addEventListener("load",(function t(i){this.view.window.removeEventListener("load",t),e()})),this.view.window.addEventListener("error",(function e(i){this.view.window.removeEventListener("error",e),t()})),this.view.window.document.location.reload()})):Promise.resolve()}async closeAsync(){return this.view.window.close(),"goBackAsync"in this.host&&await this.host.goBackAsync(),!0}}W(Xe,"WebPage");class Ye extends ne{_container;_showResolve;_isVisible=!1;constructor(e){super(e),this.bindConfig("className",e),this._container=document.createElement("DIV"),this._container.className=this.className+"-container"}async showAsync(){if(this._isVisible)return;this._isVisible=!0,l.gV.unblock(!0);return new ee(this,this._container).template(this.template,(e=>e)),document.body.appendChild(this._container),await(0,V.$)(0),this._container.classList.add("visible"),new Promise((e=>this._showResolve=e))}hide(e){this._isVisible&&(this._isVisible=!1,l.gV.restoreBlock(),this._container.classList.remove("visible"),this._showResolve&&(this._showResolve(e),this._showResolve=null),setTimeout((()=>{this._isVisible||document.body.removeChild(this._container)}),500))}className=null}W(Ye,"BasePopUpMessage");class Ke extends Ye{_resultResolve;constructor(e){super({template:"PopUpContent",className:"pop-up-content",...e}),this.bindConfig("contentProvider",e),this.bindConfig("contentStyle",e),this.bindConfigString("title",e),this.bindConfigString("closeLabel",e)}async createAsync(){const e=await this.contentProvider.getContentAsync(this);this.closeLabel&&this.addAction({name:"close",icon:"fas fa-close",displayName:this.closeLabel,executeAsync:()=>this.closeAsync()}),e.actions&&e.actions.forEach((e=>this.addAction(e))),!this.title&&e.title&&(this.title=h.E.title(e.title)),this.contentView.content.clear(),e.views&&e.views.forEach((e=>this.contentView.addView(e))),this.contentView.styles=[...this.contentStyle,...e.styles]}get result(){return new Promise((e=>this._resultResolve=e))}async openAsync(){return await this.createAsync(),await this.contentView.loadAsync(),this.showAsync(),this}notifyContentChanged(e){this.createAsync()}closeAsync(e){return this._resultResolve&&this._resultResolve(e),this.hide(""),Promise.resolve(!0)}addAction(e){const t=me.fromAction(e);return e.priority==xe.Evidence&&(t.styles.push("primary"),t.buildStyles()),this.actions.add(t),t}contentProvider=null;actions=se();contentView=new we;title=null;contentStyle=["vertical","fill-h","fit-items-h"];closeLabel="Cancel"}W(Ke,"PopUpContent");class Je extends R{constructor(e){super(),this.bindConfig("name",e),this.bindConfig("editor",e),this.bindConfig("actions",e),this.bindConfig("styles",e),this.bindConfig("saveOnCommit",e),this.bindConfig("savePriority",e),this.bindConfigString("title",e,r.Fq.Title),this.bindConfigString("closeLabel",e,r.Fq.Action),this.bindConfigString("saveLabel",e,r.Fq.Action),e&&e.editToItemAsync&&(this.editToItemAsync=e.editToItemAsync),this.closeLabel||(this.closeLabel=h.E.action("cancel")),this.saveLabel||(this.saveLabel=h.E.action("ok"))}async editAsync(e,t){const i=new Ke({title:this.title,contentProvider:new He({editor:this.editor,value:e,actions:this.actions,styles:this.styles,savePriority:this.savePriority,saveOnCommit:this.saveOnCommit,saveLabel:this.saveLabel,saveItemAsync:async e=>{if(t){if(null==await t(e))return null}return await this.editToItemAsync(e)}}),closeLabel:this.closeLabel});return await(await i.openAsync()).result?this.editor.value:null}editToItemAsync(e){return Promise.resolve(e)}editor=null;title="Edit";saveLabel=null;actions=[];savePriority=null;closeLabel=null;saveOnCommit=!1;styles=[];name=null}W(Je,"PopUpEditor");class Ze extends le{_needValidation=!1;_isEditing=0;_onCommit;_editValue=null;constructor(e){super({...e}),function(e,t){let i=G(e);for(;;){const s=Object.getOwnPropertyDescriptor(i.prototype,t);if(s)return void(s.enumerable||(s.enumerable=!0,Object.defineProperty(e,t,s)));i=O(i)}}(this,"editValue"),this._onCommit=e?.onCommit,this.bindConfig("allowNull",e),this.bindConfig("hasFocus",e),this.bindConfig("value",e),this.bindConfig("commitMode",e),this.bindConfig("validationMode",e),this.prop("displayValue"),this.prop("value").subscribe(((e,t)=>this.onValueChanged(e,t))),this.prop("name").subscribe((()=>this.updateUid())),e.converter&&(this.editToValue=e.converter.convertFrom,this.valueToEdit=e.converter.convertTo),this.updateUid()}updateUid(){var e;this.uid=((e=oe(this.name??F(this)))||(e="item"),void 0===x[e]&&(x[e]=0),x[e]++,1==x[e]?e:e+x[e])}createEditValueProp(){this.prop("editValue").subscribe((()=>this.notifyEditValueChangedAsync()))}async notifyEditValueChangedAsync(){console.debug("value changed: ",this.debugName),this._needValidation=!0,this.isDirty=!0,this._isEditing||("onchange"==this.commitMode?await this.commitAsync():await this.validateAsync())}onValueChanged(e,t){"commiting"!=this.status&&this.beginEditAsync(e)}clear(){this.value=null}async loadAsync(){console.group("begin load: ",this.debugName," - status: ",this.status);try{if("none"!=this.status)return;this.status="loading";try{await this.loadAsyncWork()}finally{this.status="loaded"}}finally{console.groupEnd()}}clearError(){this.error=null}loadAsyncWork(){return Promise.resolve()}async beginEditAsync(e){if(!this._isEditing){console.group("begin edit: ",this.debugName),this._isEditing++;try{"none"==this.status&&await this.loadAsync(),this.value=e,this.editValue=this.valueToEdit(e),await this.beginEditWorkAsync(e),this._needValidation=!0}finally{this._isEditing--,console.groupEnd()}}}valueToEdit(e){return e}editToValue(e){return e}beginEditWorkAsync(e){return Promise.resolve()}async validateAsync(e){console.group("begin validation: "+this.debugName," - needValidation: ",this._needValidation);try{if(this._isEditing)return;if(!this._needValidation&&"onchanged"==this.validationMode&&!e)return this.isValid;this.clearError();const t=await this.validateAsyncWork(e);return void 0!==t&&(this.isValid=t,this._needValidation=!1),console.debug("validation: ",this.debugName," = ",this.isValid),this.isValid}finally{console.groupEnd()}}validateAsyncWork(e){return Promise.resolve(!0)}async commitAsync(e){console.group("begin commit: ",this.debugName," isDirty: ",this.isDirty," - status: ",this.status);try{if(this._isEditing)return!1;if(!e&&"manual"!=this.commitMode&&!this.isDirty)return!0;if("loaded"!=this.status)return"commiting"==this.status;this.status="commiting";try{if(!await this.validateAsync(e))return!1;if(!await this.commitAsyncWork(e))return!1;const t=this.editToValue(this.editValue);return void 0!==t&&(this.value=t),this._onCommit&&this._onCommit(this),this.isDirty=!1,!0}finally{this.status="loaded"}}finally{console.groupEnd()}}activateAsync(){return Promise.resolve()}commitAsyncWork(e){return Promise.resolve(!0)}rollback(){this.editValue=this.valueToEdit(this.value)}get view(){return this}get editValue(){return this._editValue}set editValue(e){this._editValue=e}isValid=!0;status="none";commitMode="onchange";validationMode="onchanged";allowNull=!0;displayValue=null;value=null;hasFocus=!1;isDirty=!1;uid=null;error=null}W(Ze,"BaseEditor");i(3999);class Qe extends Ze{_isSelecting;constructor(e){super({template:"SelectEditor",...e}),this.bindConfig("itemsSource",e),this.bindConfig("itemTemplate",e),this.bindConfigString("placeholder",e),this.bindConfigString("emptyText",e,r.Fq.Title),e?.createItemView&&(this.createItemViewWork=e?.createItemView),e?.items&&(this.allowNull&&this.items.add(this.createEmptyItem()),e.items.forEach((e=>this.items.add(this.createItemView(e)))),this.status="loaded"),this.prop("selectedItem").subscribe((async(e,t)=>{if(!this._isSelecting){if(!e&&this.emptyText)return this.selectedItemText=this.emptyText,void(this.selectedItem=this.items.get(0));this._isSelecting=!0;try{t&&(t.isSelected=!1),e&&(e.isSelected=!0),this.selectedIndex=this.items.indexOf(e),this.itemsSource&&(this.selectedItemText=e?.content??""),"loading"!=this.status&&await this.notifyEditValueChangedAsync()}finally{this._isSelecting=!1}}})),this.prop("selectedIndex").subscribe((e=>{-1==e&&this.emptyText?this.selectedIndex=0:(this.selectedItem=-1==e?null:this.items.get(e),"SELECT"==this.element?.tagName&&(this.element.selectedIndex=e))}))}attach(e){this.element=e,"SELECT"==e.tagName&&(this.element.selectedIndex=this.selectedIndex,this.element.addEventListener("change",(()=>this.selectedIndex=e.selectedIndex)))}async selectAsync(){const e=new Je({editor:new Qe({template:"ItemSelectorList",itemsSource:this.itemsSource,allowNull:!1,styles:["no-padding-items-h"]}),saveOnCommit:!0,saveLabel:"select",closeLabel:"cancel",title:"select-an-item",styles:[""]}),t=await e.editAsync(this.value);null!==t&&(this.editValue=t)}findItemByValue(e){return this.itemsSource?(0,c.k)(this.items).first((t=>this.itemsSource.equals(t.item,e))):(0,c.k)(this.items).first((t=>t.item==e))}set editValue(e){this.editValue!=e&&(null==e&&this.emptyText?this.selectedItem=this.items[0]:this.selectedItem=this.findItemByValue(e))}get editValue(){return this.selectedItem?.item}async loadAsyncWork(){if(this.itemsSource){this.items.clear(),this.allowNull&&this.items.add(this.createEmptyItem());const e=await this.itemsSource.getItemsAsync(this.itemsSource.getFilter());e&&e.forEach((e=>this.items.add(this.createItemView(e))))}this.selectedIndex=0,this.isDirty=!0}createEmptyItem(){const e=new ze({item:null,content:this.emptyText??"",template:this.itemTemplate,styles:["single","checkbox"]});return e.prop("isSelected").subscribe((e=>{e&&(this.selectedItem=null)})),e}createItemViewWork(e){if(this.itemsSource)return new ze({item:this.itemsSource.getItemValue(e),content:this.itemsSource.getItemText(e),template:this.itemTemplate,styles:["single","checkbox"]})}createItemView(e){const t=this.createItemViewWork(e);return t.prop("isSelected").subscribe((e=>{e&&(this.selectedItem=t)})),t}itemTemplate="SelectableItemView";placeholder=null;emptyText=null;selectedItemText=null;selectedItem=null;selectedIndex=-1;itemsSource=null;items=se()}W(Qe,"SingleItemSelector");const et={selectFileAsync:e=>new Promise(((e,t)=>{const i=document.createElement("input");i.type="file";let s=!1;i.onchange=()=>{s=!0,e(i.files[0])},i.click();const n=async()=>{window.removeEventListener("focus",n),await(0,V.$)(500),s&&0!=i.files.length||e(void 0)};window.addEventListener("focus",n)})),selectOptionAsync:async e=>{const t=new Je({editor:new Qe({template:"ItemSelectorList",itemsSource:e.itemsSource,styles:["no-padding-items-h"]}),saveOnCommit:null==e.saveOnCommit||e.saveOnCommit,saveLabel:e.saveLabel,closeLabel:e.closeLabel,title:e.title,styles:e.styles});return await t.editAsync(e.value)},loadPageAsync:async(e,t)=>await l.gV.pageHost.loadAsync(e,t),content:(e,t,i)=>{const s="function"==typeof e?new e:e,n=new Pe({providers:[s],...t});return et.loadPageAsync(n,i)},go:e=>(window.location.href=e,Promise.resolve()),call:e=>(window.location.href="tel:"+e,Promise.resolve()),email:e=>(window.location.href="mailto:"+e,Promise.resolve()),webPage:e=>et.loadPageAsync(new Xe({url:e})),navigate:e=>new Promise(((t,i)=>{const s=window.open(e,"_blank");s.addEventListener("load",(e=>{t()})),s.addEventListener("error",(e=>{i()}))})),facebookPage:e=>(window.location.href="https://www.facebook.com/"+e,Promise.resolve()),maps:(e,t=17)=>(e.position?window.location.href="https://www.google.com/maps/search/?api=1&query="+e.position.latitude+","+e.position.longitude:window.location.href="https://www.google.com/maps/search/?api=1&query="+encodeURIComponent(e.address),Promise.resolve())};class tt extends R{constructor(e){super(),this.bindConfig("editor",e),this.bindConfigString("title",e),e&&e.editToItemAsync&&(this.editToItemAsync=e.editToItemAsync)}async editAsync(e,t){const i=new Pe({providers:[new He({editor:this.editor,title:this.title,value:e,saveItemAsync:async e=>{if(t){if(null==await t(e))return null}return await this.editToItemAsync(e)}})]});return null==await(await et.loadPageAsync(i,{loadMode:"add"})).result?null:this.editor.value}editToItemAsync(e){return Promise.resolve(e)}editor=null;title="Edit"}W(tt,"ActivityEditor");class it extends We{_bottomSheet;_emptyItem;constructor(e){super(e),this.bindConfig("canAdd",e),this.bindConfigString("emptyLabel",e,r.Fq.Title),this.bindConfig("showEmptyItem",e),this.bindConfig("itemsSource",e),this.bindConfigString("addLabel",e),e&&(e.createItemView&&(this.createItemContentView=e.createItemContentView),e.createItemListView&&(this.createItemListView=e.createItemListView),e.createItemEditor&&(this.createItemEditor=e.createItemEditor),e.filters&&this.filters.addRange(e.filters),e.selectedItems&&this.setSelectedItems(e.selectedItems),"client"==e.searchMode&&(this.searchWorkAsync=async e=>(this._lastItems||(this._lastItems=await this.itemsSource.getItemsAsync(this.getFilter(void 0))),e?(e=e.toLowerCase(),(0,c.k)(this._listView.items).where((t=>{const i=this.itemsSource.getItemText(t).toLowerCase();return i&&-1!=i.indexOf(e)})).toArray()):this._lastItems))),e?.tooltip||(this.tooltip=r.wI.get("select-item")({params:[this.itemsSource.displayName],number:r.sZ.Plural,usage:r.Fq.Tooltip})),e?.addLabel||(this.addLabel=h.E.action("new-item",this.itemsSource.displayName))}setSelectedItems(e){this.selectedItems.clear(),e&&e.forEach((e=>this.addSelection(e)))}async createAsync(){await super.createAsync(),this._actionBar.addAction({name:"confirm",icon:"fas fa-check",displayName:"confirm",executeAsync:()=>this.confirmAsync(),priority:xe.Primary}),this._bottomSheet=new Be({headHeight:50,content:new _e({styles:["padding","horizontal-wrap"],content:this.selectedItems})}),this.view.addView(this._bottomSheet),this.updateView()}async confirmAsync(){await this.closeAsync((0,c.k)(this.selectedItems).select((e=>e.item)).toArray())}configureListView(){const e=[];this.canAdd&&e.push(me.fromAction({name:"add-item",icon:"fas fa-plus",operation:o.Local,executeAsync:()=>this.addItemAsync(),displayName:this.addLabel})),this.showEmptyItem&&(this._emptyItem=new ze({content:new Le({content:this.emptyLabel}),item:null}),this._emptyItem.toggle=()=>this.closeAsync([]),e.push(this._emptyItem));const t={header:e,selectionMode:"multiple"};return this.pageSize>0&&(t.itemsSource=this.itemsSource),t}searchWorkAsync(e){return this.itemsSource.getItemsAsync(this.getFilter(e))}getFilter(e,t,i){let s=this.itemsSource.getFilter(e,t,i);return 1==this.filters.count&&(s={...s,...this.filters.get(0).content}),s}createItemListView(e){return new Le({content:this.itemsSource.getItemText(e)})}createItemContentView(e){return new Le({content:this.itemsSource.getItemText(e)})}createItemEditor(){throw"Not Supported"}createItemView(e){const t=new ze({content:this.createItemListView(e),item:e});t.prop("isSelected").subscribe((i=>this.updateSelection(t,e,i)));return null!=this.findItem(e)&&(t.isSelected=!0),t}updateSelection(e,t,i){i?this.addSelection(t,e):this.removeSelection(t),this.updateView()}updateView(){this._bottomSheet&&(this.selectedItems.count>0?this._bottomSheet.open():this._bottomSheet.close())}removeSelection(e){const t=this.findItem(e);t&&this.selectedItems.remove(t)}addSelection(e,t){if(this.findItem(e))return;const i=new Ue({content:this.createItemContentView(e),removeAsync:()=>{this.selectedItems.remove(i);const t=this.findSelectable(e);return t&&(t.isSelected=!1),Promise.resolve()},item:e});return this.selectedItems.add(i),i}findItem(e){return(0,c.k)(this.selectedItems).first((t=>this.itemsSource.itemComparer(t.item,e)))}findSelectable(e){return(0,c.k)(this._listView.content).first((t=>this.itemsSource.itemComparer(t.item,e)))}async addItemAsync(){const e=this.createItemEditor();let t;if(H(e))t=await e.editAsync(this.itemsSource.newItem());else{const i=new tt({editor:e,title:this.addLabel});t=await i.editAsync(this.itemsSource.newItem())}if(!t)return;const i=await this.itemsSource.addItemAsync(t);if(!i)return;const s=this.createItemView(i);s.isSelected=!0,this._listView.content.insert(0,s)}canAdd=!1;showEmptyItem=!1;emptyLabel="[None]";itemsSource=null;addLabel="Add New";filters=se();selectedItems=se()}W(it,"SelectMultipleItemsActivity");class st extends We{constructor(e){super(e),this.bindConfig("canAdd",e),this.bindConfig("itemsSource",e),this.bindConfig("selectedValue",e),this.bindConfigString("addLabel",e),e&&(e.createItemContentView&&(this.createItemContentView=e.createItemContentView),e.createItemEditor&&(this.createItemEditor=e.createItemEditor),e.filters&&this.filters.addRange(e.filters)),e?.tooltip||(this.tooltip=h.E.tooltip("select-item",this.itemsSource.displayName)),e?.addLabel||(this.addLabel=h.E.action("new-item",this.itemsSource.displayName))}async createAsync(){await super.createAsync(),this._actionBar.addAction({name:"confirm",icon:"fas fa-check",displayName:"confirm",executeAsync:()=>this.confirmAsync(),priority:xe.Primary})}async confirmAsync(){await this.closeAsync()}configureListView(){const e=[];this.canAdd&&e.push(me.fromAction({name:"add-item",icon:"fas fa-plus",operation:o.Local,executeAsync:()=>this.addItemAsync(),displayName:this.addLabel}));const t={header:e};return this.pageSize>0&&(t.itemsSource=this.itemsSource),t}searchWorkAsync(e){return this.itemsSource.getItemsAsync(this.getFilter(e))}getFilter(e,t,i){let s=this.itemsSource.getFilter(e,t,i);return 1==this.filters.count&&(s={...s,...this.filters.get(0).content}),s}createItemContentView(e){return new Le({content:this.itemsSource.getItemText(e)})}createItemEditor(){throw"Not Supported"}createItemView(e){const t=new ze({content:this.createItemContentView(e),styles:["single"],item:e});return this.itemsSource.equals(this.itemsSource.getItemValue(e),this.selectedValue)&&(t.isSelected=!0),t.prop("isSelected").subscribe((t=>{t&&this.setSelectionAsync(e)})),t}setSelectionAsync(e){return this.closeAsync(e)}async addItemAsync(){const e=this.createItemEditor();let t;if(H(e))t=await e.editAsync(this.itemsSource.newItem());else{const i=new tt({editor:e,title:this.addLabel});t=await i.editAsync(this.itemsSource.newItem())}if(!t)return;const i=await this.itemsSource.addItemAsync(t);i&&await this.setSelectionAsync(i)}canAdd=!1;itemsSource=null;addLabel="Add New";filters=se();selectedValue=null}W(st,"SelectSingleItemActivity");class nt extends ne{constructor(e){super(),this.content=e}debugTypeName(){}content}class at extends nt{constructor(e,...t){super(t),this.type=e,this.template="ConsoleMessageView"}type}class rt extends nt{constructor(...e){super(e),this.template="ConsoleGroupView"}items=se()}W(class extends le{_oldConsole;_groups=[];_activeGroup;_isCreated=!1;constructor(){super({template:"ConsoleView"}),this.root=new rt,this._activeGroup=this.root}debugTypeName(){}show(){this._isCreated||new ee(this,document.body).content(this);this.visible=!0}hide(){this.visible=!1}attach(){if(!this._oldConsole){this._oldConsole={};for(const e in console)this._oldConsole[e]=console[e];console.log=(...e)=>this.write("log",e),console.warn=(...e)=>this.write("warn",e),console.info=(...e)=>this.write("info",e),console.trace=(...e)=>this.write("trace",e),console.error=(...e)=>this.write("error",e),console.debug=(...e)=>this.write("debug",e),console.clear=()=>this.clear(),console.group=(...e)=>this.group(e),console.groupEnd=()=>this.groupEnd()}}detach(){if(this._oldConsole){for(const e in console)console[e]=this._oldConsole[e];this._oldConsole=null}}write(e,t){this._oldConsole[e].apply(console,t),this._activeGroup.items.add(new at(e,t)),"error"==e&&this._activeGroup.items.add(new at(e,(new Error).stack))}group(e){this._oldConsole.group.apply(console,e);const t=new rt(e);this._activeGroup.items.add(t),this._groups.push(t),this._activeGroup=t}groupEnd(){this._oldConsole.groupEnd.apply(console),this._groups.length>0&&(this._activeGroup=this._groups.pop())}clear(){this._oldConsole.clear.apply(console),this._groups=[],this.root.items.clear(),this._activeGroup=this.root}root},"ConsoleView");var ot;W(class extends we{_body;_actions;constructor(e){super({...e}),this.bindConfig("contentProvider",e),this.bindConfig("actionTemplate",e),this._body=new we({name:"body"}),this._actions=new we({name:"actions"}),this.addView(this._body),this.addView(this._actions),this._body.emptyView=this.emptyView,this.emptyView=null}async loadAsync(){if(this.contentProvider){await this.closeAsync();const e=await this.contentProvider.getContentAsync(this);e.styles&&(this._body.styles=e.styles),this.name=this.contentProvider.info.name,this.title=h.E.title(e.title),e.views.forEach((e=>this._body.addView(e))),e.actions&&e.actions.forEach((e=>this.addAction(e))),await super.loadAsync(),this.contentProvider.activateAsync&&await this.contentProvider.activateAsync()}this._actions.visible=this._actions.content.count>0}addAction(e){this._actions.addView(me.fromAction(e,{template:this.actionTemplate}))}notifyContentChanged(e){this.loadAsync()}async closeAsync(e){return this.contentProvider?.deactivateAsync&&await this.contentProvider.deactivateAsync(),this._body.clear(),this._actions.clear(),this.title=null,!0}title=null;actionTemplate="ActionButton";contentProvider=null},"ContentHostView"),function(e){e.cubic=function(e,t,i,s){return n=>Math.pow(1-n,3)*e+3*Math.pow(1-n,2)*n*t+3*(1-n)*Math.pow(n,2)*i+Math.pow(n,3)*s},e.linear=function(){return e=>e},e.animate=function(e){let t=0;const i=setInterval((()=>{t>e.duration&&(t=e.duration),e.step(e.timeFunction(t/e.duration)),t==e.duration&&clearInterval(i),t+=e.stepTime}),e.stepTime)}}(ot||(ot={}));W(class extends ce{constructor(e){super({template:"CounterView",...e}),this.bindConfig("value",e),this.bindConfig("title",e),this.prop("value").subscribe((()=>this.animate())),null!=this.value&&this.animate()}animate(){this.content=0;const e=this.value/200;return ot.animate({timeFunction:ot.linear(),duration:isNaN(e)||e<1?1:e,stepTime:.05,step:e=>this.content=Math.round(this.value*e)})}title=null;value=0},"CounterView");class lt{_host;constructor(e,t){this._host=e,t&&(this.label=h.E.action(t.label),t.actions.forEach((e=>this.addAction(e))))}addAction(e){const t=me.fromAction(e,{executeAsync:async()=>{this._host.hideAsync(),await e.executeAsync()}});return this.actions.add(t),t}actions=se();label=null}W(class extends ne{constructor(e){super({template:"Drawer",...e}),this.bindConfig("header",e),e&&e.groups.forEach((e=>this.addGroup(e)))}onGesture(e){e.type==Ae.SwipeLeft&&this.hideAsync()}getGroup(e){const t=h.E.action(e);return(0,c.k)(this.groups).first((e=>e.label==t))}addGroup(e){const t=new lt(this,e);return this.groups.add(t),t}attach(e){e.addEventListener("click",(e=>{e.srcElement==e.currentTarget&&this.hideAsync()}))}async showAsync(e){this.status="showing",await(0,V.$)(0),this.status="visible"}async hideAsync(){this.status="hiding",await(0,V.$)(500),"hiding"==this.status&&(this.status="hidden")}status="hidden";header=null;groups=se()},"Drawer");class ct extends le{_input;constructor(e){super(e),this._input=document.createElement("input"),this._input.type="file",this._input.addEventListener("change",(()=>{this.update(),e?.onChanged&&e.onChanged()})),this.update()}update(){const e=this._input.files[0];e?(this.text=e.name,this.status="selected"):(this.text="Seleziona file",this.status="empty"),this.isSelected=null!=this._input.files[0]}select(){this._input.click()}remove(){}async uploadAsync(e){this.status="uploading";const t=await u.e.postBinaryAsync(e,this._input.files[0],(e=>(this.progress=e.loaded/e.total,!0)));return this.status="uploaded",t}get file(){return this._input.files&&0!=this._input.files.length?this._input.files[0]:null}progress=0;text=null;progressText=null;status="empty";error=null;isSelected=!1}W(ct,"FileUploadView");W(class extends $e{constructor(e){super({styles:["grid"],...e}),this.bindConfig("colsCount",e),this.bindConfig("rowsCount",e)}colsCount=0;rowsCount=0},"GridView");var dt,ht,ut;i(9337);W(class extends ce{constructor(e){super(e),this.bindConfig("header",e)}header=null;headerTemplate=null},"HeadedContentView");W(class extends ce{constructor(e){super({template:"Html",...e})}},"HtmlView");class mt extends ce{constructor(e){super({template:"Image",...e})}loadAsync(){return this.content?function(e){const t=l.K9.operation.begin({message:"Loading image: "+e.substring(0,50),type:o.Local});return new Promise(((i,s)=>{const n=document.createElement("img");n.addEventListener("load",(()=>{i(n),t.end()})),n.addEventListener("error",(e=>{s(e?.error),t.end()})),n.src=e}))}(this.content):Promise.resolve()}}W(mt,"ImageView");class pt extends we{_otherAction;constructor(e){super({template:"ItemView",...e}),this.bindConfig("item",e),this.bindConfig("canOpen",e),e&&(e.open&&(this.openWork=e.open),e.actions&&e.actions.forEach((e=>this.addAction(e))),e.itemTemplate&&this.content.add(new ne({template:t=>t.template(e.itemTemplate,this)}))),this.computed("hasActions",(e=>(0,c.k)(e.contextActions).any((e=>e.visible)))),this.create()}addAction(e){const t=me.fromItemAction(e,(()=>this.item));e.priority==xe.Primary?this.mainActions.length>=3?(this._otherAction||(this._otherAction=me.fromAction({name:"other",icon:"fas fa-ellipsis-h",operation:o.Local,executeAsync:()=>Promise.resolve()}),this._otherAction.subActions.add(this.mainActions.pop()),this.mainActions.push(this._otherAction)),this._otherAction.subActions.add(t)):this.mainActions.push(t):(this.contextActions.push(t),this.prop("hasActions").notifyChanged())}create(){}open(){this.canOpen&&this.openWork()}openWork(){}showMenu(){const e=new de;this.contextActions.forEach((t=>e.actions.add(t))),e.showAsync(window.event.srcElement)}item=null;contextActions=[];mainActions=[];status=null;canOpen=!1;hasActions=null}W(pt,"ItemView");W(class extends ce{constructor(e){super({template:"LocationView",...e}),e&&(e.mapSize&&(this.mapSize=e.mapSize),e.zoomLevel&&(this.zoomLevel=e.zoomLevel)),this.updateAsync()}onContentChanged(){this.updateAsync()}showMap(){et.maps(this.content)}async updateAsync(){const e=l.K9.mapManager();let t=this.content.position;t||(t=await e.getLocationAsync(this.content.address)),this.map=e.staticMap({center:t,size:this.mapSize,zoomLevel:this.zoomLevel,pins:[{center:t,icon:113,name:this.content.name}]})}map;mapSize={width:1280,height:720};zoomLevel=16},"LocationView");class gt{_waitHandlers=[];_isSet;_autoReset;constructor(e=!1,t=!0){this._isSet=e,this._autoReset=t}set(){this._isSet=!0;for(let e=this._waitHandlers.length-1;e>=0;e--)this._waitHandlers[e](!0)}reset(){this._isSet=!1}waitFor(e){return this._isSet?(this._autoReset&&0==this._waitHandlers.length&&this.reset(),Promise.resolve(!0)):new Promise((t=>{const i=e=>{t(e);const s=this._waitHandlers.indexOf(i);-1!=s&&this._waitHandlers.splice(s,1),0==this._waitHandlers.length&&this._autoReset&&this.reset()};e&&setTimeout((()=>{const e=this._waitHandlers.indexOf(i);-1!=e&&(this._waitHandlers.splice(e,1),t(!1))}),e.totalMilliseconds),this._waitHandlers.push(i)}))}get isSet(){return this._isSet}}W(class extends _e{_manager;constructor(e){super({template:"Attach",...e}),this.bindConfig("itemsSource",e),this.bindConfig("showCurrentPosition",e),e&&(e.manager&&(this._manager=e.manager),e.createMapItem&&(this.createMapItem=e.createMapItem)),this._manager||(this._manager=l.K9.mapManager()),this.prop("selectedItem").subscribe((t=>{this._manager.selectedItem=t?t["@mapItem"]:null,e&&e.onItemSelected&&e.onItemSelected(t)})),this._manager.onSelectionChanged=()=>{this._manager.selectedItem?this.selectedItem=this._manager.selectedItem["@item"]:this.selectedItem=null},this.prop("showCurrentPosition").subscribe((e=>{this.manager.showCurrentPositionAsync(e)}))}async loadItemsAsync(e){if(!this.itemsSource)return;this.beginUpdate(),this.content.clear(),this.status="loading";const t=l.K9.operation.begin({message:"Loading items",type:o.Local});try{const i=await this.itemsSource.getItemsAsync(e);i&&i.forEach((e=>this.content.add(e))),this.mapReady.isSet&&this.initItems()}finally{t.end(),this.status="",this.endUpdate()}}attach(e){l.K9.operation.progress("Map attacched"),this._manager&&this._manager.attach(e),this.mapReady.set(),"loading"!=this.status&&this.initItems(),this._manager.showCurrentPositionAsync(this.showCurrentPosition)}initItems(){const e=(0,c.k)(this.content).select((e=>this.createMapItem(e))).toArray(),t=this._manager.addItems(e);for(let e=0;e<t.length;e++)$(this.content.get(e),"@mapItem",t[e]),$(t[e],"@item",this.content.get(e))}createMapItem(e){}onItemAdded(e){if(!this.mapReady.isSet)return;const t=this.createMapItem(e);if(!t.location||isNaN(t.location.latitude)||isNaN(t.location.longitude))return void console.warn("Invalid location for "+t.title);const i=this._manager.addItems([t]);$(e,"@mapItem",i),$(i,"@item",e)}onItemRemoved(e){if(!this.mapReady.isSet)return;const t=L(e,"@mapItem");t&&this._manager.removeItem(t)}itemsSource=null;status="";selectedItem=null;showCurrentPosition=!1;mapReady=new gt;get manager(){return this._manager}},"MapItemsView");W(class extends le{constructor(e){super({template:"Attach",...e}),e&&(e.onMapLoaded&&(this.onMapLoaded=e.onMapLoaded),e.manager&&(this.manager=e.manager),this.bindConfig("showCurrentPosition",e)),this.manager||(this.manager=l.K9.mapManager()),this.prop("showCurrentPosition").subscribe((e=>{this.manager.showCurrentPositionAsync(e)}))}attach(e){this.manager&&this.manager.attach(e),this.mapReady.set(),this.onMapLoaded(),this.manager.showCurrentPositionAsync(this.showCurrentPosition)}onMapLoaded(){}showCurrentPosition=!1;manager;mapReady=new gt},"MapView");class ft extends ce{_video;constructor(e){super({template:"VideoView",...e}),this.bindConfig("isAutoPlay",e),this.bindConfig("isMuted",e),this.bindConfig("showControls",e),this.bindConfig("isLoop",e)}onContentChanged(){this.updateVideo()}attach(e){this._video=e,this.updateVideo()}loadAsync(){return this.content?this._video?function(e,t){if(!t.paused||t.played)return Promise.resolve();const i=l.K9.operation.begin({message:"Loading image: "+e,type:o.Local});return new Promise(((s,n)=>{function a(){t.removeEventListener("playing",r),t.removeEventListener("error",o)}const r=()=>{i.end(),a(),s(void 0)},o=e=>{i.end(),a(),n(e.error)};t.addEventListener("playing",r),t.addEventListener("error",o),t.src=e,t.play()}))}(this.content,this._video):function(e){const t=l.K9.operation.begin({message:"Loading video: "+e.substring(0,50),type:o.Local});return new Promise(((i,s)=>{const n=document.createElement("video");n.addEventListener("playing",(()=>{n.pause(),t.end(),i(n)})),n.addEventListener("error",(e=>{t.end(),s("error"in e?e.error:"video load error")})),n.src=e,n.muted=!0,n.play(),n.readyState>=2&&i(n)}))}(this.content):Promise.resolve()}updateVideo(){this._video&&(this._video.muted=this.isMuted,this._video.autoplay=this.isAutoPlay,this._video.controls=this.showControls,this._video.loop=this.isLoop,this.content&&this._video.load())}play(){this._video&&this._video.play()}pause(){this._video&&this._video.pause()}isAutoPlay=!0;isMuted=!0;showControls=!1;isLoop=!0}W(ft,"VideoView");class vt extends ce{_imageConfig={};_videoConfig={};constructor(e){super({template:"MediaView",...e}),e&&(e.image&&(this._imageConfig=e.image),e.video&&(this._videoConfig=e.video)),this.updateContent()}loadAsync(){return this.activeView?this.activeView.loadAsync():Promise.resolve()}onContentChanged(){this.updateContent()}updateContent(){this.content&&"image"==this.content.type&&(this.activeView=new mt({...this._imageConfig,content:this.content.src})),this.content&&"video"==this.content.type&&(this.activeView=new ft({...this._videoConfig,content:this.content.src}))}activeView=null}W(vt,"MediaView");class yt extends Ye{constructor(e){super({template:"MessageBox",className:"message-box",...e}),this.bindConfigString("title",e,r.Fq.Title),this.bindConfigString("message",e,r.Fq.Message),this.bindConfig("icon",e),e&&e.actions&&e.actions.forEach((e=>this.addAction(e)))}addAction(e){const t=e.styles??[];e.priority==xe.Evidence&&t.push("primary"),this.actions.add(me.fromAction(e,{template:"ActionButton",styles:t,executeAsync:async()=>{await e.executeAsync(),this.hide(e.name)}}))}actions=se();message=null;title=null;icon=null}W(yt,"MessageBox");W(class extends le{constructor(e){super(e)}},"ProgressView");class bt extends Ze{_element;constructor(e){super(e),this.bindConfig("trackMode",e),this.prop("hasFocus").subscribe((e=>this.onFocusChanged(e)))}attach(e){this._element=e}async activateAsync(){if("INPUT"==this._element.nodeName||"TEXTAREA"==this._element.nodeName)for(;;){const e=this._element;if(e.selectionStart=0,e.selectionEnd=e.value?.length,this._element.focus(),this.hasFocus)break;await(0,V.$)(100)}}onFocusChanged(e){e||"onlostfocus"!=this.trackMode||this.notifyEditValueChangedAsync()}notifyEditValueChangedAsync(){return this.hasFocus&&"onlostfocus"==this.trackMode?(this._needValidation=!0,this.isDirty=!0,Promise.resolve()):super.notifyEditValueChangedAsync()}trackMode="onlostfocus"}W(bt,"BaseTextEditor");class _t extends bt{constructor(e){super({template:"NumberEditor",...e}),this.bindConfig("placeholder",e),this.bindConfig("precision",e),this.createEditValueProp()}valueToEdit(e){return isNaN(e)?"":(null!=this.precision?e.toFixed(this.precision):e.toString()).replace(".",",")}editToValue(e){const t=parseFloat(e?.replace(",","."));return isNaN(t)?null:t}placeholder=null;min=null;max=null;precision=null}W(_t,"NumberEditor");class wt extends le{_lastValidationValue=void 0;constructor(e){super({template:"PropertyView",...e}),this.bindConfig("host",e),this.bindConfig("editor",e),this.bindConfig("readonly",e),this.bindConfig("showLabel",e),this.bindConfig("value",e),this.bindConfigString("label",e,r.Fq.Label),this.prop("error"),e&&(e.onChanged&&this.prop("value").subscribe(((t,i)=>e.onChanged(t,i,this.host?.editValue,"editor"))),e.validators&&(this.validators=e.validators)),this.prop("editor").subscribe((()=>this.bindEditor())),this.bindEditor()}bindEditor(){this.editor&&(this.editor.name=this.name,this.editor.value=this.value,this.bind("value",this.editor.prop("value")),this.bind("isDirty",this.editor.prop("isDirty")),"label"in this.editor&&(this.bind("label",this.editor.prop("label")),this.showLabel=!1),this.editor.prop("isValid").subscribe((e=>{e||(this.isValid=!1),this.error=this.editor.error})))}clearError(){this.editor.error=null,this.error=null}async validateAsync(e,t){console.group("begin validation: "+this.label," - needValidation: ",this.isDirty);try{await(0,V.$)(0);const i=this.editor instanceof _t?this.editor.value:this.editor.editValue;if(!t&&void 0!==this._lastValidationValue&&N(this._lastValidationValue,i))return this.isValid;if(this.clearError(),this._lastValidationValue=i,!await this.editor.validateAsync(t))return this.isValid=!1,this.error=this.editor.error,!1;const s={value:i,fieldName:this.label,target:e};for(const e of this.validators){const t=await e.validateAsync(s);if(!t.isValid)return this.error=h.E.message(t.error),this.isValid=!1,!1}return this.isValid=!0,!0}finally{console.groupEnd()}}loadAsync(){return this.editor.loadAsync()}clear(){this.editor.clear(),this.clearError()}isDirty=null;isValid=!0;value=null;editor=null;error=null;label=null;readonly=!1;showLabel=!0;host=null;validators=[]}W(wt,"PropertyView");class Ct extends ce{constructor(e){super(e),"string"==typeof e?.header&&(this.header=new Le({content:e.header}))}header}class At extends _e{constructor(e){super(e),e?.sections&&e.sections.forEach((e=>this.content.add(new Ct(e))))}section(e){return(0,c.k)(this.content).first((t=>t.name==e))}}W(At,"SectionsView");W(class extends he{constructor(e){super(e),this.bindConfigString("subText",e),this.bindConfig("status",e),this.bindConfig("item",e)}subText=null;status=null;item=null},"SimpleItemView");class xt extends le{_showResolve;constructor(){super({template:"SnackBar"}),this.status="close",new ee(this,document.body).content(this)}async showAsync(){if("open"!=this.status)return l.gV.unblock(!0),await(0,V.$)(0),this.status="open",new Promise((e=>this._showResolve=e))}hide(e){"open"==this.status&&(this.status="close",l.gV.restoreBlock(),this._showResolve&&(this._showResolve(e),this._showResolve=null))}static showAsync(e){const t=(new Date).valueOf();if(xt.instance||(xt.instance=new xt),xt.instance.content=e.content,xt.instance.instanceId=t,e.action){let t;t="string"==typeof e.action?{name:e.action,executeAsync:()=>Promise.resolve()}:e.action,xt.instance.action=me.fromAction(t,{executeAsync:async()=>{await t.executeAsync(),xt.instance.hide(t.name)}})}else xt.instance.action=null;return e.showTime&&setTimeout((()=>{xt.instance.instanceId==t&&xt.instance._isVisible&&xt.instance.hide(null)}),e.showTime.totalMilliseconds),xt.instance.showAsync()}action=null;content=null;showTime=v.fromSeconds(0);instanceId=null;static instance=null}W(xt,"SnackBar");W(class extends le{constructor(e){super({template:"ImageView",...e}),this.bindConfig("options",e),this.update()}update(){this.content=l.K9.mapManager().staticMap(this.options)}options;content},"StaticMapView");class It extends le{static _container;static _items=se();_showResolve;constructor(e){super({template:"Toast",visible:!1,...e}),null==It._container&&It.init(),this.bindConfigString("message",e,r.Fq.Tooltip),this.bindConfig("showTime",e),this.bindConfig("icon",e)}static init(){It._container=document.createElement("div"),It._container.className="toast-container";new ee(It._items,It._container).template("ToastContainer",(e=>e)),document.body.appendChild(It._container)}async showAsync(){It._items.add(this),await(0,V.$)(10),this.visible=!0;let e=this.showTime.totalMilliseconds;return 0==e&&(e=Math.min(Math.max(70*this.message.length,2e3),7e3)),setTimeout((()=>this.hideAsync()),e),new Promise((e=>this._showResolve=e))}async hideAsync(){this.visible=!1,await(0,V.$)(600),It._items.remove(this),this._showResolve&&(this._showResolve(),this._showResolve=null)}message=null;icon=null;showTime=v.fromSeconds(0)}W(It,"Toast");class St extends ce{constructor(e){super({template:"ContentView",...e}),this.bindConfig("index",e),this.bindConfig("coverImage",e),this.bindConfigString("title",e,r.Fq.Title),this.bindConfigString("nextLabel",e,r.Fq.Action),e&&(e.loadAsync&&(this.loadAsync=()=>e.loadAsync(this)),e.validateAsync&&(this.validateAsync=t=>e.validateAsync(this)),e.actions&&e.actions.forEach((e=>this.addAction(e))))}addAction(e){const t=me.fromAction(e,{template:"ActionButton",styles:["primary"]});return this.actions.add(t),t}loadAsync(){return Y(this.content)?this.content.loadAsync():Promise.resolve()}async validateAsync(e){return K(this.content)&&(this.isValid=await this.content.validateAsync(e)),this.isValid}select(){this.parentView.selectStepAsync(this.index)}error=null;isValid=!0;index=0;title="";isActive=!1;nextLabel=null;coverImage=null;actions=se()}W(St,"WizardStepView"),W(class extends _e{constructor(e){super({template:"WizardView",...e}),this.actions={next:new me({name:"next",template:"ActionButton",styles:["secondary"],content:new he({template:"IconTextViewInline",text:this.prop("nextLabel")}),executeAsync:()=>this.nextAsync()}),prev:new me({name:"prev",template:"ActionButton",styles:["secondary"],content:new he({template:"IconTextViewInline",text:this.prop("prevLabel")}),executeAsync:()=>this.previousAsync()}),finish:new me({name:"finish",template:"ActionButton",styles:["secondary"],content:new he({template:"IconTextViewInline",text:this.prop("finishLabel")}),executeAsync:()=>this.finishAsync()})},this.prop("currentStepIndex").subscribe(((t,i)=>{-1!=i&&(this.content.get(i).isActive=!1),this.content.get(t).isActive=!0,this.currentView=this.content.get(t),this.actions.next.visible=this.hasNextStep(),this.actions.prev.visible=this.hasPrevStep(),this.actions.finish.visible=!this.hasNextStep(),this.currentView.nextLabel?this.nextLabel=this.currentView.nextLabel:this.nextLabel=h.E.action(e?.nextLabel??"wizard-next")})),this.bindConfigString("nextLabel",e,r.Fq.Action),this.bindConfigString("prevLabel",e,r.Fq.Action),this.bindConfigString("finishLabel",e,r.Fq.Action),e&&(e.steps&&(e.steps.forEach(((e,t)=>this.content.add(new St({...e,index:t})))),this.currentStepIndex=0),e.finishAsync&&(this.doFinishAsync=e.finishAsync)),e?.prevLabel||(this.prevLabel=h.E.action("wizard-prev")),e?.finishLabel||(this.prevLabel=h.E.action("wizard-finish"))}async finishAsync(){!0===await this.validateUntilAsync(this.content.count-1)&&await this.doFinishAsync()}async doFinishAsync(){return Promise.resolve()}clearErrors(){}async validateUntilAsync(e){let t=this.currentStepIndex;for(;t<=e;){if(!await this.content.get(t).validateAsync())return t;t++}return!0}async loadAsync(){this.content.count>0&&await this.content.get(this.currentStepIndex).loadAsync()}async selectStepAsync(e){if(e!=this.currentStepIndex)if(this.clearErrors(),e>this.currentStepIndex){const t=await this.validateUntilAsync(e-1);!0===t?(this.currentStepIndex=e,await this.content.get(e).loadAsync()):(this.currentStepIndex=t,t!=this.currentStepIndex&&await this.content.get(t).loadAsync())}else this.currentStepIndex=e}async nextAsync(){this.currentStepIndex+1<this.content.count&&await this.selectStepAsync(this.currentStepIndex+1)}async previousAsync(){this.currentStepIndex>0&&await this.selectStepAsync(this.currentStepIndex-1)}async endAsync(){await this.selectStepAsync(this.content.count-1)}hasPrevStep(){let e=this.currentStepIndex-1;for(;e>=0;){if(this.content.get(e).visible)return!0;e--}return!1}hasNextStep(){let e=this.currentStepIndex+1;for(;e<=this.content.count-1;){if(this.content.get(e).visible)return!0;e++}return!1}isComplete(){return!this.hasNextStep()}currentStepIndex=-1;currentView;actions;nextLabel="Next";prevLabel="Previous";finishLabel="Finish"},"WizardView");class Vt{_options;constructor(e){this._options=e}async getContentAsync(e){const t=[];return t.push(new he({icon:this._options.icon,text:this._options.message,styles:["message-view"]})),this._options.customActions&&this._options.customActions.forEach((i=>t.push(new me({name:i.name,template:"ActionButton",styles:["primary"],content:new Le({content:h.E.action(i.displayName)}),executeAsync:async()=>{await e.closeAsync(),await i.executeAsync()}})))),Promise.resolve({views:t,title:this._options.title,styles:["vertical","margin-items-v","scroll","fit-items-h","surface","padding","small"]})}get info(){return{name:"message",icon:null,displayName:this._options.title}}}W(class extends R{constructor(e){super()}beginEditAsync(e){throw"Not implemented"}commitAsync(e){throw"Not implemented"}view=null;value=null;isValid=null},"BaseItemEditor");class Et extends Ze{constructor(e){super(e),this.bindConfig("canAdd",e),this.bindConfig("itemsSource",e),this.bindConfig("pageSize",e),this.bindConfigString("addLabel",e),this.bindConfigString("pickLabel",e),this.bindConfig("searchMode",e),e&&(e.filters&&this.filters.addRange(e.filters),e.createItemView&&(this.createItemView=e.createItemView),e.createItemListView&&(this.createItemListView=e.createItemListView),e.createItemEditor&&(this.createItemEditor=e.createItemEditor)),e?.addLabel||(this.addLabel=h.E.title("new-item",this.itemsSource.displayName)),e?.pickLabel||(this.pickLabel=h.E.title("select-item",this.itemsSource.displayName)),this.createEditValueProp(),this.selectAction=me.fromActionIcon({name:"select",icon:"fas fa-list",operation:o.Local,displayName:this.pickLabel,executeAsync:()=>this.selectAsync()})}createItemEditor(){throw"Not Supported"}createItemView(e){return new Le({content:this.itemsSource.getItemText(e)})}createItemListView(e){return this.createItemView(e)}async notifyEditValueChangedAsync(){await super.notifyEditValueChangedAsync(),await this.updateViewAsync()}canAdd=!1;addLabel="Add";pickLabel="Select";selectAction=null;itemsSource=null;pageSize=0;searchMode="default";filters=se()}W(Et,"BasePicker");class kt extends Ze{constructor(e){super({template:"CheckBox",...e}),this.bindConfigString("trueLabel",e),this.bindConfigString("falseLabel",e),this.bindConfigString("label",e,r.Fq.Action),this.createEditValueProp()}toggle(){window.event&&window.event.stopPropagation(),this.editValue=!this.editValue}trueLabel=null;falseLabel=null;label=null}W(kt,"BooleanEditor");W(class extends bt{constructor(e){super({template:"DateEditor",...e}),this.bindConfig("placeholder",e),this.createEditValueProp()}valueToEdit(e){return null==e?"":w(e,"{YYYY}-{MM}-{DD}")}editToValue(e){return null==e?null:_(e+" 00:00")}placeholder=null},"DateEditor");class Tt extends Ze{constructor(e){super(e);for(let e=1;e<=31;e++)this.days.push(e.toString());for(let e=1;e<=12;e++)this.months.push({number:e.toString(),name:b[e-1]});const t=e?.maxYear??(new Date).getFullYear();for(let i=e?.minYear??(new Date).getFullYear()-100;i<=t;i++)this.years.push(i.toString());this.prop("selectedDay").subscribe((()=>this.tryCommit())),this.prop("selectedMonth").subscribe((()=>this.tryCommit())),this.prop("selectedYear").subscribe((()=>this.tryCommit()))}tryCommit(){this.commitAsync()}commitAsync(e){return this.editValue?.getTime()!=this.value?.getTime()&&(this.value=this.editValue),Promise.resolve(!0)}get editValue(){return this.selectedDay&&this.selectedMonth&&this.selectedYear?new Date(parseInt(this.selectedYear),parseInt(this.selectedMonth)-1,parseInt(this.selectedDay)):null}set editValue(e){e?.getTime()!=this.editValue?.getTime()&&(e?(this.selectedDay=e.getDate().toString(),this.selectedMonth=(e.getMonth()+1).toString(),this.selectedYear=e.getFullYear().toString()):(this.selectedDay=null,this.selectedMonth=null,this.selectedYear=null))}selectedDay=null;selectedMonth=null;selectedYear=null;days=[];months=[];years=[]}W(Tt,"DateEditorCombo");class Nt extends R{_item;constructor(e){super(),this.bindConfig("editor",e),e&&(e.itemToEdit&&(this.itemToEdit=e.itemToEdit),e.editToItem&&(this.editToItem=e.editToItem))}activateAsync(){return j(this.editor)?this.editor.activateAsync():Promise.resolve()}beginEditAsync(e){return this._item=e,this.editor.beginEditAsync(this.itemToEdit(e))}async commitAsync(e){return!!await this.editor.commitAsync(e)&&(this.editToItem(this._item,this.editor.value),!0)}itemToEdit(e){throw"Not supported"}editToItem(e,t){}get value(){return this.editor.value}get view(){return this.editor}get isValid(){return this.editor.isValid}editor=null}W(Nt,"ItemEditorConverter"),function(e){async function t(e){const t=e.actions??(e.customActions?[]:["ok"]),i=new yt({message:e.message,icon:e.icon,title:e.title});t.forEach((e=>{i.addAction({name:e,displayName:h.E.action(e),executeAsync:()=>Promise.resolve()})})),e.customActions&&e.customActions.forEach((e=>i.addAction(e)));return await i.showAsync()}e.showMessageAsync=t,e.confirmAsync=async function(e){return"yes"==await t({message:e,title:"confirm",actions:["yes","no"]})},e.info=function(e){new It({message:e}).showAsync()},e.warning=function(e){new It({message:e,styles:["warning"]}).showAsync()},e.error=function(e){new It({message:e,styles:["error"],icon:"fas fa-exclamation"}).showAsync()},e.succeed=async function(e){const t=await et.loadPageAsync(new Pe({providers:[new Vt({icon:"far fa-smile",customActions:[{name:"close",displayName:"close",executeAsync:()=>Promise.resolve()}],...e})],name:"message"}));return await t.result},e.fail=async function(e){const t=await et.loadPageAsync(new Pe({providers:[new Vt({icon:"far fa-sad-tear",customActions:[{name:"close",displayName:"close",executeAsync:()=>Promise.resolve()}],...e})],name:"message"}));return await t.result}}(dt||(dt={}));class Mt extends Oe{constructor(e){super(e),e&&(e.addItemAsync&&(this.addItemAsync=e.addItemAsync),e.updateItemAsync&&(this.updateItemAsync=e.updateItemAsync),e.removeItemAsync&&(this.removeItemAsync=e.removeItemAsync),e.newItem&&(this.newItem=e.newItem))}newItem(){return{}}addItemAsync(e){return Promise.resolve(e)}updateItemAsync(e,t){return Promise.resolve(t)}removeItemAsync(e){return Promise.resolve(!0)}}class Pt extends pt{constructor(e){super({...e}),e.canEdit&&this.addAction({name:"edit-item",icon:"fas fa-edit",operation:o.Local,priority:R.bindValue(e.editActionsPriority),displayName:e.editActionLabel,executeAsync:()=>this.editAsync()}),e.canRemove&&this.addAction({name:"remove-item",icon:"fas fa-trash",operation:o.Local,priority:R.bindValue(e.editActionsPriority),displayName:e.removeActionLabel,executeAsync:()=>this.removeAsync()}),e.itemActions&&e.itemActions.forEach((t=>this.addAction({name:t.name,icon:t.icon,priority:t.priority,operation:t.operation,displayName:h.E.action(t.displayName,e.itemsSource.displayName),canExecute:t.canExecute?()=>t.canExecute(this):void 0,executeAsync:()=>t.executeAsync(this)}))),this.value=e.value}updateView(){this.content.clear(),this.isEdit&&"inline"==this.editMode&&!H(this.editor)?this.content.add(this.editor.view):this.content.add(this.view)}updateValueAsync(){throw"Not implemented"}createUpdateEditor(){throw"Not implemented"}createAddEditor(){throw"Not implemented"}executeUpdateAsync(e){throw"Not implemented"}executeAddAsync(e){throw"Not implemented"}async editAsync(){if(this.isEdit)return!1;if(this.editor||("added"==this.status?this.editor=this.createAddEditor():this.editor=this.createUpdateEditor()),this.isEdit=!0,"external"==this.editMode){let e=null;if(H(this.editor)){const t=await this.editor.editAsync(this.item);t&&(e="added"==this.status?await this.executeAddAsync(t):await this.executeUpdateAsync(t))}else{const t=new Pe({providers:[new He({editor:this.editor,title:e=>"added"==this.status?this.addTitle:this.editTitle,value:this.item,saveItemAsync:e=>"added"==this.status?this.executeAddAsync(e):this.executeUpdateAsync(e)})]});e=await(await et.loadPageAsync(t)).result}return e?(this.item=e,this.status="unchanged",this.isEdit=!1,await this.updateValueAsync()):this.isEdit=!1,this.editor=null,null!=e}return!1}cancelEdit(){this.isEdit=!1}removeAsync(){throw"Not implemented"}clearErrors(){this.error=null}async validateAsync(e){if(this.isEdit){if(K(this.editor))return await this.editor.validateAsync()}else if(K(this.view))return await this.view.validateAsync();return!0}async loadAsync(){this.updateView()}get itemsEditor(){return this.parentView}error=null;addTitle=null;editTitle=null;editor=null;view=null;value=null;status="unchanged";editMode="external";isEdit=!1}class Dt extends Ze{_changesCount=0;_isUpdating=0;constructor(e){super({template:"ItemsEditor",...e}),this.bindConfig("editMode",e),this.bindConfig("canAdd",e),this.bindConfig("canOpen",e),this.bindConfig("canRemove",e),this.bindConfig("isConfirmRemove",e),this.bindConfig("canEdit",e),this.bindConfig("itemsSource",e),this.bindConfig("itemActions",e),this.bindConfig("editActionsPriority",e),this.bindConfig("removeActionLabel",e),this.bindConfig("editActionLabel",e),e&&(e.editActionLabel||(this.editActionLabel=h.E.action("edit-item",this.itemsSource?.displayName)),e.removeActionLabel||(this.removeActionLabel=h.E.action("remove-item",this.itemsSource?.displayName)),e.createItemAddEditor&&(this.createItemAddEditor=e.createItemAddEditor),e.createItemUpdateEditor&&(this.createItemUpdateEditor=e.createItemUpdateEditor),e.createItemView&&(this.createItemView=e.createItemView),e.attachItem&&(this.attachItem=e.attachItem),e.newItem&&(this.newItem=e.newItem),e.openItem&&(this.openItem=e.openItem,null==e.canOpen&&(this.canOpen=!0))),this.itemsSource||(this.itemsSource=new Mt),this.addAction=me.fromAction({name:"add-item",icon:"fas fa-plus",operation:o.Local,displayName:e?.addActionLabel??h.E.action("add-item",this.itemsSource.displayName),executeAsync:async()=>await this.addAsync()}),this.value&&this.beginEditAsync(this.value)}async loadAsyncWork(){const e=[];for(const t of this.content)e.push(t.loadAsync());await Promise.all(e)}clear(){this.content.clear()}clearErrors(){for(const e of this.content)e.clearErrors()}insert(){}async addAsync(){const e=this.newItem();this.attachItem(e,!0);const t=this.createItem(this.itemToValue(e),e);if(t.item=e,t.status="added",await t.editAsync()){if((0,c.k)(this.content).any((e=>this.itemsSource.itemComparer(e.item,t.item))))return;this.content.add(t),await this.notifyEditValueChangedAsync()}}openItem(e){}attachItem(e,t){}isCapable(e,t){return"boolean"==typeof e?e:e(t)}createItem(e,t){const i=new Pt({value:e,item:t,addTitle:h.E.title("add-item",this.itemsSource.displayName),editTitle:"",itemsSource:this.itemsSource,editActionsPriority:this.editActionsPriority,editActionLabel:this.editActionLabel,removeActionLabel:this.removeActionLabel,itemActions:this.itemActions,canRemove:this.isCapable(this.canRemove,t),canEdit:this.isCapable(this.canEdit,t),canOpen:this.isCapable(this.canOpen,t),open:()=>this.openItem(i.item)});return i.parentView=this,i.isConfirmRemove=this.isConfirmRemove,i.createAddEditor=()=>this.createItemAddEditor(i.item),i.createUpdateEditor=()=>this.createItemUpdateEditor(i.item),i.executeAddAsync=e=>this.itemsSource.addItemAsync(e),i.executeUpdateAsync=e=>this.itemsSource.updateItemAsync(e,i.item),i.loadAsync=async()=>{i.item||(i.item=await this.valueToItemAsync(i.value),i.canOpen=this.isCapable(this.canOpen,i.item),i.editTitle=h.E.title("edit-item",this.itemsSource.getItemText(i.item)),this.attachItem(i.item,"added"!=i.status)),i.view=this.createItemView(i.item),i.updateView()},i.updateValueAsync=async()=>{i.canOpen=this.isCapable(this.canOpen,i.item),i.value=this.itemToValue(i.item),i.view=this.createItemView(i.item),i.editTitle=h.E.title("edit-item",this.itemsSource.getItemText(i.item)),i.updateView(),await this.notifyEditValueChangedAsync()},i.removeAsync=async()=>{if("added"==i.status)this.content.remove(i);else{if(this.isConfirmRemove&&!await dt.confirmAsync(h.E.message("msg-remove-confirm",this.itemsSource.displayName)))return;"none"==this.status&&(this.status="loaded"),i.status="removed",await this.notifyEditValueChangedAsync()}},i.value=e,"none"!=this.status&&i.loadAsync(),i}itemToValue(e){return e}valueToItemAsync(e){return Promise.resolve(e)}onItemChanged(e,t){this._needValidation=!0,this._isUpdating?this._changesCount++:this.notifyEditValueChangedAsync()}set editValue(e){if(this.content&&!this._isUpdating){this._isUpdating++,this._changesCount=0,this.content.clear();try{if(e)for(const t of e)this.content.add(this.createItem(t))}finally{this._isUpdating--}this._changesCount>0&&this.notifyEditValueChangedAsync()}}get editValue(){const e=[];for(const t of this.content)"removed"!=t.status&&e.push(t.value);return e}async validateAsyncWork(e){let t=!0;for(const i of this.content)await i.validateAsync(e)||(t=!1);return t}async commitAsyncWork(e){let t=!0,i=!1;if(!t)return!1;for(let e=this.content.count-1;e>=0;e--){const s=this.content.get(e);if(s.clearErrors(),"removed"==s.status)await this.itemsSource.removeItemAsync(s.item)?this.content.removeAt(e):(this.error="",t=!1),i=!0;else if("modified"!=s.status||H(s.editor)){if("added"==s.status&&!H(s.editor)){const e=await this.itemsSource.addItemAsync(s.editor.value);e?(s.item=e,s.status="unchanged",s.updateView()):(this.error="",t=!1),i=!0}}else{const e=await this.itemsSource.updateItemAsync(s.editor.value,s.item);e?(s.item=e,s.status="unchanged",s.updateView()):(this.error="",t=!1),i=!0}}return t&&i&&this.onValueChanged(this.editValue),t}newItem(){return this.itemsSource.newItem()}getItemViewContent(e){return this.itemsSource?this.itemsSource.getItemText(e):e.toString()}createItemView(e){return new Le({content:this.getItemViewContent(e)})}createItemUpdateEditor(e){throw"Not Supported"}createItemAddEditor(e){throw"Not Supported"}content=se();editActionsPriority=xe.Secondary;editActionLabel="Edit";removeActionLabel="Remove";canAdd=!0;canRemove=!0;canEdit=!1;canOpen=!1;editMode="inline";itemActions=[];itemsSource=null;addAction;isConfirmRemove=!0}W(Dt,"ItemsEditor"),W(Pt,"ItemsEditorItemView");W(class extends Ze{constructor(e){super({template:"MediaEditor",...e}),this.bindConfig("noMediaUrl",e),this.bindConfig("maxFileSize",e),this.bindConfig("validMedias",e),e&&(e.getUploadUrl&&(this.getUploadUrl=e.getUploadUrl),e.getMediaUrl&&(this.getMediaUrl=()=>e.getMediaUrl(this.editValue))),this.mediaView=new vt({image:{template:"ImageInline"},video:{template:"VideoViewInline"},...e?.mediaView}),this.fileUpload=new ct({onChanged:()=>this.notifyEditValueChangedAsync()}),this.fileUpload.visible=!1,this.mediaView.content={type:"empty"}}getUploadUrl(e){throw"Not implemented"}validateAsyncWork(e){return"selected"==this.fileUpload.status&&(-1!=this.validMedias.indexOf("image")&&this.fileUpload.file.type.startsWith("image/")?this.mediaView.content.type="image":-1!=this.validMedias.indexOf("video")&&this.fileUpload.file.type.startsWith("video/")?this.mediaView.content.type="video":this.error=h.E.message("msg-invalid-media"),this.maxFileSize&&this.fileUpload.file.size>this.maxFileSize&&(this.error=h.E.message("msg-max-size",(this.maxFileSize/1024/1024).toString()))),Promise.resolve(!this.error)}async commitAsyncWork(e){if("selected"==this.fileUpload.status){const e=await this.fileUpload.uploadAsync(this.getUploadUrl(this.fileUpload.file.name));this.editValue.id=e,this.editValue.status="new",this.editValue.type=this.mediaView.content.type,this.mediaView.content={src:this.getMediaUrl(),type:this.mediaView.content.type},this.notifyEditValueChangedAsync()}return!0}getMediaUrl(){throw"Not Implemented"}async beginEditAsync(e){await super.beginEditAsync(e),this.editValue||(this.editValue={id:null,type:"empty",status:"empty"}),"empty"==this.editValue.status?this.mediaView.content={type:"image",src:this.noMediaUrl}:this.mediaView.content={type:this.editValue.type,src:this.getMediaUrl()}}change(){this.fileUpload.visible=!0,this.fileUpload.select()}remove(){this.editValue.status="deleted",this.mediaView.content={type:"image",src:this.noMediaUrl},this.notifyEditValueChangedAsync()}showMenu(){const e=new de;("new"==this.editValue.status||this.editValue.id)&&e.addAction({name:"remove-item",icon:"fas fa-trash",displayName:"delete",executeAsync:async()=>this.remove()}),e.addAction({name:"edit-item",icon:"fas fa-edit",displayName:"change",executeAsync:async()=>this.change()}),e.showAsync(void 0,window.event)}fileUpload=null;mediaView=null;noMediaUrl=null;maxFileSize=null;validMedias=["video","image"]},"MediaEditor");W(class extends Et{constructor(e){super(e)}async selectAsync(){let e=!1;null==this.selector?(this.selector=new it({createItemEditor:()=>this.createItemEditor(),createItemContentView:e=>this.createItemView(e),createItemListView:e=>this.createItemListView(e),itemsSource:this.itemsSource,addLabel:this.addLabel,searchMode:this.searchMode,tooltip:this.pickLabel,canAdd:this.canAdd}),this.selector.filters=this.filters):e=!0,this.selector.setSelectedItems((0,c.k)(this.items).select((e=>e.item)).toArray()),e&&await this.selector.refreshAsync();const t=await(await et.loadPageAsync(this.selector)).result;if(null!=t){const e=(0,c.k)(t).select((e=>this.itemsSource.getItemValue(e))).toArray();k(e,this.editValue)||(this.editValue=e)}}valueToEdit(e){return e?e.slice():[]}editToValue(e){return e?e.slice():[]}async updateViewAsync(){if("loading"!=this.status&&(this.items.clear(),this.editValue)){this.status="loading";try{for(const e of this.editValue){const t=await this.itemsSource.getItemByValueAsync(e);if(!t)continue;const i=new Ue({item:t,content:this.createItemView(t),removeAsync:async()=>{this.items.remove(i);const e=this.itemsSource.getItemValue(i.item),t=(0,c.k)(this.editValue).indexOf((t=>this.itemsSource.equals(t,e)));this.editValue.splice(t,1),await this.notifyEditValueChangedAsync()}});this.items.add(i)}}finally{this.status="loaded"}}}selector=null;items=se()},"MultiItemPicker");class Lt extends Ze{_proxy;_changesCount=0;_isUpdating=0;_onPropertyChanged;constructor(e){if(super({template:"ItemsViewForm",validationMode:"always",commitMode:"manual",...e}),this.bindConfig("propertyTemplateName",e),this.bindConfig("defaultProperty",e),this.bindConfig("emptyView",e),this.prop("content"),e&&(this._onPropertyChanged=e.onPropertyChanged,e.properties))for(const t in e.properties)e.properties[t].name=t,this.addProperty(e.properties[t]);this.createProxy(),T(this.value)||this.beginEditAsync(this.value)}addProperty(e){const t=new wt({name:e.name,template:this.prop("propertyTemplateName"),...e,host:this});return this.properties[e.name]=t,t}async beginEditWorkAsync(e){this.value||(this.value={}),this.isDirty=!0;for(const e in this.properties){const t=this.properties[e];null!=t.value&&await t.editor.beginEditAsync(t.value)}}clearErrors(){for(const e in this.properties)this.properties[e].error=null}async validateAsyncWork(e){let t=!0;const i=this.editValue;for(const s in this.properties){const n=this.properties[s];await n.validateAsync(i,e)||(this.isValid=!1,t=!1)}return t}createProxy(){this._proxy={},this.content.clear();for(const e in this.properties){const t=this.properties[e];t.prop("value").subscribe(((t,i)=>this.onPropertyValueChanged(e,t,i))),t.prop("isValid").subscribe((e=>{e||(this.isValid=!1)})),t.prop("isDirty").subscribe((e=>{e&&(this.isDirty=!0)})),this.content.add(t),Object.defineProperty(this._proxy,e,{enumerable:!0,get:()=>t.value,set:e=>t.value=e})}}activateAsync(){return this.defaultProperty?this.editor(this.defaultProperty).activateAsync():Promise.resolve()}async loadAsyncWork(){const e=[];for(const t in this.properties)e.push(this.properties[t].loadAsync());await Promise.all(e)}clear(){this._isUpdating++;try{for(const e in this.properties)this.property(e).clear()}finally{this._isUpdating--}}editToValue(e){}async commitAsyncWork(e){let t=!1,i=!0;this.value||(this.value={});for(const e in this.properties){const s=await this.commitPropertyAsync(e,!1);s.isValid||(i=!1),s.isChanged||(t=!0)}return i&&t&&this.onValueChanged(this.value),i}async commitPropertyAsync(e,t){const i={isValid:!0,isChanged:!1},s=this.property(e);return t&&!await s.validateAsync(this.editValue,!1)?i.isValid=!1:await s.editor.commitAsync()?N(s.value,this.value[e])||(this.value[e]=s.value,i.isChanged=!0):i.isValid=!1,i}editor(e){return this.properties[e].editor}property(e){return this.properties[e]}async onPropertyValueChanged(e,t,i){if(this._needValidation=!0,this._isUpdating||this._isEditing)this._changesCount++;else{if("onchange"==this.commitMode){(await this.commitPropertyAsync(e,!0)).isChanged&&(this._needValidation=!0,this.isDirty=!0)}else await this.notifyEditValueChangedAsync();this._onPropertyChanged&&this._onPropertyChanged(e,t,i,this._proxy)}}set editValue(e){if(!this._isUpdating){this._isUpdating++,this._changesCount=0;try{if(T(e))this.clear();else for(const t in this.properties)this._proxy[t]=e[t]}finally{this._isUpdating--}this._changesCount>0&&this.notifyEditValueChangedAsync()}}get editValue(){return this._proxy}properties={};defaultProperty=null;propertyTemplateName="PropertyView";emptyView=null;content=se()}W(Lt,"ObjectEditor");class $t extends bt{constructor(e){super({template:"Attach",...e})}attach(e){this.editor=new Quill(e,{theme:"snow"}),this.editor.root.innerHTML=this.value,this.editor.on("text-change",(()=>this.notifyEditValueChangedAsync()))}set editValue(e){this.editor&&(this.editor.root.innerHTML=e)}get editValue(){return this.editor?this.editor.root.innerHTML:this.value}editor}W($t,"RichTextEditor");class Ft extends le{constructor(e){super(e),this.bindConfig("editor",e),this.bindConfigString("title",e)}title=null;editor}W(Ft,"SectionEditorView"),W(class extends Ze{constructor(e){super({template:"SectionEditor",...e}),this.navBar=new Ne({styles:["tab-view","surface"],itemTemplate:"TextView",itemBehavoirs:["ripple"],selectedItem:this.prop("activeSectionName")}),e&&e.sections&&e.sections.forEach((e=>this.addSection(e))),this.sections.count>0&&(this.activeSectionName=this.sections.get(0).name),this.createEditValueProp()}async loadAsyncWork(){for(const e of this.sections)e.editor&&await e.editor.loadAsync()}async beginEditWorkAsync(e){for(const t of this.sections)t.editor&&await t.editor.beginEditAsync(e)}async validateAsyncWork(e){let t=!0;for(const i of this.sections)i.editor&&(await i.editor.validateAsync(e)||(t=!1,this.activeSectionName=i.name));return t}async commitAsyncWork(e){let t=!0;for(const i of this.sections)i.editor&&(await i.editor.commitAsync(e)||(t=!1));return t}getSection(e){return(0,c.k)(this.sections).first((t=>t.name==e))}addSection(e){const t=new Ft(e);return this.sections.add(t),this.navBar.addItem({text:t.prop("title"),name:t.name,content:t}),t}sections=se();navBar;activeSectionName=null},"SectionEditor");W(class extends Et{constructor(e){super(e),this.clearAction=me.fromActionIcon({name:"clear",icon:"fas fa-times",displayName:"clear",executeAsync:()=>Promise.resolve(this.clear())})}async selectAsync(){let e=!1;null==this.selector?(this.selector=new st({itemsSource:this.itemsSource,createItemEditor:()=>this.createItemEditor(),createItemContentView:e=>this.createItemListView(e),pageSize:this.pageSize,addLabel:this.addLabel,tooltip:this.pickLabel,canAdd:this.canAdd}),this.selector.filters=this.filters):e=!0,this.selector.selectedValue=this.editValue,e&&await this.selector.refreshAsync();const t=await(await et.loadPageAsync(this.selector)).result;null!=t&&(this.editValue=this.itemsSource.getItemValue(t))}createItemEditor(){throw"Not Supported"}async updateViewAsync(){if("loading"!=this.status)if(this.editValue){this.status="loading";try{const e=await this.itemsSource.getItemByValueAsync(this.editValue);this.contentView=this.createItemView(e)}finally{this.status="loaded"}}else this.contentView=null}selector=null;contentView=null;clearAction=null},"SingleItemPicker");class Ot extends Ze{constructor(e){super({template:"SelectEditor",...e}),this.bindConfig("itemsSource",e),this.bindConfig("itemTemplate",e),this.bindConfigString("placeholder",e),e?.createItemView&&(this.createItemViewWork=e?.createItemView),e?.items&&(e.items.forEach((e=>this.items.add(this.createItemView(e)))),this.status="loaded")}async selectAsync(){const e=new Je({editor:new Ot({template:"MultiItemSelectorList",itemsSource:this.itemsSource,styles:["no-padding-items-h"]}),saveOnCommit:!0,saveLabel:"select",closeLabel:"cancel",title:"select-an-item",styles:[""]}),t=await e.editAsync(this.value);null!==t&&(this.editValue=t)}findItemByValue(e){return this.itemsSource?(0,c.k)(this.items).first((t=>this.itemsSource.equals(t.item,e))):(0,c.k)(this.items).first((t=>t.item==e))}set editValue(e){for(const t of this.items)t.isSelected=e&&(0,c.k)(e).any((e=>Fe.getValue(e)==Fe.getValue(t.item)))}get editValue(){return(0,c.k)(this.items).where((e=>e.isSelected)).select((e=>e.item)).toArray()}async loadAsyncWork(){if(this.itemsSource){this.items.clear();const e=await this.itemsSource.getItemsAsync(this.itemsSource.getFilter());e&&e.forEach((e=>this.items.add(this.createItemView(e))))}this.isDirty=!0}createItemViewWork(e){if(this.itemsSource)return new ze({item:this.itemsSource.getItemValue(e),content:this.itemsSource.getItemText(e),template:this.itemTemplate})}createItemView(e){const t=this.createItemViewWork(e);return t.prop("isSelected").subscribe((e=>{e&&this.notifyEditValueChangedAsync()})),t}itemTemplate="SelectableItemView";placeholder=null;itemsSource=null;items=se()}W(Ot,"MultiItemSelector");class Gt extends bt{constructor(e){super({template:"TextEditor",...e}),this.bindConfigString("placeholder",e,r.Fq.Tooltip),this.bindConfig("lineCount",e),this.bindConfig("maxLength",e),this.bindConfig("trackMode",e),this.createEditValueProp()}placeholder=null;lineCount=1;maxLength=null}W(Gt,"TextEditor");W(class extends bt{constructor(e){super({template:"TimeEditor",...e}),this.bindConfig("placeholder",e),this.createEditValueProp()}valueToEdit(e){return null==e?"":e.format("{hh}:{mm}")}editToValue(e){if(null==e)return null;const t=e.split(":");return 2!=t.length?null:v.fromMinutes(60*parseInt(t[0])+parseInt(t[1]))}placeholder=null},"TimeEditor"),function(e){e.sections=function(e){return new At(e)}}(ht||(ht={})),function(e){e.richText=function(){return new $t},e.currency=function(){return new _t({allowNull:!1,min:.01})},e.converter=function(e,t,i){return new Nt({editor:e,editToItem:i,itemToEdit:t})},e.items=function(e){return new Dt({...e})},e.text=function(e){return new Gt({...e})},e.textMultiLine=function(e){return new Gt({template:"TextEditorMultiLine",...e})},e.number=function(e){return new _t({...e})},e.boolean=function(e){return new kt({...e})},e.password=function(e){return new Gt({template:"PasswordEditor",...e})},e.object=function(e){return new Lt(e)},e.address=function(e){return new Gt({template:"TextEditorMultiLine",...e})},e.birthDate=function(e,t){return new Tt({maxYear:(new Date).getFullYear()-(e??0),minYear:(new Date).getFullYear()-100})},e.singleItemSelector=function(e){return new Qe(e)}}(ut||(ut={}));var Wt;i(2560);!function(e){const t=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,i=/^[+]*[(]{0,1}[0-9]{1,4}[)]{0,1}[-\s\./0-9]*$/;e.required={validateAsync:e=>Promise.resolve({isValid:null!=e.value&&""!=e.value&&(!Array.isArray(e.value)||e.value.length>0),error:h.E.message("msg-specify-value",e.fieldName)})},e.minValue=function(e){return{validateAsync:t=>Promise.resolve({isValid:t.value>=e,error:h.E.message("msg-insert-greater-than",e.toString())})}},e.maxValue=function(e){return{validateAsync:t=>Promise.resolve({isValid:t.value<=e,error:h.E.message("msg-insert-less-than",e.toString())})}},e.integer={validateAsync:e=>Promise.resolve({isValid:Math.round(e.value)==e.value,error:h.E.message("msg-insert-int-number")})},e.phone={validateAsync:e=>Promise.resolve({isValid:e.value&&e.value.length>=9&&i.test(e.value.toLowerCase()),error:h.E.message("msg-invalid-phone",e.value)})},e.email={validateAsync:e=>Promise.resolve({isValid:e.value&&t.test(e.value.toLowerCase()),error:h.E.message("msg-invalid-email",e.value)})},e.custom=function(e){return{validateAsync:async t=>await e(t)}}}(Wt||(Wt={}));class qt extends le{constructor(e){super(),this.request=e,this.switchView=new kt({label:this.request.permission.name,template:"Switch",styles:["primary"]}),this.switchView.beginEditAsync(e.granted)}request=null;switchView=null;isShowInfo=!1}W(qt,"PermissionRequestItemView");class Bt{_progress;_type;constructor(e){e.type?this._type=e.type:this._type=n.OperationType.Global,this.parentOperation=e.parentOperation}end(){zt.end(this)}get type(){return this._type}get progress(){return this._progress}set progress(e){this._progress=e,this._progress?(console.log(this.getProgressDescription(this._progress)),this._progress.message&&(this.message=this._progress.message),zt.onProgress.raise(this,{operation:this,progress:e})):this.message=void 0}addSubOperation(e){}removeSubOperation(e){}getProgressDescription(e){let t="Progress ("+this.message+"): ";return e.message&&(t+="'"+e.message+"'"),null!=e.current&&null!=e.totCount?t+=" - "+e.current+"/"+e.totCount+" ("+Math.round(100/e.totCount*e.current)+"%)":null!=e.current&&(t+=e.current),t}message=null;parentOperation=null}var Ut,zt=new class{_oprations=[];progress(e){(0,n.isString)(e)&&(e={message:e}),this.current&&(this.current.progress=e)}begin(e){(0,n.isString)(e)&&(e={message:e});let t=new Bt(e);return console.group("Begin operation: ",$string(t.message??"")),t.progress=e,void 0===t.parentOperation&&(t.parentOperation=this.current),this._oprations.push(t),t.parentOperation?t.parentOperation.addSubOperation(t):(t.type,n.OperationType.Global),this.onBegin.raise(this,t),t}end(e){console.groupEnd(),console.log("End operation: ",$string(e.message??""));const t=this._oprations.indexOf(e);this._oprations.splice(t,1),e.parentOperation?e.parentOperation.removeSubOperation(e):(e.type,n.OperationType.Global),this.onEnd.raise(this,e)}get current(){return this._oprations.length>0?this._oprations[this._oprations.length-1]:null}get operations(){return this._oprations}onBegin=(0,n.event)();onEnd=(0,n.event)();onProgress=(0,n.event)()};class Rt{_separator;_value;_startIndex;_curIndex;_currentStartIndex;_current;constructor(e,t,i=0){this._value=e,this._separator=t,this._startIndex=i}get current(){return this._current||(this._current=this._value.substring(this._currentStartIndex,this._curIndex-this._separator.length)),this._current}moveNext(){if(this._curIndex>this._value.length)return!1;this._currentStartIndex=this._curIndex;var e=this._value.indexOf(this._separator,this._curIndex);return this._curIndex=-1==e?this._value.length+1:e+this._separator.length,this._current=null,!0}reset(){this._curIndex=this._startIndex,this._currentStartIndex=this._curIndex,this._current=null}}class Ht{_state=0;_wordLength=0;_wordStartIndex;_separator;_value;_startIndex;_curIndex;_current;_hasEscape;constructor(e,t,i=0){this._value=e,this._separator=t,this._startIndex=i}get current(){return this._current||(this._current=this._value.substr(this._wordStartIndex,this._wordLength),this._hasEscape&&(this._current=this._current.replace('""','"'))),this._current}moveNext(){let e=!1;for(;;){const t=this._curIndex>=this._value.length?"":this._value[this._curIndex];switch(this._state){case 0:'"'==t?(this._state=1,this._hasEscape=!1,this._wordLength=0,this._wordStartIndex=this._curIndex+1):t!=this._separator&&t?(this._state=2,this._wordLength=1,this._wordStartIndex=this._curIndex):(this._wordStartIndex=this._curIndex,this._wordLength=0,e=this._curIndex<=this._value.length);break;case 1:'"'==t?this._state=3:this._wordLength++;break;case 2:t!=this._separator&&t?this._wordLength++:(this._state=0,e=!0);break;case 3:'"'==t?(this._hasEscape=!0,this._wordLength+=2,this._state=1):t!=this._separator&&t?this._state=4:(e=!0,this._state=0);break;case 4:t!=this._separator&&t||(e=!0,this._state=0)}if(this._curIndex++,!t||e)break}return this._current=null,e}reset(){this._hasEscape=!1,this._curIndex=this._startIndex,this._wordStartIndex=this._curIndex,this._wordLength=0,this._current=null,this._state=0}}!function(e){e[e.Exclude=0]="Exclude",e[e.XAxis=1]="XAxis",e[e.Serie=2]="Serie",e[e.Group=3]="Group"}(Ut||(Ut={}));class jt{constructor(){}}class Xt extends jt{constructor(){super()}createIdentifier(e){let t=0,i="";for(let s=0;s<e.length;s++){const n=e[s];switch(t){case 0:i+=n.toLowerCase(),t=1;break;case 1:" "==n||"-"==n||"_"==n?t=2:i+=n;break;case 2:i+=n.toUpperCase(),t=1}}return i}extractHeader(e,t){const i=(0,n.linq)(new Rt(e,t.rowSeparator)).first(),s=(0,n.linq)(new Ht(i,t.columnSeparator)).toArray();let a;if(!1!==t.hasHeader){const e=[];this.analyzeRow(s,e);const i=(0,n.linq)(e).sum((e=>e.stringCount)),r=(0,n.linq)(e).sum((e=>e.emptyCount));i>0&&i+r==s.length&&(t.hasHeader=!0,a=(0,n.linq)(s).select(((e,t)=>""==e?"col"+t:e)).toArray())}a||(t.hasHeader=!1,a=(0,n.linq)(s).select(((e,t)=>"col"+t)).toArray()),t.columns||(t.columns=(0,n.linq)(a).select((e=>({id:this.createIdentifier(e),name:e,type:Ut.Exclude}))).toArray())}extractRowSeparator(e,t){if(t.rowSeparator)return;const i=["\r\n","\n"];for(var s of i)if(-1!=e.indexOf(s))return void(t.rowSeparator=s)}extractColumnSeparator(e,t){if(t.columnSeparator)return;const i=["\t",";",","," "],s={},a=(0,n.linq)(new Rt(e,t.rowSeparator)).take(10);for(let e of a)if(0!=e.trim().length)for(let t of i){if(!1===s[t])continue;const i=(0,n.linq)(new Ht(e,t)).count();i>1&&!(t in s)?s[t]=i:s[t]!=i&&(s[t]=!1)}for(var r in s)if(!1!==s[r])return void(t.columnSeparator=r)}analyzeRow(e,t){if(0==t.length)for(let i=0;i<e.length;i++)t.push({values:{},booleanCount:0,dateCount:0,emptyCount:0,numberCount:0,stringCount:0});for(let i=0;i<e.length;i++)this.analyzeColumn(e[i],t[i])}analyzeColumn(e,t){(!t.values||Object.keys(t.values).length<150)&&(e in t.values?t.values[e]++:t.values[e]=1),null==e||0==e.length||0==e.trim().length?t.emptyCount++:isNaN(e)?Date.parse(e)?t.dateCount++:"true"==e||"false"==e?t.booleanCount++:t.stringCount++:t.numberCount++}createParser(e){return e.numberCount>0&&0==e.stringCount?e=>isNaN(e)?null:parseFloat(e):e.booleanCount>0&&0==e.stringCount?e=>"true"==e:e.dateCount>0&&0==e.stringCount?e=>e?new Date(e):null:e.stringCount>0?e=>e?e.startsWith('"')&&e.endsWith('"')?e.substr(1,e.length-2):e:"":e=>null}async analyzeAsync(e,t,i){t||(t={}),this.extractRowSeparator(e,t),this.extractColumnSeparator(e,t),this.extractHeader(e,t);let s=(0,n.linq)(new Rt(e,t.rowSeparator));i&&(s=s.take(i)),t.hasHeader&&(s=s.skip(1));let a=zt.begin("Analazing rows...");const r=[];let o=0;await s.foreachAsync((async e=>{o++,this.analyzeRow((0,n.linq)(new Ht(e,t.columnSeparator)).toArray(),r),o%200==0&&(a.progress={current:o},await(0,V.$)(0))})),t.rowsCount=o,a.end();const l=(0,n.linq)(t.columns);return r.forEach(((e,i)=>{t.columns[i].parser||(t.columns[i].parser=this.createParser(e))})),l.any((e=>e.type==Ut.XAxis))||(l.first((e=>e.type==Ut.Exclude)).type=Ut.XAxis),l.any((e=>e.type==Ut.Serie))||r.forEach(((e,i)=>{e.numberCount>0&&0==e.stringCount&&(t.columns[i].type=Ut.Serie)})),l.any((e=>e.type==Ut.Group))||r.forEach(((e,i)=>{if(e.stringCount>0&&0==e.emptyCount){var s=(0,n.linq)(e.values);s.count()>1&&s.any((e=>e.value>1))&&(t.columns[i].type=Ut.Group)}})),t}async loadTableAsync(e,t,i){var s=[],a=(0,n.linq)(new Rt(e,t.rowSeparator));for(var r of(t.hasHeader&&(a=a.skip(1)),a)){const e=(0,n.linq)(new Ht(r,t.columnSeparator)).toArray(),a={};for(let i=0;i<e.length;i++){const s=t.columns[i];s.type!=Ut.Exclude&&(a[s.id]=s.parser(e[i]))}if(s.push(a),i&&s.length>=i)break}return s}async loadGroupAsync(e,t){var i={name:$string("$(da-main-group)")},s=(0,n.linq)(new Rt(e,t.rowSeparator));t.hasHeader&&(s=s.skip(1));const a=(0,n.linq)(t.columns).where((e=>e.type==Ut.XAxis)).select(((e,t)=>t)).first();let r=zt.begin("Loading groups..."),o=0;return await s.foreachAsync((async e=>{const s=(0,n.linq)(new Ht(e,t.columnSeparator)).toArray(),l=t.columns[a].parser(s[a]);let c=i;for(let e=0;e<s.length;e++){const i=t.columns[e];if(i.type==Ut.Exclude||i.type==Ut.XAxis)continue;let n=i.parser(s[e]);i.type==Ut.Group?(c.groups||(c.groups={}),""===n&&(n=$string("<$(empty)>")),n in c.groups||(c.groups[n]={name:n,colId:i.id}),c=c.groups[n]):i.type==Ut.Serie&&(c.series||(c.series={}),i.id in c.series||(c.series[i.id]={name:i.name,colId:i.id,values:[]}),c.series[i.id].values.push({x:l,y:n}))}o++,o%200==0&&(r.progress={current:o,totCount:t.rowsCount},await(0,V.$)(0))})),t.rowsCount=o,r.end(),i}}class Yt{constructor(){this.canDrag=!1}canReadData(e){return!1}readData(e){}writeData(e){return!1}attachNode(e){this.node=e}remove(){}onParentChanged(){}canAccept(e){return!1}name=ko.observable();color=ko.observable();canDrag;itemType;icon;node}class Kt{execute(){}text;icon}class Jt{_treeView;_parentNode;_element;_dargEnterCount=0;_childLoaded=!1;constructor(e){this.value(e),this.isExpanded.subscribe((async e=>{e&&!this._childLoaded&&(await this.loadChildNodes(),this._childLoaded=!0)})),this.isSelected.subscribe((e=>{e&&this._treeView.select(this)}))}async loadChildNodes(){}clear(){this._childLoaded=!1,this.nodes.removeAll()}get element(){return this._element}attachNode(e){this._element=e,this._element.id=(0,n.generateId)("id"),this._element.$model=this,this._element.addEventListener("keydown",(e=>this.onKeyDown(e)));let t=this._element.querySelector("header");t.ondragstart=e=>this.onDrag(e),t.ondragover=e=>this.onDragOver(e),t.ondragenter=e=>this.onDragEnter(e),t.ondragleave=e=>this.onDragLeave(e),t.ondrop=e=>this.onDrop(e)}onKeyDown(e){46==e.keyCode&&"INPUT"!=e.target.tagName&&(e.preventDefault(),this.isSelected()&&this.value().remove())}onDrag(e){if(!this.value().writeData(e.dataTransfer)||!this.value().canDrag)return e.preventDefault(),!1}onDragEnter(e){this._dargEnterCount++}onDragLeave(e){this._dargEnterCount--,0==this._dargEnterCount&&(0,n.removeClass)(this._element,"drop")}onDragOver(e){if(e.preventDefault(),1==this._dargEnterCount){let t=!0;this.value().canReadData(e.dataTransfer)||(t=!1),t?(e.ctrlKey?e.dataTransfer.dropEffect="copy":e.dataTransfer.dropEffect="move",(0,n.addClass)(this._element,"drop")):e.dataTransfer.dropEffect="move"}}onDrop(e){e.preventDefault(),this._dargEnterCount=0,(0,n.removeClass)(this._element,"drop");const t=e.dataTransfer.getData("text/html+id");if(t){const i=document.getElementById(t).$model;if(!this.value().canAccept(i.value()))return;if(!e.ctrlKey){if(i._parentNode==this)return;return i._parentNode.nodes.remove(i),i._parentNode=this,this.nodes.push(i),this.isExpanded(!0),void i.value().onParentChanged()}}else this.value().readData(e.dataTransfer)}remove(){this._parentNode&&this._parentNode.nodes.remove(this),this._treeView.selectedNode()==this&&this._treeView.select(null)}addNode(e){e.attach(this._treeView,this),this.nodes.push(e)}attach(e,t){this._treeView=e,this._parentNode=t;for(let t of this.nodes())t.attach(e)}get parentNode(){return this._parentNode}toggleVisible(){this.isVisible(!this.isVisible())}select(e=!1){if(this.isSelected(!0),this._element&&this._element.focus(),e){let e=this;for(;e;)e.isExpanded(!0),e=e.parentNode}}expandCollapse(){this.isExpanded(!this.isExpanded())}nodes=ko.observableArray();value=ko.observable();isSelected=ko.observable(!1);isVisible=ko.observable(!0);isExpanded=ko.observable(!1);actions=ko.observable()}class Zt{_selectedNode;select(e){this.selectedNode()!=e&&(this.selectedNode()&&this.selectedNode().isSelected(!1),this.selectedNode(e),this.selectedNode()&&this.selectedNode().isSelected(!0))}setRoot(e){e.attach(this),this.root(e)}root=ko.observable();selectedNode=ko.observable()}class Qt{_element;_dargEnterCount=0;attachNode(e){this._element=e,e.ondragover=e=>this.onDragOver(e),e.ondrop=e=>this.onDrop(e),e.ondragenter=e=>this.onDragEnter(e),e.ondragleave=e=>this.onDragLeave(e)}onFileDropped(e){}onDragEnter(e){this._dargEnterCount++}onDragLeave(e){this._dargEnterCount--,0==this._dargEnterCount&&(0,n.removeClass)(this._element,"drop")}onDragOver(e){e.preventDefault(),1==this._dargEnterCount&&(0,n.addClass)(this._element,"drop")}async onDrop(e){if(e.preventDefault(),this._dargEnterCount=0,(0,n.removeClass)(this._element,"drop"),1==e.dataTransfer.files.length){if(e.dataTransfer.files[0].name.toLowerCase().endsWith(".csv")){const t=await e.dataTransfer.files[0].text();return void this.onFileDropped(t)}}M.toast({html:$string("$(msg-not-supported-only-csv)")})}}class ei{_showCount=0;constructor(){this.status("hidden"),zt.onBegin.add(((e,t)=>this.show(t))),zt.onEnd.add(((e,t)=>this.hide(t))),zt.onProgress.add(((e,t)=>this.update(t.operation,t.progress)))}show(e){0==this._showCount&&(this.status("indefinite"),this.percentage(100)),this.message(e.message),this._showCount++}update(e,t){this.message(e.getProgressDescription(t)),null!=t.totCount&&null!=t.current?(this.percentage(Math.min(100,t.current/t.totCount*100)),this.status("show")):(this.status("show"),this.percentage(100))}hide(e){this._showCount--,0==this._showCount&&this.status("hidden")}message=ko.observable();percentage=ko.observable();status=ko.observable()}class ti{constructor(e){this.types=[{text:$string("$(exclude)"),value:Ut.Exclude},{text:$string("$(x-axis)"),value:Ut.XAxis},{text:$string("$(serie)"),value:Ut.Serie},{text:$string("$(group)"),value:Ut.Group}],this.value=e,this.type(e.type),this.alias(e.name)}value;alias=ko.observable();type=ko.observable();types}class ii extends Yt{constructor(e){super(),this.value=e,this.icon="folder",this.itemType="group",this.color("#ffc107"),this.name(e.name)}attachNode(e){super.attachNode(e),e.isVisible.subscribe((e=>{for(var t of this.node.nodes())t.isVisible(e)}))}value}class si extends Yt{constructor(e){super(),this.value=e,this.icon="insert_chart",this.itemType="serie",this.color("#4caf50"),this.name(e.name)}value;colId}class ni{_model;_adapter;_text;_options;_onGetData;constructor(){this.columnSeparators=[{text:$string("$(tab-key)"),value:"\t"},{text:",",value:","},{text:";",value:";"},{text:$string("$(sapce-key)"),value:" "}],this.treeView.setRoot(new Jt),this.treeView.selectedNode.subscribe((e=>this.onNodeSelected(e))),this.fileDrop.onFileDropped=e=>this.importText(e)}async importText(e,t){if(M.toast({html:$string("$(msg-start-analysis)")}),this.hasData(!0),await(0,V.$)(0),this._text=e,this._adapter=new Xt,this._options=await this._adapter.analyzeAsync(this._text,t,5e3),!this._options.columnSeparator||!this._options.rowSeparator||!this._options.columns||this._options.columns.length<2)return!1;this.hasHeader(this._options.hasHeader),this.columnSeparator(this._options.columnSeparator);const i=[];for(let e of this._options.columns){var s=new ti(e);i.push(s)}return this.columns(i),await this.updatePreview(),!0}async getSelectedData(){const e=[];return await this.getSelectedDataWork(this.treeView.root(),[],e),e}async getSelectedDataWork(e,t,i){if(e.isVisible())if(e.value()instanceof si){const s=e.value().value,n={type:"data-import",options:this._options,serie:s,groups:t};i.push(n)}else{if(e.isExpanded()||await e.loadChildNodes(),e.value()instanceof ii){const i=e.value().value;let s=t.slice(0,t.length);s.push({id:i.colId,value:i.name}),t=s}for(let s of e.nodes())await this.getSelectedDataWork(s,t,i)}}async executeImport(){const e=await this.getSelectedData();this._onGetData&&(this._onGetData(e),this._onGetData=null),this._model.close()}async applyChanges(){this._options.hasHeader=this.hasHeader(),this._options.columnSeparator=this.columnSeparator(),this._options.columns.forEach(((e,t)=>{e.name=this.columns()[t].alias(),e.type=this.columns()[t].type()})),await this.updatePreview(!0)}async updateGroups(){const e=await this._adapter.loadGroupAsync(this._text,this._options);let t=new Jt(new ii(e));this.treeView.root().clear(),this.treeView.root().addNode(t),t.value().attachNode(t),this.updateNode(t,e),t.isExpanded(!0)}updateNode(e,t){if(e.clear(),t.groups)for(let i of(0,c.k)(t.groups)){let t=new Jt(new ii(i.value));t.loadChildNodes=async()=>this.updateNode(t,i.value),e.addNode(t),t.value().attachNode(t)}if(t.series)for(let i of(0,c.k)(t.series)){let t=new Jt(new si(i.value));e.addNode(t),t.value().attachNode(t)}}async updateTable(){const e=await this._adapter.loadTableAsync(this._text,this._options,50),t={header:(0,c.k)(this._options.columns).where((e=>e.type!=Ut.Exclude)).select((e=>e.name)).toArray(),rows:(0,c.k)(e).select((e=>(0,c.k)(e).select((e=>this.format(e.value))).toArray())).toArray()};this.table(t)}format(e){return"number"==typeof e?formatNumber(e):"boolean"==typeof e?$string(e?"$(yes)":"$(no)"):e instanceof Date?w(e,$string("$(date-format)")):e}async updatePreview(e=!1){e||this._options.rowsCount<4999?await this.updateGroups():this.treeView.root().clear(),await this.updateTable()}onNodeSelected(e){if(e&&e.value()instanceof si){const t=e.value().value,i={header:[(0,c.k)(this._options.columns).where((e=>e.type==Ut.XAxis)).select((e=>e.name)).first(),t.name],rows:(0,c.k)(t.values).take(50).select((e=>[this.format(e.x),this.format(e.y)])).toArray()};this.table(i)}else this.table(null)}show(){return this._model||(this._model=M.Modal.init(document.getElementById("dataImport"),{onCloseEnd:e=>{this._onGetData&&this._onGetData([]),this.reset()}})),this._model.open(),new Promise((e=>this._onGetData=e))}reset(){this._text=null,this._options=null,this._onGetData=null,this.hasData(!1),this.treeView.root().clear(),this.table(null)}async importUrl(){const e=zt.begin($string("$(msg-download-progress)"));try{let t=await fetch(this.sourceUrl());if(t.ok){const e=await t.text();if(e)return void this.importText(e)}M.toast({html:$string("$(msg-download-error): "+t.statusText)})}finally{e.end()}}hasHeader=ko.observable();columnSeparator=ko.observable();columns=ko.observable();columnSeparators;table=ko.observable();treeView=new Zt;progress=new ei;hasData=ko.observable(!1);sourceUrl=ko.observable();fileDrop=new Qt}class ai{setExpressions(e){const t=this.calculator.getState();for(let i of e){const e=(0,n.linq)(t.expressions.list).first((e=>e.id==i.id));if(e)for(let t of Object.getOwnPropertyNames(i))e[t]=i[t];else t.expressions.list.push(i)}const i=(0,n.linq)(t.expressions.list).where((e=>"folder"!=e.type)).groupBy((e=>e.folderId?e.folderId:"")).toDictionary((e=>e.key),(e=>e.values.toArray())),s=[];for(let e of(0,n.linq)(t.expressions.list).where((e=>"folder"==e.type))){s.push(e);const t=i[e.id];if(t)for(let e of t)s.push(e)}const a=i[""];if(a)for(let e of a)s.push(e);t.expressions.list=s,this.calculator.setState(t)}setSelectedId(e){this.calculator.controller.listModel.selectedItem&&this.calculator.controller.listModel.selectedItem.id==e||this.calculator.controller.dispatch({type:"set-selected-id",id:e})}setColor(e,t){this.calculator.controller.dispatch({type:"set-item-color",id:e,color:t})}updateTable(e,t){const i=(0,n.linq)(this.calculator.getExpressions()).where((t=>t.id==e)).first();i&&(i.columns[0].values=(0,n.linq)(t).select((e=>e.x.toString())).toArray(),i.columns[1].values=(0,n.linq)(t).select((e=>e.y.toString())).toArray(),this.calculator.setExpression(i))}updateExpression(e){this.calculator.setExpression(e)}updateVariable(e,t,i){t&&this.updateExpression({id:e,latex:t+"="+i.toString()})}expressionZoomFit(e){this.calculator.controller.dispatch({type:"expression-zoom-fit",id:e})}setItemVisibile(e,t){this.updateExpression({id:e,hidden:!t})}generateVars(e){for(let t in e)e[t]||(e[t]=this.generateVar(t))}generateVar(e="a"){return this.vars[e[0]]||(this.vars[e[0]]=0),this.vars[e[0]]++,e[0]+"_{"+this.vars[e[0]]+"}"}serieCalculator;calculator;vars={};treeItems={}}class ri extends Yt{_graphCtx;_varsMap;_isUpdating=0;constructor(){super()}createActions(e){e.push((0,n.apply)(new Kt,(e=>{e.text=$string("$(delete)"),e.icon="delete",e.execute=()=>this.remove()})))}setState(e){this._isUpdating++,e.name&&this.name(e.name),null!=e.visible&&this.node.isVisible(e.visible),e.color&&this.color(e.color),null!=e.opened&&this.node.isExpanded(e.opened),e.folderId&&(this.folderId=e.folderId),this.setStateWork(e),this.updateGraph(),this.setChildrenStateWork(e),this._isUpdating--}getState(){return{name:this.name(),visible:this.node.isVisible(),folderId:this.folderId,color:this.color(),opened:this.node.isExpanded()}}getVar(e){return this._varsMap[e]}remove(e=!0){this._graphCtx&&(this._graphCtx.calculator.removeExpression({id:this.getGraphId("private")}),this._graphCtx.calculator.removeExpression({id:this.getGraphId("public")})),this.node.remove(),e&&this.children.foreach((e=>e.remove()))}attachNode(e){this.node=e,this.node.isVisible.subscribe((e=>this.updateGraphVisibility())),this.node.isSelected.subscribe((e=>{e&&this.onSelected()}));const t=[];this.createActions(t),this.node.actions(t)}attachGraph(e){this._graphCtx=e,this._graphCtx.calculator.observe("expressionAnalysis",(()=>this.onGraphChanged())),this.color.subscribe((e=>this.updateColor()))}isFullVisible(){let e=this.node;for(;e;){if(!e.isVisible())return!1;e=e.parentNode}return!0}updateGraphVisibility(e=!0){const t=this.isFullVisible();return this._graphCtx.setItemVisibile(this.getGraphId("public"),t),this._graphCtx.setItemVisibile(this.getGraphId("private"),t),e&&this.children.foreach((e=>e.updateGraphVisibility())),t}updateGraph(e=!0){if(!this._graphCtx)return;this.folderId||(this.folderId=(0,n.uuidv4)()),this._graphCtx.treeItems[this.folderId]=this;const t=this.getExpressions();this._graphCtx.setExpressions(t),this.updateGraphWork(),this.updateGraphVisibility(),this.updateParameters(),e&&this.children.foreach((t=>t.updateGraph(e)))}onParentChanged(){this.updateGraphVisibility()}get parent(){return this.node.parentNode.value()}get children(){return(0,n.linq)(this.node.nodes()).select((e=>e.value()))}replaceVars(e){for(let t in this._varsMap){const i=new RegExp("\\$"+t,"g");e=e.replace(i,this._varsMap[t])}return e}getGraphId(e){return this.folderId+"/"+e}addChildrenWork(e,t=!0){const i=new Jt(e);return this.node.addNode(i),e.attachNode(i),e.attachGraph(this._graphCtx),t&&e.updateGraph(),e.onParentChanged(),e}createParameters(e){return!1}updateParameters(){const e=[];this.createParameters(e)&&(this.parameters.removeAll(),e.forEach((e=>this.parameters.push(e))))}updateGraphWork(){}setChildrenStateWork(e){}onSelected(){this.mainExpression&&this._graphCtx&&this._graphCtx.setSelectedId(this.mainExpression)}onGraphChanged(){}updateColor(){}get mainExpression(){}folderId;time=ko.observable(0);optionsTemplateName;parameters=ko.observableArray()}var oi=i(1310),li=i(2407),ci=i(6403),di=i(1055),hi=i(1431);function ui(e){let t,i,s,n,a=Math.round,r=parseInt,o=e.length,l={};if(o>9){if([t,i,s,n]=e=e.split(","),o=e.length,o<3||o>4)return null;l.r=r("a"==t[3]?t.slice(5):t.slice(4)),l.g=r(i),l.b=r(s),l.a=n?parseFloat(n):-1}else{if(8==o||6==o||o<4)return null;o<6&&(e="#"+e[1]+e[1]+e[2]+e[2]+e[3]+e[3]+(o>4?e[4]+e[4]:"")),e=r(e.slice(1),16),9==o||5==o?(l.r=e>>24&255,l.g=e>>16&255,l.b=e>>8&255,l.a=a((255&e)/.255)/1e3):(l.r=e>>16,l.g=e>>8&255,l.b=255&e,l.a=-1)}return l}function mi(e){if(null!=e&&null!=e)return e.toString()}class pi{select(){}icon;value;vars=ko.observable()}class gi{value;curValue=ko.observable();autoCompute=ko.observable();min=ko.observable();max=ko.observable();step=ko.observable()}class fi extends ri{_varsMap={};constructor(e){super(),this._varsMap={fun:null,sum:null,n1:null,n2:null,value:null,time:null,tend:null,tstart:null,xp:null,s:null,n3:null},this.itemType="regression",this.icon="show_chart",this.optionsTemplateName="RegressionOptionsTemplate",this.functions=[],this.addFunction({name:$string("$(log-normal)"),type:"log-normal",value:"$s\\sim $c\\cdot\\frac{ e^ {-\\frac{ \\left(\\ln\\ \\left($x - $a\\right) \\ -$u\\right)^ { 2}} { 2$o^ { 2} }}}{ \\left($x - $a\\right) \\sqrt{ 2\\pi } $o }",vars:[{name:"a",label:$string("$(offset)"),autoCompute:!0,precision:0},{name:"c",label:$string("$(total)"),autoCompute:!0,precision:0},{name:"o",label:$string("$(variance)"),autoCompute:!0,precision:5},{name:"u",label:$string("$(average)"),autoCompute:!0,precision:5}]}),this.addFunction({name:$string("$(normal)"),type:"normal",value:"$s\\sim $c\\cdot\\ \\left(\\frac{1}{\\sqrt{2\\cdot\\pi}\\cdot $o}\\right)\\cdot e^{-\\frac{1}{2}\\cdot\\left(\\frac{\\left($x-$u\\right)}{$o}\\right)^{2}}",vars:[{name:"c",label:$string("$(total)"),autoCompute:!0,precision:0},{name:"o",label:$string("$(variance)"),autoCompute:!0,precision:5},{name:"u",label:$string("$(avg-peak)"),autoCompute:!0,precision:0}]}),this.addFunction({name:$string("$(exponential)"),type:"exponential",value:"$s\\sim $a^{\\left($x-$b\\right)}",vars:[{name:"a",label:$string("$(base)"),autoCompute:!0,precision:5},{name:"b",label:$string("$(offset)"),autoCompute:!0,precision:5}]}),this.addFunction({name:$string("$(linear)"),type:"linear",value:"$s\\sim $a+$m$x",vars:[{name:"a",label:$string("$(offset)"),autoCompute:!0,precision:5},{name:"m",label:$string("$(slope)"),autoCompute:!0,precision:5}]}),this.showIntegration.subscribe((()=>{this._graphCtx.setItemVisibile(this.getGraphId("sum-serie"),this.isFullVisible()&&this.showIntegration()),this._graphCtx.setItemVisibile(this.getGraphId("sum-point"),this.isFullVisible()&&this.showIntegration())})),this.selectedFunction.subscribe((e=>{if(!this.name()&&e)return this.name(e.value.name)})),this.startDay.subscribe((e=>this.updateStartDay())),this.endDay.subscribe((e=>this.updateEndDay())),this.maxDay.subscribe((e=>{this.updateEndDay(),this.updateStartDay()})),this.selectedFunction(this.functions[0]),e&&this.setState(e)}get mainExpression(){return this.getGraphId("main-func")}addFunction(e){const t=new pi;t.value=e,t.select=()=>{this.selectedFunction(t),this.name(t.value.name),this.updateGraph()};const i=[];for(let t of e.vars){const e=new gi;e.value=t,e.curValue(t.value),e.autoCompute(t.autoCompute),e.min(t.minValue),e.max(t.maxValue),e.step(t.step),e.min.subscribe((e=>t.minValue=e)),e.max.subscribe((e=>t.maxValue=e)),e.step.subscribe((e=>t.step=e)),e.curValue.subscribe((e=>t.value=e)),e.autoCompute.subscribe((e=>{t.autoCompute=e,this.updateGraph()})),e.curValue.subscribe((i=>{e.autoCompute()||this._graphCtx.updateVariable(this.getGraphId(t.name+"-value"),this.getVar(t.name),i)})),i.push(e)}return t.vars(i),this.functions.push(t),t}onGraphChanged(){this.updateRegressionVars()}updateRegressionVars(){let e=this._graphCtx.calculator.controller.getItemModel(this.getGraphId("main"));if(e&&e.regressionParameters)for(let t of this.selectedFunction().vars()){const i=this.getVar(t.value.name).replace("{","").replace("}","");let s=e.regressionParameters[i];null!=s&&(null!=t.value.precision&&(s=(0,n.round)(s,t.value.precision)),t.curValue(s))}}createParameters(e){return e.push((0,n.apply)(new bi({value:this.startDay,name:$string("$(start-day)")}),(e=>{e.max=this.maxDay,e.min(1),e.step(1)}))),e.push((0,n.apply)(new bi({value:this.endDay,name:$string("$(end-day)")}),(e=>{e.max=this.maxDay,e.min(1),e.step(1)}))),!0}setStateWork(e){if(e.function){const t=(0,n.linq)(this.functions).first((t=>t.value.type==e.function.type));if(t){for(let i of e.function.vars){const e=(0,n.linq)(t.vars()).first((e=>e.value.name==i.name));e&&(e.autoCompute(i.autoCompute),e.max(i.maxValue),e.min(i.minValue),e.step(i.step),e.curValue(i.value))}this.selectedFunction(t)}}null!=e.showIntegration&&this.showIntegration(e.showIntegration),null!=e.startDay&&this.startDay(e.startDay),null!=e.endDay&&this.endDay(e.endDay)}getState(){const e=super.getState();e.function=this.selectedFunction().value,e.showIntegration=this.showIntegration(),e.startDay=this.startDay(),e.endDay=this.endDay();for(let e of this.selectedFunction().vars())e.value.value=e.curValue(),e.value.maxValue=e.max(),e.value.minValue=e.min(),e.value.step=e.step(),e.value.autoCompute=e.autoCompute();return e}onParentChanged(){super.onParentChanged(),this.color(this.parent.color()),this.maxDay((0,n.linq)(this.parent.values).max((e=>e.x))),null==this.endDay()&&this.endDay(this.maxDay()),null==this.startDay()&&this.startDay(1)}updateEndDay(){this._varsMap.tend&&this._graphCtx.updateExpression({type:"expression",id:this.getGraphId("end-day"),latex:this._varsMap.tend+"="+this.endDay(),slider:{min:"0",step:"1",max:this.maxDay().toString()}})}updateStartDay(){this._varsMap.tstart&&this._graphCtx.updateExpression({type:"expression",id:this.getGraphId("start-day"),latex:this._varsMap.tstart+"="+this.startDay(),slider:{min:"0",step:"1",max:this.maxDay().toString()}})}updateColor(){this._graphCtx.setColor(this.getGraphId("main-func"),this.color()),this._graphCtx.setColor(this.getGraphId("sum-serie"),this.color()),this._graphCtx.setColor(this.getGraphId("sum-point"),this.color()),this._graphCtx.setColor(this.getGraphId("end-day-line"),this.color()),this._graphCtx.setColor(this.getGraphId("start-day-line"),this.color())}updateGraphWork(){this.updateRegressionVars()}getExpressions(){const e=[];e.push({type:"folder",id:this.getGraphId("public"),title:this.parent.name()+" - "+this.name(),collapsed:!0}),e.push({type:"folder",id:this.getGraphId("private"),secret:!0,title:this.parent.name()+" - "+this.name(),collapsed:!0});const t=this.selectedFunction().value;this._varsMap.x="",this._varsMap.y=this.parent.getVar("y"),this._varsMap.time=this.parent.parent.getVar("time");for(let e of t.vars)this._varsMap[e.name]||(this._varsMap[e.name]=null);this._graphCtx.generateVars(this._varsMap),this._varsMap.x=this.getVar("xp");const i=function(e,t,i,s){parseInt;let n,a,r,o,l,c,d,h=Math.round,u="string"==typeof i;return"number"!=typeof e||e<-1||e>1||"string"!=typeof t||"r"!=t[0]&&"#"!=t[0]||i&&!u?null:(d=t.length>9,d=u?i.length>9||"c"==i&&!d:d,l=ui(t),o=e<0,c=i&&"c"!=i?ui(i):o?{r:0,g:0,b:0,a:-1}:{r:255,g:255,b:255,a:-1},o=1-(e=o?-1*e:e),l&&c?(s?(n=h(o*l.r+e*c.r),a=h(o*l.g+e*c.g),r=h(o*l.b+e*c.b)):(n=h((o*l.r**2+e*c.r**2)**.5),a=h((o*l.g**2+e*c.g**2)**.5),r=h((o*l.b**2+e*c.b**2)**.5)),u=l.a,c=c.a,l=u>=0||c>=0,u=l?u<0?c:c<0?u:u*o+c*e:0,d?"rgb"+(l?"a(":"(")+n+","+a+","+r+(l?","+h(1e3*u)/1e3:"")+")":"#"+(4294967296+16777216*n+65536*a+256*r+(l?h(255*u):0)).toString(16).slice(1,l?void 0:-2)):null)}(-.3,this.color(),!1,!0);e.push({type:"expression",id:this.getGraphId("main"),folderId:this.getGraphId("private"),latex:this.replaceVars(t.value),hidden:!0}),e.push({type:"expression",id:this.getGraphId("main-func"),folderId:this.getGraphId("private"),latex:this.replaceVars(t.value.replace("$s\\sim ","$fun\\left(x\\right)=").replace(/\$x/g,"x")),color:i,lineStyle:hi.Styles.DASHED}),e.push({type:"expression",id:this.getGraphId("sum-func"),folderId:this.getGraphId("private"),latex:this.replaceVars("$sum\\left(x\\right)=\\sum_{$n1=1}^{x}\\operatorname{round}\\left($fun\\left($n1\\right)\\right)"),hidden:!0}),e.push({type:"expression",id:this.getGraphId("subserie-func"),folderId:this.getGraphId("private"),latex:this.replaceVars("$s=\\sum_{$n3=$xp}^{$xp}{$y}[$n3+1]"),hidden:!0}),e.push({type:"expression",id:this.getGraphId("subserie-hl"),folderId:this.getGraphId("private"),latex:this.replaceVars("($xp, $s)"),color:i,lines:!1,lineStyle:hi.Styles.POINT,pointStyle:"NONE",points:!0}),e.push({type:"expression",id:this.getGraphId("sum-x-time"),folderId:this.getGraphId("private"),latex:this.replaceVars("$n2=\\left[1,...,$time\\right]")}),e.push({type:"expression",id:this.getGraphId("sum-serie"),folderId:this.getGraphId("private"),latex:this.replaceVars("\\left($n2,\\ $sum\\left($n2\\right)\\right)"),color:this.parent.color(),lines:!0,hidden:!this.showIntegration(),lineStyle:hi.Styles.SOLID,pointStyle:"NONE",points:!1}),e.push({type:"expression",id:this.getGraphId("sum-value"),folderId:this.getGraphId("public"),latex:this.replaceVars("$value=$sum\\left($time\\right)")}),e.push({type:"expression",id:this.getGraphId("sum-point"),folderId:this.getGraphId("private"),hidden:!this.showIntegration(),latex:this.replaceVars("\\left($time,$value\\right)"),color:this.parent.color(),label:this.parent.name(),dragMode:"XY",showLabel:!0}),e.push({type:"expression",id:this.getGraphId("end-day"),latex:this._varsMap.tend+"="+this.endDay(),folderId:this.getGraphId("public"),label:"Fine Previsione",slider:{min:(0).toString(),max:this.maxDay().toString(),hardMax:!0,hardMin:!0,step:"1"}}),e.push({type:"expression",id:this.getGraphId("start-day"),latex:this._varsMap.tstart+"="+this.startDay(),folderId:this.getGraphId("public"),label:"Inizio Previsione",slider:{min:(0).toString(),max:this.maxDay().toString(),hardMax:!0,hardMin:!0,step:"1"}}),e.push({type:"expression",id:this.getGraphId("end-day-line"),color:i,latex:"x="+this._varsMap.tend,folderId:this.getGraphId("private"),lines:!0}),e.push({type:"expression",id:this.getGraphId("start-day-line"),color:i,latex:"x="+this._varsMap.tstart,folderId:this.getGraphId("private"),lines:!0}),e.push({type:"expression",id:this.getGraphId("end-day-serie"),latex:this.replaceVars("$xp=[$tstart,...,$tend]+"+this.parent.getVar("ofs")),folderId:this.getGraphId("private"),hidden:!0});for(let t of this.selectedFunction().vars())t.autoCompute()?this._graphCtx.calculator.removeExpression({id:this.getGraphId(t.value.name+"-value")}):e.push({type:"expression",id:this.getGraphId(t.value.name+"-value"),latex:this.getVar(t.value.name)+"="+(t.curValue()?t.curValue().toString():"0"),folderId:this.getGraphId("public"),label:t.value.name,slider:{min:mi(t.value.minValue),max:mi(t.value.maxValue),hardMax:!0,hardMin:!0,step:mi(t.value.step)}});return e}functions;selectedFunction=ko.observable();showIntegration=ko.observable(!0);maxDay=ko.observable();endDay=ko.observable();startDay=ko.observable()}class vi extends ri{constructor(e){super(),this.canDrag=!0,this.itemType="serie",this.icon="insert_chart",this.optionsTemplateName="StudioOptionsTemplate",this._varsMap={x:null,y:null,ofs:null,xofs:null},e&&this.setState(e)}importValues(e){if(e&&e.length>0)if(e[0].x instanceof Date){const t=e[0].x;this.values=(0,n.linq)(e).select((e=>({x:Math.round((0,n.dateDiff)(e.x,t).totalDays),xLabel:e.x,y:e.y}))).toArray()}else{if(isNaN(e[0].x))return void(this.values=(0,n.linq)(e).select(((e,t)=>({x:t,xLabel:e.x,y:e.y}))).toArray());this.values=e}else this.values=[];this.onSerieChanged()}writeData(e){var t={version:1,type:"serieState",state:this.getState()};return e.setData("application/json+studio",JSON.stringify(t)),e.setData("text/html+id",this.node.element.id),!0}createActions(e){super.createActions(e),e.push((0,n.apply)(new Kt,(e=>{e.text=$string("$(update)"),e.icon="autorenew",e.execute=()=>this.updateSerie()}))),e.push((0,n.apply)(new Kt,(e=>{e.text=$string("$(new-regression)"),e.icon="add_box",e.execute=()=>{const e=this.addRegression(null,!1);e.updateGraph(),this.node.isExpanded(!0),e.node.isSelected(!0)}}))),e.push((0,n.apply)(new Kt,(e=>{e.text=$string("$(zoom)"),e.icon="zoom_in",e.execute=()=>this.zoom()}))),e.push((0,n.apply)(new Kt,(e=>{e.text=$string("$(align-with-this)"),e.icon="compare_arrows",e.execute=()=>{let e=prompt($string("$(tollerance)"),"10");this.alignOthers(isNaN(e)?10:parseInt(e))}})))}static fromText(e){try{const t=JSON.parse(e);if(t){if("serie"==t.type)return new vi({name:t.title,values:t.values,source:t.serie,color:t.color});if("serieState"==t.type)return new vi(t.state)}}catch{}}getExpressions(){this.color()||this.color("#0000ff"),this._graphCtx.generateVars(this._varsMap);return[{type:"folder",id:this.getGraphId("public"),title:this.parent.name()+" - "+this.name(),collapsed:!0},{type:"folder",id:this.getGraphId("private"),title:this.parent.name()+" - "+this.name(),secret:!0,collapsed:!0},{type:"expression",id:this.getGraphId("offset"),latex:this._varsMap.ofs+"="+this.offsetX(),folderId:this.getGraphId("public"),label:"Scostamento",slider:{min:(-this.values.length).toString(),max:this.values.length.toString(),hardMax:!0,hardMin:!0,step:"1"}},{type:"expression",id:this.getGraphId("offset-x"),latex:this._varsMap.xofs+"="+this._varsMap.x+"+"+this._varsMap.ofs,folderId:this.getGraphId("private")},{type:"expression",id:this.getGraphId("offset-x-serie"),latex:"("+this._varsMap.xofs+","+this._varsMap.y+")",folderId:this.getGraphId("private"),points:!0,lines:!0,color:this.color()},{type:"table",id:this.getGraphId("table"),folderId:this.getGraphId("private"),columns:[{id:this.getGraphId("table/x"),latex:this._varsMap.x},{id:this.getGraphId("table/y"),latex:this._varsMap.y,hidden:!0}]}]}alignOthers(e,...t){t&&0!=t.length||(t=this.parent.children.where((e=>e!=this)).toArray());for(let i of t)i.alignWith(this,e)}alignWith(e,t){let i=0,s=Number.NEGATIVE_INFINITY;for(let n=-this.values.length;n<this.values.length;n++){let a=0;for(let i=0;i<this.values.length;i++){const s=i-n;s<0||s>=this.values.length||(i>=e.values.length||Math.abs(this.values[s].y-e.values[i].y)<t&&a++)}a>s&&(s=a,i=n)}e.offsetX(0),this.offsetX(i)}get mainExpression(){return this.getGraphId("offset-x-serie")}createParameters(e){return e.push((0,n.apply)(new bi({value:this.offsetX,name:$string("$(shift)")}),(e=>{e.max(this.values.length),e.min(-this.values.length),e.step(1)}))),!0}updateGraphWork(){this._graphCtx.updateTable(this.getGraphId("table"),this.values)}onGraphChanged(){}onSelected(){super.onSelected()}updateColor(){this._graphCtx.setColor(this.getGraphId("offset-x-serie"),this.color()),this.children.foreach((e=>e.onParentChanged()))}attachGraph(e){super.attachGraph(e),this.offsetX.subscribe((e=>{this._graphCtx.updateVariable(this.getGraphId("offset"),this._varsMap.ofs,e),this.onSerieChanged()}))}onSerieChanged(){0==this._isUpdating&&this.parent.updateAggregate()}setChildrenStateWork(e){null!=e.children&&(this.children.foreach((e=>e.remove())),e.children.forEach((e=>{this.addRegression(null,!1).setState(e)})))}setStateWork(e){null!=e.offsetX&&this.offsetX(e.offsetX),e.source&&(this.source=this.upgradeSource(e.source)),null!=e.values&&this.importValues(e.values)}upgradeSource(e){if(e.type||(e.type="geoplot"),"geoplot"==e.type&&(e.areaId=this.upgradeAreaId(e.areaId),e.exeludedAreaIds))for(let t=0;t<e.exeludedAreaIds.length;t++)e.exeludedAreaIds[t]=this.upgradeAreaId(e.exeludedAreaIds[t]);return e}upgradeAreaId(e){if(e){if(e.startsWith("R")&&2==e.length)return"R0"+e.substring(1);if(e.startsWith("D")&&2==e.length)return"D00"+e.substring(1);if(e.startsWith("D")&&3==e.length)return"D0"+e.substring(1)}return e}getState(){const e=super.getState();return e.offsetX=this.offsetX(),e.source=this.source,e.values=this.values,e.children=this.children.select((e=>e.getState())).toArray(),e}addRegression(e,t=!0){return this.addChildrenWork(e instanceof fi?e:new fi(e),t)}async changeColor(){const e=await di.z.instance.pick();e&&this.color(e)}async updateSerie(){if("geoplot"!=this.source.type&&this.source.type)M.toast({html:$string("$(msg-update-not-supported)")});else{if(!this._graphCtx.serieCalculator){M.toast({html:$string("$(msg-downloading-data)")});const e=await s.loadStudioData();this._graphCtx.serieCalculator=new ci.kN(new li.k(e.data),oi.X,e.geo)}const e=this.source;e.range?(this._graphCtx.serieCalculator.data.startDay=e.range.start,this._graphCtx.serieCalculator.data.endDay=e.range.end):(this._graphCtx.serieCalculator.data.startDay=void 0,this._graphCtx.serieCalculator.data.endDay=void 0),this.importValues(this._graphCtx.serieCalculator.getSerie(e)),this._graphCtx.updateTable(this.getGraphId("table"),this.values),this.children.foreach((e=>e.onParentChanged())),this.onSerieChanged(),M.toast({html:$string("$(msg-update-complete)")})}}zoom(){const e=(0,n.linq)(this.values).min((e=>e.x)),t=(0,n.linq)(this.values).min((e=>e.y)),i=(0,n.linq)(this.values).max((e=>e.x)),s=(0,n.linq)(this.values).max((e=>e.y));this._graphCtx.calculator.setMathBounds({top:s+.1*(s-t),right:i+.1*(i-e),bottom:t-.1*(s-t),left:e-.1*(i-e)})}color=ko.observable();offsetX=ko.observable(0);source;values=[]}class yi extends ri{constructor(e){super(),this.itemType="project",this.icon="folder",this.optionsTemplateName="ProjectOptionsTemplate",this.aggregationModes=[{text:$string("$(none)"),value:"none"},{text:$string("$(sum)"),value:"sum"},{text:$string("$(average)"),value:"avg"}],this._varsMap={time:null,xagg:null,yagg:null},e&&this.setState(e)}createActions(e){super.createActions(e),e.push((0,n.apply)(new Kt,(e=>{e.text=$string("$(update-all-proj)"),e.icon="autorenew",e.execute=()=>this.updateAllSerie()})))}async updateAllSerie(){for(let e of this.children)await e.updateSerie()}canAccept(e){return e instanceof vi}canReadData(e){return-1!=e.types.indexOf("application/json+studio")}readData(e){const t=e.getData("application/json+studio");let i=vi.fromText(t);i&&(this.addSerie(i),this.node.isExpanded(!0))}getExpressions(){this._graphCtx.generateVars(this._varsMap);return[{type:"folder",id:this.getGraphId("public"),title:this.name(),collapsed:!0},{type:"folder",id:this.getGraphId("private"),title:this.name(),secret:!0,collapsed:!0},{type:"expression",folderId:this.getGraphId("public"),id:this.getGraphId("time"),latex:this._varsMap.time+"="+this.time(),slider:{hardMin:!0,hardMax:!0,min:"0",max:"100",step:"1"}},{type:"table",id:this.getGraphId("aggregate"),folderId:this.getGraphId("private"),columns:[{id:this.getGraphId("table/xagg"),latex:this._varsMap.xagg},{id:this.getGraphId("table/yagg"),latex:this._varsMap.yagg,lines:!0,points:!0}]}]}updateAggregate(){const e={},t=this.children.toArray();for(var i of t){const t=parseInt(i.offsetX());for(var s of i.values){const i=s.x+t;i in e?e[i]+=s.y:e[i]=s.y}}const a=(0,n.linq)(e).orderBy((e=>e.key)).select((e=>({x:e.key,y:e.value}))).toArray();this._graphCtx.updateTable(this.getGraphId("aggregate"),a)}updateColor(){this._graphCtx.setColor(this.getGraphId("aggregate"),this.color())}get mainExpression(){return this.getGraphId("aggregate")}createParameters(e){return e.push((0,n.apply)(new bi({value:this.time,name:$string("$(day)")}),(e=>{e.max(100),e.min(0),e.step(1)}))),!0}setStateWork(e){null!=e.time&&this.time(e.time),e.aggregationMode?this.aggregationMode(e.aggregationMode):this.aggregationMode("none")}setChildrenStateWork(e){null!=e.children&&(this.children.foreach((e=>e.remove())),e.children.forEach((e=>{this.addSerie(null,!1).setState(e)}))),"none"!=this.aggregationMode()&&this.updateAggregate()}getState(){const e=super.getState();return e.time=this.time(),e.children=this.children.select((e=>e.getState())).toArray(),e.aggregationMode=this.aggregationMode(),e}onGraphChanged(){}attachGraph(e){super.attachGraph(e),this.time.subscribe((e=>this._graphCtx.updateVariable(this.getGraphId("time"),this._varsMap.time,this.time()))),this.aggregationMode.subscribe((e=>this.updateAggregate()))}addSerie(e,t=!0){return this.addChildrenWork(e instanceof vi?e:new vi(e),t)}time=ko.observable(0);aggregationMode=ko.observable("none");aggregationModes}class bi{constructor(e){this.value=e.value,this.name=e.name}name;min=ko.observable();max=ko.observable();step=ko.observable();isSelected=ko.observable(!0);value}class _i{_graphCtx;_projectId;constructor(e){this._projectId=e,this._graphCtx=new ai,this._graphCtx.calculator=hi.GraphingCalculator(document.getElementById("calculator"),{pasteGraphLink:!1,pasteTableData:!1,expressionsCollapsed:!0,restrictedFunctions:!0,administerSecretFolders:!0,authorIDE:!0,advancedStyling:!0}),this._graphCtx.calculator.controller.listModel.onSelectionChanged=e=>this.onGraphSelectionChanged(e);const t=[];t.push((0,n.apply)(new Kt,(e=>{e.text=$string("$(new-project)"),e.icon="create_new_folder",e.execute=()=>this.newProject()}))),t.push((0,n.apply)(new Kt,(e=>{e.text=$string("$(save)"),e.icon="save",e.execute=()=>this.saveState()}))),t.push((0,n.apply)(new Kt,(e=>{e.text=$string("$(import)"),e.icon="import_export",e.execute=()=>this.import()}))),t.push((0,n.apply)(new Kt,(e=>{e.text=$string("$(share) Studio"),e.icon="share",e.execute=()=>this.share()}))),t.push((0,n.apply)(new Kt,(e=>{e.text=$string("$(options)"),e.icon="settings",e.execute=()=>this.showOptions()})));const i=new Jt;i.actions(t),this.items.setRoot(i),document.body.addEventListener("paste",(async e=>{"INPUT"!=e.target.tagName&&await this.onPaste(e.clipboardData)&&e.preventDefault()})),M.Modal.init(document.getElementById("options"),{onCloseEnd:()=>this.updateOptions()}),setTimeout((()=>this.init()))}onGraphSelectionChanged(e){if(!e||!e.folderId)return;const t=e.folderId.split("/")[0],i=this._graphCtx.treeItems[t];i&&i.node.select(!0)}updateOptions(){const e=parseInt(this.maxX()),t=parseInt(this.maxY());this._graphCtx.calculator.setMathBounds({bottom:-t/10,left:-e/10,right:e,top:t})}async share(){const e=(0,n.uuidv4)();await s.saveState(e,this.getState());const t=n.Uri.absolute("~/"+$language.split("-")[0]+"/Studio/"+e);await(0,n.copyText)(t),M.toast({html:$string("$(msg-shared)")})}showOptions(){const e=this._graphCtx.calculator.graphpaperBounds;this.maxX(Math.round(e.mathCoordinates.width)),this.maxY(Math.round(e.mathCoordinates.height));M.Modal.getInstance(document.getElementById("options")).open()}getSelectedProject(){if(!this.items.selectedNode())return;const e=this.items.selectedNode().value();return"project"==e.itemType?e:"serie"==e.itemType?e.parent:"regression"==e.itemType?e.parent.parent:void 0}newProject(){const e=this.addProject({name:"Project "+(this.projects.count()+1)});return e.node.isSelected(!0),e}addProject(e,t=!0){const i=new yi(e),s=new Jt(i);return this.items.root().addNode(s),i.attachNode(s),i.attachGraph(this._graphCtx),t&&i.updateGraph(),i}getState(){const e={version:2};return e.graphState=this._graphCtx.calculator.getState(),e.vars=this._graphCtx.vars,e.projects=this.projects.select((e=>e.getState())).toArray(),e}setState(e){e&&(e.graphState&&(e.graphState.expressions.list=[],this._graphCtx.calculator.setState(e.graphState)),null!=e.projects&&(this.projects.toArray().forEach((e=>e.remove())),e.projects.forEach((e=>{this.addProject(null,!1).setState(e)}))))}async loadState(){if(this._projectId){let e=await s.loadState(this._projectId);this.setState(e)}else{const e=localStorage.getItem("studio");e&&this.setState(JSON.parse(e))}}async saveState(){this._projectId?(await s.saveState(this._projectId,this.getState()),M.toast({html:$string("$(msg-saved)")})):(localStorage.setItem("studio",JSON.stringify(this.getState())),M.toast({html:$string("$(msg-saved-device)")}))}demo(){const e=this.addProject({name:"Project 1"});this.addProject({name:"Project 2"}),this.addProject({name:"Project 3"}),e.addSerie({name:"Serie 1"})}async onPaste(e){const t=e.getData("text/plain").toString();return!!t&&await this.importText(t)}async import(){let e=this.getSelectedProject();const t=await this.dataImport.show();return this.addImportedData(t,e),!0}async importText(e){let t=this.getSelectedProject();if(t||this.projects.any()||(t=this.newProject()),!t)return M.toast({html:$string("$(msg-select-project)")}),!1;const i=vi.fromText(e);if(i){t.addSerie(i),t.node.isExpanded(!0),i.node.isExpanded(!0),i.zoom();const e=i.addRegression(null,!1);return e.updateGraph(),e.node.isSelected(!0),!0}try{await this.dataImport.importText(e)&&await this.import()}catch(e){console.error(e)}return M.toast({html:$string("$(msg-format-not-reconized)")}),!1}addImportedData(e,t){if(1==e.length&&this.items.selectedNode()&&this.items.selectedNode().value()instanceof vi&&confirm($string("$(msg-replace-serie)"))){const t=this.items.selectedNode().value();return t.source=e[0],t.importValues(e[0].serie.values),t.updateGraph(!0),!0}t.node.isExpanded(!0);for(let i of e){const e=new vi({name:i.serie.name,values:i.serie.values,source:i});t.addSerie(e),e.node.isExpanded(!0);const s=e.addRegression(null,!1);s.updateGraph(),s.node.isSelected(!0)}}get projects(){return(0,n.linq)(function*(){for(let e of this.items.root().nodes())yield e.value()}.apply(this))}async init(){this.loadState()}items=new Zt;maxX=ko.observable();maxY=ko.observable();dataImport=new ni}},117:(e,t,i)=>{"use strict";var s,n,a;i.d(t,{Wh:()=>n,yh:()=>r}),function(e){e[e.SUm=0]="SUm",e[e.Avg=1]="Avg"}(s||(s={})),function(e){e[e.Continent=0]="Continent",e[e.CountryGroup=1]="CountryGroup",e[e.Country=2]="Country",e[e.State=3]="State",e[e.Region=4]="Region",e[e.District=5]="District",e[e.Municipality=6]="Municipality"}(n||(n={})),function(e){e[e.All=0]="All",e[e.Male=1]="Male",e[e.Female=2]="Female"}(a||(a={}));const r={red:{600:"#f44336"},pink:{600:"#e91e63"},purple:{600:"#9c27b0"},deep_purple:{600:"#673ab7"},indigo:{600:"#3f51b5"},blue:{600:"#2196f3"},light_blue:{600:"#03a9f4"},cyan:{600:"#00bcd4"},teal:{600:"#009688"},green:{600:"#4caf50"},light_green:{600:"#8bc34a"},lime:{600:"#cddc39"},yellow:{600:"#ffeb3b"},amber:{600:"#ffc107"},orange:{600:"#ff9800"},depp_orange:{600:"#ff5722"},brown:{600:"#795548"},grey:{600:"#9e9e9e"},blue_gray:{600:"#607d8b"}}},7337:(e,t,i)=>{"use strict";i.r(t);var s=i(3892),n={};for(const e in s)"default"!==e&&(n[e]=()=>s[e]);i.d(t,n)},2370:e=>{"use strict";e.exports=__WEBPACK_EXTERNAL_MODULE__2370__},1431:e=>{"use strict";e.exports=__WEBPACK_EXTERNAL_MODULE__1431__},4396:e=>{"use strict";e.exports=__WEBPACK_EXTERNAL_MODULE__4396__},3892:e=>{"use strict";e.exports=__WEBPACK_EXTERNAL_MODULE__3892__}},__webpack_module_cache__={};function __webpack_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var i=__webpack_module_cache__[e]={exports:{}};return __webpack_modules__[e](i,i.exports,__webpack_require__),i.exports}__webpack_require__.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return __webpack_require__.d(t,{a:t}),t},__webpack_require__.d=(e,t)=>{for(var i in t)__webpack_require__.o(t,i)&&!__webpack_require__.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},__webpack_require__.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),__webpack_require__.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var __webpack_exports__={};return(()=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{GeoPlotApplication:()=>e.n,ParameterViewModel:()=>t.O,StudioPage:()=>t.q,GeoPlotPage:()=>i.b,ViewModes:()=>a.O,capitalizeFirst:()=>r.E,expandCollapse:()=>r.D,ColorPicker:()=>o.z});var e=__webpack_require__(7794),t=__webpack_require__(1794),i=__webpack_require__(9323),s=__webpack_require__(7337),n={};for(const e in s)["default","GeoPlotApplication","ParameterViewModel","StudioPage","GeoPlotPage"].indexOf(e)<0&&(n[e]=()=>s[e]);__webpack_require__.d(__webpack_exports__,n);var a=__webpack_require__(4964),r=__webpack_require__(2233),o=__webpack_require__(1055);__webpack_require__(8280)})(),__webpack_exports__})()}));
//# sourceMappingURL=app.map