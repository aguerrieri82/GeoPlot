function formatNumber(n){return n.toString().replace(/\B(?=(\d{3})+(?!\d))/g,".")}function capitalizeFirst(n){return n.substr(0,1).toUpperCase()+n.substr(1)}var GeoPlot;(function(n){var i=function(){function t(){}return t.getStringAsync=function(t){return n.Services.httpClient.requestAsync({url:t,method:"GET"})},t.postStringAsync=function(t,i){return n.Services.httpClient.requestAsync({url:t,method:"POST",data:i})},t.getJsonAsync=function(t){return n.Services.httpClient.requestAsync({url:t,method:"GET",responseType:"application/json"})},t.postJsonAsync=function(t,i){return n.Services.httpClient.requestAsync({url:t,method:"POST",responseType:"application/json",data:i})},t.postBinaryAsync=function(t,i,r){return n.Services.httpClient.requestAsync({url:t,method:"POST",responseType:"application/json",dataType:"application/octet-stream",data:i,onProgress:r})},t}(),t;n.Http=i;t=function(){function t(){}return t.prototype.requestAsync=function(t){return new Promise(function(i,r){var u=new XMLHttpRequest,f,e,s,h,o;if(u.onreadystatechange=function(){if(u.readyState==XMLHttpRequest.DONE)if(u.status==200){var n=u.responseText,f=t.responseType=="application/json";f&&(n=JSON.parse(n));i(n)}else r(u.status)},t.onProgress&&(u.upload.onprogress=t.onProgress),u.open(t.method,n.Uri.absolute(t.url),!0),f=t.dataType,e=t.data,t.data&&(s=f=="application/json"||typeof t.data=="object",h=f=="application/octet-stream",s&&!h&&(f="application/json",e&&typeof t.data!="string"&&(e=JSON.stringify(e)))),f&&u.setRequestHeader("Content-type",f),t.headers)for(o in t.headers)u.setRequestHeader(o,t.headers[o]);u.send(e)})},t}();n.XHRHttpClient=t})(GeoPlot||(GeoPlot={})),function(n){var t;(function(){})(t=n.Services||(n.Services={}))}(GeoPlot||(GeoPlot={})),function(n){var t=function(){function t(){}return t.prototype.initServices=function(){n.Services.httpClient=new n.XHRHttpClient},t}();n.app=new t}(GeoPlot||(GeoPlot={})),function(n){var t;(function(n){n[n.Country=0]="Country";n[n.State=1]="State";n[n.Region=2]="Region";n[n.District=3]="District"})(t=n.GeoAreaType||(n.GeoAreaType={}))}(GeoPlot||(GeoPlot={})),function(n){var t=function(){function t(){}return t.parse=function(n){return n instanceof Date?n:new Date(n)},t.equalsDate=function(n,t){return this.trucateTime(n).getTime()==this.trucateTime(t).getTime()},t.trucateTime=function(n){return new Date(n.getFullYear(),n.getMonth(),n.getDate())},t.addDays=function(t,i){return this.add(t,n.TimeSpan.fromDays(i))},t.add=function(n,t){return n=this.parse(n),new Date(n.getTime()+t.ticks)},t.diff=function(t,i){return new n.TimeSpan(this.parse(t).getTime()-this.parse(i).getTime())},t.now=function(){return new Date},t.today=function(){return this.truncateTime(this.now())},t.truncateTime=function(n){return n=this.parse(n),new Date(n.getFullYear(),n.getMonth(),n.getDate())},t.timeOfDay=function(t){return t=this.parse(t),new n.TimeSpan(t.getTime()-this.truncateTime(t).getTime())},t.format=function(t,i){var r=this;return t=this.parse(t),n.Format.replaceArgs(i,function(n){return r.formatArgument(t,n)})},t.formatDate=function(n){return n?this.format(n,"{YYYY}-{MM}-{DD}"):null},t.formatArgument=function(t,i){t=this.parse(t);switch(i){case"D":return t.getDate().toString();case"DD":return n.StringUtils.padLeft(t.getDate().toString(),2,"0");case"W":return this.WEEK_DAYS[(t.getDay()+6)%7].substr(0,3);case"WW":return this.WEEK_DAYS[(t.getDay()+6)%7];case"M":return t.getMonth().toString();case"MM":return n.StringUtils.padLeft((t.getMonth()+1).toString(),2,"0");case"MMM":return this.MONTHS[t.getMonth()].substr(0,3);case"MMMM":return this.MONTHS[t.getMonth()];case"YYYY":return t.getFullYear().toString();case"h":return t.getHours().toString();case"hh":return n.StringUtils.padLeft(t.getHours().toString(),2,"0");case"m":return t.getMinutes().toString();case"mm":return n.StringUtils.padLeft(t.getMinutes().toString(),2,"0");case"s":return t.getSeconds().toString();case"ss":return n.StringUtils.padLeft(t.getSeconds().toString(),2,"0");case"f":return(t.getMilliseconds()/100).toString();case"ff":return(t.getMilliseconds()/10).toString();case"fff":return t.getMilliseconds().toString()}return i},t.WEEK_DAYS=["Lunedì","Martedì","Mercoledì","Giovedì","Venerdì","Sabato","Domenica"],t.MONTHS=["Gennaio","Febbraio","Marzo","Aprile","Maggio","Giugno","Luglio","Agosto","Settembre","Ottobre","Novembre","Dicembre"],t}();n.DateUtils=t}(GeoPlot||(GeoPlot={})),function(n){var t=function(){function n(){}return n.isParentOrSelf=function(n,t){for(var i=n;i;){if(i==t)return!0;i=i.parentElement}return!1},n.removeClass=function(n,t){n.classList.contains(t)&&n.classList.remove(t)},n.addClass=function(n,t){n.classList.contains(t)||n.classList.add(t)},n}();n.DomUtils=t}(GeoPlot||(GeoPlot={})),function(n){var t;(function(n){function t(n){return(Math.round(n*100)/100).toFixed(2)}function i(n,t){var o,u,i;if(n){o=typeof t!="function"?function(n){return t[n]}:t;var r=0,f="",e="";for(u=0;u<n.length;u++){i=n[u];switch(r){case 0:i=="{"?(e="",r=1):f+=i;break;case 1:i=="}"||i==":"||i=="="?(r=0,t&&(f+=o(e)),r=i==":"||i=="="?2:0):i!="?"&&(e+=i);break;case 2:i=="}"&&(r=0)}}return f}}function r(n,t){var o,f,i,s;if(!n)return n;o=typeof t!="function"?function(n){return t[n]}:t;var u="",e="",r=0;for(f=0;f<n.length;f++){i=n[f];switch(r){case 0:i=="$"?r=1:u+=i;break;case 1:i=="("?(r=2,e=""):(u+="$"+i,r=0);break;case 2:i==")"?(s=o(e),u+=JSON.stringify(s),r=0):e+=i}}return u}function u(n){if(!n)return"";var t,i,r,u;return i=/(\b(https?|ftp):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/gim,t=n.replace(i,'<a href="$1" target="_blank">$1<\/a>'),r=/(^|[^\/])(www\.[\S]+(\b|$))/gim,t=t.replace(r,'$1<a href="http://$2" target="_blank">$2<\/a>'),u=/(([a-zA-Z0-9\-\_\.])+@[a-zA-Z\_]+?(\.[a-zA-Z]{2,6})+)/gim,t.replace(u,'<a href="mailto:$1">$1<\/a>')}n.price=t;n.replaceArgs=i;n.replaceArgs2=r;n.linkify=u})(t=n.Format||(n.Format={}))}(GeoPlot||(GeoPlot={})),function(n){var t=function(){function n(){}return n.project=function(t){var i={x:0,y:0};return i.x=t.lng*n.OriginShift/180,i.y=Math.log(Math.tan((90+t.lat)*Math.PI/360))/(Math.PI/180),i.y=-(i.y*n.OriginShift/180),i.x-=n.OFFSET_X,i.y-=n.OFFSET_Y,i},n.EarthRadius=6378137,n.OriginShift=2*Math.PI*n.EarthRadius/2,n.OFFSET_X=1263355,n.OFFSET_Y=5543162,n}();n.Geo=t}(GeoPlot||(GeoPlot={})),function(n){var r=function(){function i(){for(var i=[],r=0;r<arguments.length;r++)i[r]=arguments[r];this.colors=i.length>0?typeof i[0]=="string"?n.linq(i).select(function(n){return new t(n)}).toArray():i:[]}return i.prototype.valueAt=function(n){if(n<0)return this.colors[0];n>1&&this.colors[this.colors.length-1];var r=1/(this.colors.length-1),o=Math.floor(n/r),s=Math.ceil(n/r),f=(n-o*r)/r,i=this.colors[o],e=this.colors[s],u=new t;return u.r=Math.round(i.r+(e.r-i.r)*f),u.g=Math.round(i.g+(e.g-i.g)*f),u.b=Math.round(i.b+(e.b-i.b)*f),u},i}(),t,i;n.LinearGradient=r;t=function(){function n(n){this.r=0;this.g=0;this.b=0;n&&this.fromHex(n)}return n.prototype.fromHex=function(n){n.length==4?(this.r=parseInt("0x"+n[1]+n[1])/255,this.g=parseInt("0x"+n[2]+n[2])/255,this.b=parseInt("0x"+n[3]+n[3])/255):(this.r=parseInt("0x"+n[1]+n[2])/255,this.g=parseInt("0x"+n[3]+n[4])/255,this.b=parseInt("0x"+n[5]+n[6])/255)},n.prototype.toString=function(){function n(n){var t=Math.round(n*255).toString(16);return t.length==1?"0"+t:t}return"#"+n(this.r)+n(this.g)+n(this.b)},n}();n.RgbColor=t;i=function(){function n(n){this._svg=n}return n.prototype.setViewPort=function(n,t,i,r){this._svg.viewBox.baseVal.x=n;this._svg.viewBox.baseVal.y=t;this._svg.viewBox.baseVal.width=i-n;this._svg.viewBox.baseVal.height=r-t},n.prototype.drawPoly=function(n){var t=document.createElementNS("http://www.w3.org/2000/svg","polygon"),i,r;for(t.style.fill=n.fillColor,t.style.stroke=n.strokeColor,t.style.strokeWidth=n.strokeSize+"%",t.id=n.id,i=0;i<n.geometry.points.length;i++)r=this._svg.createSVGPoint(),r.x=n.geometry.points[i].x,r.y=n.geometry.points[i].y,t.points.appendItem(r);this._svg.appendChild(t)},n}();n.Graphics=i}(GeoPlot||(GeoPlot={})),function(n){function t(n){var t;if(n)if(Array.isArray(n))t=new i(n);else if("getEnumerator"in n)t=n.getEnumerator();else if("item"in n)t=new o(n);else if("next"in n&&typeof n.next=="function")t=new a(n);else if("current"in n&&"reset"in n&&"moveNext"in n)t=n;else return new r(new e(n));else t=new u;return new r(t)}var u=function(){function n(){}return Object.defineProperty(n.prototype,"current",{get:function(){return undefined},enumerable:!0,configurable:!0}),n.prototype.moveNext=function(){return!1},n.prototype.reset=function(){},n.prototype.count=function(){return 0},n}(),f=function(){function n(n,t){this._selector=t;this._source=n;this._selector||(this._selector=function(n){return n});this.reset()}return Object.defineProperty(n.prototype,"current",{get:function(){return this._current},enumerable:!0,configurable:!0}),n.prototype.moveNext=function(){while(this._source.moveNext()){var n=this._selector(this._source.current);if(this._foundItems.indexOf(n)==-1)return this._foundItems.push(n),this._current=n,!0}return!1},n.prototype.reset=function(){this._source.reset();this._foundItems=[];this._current=undefined},n}(),e=function(){function n(n){this._keyList=Object.getOwnPropertyNames(n);this._value=n;this.reset()}return Object.defineProperty(n.prototype,"current",{get:function(){return{key:this._keyList[this._curIndex],value:this._value[this._keyList[this._curIndex]]}},enumerable:!0,configurable:!0}),n.prototype.moveNext=function(){return this._curIndex++,this._curIndex<this._keyList.length},n.prototype.reset=function(){this._curIndex=-1},n.prototype.first=function(){return{key:this._keyList[0],value:this._value[this._keyList[0]]}},n.prototype.last=function(){return{key:this._keyList[this._keyList.length-1],value:this._value[this._keyList[this._keyList.length-1]]}},n.prototype.count=function(){return this._keyList.length},n}(),i=function(){function n(n){this._value=n;this.reset()}return Object.defineProperty(n.prototype,"current",{get:function(){return this._value[this._curIndex]},enumerable:!0,configurable:!0}),n.prototype.toArray=function(){return this._value},n.prototype.moveNext=function(){return this._curIndex++,this._curIndex<this._value.length},n.prototype.reset=function(){this._curIndex=-1},n.prototype.first=function(){return this._value[0]},n.prototype.last=function(){return this._value[this._value.length-1]},n.prototype.count=function(){return this._value.length},n}(),o=function(){function n(n){this._value=n;this.reset()}return Object.defineProperty(n.prototype,"current",{get:function(){return this._value.item(this._curIndex)},enumerable:!0,configurable:!0}),n.prototype.moveNext=function(){return this._curIndex++,this._curIndex<this._value.length},n.prototype.reset=function(){this._curIndex=-1},n.prototype.first=function(){return this._value.item(0)},n.prototype.last=function(){return this._value.item(this._value.length-1)},n.prototype.count=function(){return this._value.length},n}(),s=function(){function n(n,t){this._selector=t;this._source=n;this.reset()}return Object.defineProperty(n.prototype,"current",{get:function(){return this._selector(this._source.current)},enumerable:!0,configurable:!0}),n.prototype.moveNext=function(){return this._source.moveNext()},n.prototype.reset=function(){this._source.reset()},n}(),h=function(){function n(n,t){this._condition=t;this._source=n;this.reset()}return Object.defineProperty(n.prototype,"current",{get:function(){return this._source.current},enumerable:!0,configurable:!0}),n.prototype.moveNext=function(){while(this._source.moveNext())if(this._condition(this._source.current))return!0;return!1},n.prototype.reset=function(){this._source.reset()},n}(),c=function(){function n(n,t){this._count=t;this._source=n;this.reset()}return Object.defineProperty(n.prototype,"current",{get:function(){return this._source.current},enumerable:!0,configurable:!0}),n.prototype.moveNext=function(){if(!this._skipped){for(var n=0;n<this._count;){if(!this._source.moveNext())return!1;n++}this._skipped=!0}return this._source.moveNext()},n.prototype.reset=function(){this._source.reset();this._skipped=!1},n}(),l=function(){function n(n,t){this._count=t;this._source=n;this.reset()}return Object.defineProperty(n.prototype,"current",{get:function(){return this._source.current},enumerable:!0,configurable:!0}),n.prototype.moveNext=function(){return this._taken>=this._count?!1:this._source.moveNext()?(this._taken++,!0):!1},n.prototype.reset=function(){this._source.reset();this._taken=0},n}(),a=function(){function n(n){this._source=n}return Object.defineProperty(n.prototype,"current",{get:function(){return this._current},enumerable:!0,configurable:!0}),n.prototype.moveNext=function(){var n=this._source.next();return n.done?!1:(this._current=n.value,!0)},n.prototype.reset=function(){},n}(),r=function(){function n(n){this._enumerator=n}return n.prototype.select=function(n){return t(new s(this._enumerator,n))},n.prototype.where=function(n){return t(new h(this._enumerator,n))},n.prototype.first=function(n){return n?this.where(n).first():this._enumerator.first?this._enumerator.first():(this._enumerator.reset(),this._enumerator.moveNext()?this._enumerator.current:void 0)},n.prototype.last=function(){if(this._enumerator.last)return this._enumerator.last();this._enumerator.reset();for(var n;this._enumerator.moveNext();)n=this._enumerator.current;return n},n.prototype.sum=function(n){if(n)return this.select(n).sum();var t=0;return this.foreach(function(n){t+=parseFloat(n)}),t},n.prototype.max=function(n){if(n)return this.select(n).max();var t=Number.NEGATIVE_INFINITY;return this.foreach(function(n){var i=parseFloat(n);i>t&&(t=i)}),t},n.prototype.avg=function(n){if(n)return this.select(n).avg();var i=0,t=0;return(this.foreach(function(n){i+=parseFloat(n);t++}),t)?i/t:NaN},n.prototype.count=function(n){if(n)return this.where(n).count();if(this._enumerator.count)return this._enumerator.count();this._enumerator.reset();for(var t=0;this._enumerator.moveNext();)t++;return t},n.prototype.concat=function(n,t){var i="",r=0;return t||(t=function(n){return n.toString()}),this.foreach(function(u){r>0&&(i+=n);i+=t(u);r++}),i},n.prototype.orderBy=function(n){var i=this.toArray();return i.sort(function(t,i){var r=n(t),u=n(i);return r-u}),t(i)},n.prototype.orderByDesc=function(n){var i=this.toArray();return i.sort(function(t,i){var r=n(t),u=n(i);return u-r}),t(i)},n.prototype.distinct=function(n){return t(new f(this._enumerator,n))},n.prototype.groupBy=function(n){var r=[],u;return typeof n=="function"&&(u=n,this.foreach(function(n){var e=u(n),f=t(r).first(function(n){return n.key==e});f||(f={key:e,values:t(new i([]))},r.push(f));f.values._enumerator.toArray().push(n)})),t(r)},n.prototype.indexOf=function(n){var t=0;for(this._enumerator.reset();this._enumerator.moveNext();){if(n(this._enumerator.current))return t;t++}},n.prototype.foreach=function(n){for(this._enumerator.reset();this._enumerator.moveNext();)n(this._enumerator.current)},n.prototype.any=function(n){return n?this.where(n).any():this._enumerator.moveNext()},n.prototype.contains=function(n,t){for(t||(t=function(n,t){return n==t}),this._enumerator.reset();this._enumerator.moveNext();)if(t(this._enumerator.current,n))return!0;return!1},n.prototype.all=function(n){return!this.where(function(t){return!n(t)}).any()},n.prototype.take=function(n){return t(new l(this._enumerator,n))},n.prototype.skip=function(n){return t(new c(this._enumerator,n))},n.prototype.replace=function(n,t){var u,r;if(!(this._enumerator instanceof i))throw"Invalid enumerator, expected array";for(u=this._enumerator.toArray(),r=0;r<u.length;r++)n[u[r]]&&u[r]==t},n.prototype.toArray=function(){if(this._enumerator.toArray)return this._enumerator.toArray();var n=[];return this.foreach(function(t){return n.push(t)}),n},n.prototype.getEnumerator=function(){return this._enumerator},n}();n.Linq=r;n.linq=t}(GeoPlot||(GeoPlot={})),function(n){var t=function(){function n(){}return n.discretize=function(n,t){return Math.round(n*t)/t},n.exponential=function(n,t){return t===void 0&&(t=2),1-Math.pow(1-n,t)},n}();n.MathUtils=t}(GeoPlot||(GeoPlot={})),function(n){var t=function(){function n(){}return n.random=function(n){for(var t="",i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",r=0;r<n;r++)t+=i.charAt(Math.floor(Math.random()*i.length));return t},n.repeat=function(n,t){for(var i="",r=0;r<t;r++)i+=n;return i},n.padLeft=function(n,t,i){if(n!=null)return n.length>=t?n:this.repeat(i,t-n.length)+n},n.padRight=function(n,t,i){if(n!=null)return n.length>=t?n:n+this.repeat(i,t-n.length)},n}();n.StringUtils=t}(GeoPlot||(GeoPlot={})),function(n){var t=function(){function t(n){n===void 0&&(n=0);this.ticks=n}return Object.defineProperty(t.prototype,"totalDays",{get:function(){return this.ticks/864e5},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"totalHours",{get:function(){return this.ticks/36e5},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"totalMinutes",{get:function(){return this.ticks/6e4},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"totalSeconds",{get:function(){return this.ticks/1e3},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"totalMilliseconds",{get:function(){return this.ticks},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"days",{get:function(){return Math.floor(this.ticks/864e5)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hours",{get:function(){return Math.floor(this.ticks/36e5)%24},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"minutes",{get:function(){return Math.floor(this.ticks/6e4)%60},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"seconds",{get:function(){return Math.floor(this.ticks/1e3)%60},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"milliseconds",{get:function(){return this.ticks%1e3},enumerable:!0,configurable:!0}),t.prototype.format=function(i){var r=this;return n.Format.replaceArgs(i,function(n){return t.formatArgument(r,n)})},t.prototype.toString=function(){return this.format("{hh}:{mm}:{ss}")},t.zero=function(){return new t(0)},t.fromMilliseconds=function(n){return new t(n)},t.fromSeconds=function(n){return new t(n*1e3)},t.fromMinutes=function(n){return new t(n*6e4)},t.fromHours=function(n){return new t(n*36e5)},t.fromDays=function(n){return new t(n*864e5)},t.create=function(n,i,r,u,f){return n===void 0&&(n=0),i===void 0&&(i=0),r===void 0&&(r=0),u===void 0&&(u=0),f===void 0&&(f=0),new t(n*864e5+i*36e5+r*6e4+u*1e3+f)},t.formatArgument=function(t,i){switch(i){case"d":return t.days.toString();case"dd":return n.StringUtils.padLeft(t.days.toString(),2,"0");case"h":return t.hours.toString();case"hh":return n.StringUtils.padLeft(t.hours.toString(),2,"0");case"m":return t.minutes.toString();case"mm":return n.StringUtils.padLeft(t.minutes.toString(),2,"0");case"s":return t.seconds.toString();case"ss":return n.StringUtils.padLeft(t.seconds.toString(),2,"0");case"f":return(t.milliseconds/100).toString();case"ff":return(t.milliseconds/10).toString();case"fff":return t.milliseconds.toString()}return i},t}();n.TimeSpan=t}(GeoPlot||(GeoPlot={})),function(n){var t=function(){function n(){}return n.absolute=function(n){return n.substr(0,2)=="./"||n.substr(0,2)=="~/"?this.getAbsoluteSegment(document.URL)+this.appRoot.substr(1)+n.substr(2):n.substr(0,1)=="/"?this.getAbsoluteSegment(document.URL)+n.substr(1):this.isAbsolute(n)?n:this.getRelativeSegment(document.URL)+n.substr(1)},n.isAbsolute=function(n){return n.indexOf("://")!=-1},n.getRelativeSegment=function(n){if(!this._relativeSegment){this._relativeSegment="";var t=n.lastIndexOf("/");t!=-1&&(this._relativeSegment=n.substr(0,t+1))}return this._relativeSegment},n.getAbsoluteSegment=function(n){if(!this._absoluteSegment){this._absoluteSegment="";var t=n.indexOf("://");t!=-1&&(t=n.indexOf("/",t+4),t!=-1&&(this._absoluteSegment=n.substr(0,t+1)))}return this._absoluteSegment},n.appRoot="",n}();n.Uri=t}(GeoPlot||(GeoPlot={})),function(n){var t=function(){function n(){this.data=ko.observable();this.factor=ko.observable();this.indicator=ko.observable();this.reference=ko.observable()}return n.prototype.select=function(){},n}(),i=function(){function i(t){var i=this,f,r,e,u,o;this._topAreasVisible=!1;this._gradient=new n.LinearGradient("#18ffff","#ffff00","#ff3d00");this.VIEW_MODES={district:{label:{singular:"provincia",plural:"province"},mapGroup:"group_district",tab:"districtTab",areaType:n.GeoAreaType.District,validateId:function(n){return n[0].toLowerCase()=="d"}},region:{label:{singular:"regione",plural:"regioni"},mapGroup:"group_dregion",tab:"regionTab",areaType:n.GeoAreaType.Region,validateId:function(n){return n[0].toLowerCase()=="r"}}};this.INDICATORS=[{id:"totalPositive",name:"Positivi Totali"},{id:"currentPositive",name:"Attuali Positivi",validFor:["region"]},{id:"totalDeath",name:"Deceduti",validFor:["region"]},{id:"totalSevere",name:"Gravi",validFor:["region"]},{id:"totalHospedalized",name:"Ricoverati",validFor:["region"]},{id:"totalHealed",name:"Guariti",validFor:["region"]},{id:"toatlTests",name:"Tamponi",validFor:["region"]},];this.FACTORS=[{id:"none",name:"Nessuno",compute:function(n,t,i){return i},reference:function(){return"N/A"},description:"[indicator]"},{id:"population",name:"Popolazione",compute:function(n,t,i){return i/t.demography.total*1e5},reference:function(n,t){return formatNumber(t.demography.total)},description:"[indicator] ogni 100.000 abitanti"},{id:"totalPositive",name:"Positivi Totali",validFor:["region"],compute:function(n,t,i){return n.totalPositive?i/n.totalPositive*100:0},reference:function(n){return n.totalPositive?formatNumber(n.totalPositive):"N/A"},description:"% [indicator] su positivi totali"},{id:"severe",name:"Gravi",validFor:["region"],compute:function(n,t,i){return n.totalSevere?i/n.totalSevere*100:0},reference:function(n){return n.totalSevere?formatNumber(n.totalSevere):"N/A"},description:"% [indicator] sui gravi totali"},{id:"test",name:"Tamponi",validFor:["region"],compute:function(n,t,i){return n.toatlTests?i/n.toatlTests*100:0},reference:function(n){return n.toatlTests?formatNumber(n.toatlTests):"N/A"},description:"% [indicator] sui tamponi eseguiti"}];this.dayNumber=ko.observable(0);this.totalDays=ko.observable(0);this.currentData=ko.observable();this.isPlaying=ko.observable(!1);this.currentArea=ko.observable();this.topAreas=ko.observable();this.viewMode=ko.observable("district");this.selectedIndicator=ko.observable();this.selectedFactor=ko.observable();this.autoMaxFactor=ko.observable(!0);this.maxFactor=ko.observable();this.isGraphDelta=ko.observable(!1);this.factorDescription=ko.observable();this._data=t.data;this._geo=t.geo;this.totalDays(this._data.days.length-1);this.dayNumber.subscribe(function(){return i.updateDayData()});this._mapSvg=document.getElementsByTagName("svg").item(0);this._mapSvg.addEventListener("click",function(n){return i.onMapClick(n)});M.AutoInit();f=M.Tabs.getInstance(document.getElementById("areaTabs"));f.options.onShow=function(n){i.setViewMode(n.dataset.viewMode)};r=M.Collapsible.getInstance(document.getElementById("topCases"));r.options.onOpenStart=function(){i._daysData||i.updateTopAreas();i._topAreasVisible=!0};r.options.onCloseEnd=function(){i._topAreasVisible=!1};this.indicators=ko.computed(function(){return n.linq(i.INDICATORS).where(function(n){return!n.validFor||n.validFor.indexOf(i.viewMode())!=-1}).toArray()});this.factors=ko.computed(function(){return n.linq(i.FACTORS).where(function(n){return!n.validFor||n.validFor.indexOf(i.viewMode())!=-1}).toArray()});this.selectedIndicator.subscribe(function(n){n&&i.updateIndicator()});this.selectedFactor.subscribe(function(n){n&&i.updateIndicator()});this.autoMaxFactor.subscribe(function(n){n&&(i.updateMaxFactor(),i.updateMap());i.updateUrl()});this.maxFactor.subscribe(function(){i.autoMaxFactor()||i.updateMap();i.updateUrl()});this.isGraphDelta.subscribe(function(){i.updateChart();i.updateUrl()});e=new URLSearchParams(window.location.search);u=e.get("state");o=u?JSON.parse(atob(u)):{};setTimeout(function(){return i.loadState(o)},0)}return i.prototype.isDefaultState=function(n){return(!n.day||n.day==this._data.days.length-1)&&(!n.view||n.view=="district")&&!n.area&&(!n.indicator||n.indicator=="totalPositive")&&(!n.factor||n.factor=="none")&&!n.maxFactor&&!n.graphDelta},i.prototype.loadState=function(t){t.view||(t.view="district");var i=M.Tabs.getInstance(document.getElementById("areaTabs"));i.select(this.VIEW_MODES[t.view].tab);t.indicator&&this.selectedIndicator(n.linq(this.INDICATORS).first(function(n){return n.id==t.indicator}));t.factor&&this.selectedFactor(n.linq(this.FACTORS).first(function(n){return n.id==t.factor}));t.graphDelta&&this.isGraphDelta(t.graphDelta);t.maxFactor&&(this.autoMaxFactor(!1),this.maxFactor(t.maxFactor));this.dayNumber(t.day!=undefined?t.day:this._data.days.length-1);t.area&&(this.selectedArea=this._geo.areas[t.area.toLowerCase()])},i.prototype.saveStata=function(){return{view:this.viewMode(),indicator:this.selectedIndicator()?this.selectedIndicator().id:undefined,factor:this.selectedFactor()?this.selectedFactor().id:undefined,graphDelta:this.isGraphDelta(),maxFactor:this.autoMaxFactor()?undefined:this.maxFactor(),day:this.dayNumber(),area:this.selectedArea?this.selectedArea.id:undefined}},i.prototype.play=function(){this.isPlaying(!0);this.nextFrame()},i.prototype.pause=function(){this.isPlaying(!1)},i.prototype.setViewMode=function(n){this.viewMode(n);var t=document.getElementById("group_district");n=="district"?t.style.removeProperty("display"):t.style.display="none";this.selectedArea=null;this._chart=null;this.updateMaxFactor();this.updateDayData();this._topAreasVisible?this.updateTopAreas():this._daysData=undefined;setTimeout(function(){return M.FormSelect.init(document.querySelectorAll("select"))})},Object.defineProperty(i.prototype,"selectedArea",{get:function(){return this._selectedArea},set:function(n){var t,i;n!=this._selectedArea&&(this._selectedArea&&(t=document.getElementById(this._selectedArea.id.toUpperCase()),t.classList.remove("selected")),this._selectedArea=n,this._selectedArea&&(t=document.getElementById(this._selectedArea.id.toUpperCase()),t.classList.add("selected"),i=t.parentElement,t.remove(),i.appendChild(t)),this.changeArea())},enumerable:!0,configurable:!0}),i.prototype.onMapClick=function(n){var t=n.target,i;t.parentElement.classList.contains(this.viewMode())&&(i=this._geo.areas[t.parentElement.id.toLowerCase()],this.selectedArea=i)},i.prototype.nextFrame=function(){var n=this;this.isPlaying()&&(this.dayNumber()>=this._data.days.length-1?this.dayNumber(0):this.dayNumber(parseInt(this.dayNumber().toString())+1),setTimeout(function(){return n.nextFrame()},300))},i.prototype.changeArea=function(){if(this._selectedArea==null)this.currentArea(null);else{var n=new t;n.value=this._selectedArea;this.updateArea(n);this.currentArea(n);this.updateChart()}this.updateUrl()},i.prototype.initChart=function(){var n=document.querySelector("#areaGraph");this._chart=new Chart(n,{type:"line",data:{datasets:[{label:"Infetti",lineTension:0,data:[],backgroundColor:"#5cd6d3",borderColor:"#00a59d",borderWidth:1}]},options:{legend:{display:!1},scales:{xAxes:[{type:"time",distribution:"linear",time:{unit:"day",tooltipFormat:"DD/MMM"}}]}}})},i.prototype.updateIndicator=function(){this.selectedIndicator()&&this.selectedFactor()&&this.factorDescription(this.selectedFactor().description.replace("[indicator]",this.selectedIndicator().name));this.updateMaxFactor();this.updateDayData();this.updateChart();this._topAreasVisible&&this.updateTopAreas()},i.prototype.updateMaxFactor=function(){var t=this,i;this.selectedFactor()&&this.selectedIndicator()&&this.autoMaxFactor()&&(i=n.linq(this._data.days).select(function(i){return n.linq(i.values).where(function(n){return t.VIEW_MODES[t.viewMode()].validateId(n.key)}).select(function(n){return t.selectedFactor().compute(n.value,t._geo.areas[n.key],n.value[t.selectedIndicator().id])}).max()}).max(),this.maxFactor(parseFloat(i.toFixed(1))))},i.prototype.updateChart=function(){var o=this,i;if(this.selectedIndicator()&&this.currentArea()&&this.selectedFactor()){this._chart==null&&this.initChart();var r=this.currentArea().value,t=r.id.toLowerCase(),u=this.selectedIndicator().id;if(this.isGraphDelta())for(this._chart.data.datasets[0].data=[],i=1;i<this._data.days.length-1;i++){var f=this._data.days[i],e=this._data.days[i-1],s={x:new Date(f.date),y:this.selectedFactor().compute(f.values[t],r,f.values[t][u])-this.selectedFactor().compute(e.values[t],r,e.values[t][u])};this._chart.data.datasets[0].data.push(s)}else this._chart.data.datasets[0].data=n.linq(this._data.days).select(function(n){return{x:new Date(n.date),y:o.selectedFactor().compute(n.values[t],r,n.values[t][u])}}).toArray();this._chart.update()}},i.prototype.updateArea=function(t){if(t&&this.selectedIndicator()&&this.selectedFactor()){var i=t.value.id.toLowerCase(),u=t.value,r=this._data.days[this.dayNumber()];t.data(r.values[i]);t.indicator(r.values[i][this.selectedIndicator().id]);t.factor(n.MathUtils.discretize(this.selectedFactor().compute(r.values[i],u,t.indicator()),10));t.reference(this.selectedFactor().reference(r.values[i],u))}},i.prototype.updateTopAreas=function(){var r=this,f,i,u;for(this._daysData=[],f=function(u){var e=i._data.days[u],f={},o=i.VIEW_MODES[i.viewMode()].validateId;f.topAreas=n.linq(e.values).orderByDesc(function(n){return n.value[r.selectedIndicator().id]}).where(function(n){return o(n.key)}).select(function(n){var i=new t;return i.value=r._geo.areas[n.key.toLowerCase()],i.select=function(){return r.selectedArea=i.value},r.updateArea(i),i}).take(25).toArray();i._daysData.push(f)},i=this,u=0;u<this._data.days.length;u++)f(u);this.topAreas(this._daysData[this.dayNumber()].topAreas)},i.prototype.updateDayData=function(){var t=this._data.days[this.dayNumber()];this.currentData(n.DateUtils.format(t.date,"{DD}/{MM}/{YYYY}"));this.updateMap();this.updateArea(this.currentArea());this._daysData&&this._topAreasVisible&&this.topAreas(this._daysData[this.dayNumber()].topAreas);this.updateUrl()},i.prototype.updateUrl=function(){var t=this.saveStata(),i=n.Uri.appRoot+"Home/Overview";this.isDefaultState(t)||(i+="?state="+encodeURIComponent(btoa(JSON.stringify(t))));history.replaceState(null,null,i)},i.prototype.updateMap=function(){var r,i,t,f,e,u,o;if(this.selectedIndicator()&&this.selectedFactor()){r=this._data.days[this.dayNumber()];for(i in r.values)if(t=document.getElementById(i.toUpperCase()),t){if(f=this._geo.areas[i],f.type!=this.VIEW_MODES[this.viewMode()].areaType)continue;e=this.selectedIndicator().id;u=this.selectedFactor().compute(r.values[i],f,r.values[i][e]);u=Math.min(1,u/this.maxFactor());r.values[i][e]==0||isNaN(u)?(t.classList.contains("valid")&&t.classList.remove("valid"),t.style.fillOpacity="1",t.style.removeProperty("fill")):(t.classList.contains("valid")||t.classList.add("valid"),o=n.MathUtils.discretize(n.MathUtils.exponential(u),20),t.style.fillOpacity=o.toString())}}},i}();n.GeoPlotPage=i}(GeoPlot||(GeoPlot={}));