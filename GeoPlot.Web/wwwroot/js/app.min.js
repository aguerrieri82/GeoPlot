var __awaiter=this&&this.__awaiter||function(e,t,i,s){return new(i||(i=Promise))((function(n,a){function o(e){try{l(s.next(e))}catch(e){a(e)}}function r(e){try{l(s.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,r)}l((s=s.apply(e,t||[])).next())}))},WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp,WebApp;function listOf(e){return new WebApp.ObservableList(e)}function observableListOf(e,t){return new WebApp.ObservableList(e,t)}function capitalizeFirst(e){return e.substr(0,1).toUpperCase()+e.substr(1)}function expandCollapse(e){let t=e.parentElement,i=t.querySelector(".section-content");t.classList.contains("closed")?(i.style.removeProperty("display"),t.classList.remove("closed")):(t.classList.add("closed"),setTimeout(()=>i.style.display="none",300))}!function(e){e.isAndroidApp=function(){return"android"in window}}(WebApp||(WebApp={})),function(e){class t{get current(){}moveNext(){return!1}reset(){}count(){return 0}}class i{constructor(e,t){this._selector=t,this._source=e,this._selector||(this._selector=e=>e),this.reset()}get current(){return this._current}moveNext(){for(;this._source.moveNext();){const e=this._selector(this._source.current);if(-1==this._foundItems.indexOf(e))return this._foundItems.push(e),this._current=e,!0}return!1}reset(){this._source.reset(),this._foundItems=[],this._current=void 0}}class s{constructor(e){this._keyList=Object.getOwnPropertyNames(e),this._value=e,this.reset()}get current(){return{key:this._keyList[this._curIndex],value:this._value[this._keyList[this._curIndex]]}}moveNext(){return this._curIndex++,this._curIndex<this._keyList.length}reset(){this._curIndex=-1}first(){return{key:this._keyList[0],value:this._value[this._keyList[0]]}}last(){return{key:this._keyList[this._keyList.length-1],value:this._value[this._keyList[this._keyList.length-1]]}}count(){return this._keyList.length}}class n{constructor(e){this._value=e,this.reset()}get current(){return this._value[this._curIndex]}toArray(){return this._value}moveNext(){return this._curIndex++,this._curIndex<this._value.length}reset(){this._curIndex=-1}first(){return this._value[0]}last(){return this._value[this._value.length-1]}count(){return this._value.length}}class a{constructor(e){this._value=e,this.reset()}get current(){return this._value.item(this._curIndex)}moveNext(){return this._curIndex++,this._curIndex<this._value.length}reset(){this._curIndex=-1}first(){return this._value.item(0)}last(){return this._value.item(this._value.length-1)}count(){return this._value.length}}class o{constructor(e,t){this._selector=t,this._source=e,this.reset()}get current(){var e;return null===(e=this._curGroup)||void 0===e?void 0:e.current}moveNext(){for(var e;;){for(;!this._curGroup;){if(!this._source.moveNext())return!1;this._curGroup=null===(e=this._selector(this._source.current,this._index))||void 0===e?void 0:e.getEnumerator()}if(this._curGroup){if(this._curGroup.moveNext())return this._index++,!0;this._curGroup=null}}}reset(){this._curGroup=null,this._index=-1,this._source.reset()}}class r{constructor(e,t){this._selector=t,this._source=e,this.reset()}get current(){return this._selector(this._source.current,this._index)}moveNext(){return this._index++,this._source.moveNext()}reset(){this._index=-1,this._source.reset()}}class l{constructor(e,t){this._condition=t,this._source=e,this.reset()}get current(){return this._source.current}moveNext(){for(;this._source.moveNext();)if(this._condition(this._source.current))return!0;return!1}reset(){this._source.reset()}}class c{constructor(e,t){this._count=t,this._source=e,this.reset()}get current(){return this._source.current}moveNext(){if(!this._skipped){let e=0;for(;e<this._count;){if(!this._source.moveNext())return!1;e++}this._skipped=!0}return this._source.moveNext()}reset(){this._source.reset(),this._skipped=!1}}class d{constructor(e,t){this._count=t,this._source=e,this.reset()}get current(){return this._source.current}moveNext(){return!(this._taken>=this._count)&&(!!this._source.moveNext()&&(this._taken++,!0))}reset(){this._source.reset(),this._taken=0}}class h{constructor(e){this._source=e}get current(){return this._current}moveNext(){const e=this._source.next();return!e.done&&(this._current=e.value,!0)}reset(){}}class u{constructor(e){this._enumerator=e}selectMany(e){return p(new o(this._enumerator,e))}select(e){return p(new r(this._enumerator,e))}ofType(e){return p(new l(this._enumerator,e))}where(e){return p(new l(this._enumerator,e))}first(e){return e?this.where(e).first():this._enumerator.first?this._enumerator.first():(this._enumerator.reset(),this._enumerator.moveNext()?this._enumerator.current:void 0)}last(){if(this._enumerator.last)return this._enumerator.last();let e;for(this._enumerator.reset();this._enumerator.moveNext();)e=this._enumerator.current;return e}sum(e){if(e)return this.select(e).sum();let t=0;return this.foreach(e=>{t+=parseFloat(e)}),t}min(e){if(e)return this.select(e).min();let t=Number.POSITIVE_INFINITY;return this.foreach(e=>{const i=parseFloat(e);i<t&&(t=i)}),t}max(e){if(e)return this.select(e).max();let t=Number.NEGATIVE_INFINITY;return this.foreach(e=>{const i=parseFloat(e);i>t&&(t=i)}),t}avg(e){if(e)return this.select(e).avg();let t=0,i=0;return this.foreach(e=>{t+=parseFloat(e),i++}),i?t/i:NaN}count(e){if(e)return this.where(e).count();if(this._enumerator.count)return this._enumerator.count();this._enumerator.reset();let t=0;for(;this._enumerator.moveNext();)t++;return t}concat(e,t){let i="",s=0;return t||(t=e=>e.toString()),this.foreach(n=>{s>0&&(i+=e),i+=t(n),s++}),i}orderBy(e){const t=this.toArray();return t.sort((t,i)=>e(t)-e(i)),p(t)}orderByDesc(e){const t=this.toArray();return t.sort((t,i)=>{const s=e(t);return e(i)-s}),p(t)}distinct(e){return p(new i(this._enumerator,e))}groupBy(e,t){const i=[];if(t||(t=(e,t)=>e==t),"function"==typeof e){const s=e;this.foreach(e=>{const a=s(e);let o=p(i).first(e=>t(e.key,a));o||(o={key:a,values:p(new n([]))},i.push(o)),o.values._enumerator.toArray().push(e)})}return p(i)}indexOf(e){let t=0;for(this._enumerator.reset();this._enumerator.moveNext();){if(e(this._enumerator.current))return t;t++}}foreach(e){this._enumerator.reset();let t=0;for(;this._enumerator.moveNext();)e(this._enumerator.current,t),t++;return this}foreachAsync(e,t=1){return __awaiter(this,void 0,void 0,(function*(){this._enumerator.reset();let t=0;for(;this._enumerator.moveNext();)yield e(this._enumerator.current,t),t++;return this}))}any(e){return e?this.where(e).any():this._enumerator.moveNext()}contains(e,t){for(t||(t=(e,t)=>e==t),this._enumerator.reset();this._enumerator.moveNext();)if(t(this._enumerator.current,e))return!0;return!1}all(e){return!this.where(t=>!e(t)).any()}take(e){return p(new d(this._enumerator,e))}skip(e){return p(new c(this._enumerator,e))}replace(e,t){if(!(this._enumerator instanceof n))throw"Invalid enumerator, expected array";const i=this._enumerator.toArray();for(let t=0;t<i.length;t++)e(i[t])&&i[t]}toGenerator(){return function*(e){for(e._enumerator.reset();e._enumerator.moveNext();)yield e._enumerator.current}(this)}toArrayAsync(t=1){return __awaiter(this,void 0,void 0,(function*(){if(this._enumerator.toArray)return this._enumerator.toArray();let i=[],s=0;for(let n of this.toGenerator())i.push(n),s%t==0&&(yield e.PromiseUtils.delay(0)),s++;return i}))}toArray(){if(this._enumerator.toArray)return this._enumerator.toArray();const e=[];return this.foreach(t=>e.push(t)),e}toDictionary(e,t){t||(t=e=>e);const i={};return this.foreach(s=>i[e(s)]=t(s)),i}getEnumerator(){return this._enumerator}[Symbol.iterator](){return this._enumerator.reset(),{next:e=>({done:!this._enumerator.moveNext(),value:this._enumerator.current})}}}function p(i){let o;return o=i?Array.isArray(i)?new n(i):"getEnumerator"in i?i.getEnumerator():e.TypeCheck.isList(i)?new n(i.toArray()):"item"in i?new a(i):"next"in i&&"function"==typeof i.next?new h(i):"current"in i&&"reset"in i&&"moveNext"in i?i:new s(i):new t,new u(o)}e.Linq=u,e.linq=p}(WebApp||(WebApp={})),function(e){class t{static getKey(e){let t=e.language;return e.sector&&(t+="|"+e.sector),t}static get(e){e||(e=this._currentConfig);let i=t._tables[this.getKey(e)];return!i&&e.sector&&(i=t._tables[this.getKey({language:e.language})]),i}static add(e,t){this._tables[this.getKey(t)]=e}static get currentConfig(){return this._currentConfig}static set currentConfig(i){this._currentConfig=i,e.Strings=t.get()}}t._tables={},e.StringTable=t}(WebApp||(WebApp={})),WebApp||(WebApp={}),function(e){let t;!function(e){e[e.Global=0]="Global",e[e.Local=1]="Local"}(t=e.OperationType||(e.OperationType={}))}(WebApp||(WebApp={})),WebApp||(WebApp={}),function(e){let t;!function(t){t.join=function(t,...i){let s="";for(let n of i)n&&(s.length>0&&(s+=t),s+=e.DynamicString.getValue(n));return s},t.text=function(t,...i){return e.DynamicString.getValue(t,{params:i})},t.title=function(t,...i){return e.DynamicString.getValue(t,{params:i,usage:e.StringUsage.Title})},t.action=function(t,...i){return e.DynamicString.getValue(t,{params:i,usage:e.StringUsage.Action})},t.message=function(t,...i){return e.DynamicString.getValue(t,{params:i,usage:e.StringUsage.Message})},t.currency=function(e,t="€. "){return null==e||null==e?"":t+" "+e.toFixed(2)},t.replaceArgs=function(e,t){if(!e)return;let i;i="function"!=typeof t?e=>t[e]:t;let s=0,n="",a="";for(let o=0;o<e.length;o++){const r=e[o];switch(s){case 0:"{"==r?(a="",s=1):n+=r;break;case 1:"}"==r||":"==r||"="==r?(s=0,t&&(n+=i(a)),s=":"==r||"="==r?2:0):"?"!=r&&(a+=r);break;case 2:"}"==r&&(s=0)}}return n},t.replaceArgs2=function(e,t){if(!e)return e;let i;i="function"!=typeof t?e=>t[e]:t;let s="",n="",a=0;for(let t=0;t<e.length;t++){let o=e[t];switch(a){case 0:"$"==o?a=1:s+=o;break;case 1:"("==o?(a=2,n=""):(s+="$"+o,a=0);break;case 2:if(")"==o){const e=i(n);s+=JSON.stringify(e),a=0}else n+=o}}return s},t.linkify=function(e){if(!e)return"";let t,i,s,n;return i=/(\b(https?|ftp):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/gim,t=e.replace(i,'<a href="$1" target="_blank">$1</a>'),s=/(^|[^\/])(www\.[\S]+(\b|$))/gim,t=t.replace(s,'$1<a href="http://$2" target="_blank">$2</a>'),n=/(([a-zA-Z0-9\-\_\.])+@[a-zA-Z\_]+?(\.[a-zA-Z]{2,6})+)/gim,t=t.replace(n,'<a href="mailto:$1">$1</a>'),t}}(t=e.Format||(e.Format={}))}(WebApp||(WebApp={})),function(e){e.apply=function(e,t){return t(e),e},e.injectProxy=function(e,t,i){return e[t]=i,e[t]},e.safeCall=function(e,t){try{return e()}catch(e){if(t)return t(e)}},e.safeCallAsync=function(e,t){return __awaiter(this,void 0,void 0,(function*(){try{return yield e()}catch(e){if(t)return Promise.resolve(t(e))}}))}}(WebApp||(WebApp={})),function(e){let t;!function(t){t.getStringAsync=function(t){return e.Services.httpClient.requestAsync({url:t,method:"GET"})},t.postStringAsync=function(t,i){return e.Services.httpClient.requestAsync({url:t,method:"POST",data:i})},t.getJsonAsync=function(t){return e.Services.httpClient.requestAsync({url:t,method:"GET",responseType:"application/json"})},t.postJsonAsync=function(t,i){return e.Services.httpClient.requestAsync({url:t,method:"POST",responseType:"application/json",data:i})},t.postBinaryAsync=function(t,i,s){return e.Services.httpClient.requestAsync({url:t,method:"POST",responseType:"application/json",dataType:"application/octet-stream",data:i,onProgress:s})}}(t=e.Http||(e.Http={}))}(WebApp||(WebApp={})),function(e){let t;t=e.Services||(e.Services={})}(WebApp||(WebApp={})),function(e){let t;!function(e){e.isList=function(e){return e&&"object"==typeof e&&"add"in e&&"get"in e&&"count"in e},e.isCloneable=function(e){return e&&"object"==typeof e&&"clone"in e&&"function"==typeof e.clone},e.isObservableList=function(t){return e.isList(t)&&"subscribe"in t},e.isString=function(e){return"string"==typeof e},e.isFunction=function(e){return"function"==typeof e},e.isObject=function(e){return"object"==typeof e},e.isStateManager=function(e){return e&&"object"==typeof e&&"setState"in e&&"getState"in e}}(t=e.TypeCheck||(e.TypeCheck={}))}(WebApp||(WebApp={})),function(e){let t;!function(t){var i,s;function n(e){return-1!=e.indexOf("://")}function a(e){if(!i){i="";let t=e.lastIndexOf("/");-1!=t&&(i=e.substr(0,t+1))}return i}function o(e){if(!s){s="";let t=e.indexOf("://");-1!=t&&(t=e.indexOf("/",t+4),-1!=t&&(s=e.substr(0,t+1)))}return s}t.absolute=function(t){return"./"==t.substr(0,2)||"~/"==t.substr(0,2)?o(document.URL)+e.app.baseUrl.substr(1)+t.substr(2):"/"==t.substr(0,1)?o(document.URL)+t.substr(1):n(t)?t:a(document.URL)+t.substr(1)},t.isAbsolute=n,t.getRelativeSegment=a,t.getAbsoluteSegment=o}(t=e.Uri||(e.Uri={}))}(WebApp||(WebApp={})),function(e){e.DbStorage=class{constructor(){}openAsync(e){return __awaiter(this,void 0,void 0,(function*(){return new Promise((t,i)=>{const s=indexedDB.open(e,2);s.onerror=e=>i(),s.onsuccess=e=>{this._database=s.result,t(!0)},s.onupgradeneeded=e=>{s.result.objectStoreNames.contains("object")||s.result.createObjectStore("object"),t(!0)}})}))}openReadWrite(){return this._database.transaction("object","readwrite").objectStore("object")}openRead(){return this._database.transaction("object","readonly").objectStore("object")}setItem(e,t){return new Promise((i,s)=>{const n=this.openReadWrite().put(JSON.stringify(t),e);n.onerror=e=>s(),n.onsuccess=e=>i(n.result)})}getItem(e){return new Promise((t,i)=>{const s=this.openRead().get(e);s.onerror=e=>i(),s.onsuccess=e=>{t(JSON.parse(s.result))}})}removeItem(e){return new Promise((t,i)=>{const s=this.openReadWrite().delete(e);s.onerror=e=>i(),s.onsuccess=e=>t()})}clear(e){return new Promise((e,t)=>{const i=this.openReadWrite().clear();i.onerror=e=>t(),i.onsuccess=t=>e()})}}}(WebApp||(WebApp={})),function(e){e.LocalStorageCache=class{read(t){let i=localStorage.getItem("cache:"+t);if(i){let s=JSON.parse(i);return s.readCount++,s.lastReadTime=e.DateUtils.now(),localStorage.setItem("cache:"+t,JSON.stringify(s)),s}return null}update(t,i){let s=this.read(t);return s?(s.writeCount++,s.lastWriteTime=e.DateUtils.now(),s.value=i):s={creationTime:e.DateUtils.now(),key:t,lastReadTime:null,lastWriteTime:null,value:i,readCount:0,writeCount:0},localStorage.setItem("cache:"+t,JSON.stringify(s)),s}remove(e){localStorage.removeItem("cache:"+e)}clear(){for(let e=localStorage.length-1;e>=0;e--){const t=localStorage.key(e);t.startsWith("cache:")&&localStorage.removeItem(t)}}contains(e){return null!=localStorage.getItem("cache:"+e)}}}(WebApp||(WebApp={})),function(e){class t extends Error{constructor(e,t){super(),this.message=e,this.innerException=t}}e.Exception=t}(WebApp||(WebApp={})),function(e){class t extends e.Exception{constructor(e,t,i){super("HTTP error, status code: "+t,i),this.request=e}}e.HttpException=t;e.XHRHttpClient=class{onNewRequest(e){}requestAsync(i){return this.onNewRequest(i),new Promise((s,n)=>{const a=new XMLHttpRequest;let o;e.Operation&&(o=e.Operation.begin({message:i.method+" "+i.url,type:e.OperationType.Local})),a.onreadystatechange=e=>{if(a.readyState==XMLHttpRequest.DONE)if(o&&o.end(),200==a.status){let e=a.responseText;"application/json"==i.responseType&&(e=JSON.parse(e)),s(e)}else n(new t(i,a.status))},i.onProgress&&(a.upload.onprogress=i.onProgress),a.open(i.method,e.Uri.absolute(i.url),!0);let r=i.dataType,l=i.data;if(i.data){const e="application/octet-stream"==r;("application/json"==r||"object"==typeof i.data)&&!e&&(r="application/json",l&&"string"!=typeof i.data&&(l=JSON.stringify(l)))}if(r&&a.setRequestHeader("Content-type",r),i.headers)for(let e in i.headers)a.setRequestHeader(e,i.headers[e]);a.send(l)})}}}(WebApp||(WebApp={})),function(e){let t,i,s;!function(e){e[e.Singular=0]="Singular",e[e.Plural=1]="Plural"}(t=e.WordNumber||(e.WordNumber={})),function(e){e[e.Male=0]="Male",e[e.Female=1]="Female"}(i=e.WordGender||(e.WordGender={})),function(e){e[e.General=0]="General",e[e.Label=1]="Label",e[e.Column=2]="Column",e[e.Action=3]="Action",e[e.Message=4]="Message",e[e.Question=5]="Question",e[e.Title=6]="Title",e[e.Tooltip=7]="Tooltip"}(s=e.StringUsage||(e.StringUsage={}));e.DynamicString=new class{format(e){return t=>{let i=e(t);return t&&(t.usage!==s.Column&&t.usage!==s.Label&&t.usage!==s.Action&&t.usage!==s.Title&&t.usage!==s.Question&&t.usage!==s.Tooltip&&t.usage!==s.Message||(i=i.substr(0,1).toUpperCase()+i.substr(1)),t.usage===s.Label&&(i+=":"),t.usage===s.Message&&(i+="."),t.usage===s.Question&&(i+="?")),i}}getValue(t,i){if("function"==typeof t){let e;return i&&(e=s[i]?{usage:i}:i),t(e)}return t&&e.Strings&&t in e.Strings?this.getValue(e.Strings[t],i):t}complex(i){return e.DynamicString.format(s=>{let n=0,a="",o="",r=null,l=0;s||(s={}),!s.gender&&s.params&&s.params.forEach(e=>{"function"==typeof e&&e(Object.assign(Object.assign({},s),{params:[]}))});for(let c=0;c<i.length;c++){let d=i[c];switch(n){case 0:"{"==d?(o="",r=null,n=1):a+=d;break;case 1:if("}"==d){n=3,c--;break}":"==d?(r="",l=0,n=2):o+=d;break;case 2:"{"==d&&l++,"}"==d?(l--,l<0?(n=3,c--):r+=d):r+=d;break;case 3:let i;i=r?JSON.parse(r.trim()):{};let h=!0;for(;h;)h=!1,o.startsWith("*")&&(i.number=t.Plural,o=o.substr(1),h=!0),o.startsWith("!")&&(i.useArticle=!0,o=o.substr(1),h=!0),o.startsWith(".")&&(i.useArticleInd=!0,o=o.substr(1),h=!0);s.gender&&!i.gender&&(i.gender=s.gender),s.cardinality&&!i.cardinality&&(i.cardinality=s.cardinality),s.number&&!i.number&&(i.number=s.number),void 0!==s.useArticle&&void 0===i.useArticle&&(i.useArticle=s.useArticle);const u=parseInt(o);if(isNaN(u))a+=e.Strings[o](i);else if(s.params&&u<s.params.length){const e=s.params[u];a+=this.getValue(e,i)}i.gender&&(s.gender=i.gender),n=0}}return a})}adverb(e){return this.format(t=>t&&t.gender==i.Female?e.female:e.male)}appendArticle(e,t){let i=e;return"'"!=i.charAt(i.length-1)&&(i+=" "),i+t}adjective(e){return this.format(s=>{const n=s&&s.gender==i.Female?e.female:e.male,a=s&&(s.number==t.Plural||s.cardinality>1)?n.plural:n.singular;return s&&s.useArticle?this.appendArticle(a.detArticle,a.name):s&&s.useArticleInd?this.appendArticle(a.undetArticle,a.name):a.name})}noun(e){return this.format(i=>{i||(i={}),e.gender&&(i.gender=e.gender);const s=i.number==t.Plural||i.cardinality>1?e.plural:e.singular;return i&&i.useArticle?this.appendArticle(s.detArticle,s.name):i&&i.useArticleInd?this.appendArticle(s.undetArticle,s.name):s.name})}map(t){return i=>t(e.Strings)(i)}simple(e){return this.format(()=>e)}}}(WebApp||(WebApp={})),function(e){class t{add(e){this._handlers||(this._handlers=[]),-1==this._handlers.indexOf(e)&&this._handlers.push(e)}remove(e){if(this._handlers){const t=this._handlers.indexOf(e);-1!=t&&this._handlers.splice(t,1)}}raise(e,t){this._handlers&&this._handlers.forEach(i=>i(e,t))}}e.AppEvent=t,e.event=function(){return new t}}(WebApp||(WebApp={})),function(e){e.Signal=class{constructor(e=!1){this._waitHandlers=[],this._isSet=e}set(){this._isSet=!0,this._waitHandlers.forEach(e=>e(!0)),this._waitHandlers=[]}reset(){this._isSet=!1}waitFor(e){return this._isSet?Promise.resolve(!0):new Promise((t,i)=>{e&&setTimeout(()=>{const e=this._waitHandlers.indexOf(t);-1!=e&&(this._waitHandlers.splice(e,1),t(!1))},e.totalMilliseconds),this._waitHandlers.push(t)})}get isSet(){return this._isSet}}}(WebApp||(WebApp={})),function(e){let t;!function(e){e[e.Milliseconds=0]="Milliseconds",e[e.Seconds=1]="Seconds",e[e.Minutes=2]="Minutes",e[e.Hours=3]="Hours",e[e.Days=4]="Days"}(t=e.TimePart||(e.TimePart={}));class i{constructor(e=0){this.ticks=e}get totalDays(){return this.ticks/864e5}get totalHours(){return this.ticks/36e5}get totalMinutes(){return this.ticks/6e4}get totalSeconds(){return this.ticks/1e3}get totalMilliseconds(){return this.ticks}get days(){return Math.floor(this.ticks/864e5)}get hours(){return Math.floor(this.ticks/36e5)%24}get minutes(){return Math.floor(this.ticks/6e4)%60}get seconds(){return Math.floor(this.ticks/1e3)%60}get milliseconds(){return this.ticks%1e3}format(t){return e.Format.replaceArgs(t,e=>i.formatArgument(this,e))}toString(){return this.format("{hh}:{mm}:{ss}")}static zero(){return new i(0)}static fromMilliseconds(e){return new i(e)}static fromSeconds(e){return new i(1e3*e)}static fromMinutes(e){return new i(1e3*e*60)}static fromHours(e){return new i(1e3*e*60*60)}static fromDays(e){return new i(1e3*e*60*60*24)}static create(e=0,t=0,s=0,n=0,a=0){return new i(1e3*e*60*60*24+1e3*t*60*60+1e3*s*60+1e3*n+a)}static formatArgument(t,i){switch(i){case"d":return t.days.toString();case"dd":return e.StringUtils.padLeft(t.days.toString(),2,"0");case"h":return t.hours.toString();case"hh":return e.StringUtils.padLeft(t.hours.toString(),2,"0");case"m":return t.minutes.toString();case"mm":return e.StringUtils.padLeft(t.minutes.toString(),2,"0");case"s":return t.seconds.toString();case"ss":return e.StringUtils.padLeft(t.seconds.toString(),2,"0");case"f":return(t.milliseconds/100).toString();case"ff":return(t.milliseconds/10).toString();case"fff":return t.milliseconds.toString()}return i}}e.TimeSpan=i}(WebApp||(WebApp={})),function(e){let t;!function(t){t.merge=function(...e){const t=[];return e.forEach(e=>{e&&e.forEach(e=>{-1==t.indexOf(e)&&t.push(e)})}),t},t.equals=function(t,i){if(!Array.isArray(t)||!Array.isArray(i))return!1;if(t.length!=i.length)return!1;for(let s=0;s<t.length;s++)if(!e.ObjectUtils.equals(t[s],i[s]))return!1;return!0},t.forEachAsync=function(t,i,s){return __awaiter(this,void 0,void 0,(function*(){let n=0;for(let a of t)s(a,n),n%i==0&&(yield e.PromiseUtils.delay(0)),n++}))}}(t=e.ArrayUtils||(e.ArrayUtils={}))}(WebApp||(WebApp={})),function(e){let t;!function(t){function i(e){return e instanceof Date?e:new Date(e)}function s(e,t){return e=i(e),new Date(e.getTime()+t.ticks)}function n(){return new Date}function a(e){return e=i(e),new Date(e.getFullYear(),e.getMonth(),e.getDate())}function o(s,n){switch(s=i(s),n){case"D":return s.getDate().toString();case"DD":return e.StringUtils.padLeft(s.getDate().toString(),2,"0");case"W":return t.WEEK_DAYS[(s.getDay()+6)%7].substr(0,3);case"WW":return t.WEEK_DAYS[(s.getDay()+6)%7];case"M":return s.getMonth().toString();case"MM":return e.StringUtils.padLeft((s.getMonth()+1).toString(),2,"0");case"MMM":return t.MONTHS[s.getMonth()].substr(0,3);case"MMMM":return t.MONTHS[s.getMonth()];case"YYYY":return s.getFullYear().toString();case"h":return s.getHours().toString();case"hh":return e.StringUtils.padLeft(s.getHours().toString(),2,"0");case"m":return s.getMinutes().toString();case"mm":return e.StringUtils.padLeft(s.getMinutes().toString(),2,"0");case"s":return s.getSeconds().toString();case"ss":return e.StringUtils.padLeft(s.getSeconds().toString(),2,"0");case"f":return(s.getMilliseconds()/100).toString();case"ff":return(s.getMilliseconds()/10).toString();case"fff":return s.getMilliseconds().toString()}return n}t.WEEK_DAYS=["Lunedì","Martedì","Mercoledì","Giovedì","Venerdì","Sabato","Domenica"],t.MONTHS=["Gennaio","Febbraio","Marzo","Aprile","Maggio","Giugno","Luglio","Agosto","Settembre","Ottobre","Novembre","Dicembre"],t.parse=i,t.addDays=function(t,i){return s(t,e.TimeSpan.fromDays(i))},t.add=s,t.diff=function(t,s){return new e.TimeSpan(i(t).getTime()-i(s).getTime())},t.now=n,t.today=function(){return a(n())},t.truncateTime=a,t.timeOfDay=function(t){return t=i(t),new e.TimeSpan(t.getTime()-a(t).getTime())},t.format=function(t,s){return t=i(t),e.Format.replaceArgs(e.DynamicString.getValue(s),e=>o(t,e))},t.formatArgument=o}(t=e.DateUtils||(e.DateUtils={}))}(WebApp||(WebApp={})),function(e){class t{constructor(e){this.node=e}get childNodes(){return e.linq(this.node.childNodes).select(e=>new t(e))}descendsFrom(e){let t=this.node;for(;null!=t;){if(t==e)return!0;t=t.parentNode}return!1}hasClass(e){return"classList"in this.node&&this.node.classList.contains(e)}get discendants(){return e.linq(function*e(i){for(let i of this.node.childNodes){yield new t(i);for(let t of e(i))yield t}}(this.node))}get parentNodesOrSelf(){return e.linq(function*(e){let i=e;for(;null!=i;)yield new t(i),i=i.parentNode}(this.node))}get parentNodes(){return this.parentNodesOrSelf.skip(1)}get name(){return this.node.nodeName}}let i;!function(i){i.parentOfClass=function(e,t){return i.node(e).parentNodes.where(e=>e.hasClass(t)).select(e=>e.node).first()},i.node=function(e){return new t(e)},i.isParentOrSelf=function(e,t){let i=e;for(;i;){if(i==t)return!0;i=i.parentElement}return!1},i.generateId=function(t="id_"){for(;;){const i=t+e.StringUtils.random(8);if(!document.getElementById(i))return i}},i.removeClass=function(e,t){e.classList.contains(t)&&e.classList.remove(t)},i.addClass=function(e,t){e.classList.contains(t)||e.classList.add(t)},i.isSmallDevice=function(){return window.innerWidth<610},i.copyText=function(e){return __awaiter(this,void 0,void 0,(function*(){if(navigator.clipboard)yield navigator.clipboard.writeText(e);else{const t=document.createElement("textarea");document.body.appendChild(t),t.value=e,t.select(),document.execCommand("copy"),document.body.removeChild(t)}}))},i.centerElement=function(e,t=!0){const i=document.documentElement.scrollTop,s=window.innerHeight;let n=0,a=0;for(let t=e;t&&t!=document.body;t=t.offsetParent)n+=t.offsetTop;return a=e.offsetHeight,(t||n+a>i+s||n<i)&&(document.documentElement.scrollTop=Math.max(0,n-(s-a)/2)),n-document.documentElement.scrollTop}}(i=e.DomUtils||(e.DomUtils={}))}(WebApp||(WebApp={})),function(e){class t{static generate(e){return e||(e="item"),void 0===this._map[e]&&(this._map[e]=0),this._map[e]++,1==this._map[e]?e:e+this._map[e]}}t._map={},e.Identifier=t}(WebApp||(WebApp={})),function(e){let t;!function(e){function t(e){return isNaN(e)||null===e}e.discretize=function(e,i){if(!t(e))return Math.round(e*i)/i},e.round=function(e,i){if(!t(e))return Math.round(e*Math.pow(10,i))/Math.pow(10,i)},e.exponential=function(e,i=2){if(!t(e))return 1-Math.pow(1-e,i)},e.isNaNOrNull=t,e.sumNull=function(e,i){if(!t(e)||!t(i))return t(i)?e:t(e)?i:e+i},e.divideNull=function(e,i){if(!t(e)&&!t(i)&&0!=i)return e/i}}(t=e.MathUtils||(e.MathUtils={}))}(WebApp||(WebApp={})),function(e){let t;!function(t){t.isEmpty=function(e){return null==e||Array.isArray(e)&&0==e.length},t.equals=function(t,i){return Array.isArray(t)||Array.isArray(i)?e.ArrayUtils.equals(t,i):t==i},t.createInstance=function(e,...t){const i=e.split(".");let s=window;for(let e of i)s=s[e];return new s(...t)},t.hasProp=function(e,t){return t in e},t.isInstanceOf=function(e,i){if(!e)return;let s=t.getType(e);for(;null!=s;){if(s==i)return!0;s=t.getBaseType(s)}return!1},t.getOrCreate=function(e,i,s){return Object.getOwnPropertyDescriptor(e,i)?t.get(e,i):(t.createProperty(e,i,s),s)},t.createProperty=function(e,t,i){"@"==t.substr(0,1)?Object.defineProperty(e,t,{writable:!0,enumerable:!1,value:i}):Object.defineProperty(e,t,{value:i})},t.get=function(e,t,i){if(!e)return i;const s=e[t];return null==s?i:s},t.set=function(e,i,s){if("@"==i.substr(0,1)){Object.getOwnPropertyDescriptor(e,i)?e[i]=s:t.createProperty(e,i,s)}else e[i]=s},t.setTypeName=function(i,s){e.TypeCheck.isObject(i)?t.set(i,"@typeName",s):t.set(Object.getPrototypeOf(i),"@typeName",s)},t.getTypeName=function(e){if(!e)return;let i=e["@typeName"];if(!i){if(i=typeof e,"function"==i)return t.getFunctionName(e);if("object"==i){const i=e.constructor;if(i)return t.getTypeName(i)}}return i},t.getBaseType=function(t){let i;return i=e.TypeCheck.isFunction(t)?t.prototype:Object.getPrototypeOf(t),Object.getPrototypeOf(i).constructor},t.getType=function(t){if(e.TypeCheck.isString(t)){const e=t.split(".");let i=self;return e.forEach(e=>{if(i=i[e],!i)return null}),i}return t.constructor},t.getFunctionName=function(e){let t=e.name;if(!t){const i=/function\s([^(]{1,})\(/.exec(e.toString());t=i&&i.length>1?i[1].trim():""}return t},t.clone=function(t){return e.TypeCheck.isCloneable(t)?t.clone():JSON.parse(JSON.stringify(t))}}(t=e.ObjectUtils||(e.ObjectUtils={}))}(WebApp||(WebApp={})),function(e){let t;!function(e){e.delay=function(e){return new Promise(t=>setTimeout(t,e))}}(t=e.PromiseUtils||(e.PromiseUtils={}))}(WebApp||(WebApp={})),function(e){let t;!function(e){e.random=function(e,t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789"){let i="";for(let s=0;s<e;s++)i+=t.charAt(Math.floor(Math.random()*t.length));return i},e.isUpperCase=function(e){return e.toUpperCase()===e},e.repeat=function(e,t){let i="";for(let s=0;s<t;s++)i+=e;return i},e.padLeft=function(e,t,i){if(null!=e)return e.length>=t?e:this.repeat(i,t-e.length)+e},e.padRight=function(e,t,i){if(null!=e)return e.length>=t?e:e+this.repeat(i,t-e.length)},e.uuidv4=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){const t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}))}}(t=e.StringUtils||(e.StringUtils={}))}(WebApp||(WebApp={})),function(e){e.BindableObject=class{prop(t){return e.Properties.getOrCreate(this,t)}static bindValue(t){return e.Properties.isProperty(t)?t.get():t}bindConfig(e,t,i,s){this.bind(e,t&&e in t?t[e]:void 0,i,s)}bindConfigString(e,t,i,s){this.bindString(e,t&&e in t?t[e]:void 0,i,s)}computed(t,i){return e.Properties.create(this,t,this.createComputed(i,t))}createComputed(t,i){this._computedBinder||(this._computedBinder=new e.Binder(this));const s=new e.ComputedProperty(()=>t(this),i);return this._computedBinder.bind(t,()=>s.notifyChanged()),s}bind(t,i,s,n){const a=e.Properties.getOrCreate(this,t);n&&a.subscribe(n),void 0!==i&&e.Properties.bind(a,i,s)}bindString(t,i,s,n){return this.bind(t,i,{convertTo:t=>e.DynamicString.getValue(t,s),convertFrom:e=>e},n)}apply(e){return e(this),this}}}(WebApp||(WebApp={})),function(e){class t{constructor(e,t){this._manager=e,this.id=t.id,this.title=t.title,this.description=t.description,this.location=t.location,this.shape=t.shape,this.icon=t.icon,this.color=t.color}openInfo(){this.infoWindow.setOptions({visible:!0,location:this.marker.getLocation()})}closeInfo(){this.infoWindow.setOptions({visible:!1})}}e.BingMapItem=t;class i extends e.BindableObject{constructor(e){super(),this._items=[],this.isReady=!1,this.selectedItem=null,this.selectionColor="#000000",this._apiKey=e,this.prop("selectedItem").subscribe((e,t)=>{e&&e.marker.setOptions({color:this.selectionColor}),t&&t.marker.setOptions({color:t.color}),this.onSelectionChanged()})}updateSize(){let e=this._map.getCenter();this._map.setView({center:e})}staticMap(e){let t="https://dev.virtualearth.net/REST/v1/Imagery/Map/Road";return e.center&&(t+="/"+e.center.latitude+","+e.center.longitude,t+="/"+(e.zoomLevel?e.zoomLevel:15)),t+="?",e.size&&(t+="mapSize="+e.size.width+","+e.size.height+"&"),e.pins&&e.pins.forEach(e=>{t+="pushpin="+e.center.latitude+","+e.center.longitude+";",t+=(e.icon?e.icon:5)+";",e.name&&(t+=encodeURIComponent(e.name)),t+="&"}),t+="format=PNG&key="+encodeURIComponent(this._apiKey),t}attach(e){this.loadModuleAsync("Microsoft.Maps.SpatialMath"),this._map=new Microsoft.Maps.Map(e,{credentials:this._apiKey,zoom:16,showMapTypeSelector:!1,liteMode:!0}),this.isReady=!0,this.onAttached()}onAttached(){}onSelectionChanged(){}zoomToItems(){if(1==this._items.length)this.centerTo(this._items[0].location);else if(this._items.length>1){const e=[];this._items.forEach(t=>e.push(new Microsoft.Maps.Location(t.location.latitude,t.location.longitude))),this._map.setView({bounds:Microsoft.Maps.LocationRect.fromLocations(e)})}}centerToCurrent(){navigator.geolocation&&navigator.geolocation.getCurrentPosition(e=>{this.centerTo({latitude:e.coords.latitude,longitude:e.coords.longitude})})}centerTo(e){this._map.setView({center:new Microsoft.Maps.Location(e.latitude,e.longitude)})}getSearchManagerAsync(){return __awaiter(this,void 0,void 0,(function*(){return this._searchManager||(yield this.loadModuleAsync("Microsoft.Maps.Search"),this._searchManager=new Microsoft.Maps.Search.SearchManager(this._map)),this._searchManager}))}getAddressAsync(e){return __awaiter(this,void 0,void 0,(function*(){let t=yield this.getSearchManagerAsync();return new Promise((i,s)=>{t.reverseGeocode({location:new Microsoft.Maps.Location(e.latitude,e.longitude),callback:e=>{e&&e.address?i(e.address.formattedAddress):i(void 0)}})})}))}getLocationAsync(e){return __awaiter(this,void 0,void 0,(function*(){let t=yield this.getSearchManagerAsync();return new Promise((i,s)=>{t.geocode({where:e,bounds:this._map.getBounds(),callback:e=>{e&&e.results&&e.results.length>0?i({latitude:e.results[0].location.latitude,longitude:e.results[0].location.longitude}):i(void 0)}})})}))}addItems(i){let s=[],n=[];return i.forEach(i=>{let a=new t(this,i);if(a.marker=new Microsoft.Maps.Pushpin(new Microsoft.Maps.Location(i.location.latitude,i.location.longitude),{title:i.title,icon:i.icon,color:i.color}),i.shape&&i.shape.type==e.MapShapeType.Circle){let e,t,s=Microsoft.Maps.SpatialMath.getRegularPolygon(new Microsoft.Maps.Location(i.location.latitude,i.location.longitude),i.shape.radius?i.shape.radius:1,36,Microsoft.Maps.SpatialMath.DistanceUnits.Meters);i.shape.style&&(e=i.shape.style.strokeColor?Microsoft.Maps.Color.fromHex(i.shape.style.strokeColor):void 0,e&&i.shape.style.opacity&&(e.a=255*i.shape.style.opacity),t=i.shape.style.fillColor?Microsoft.Maps.Color.fromHex(i.shape.style.fillColor):void 0,t&&i.shape.style.opacity&&(t.a=255*i.shape.style.opacity));let n=new Microsoft.Maps.Polygon(s,{strokeColor:e,fillColor:t,strokeThickness:i.shape.style&&i.shape.style.strokeSize?i.shape.style.strokeSize:void 0});a.shapeObj=n}Microsoft.Maps.Events.addHandler(a.marker,"click",()=>{this.selectedItem=a}),n.push(a.marker),a.shapeObj&&n.push(a.shapeObj),this._items.push(a),s.push(a)}),this._map.entities.add(n),s}clear(){this._items=[],this.map.entities.clear()}getItemById(t){return e.linq(this._items).first(e=>e.id==t)}removeItem(e){this._items.splice(this._items.indexOf(e),1),this._map.entities.remove(e.marker),e.infoWindow&&e.infoWindow.setMap(null),e.shapeObj&&this._map.entities.remove(e.shapeObj)}loadModuleAsync(e){return new Promise((t,i)=>Microsoft.Maps.loadModule(e,()=>t()))}get map(){return this._map}}e.BingMapManager=i}(WebApp||(WebApp={})),function(e){function t(e,t){if(e&&0!=e.length)for(let i=e.length-1;i>=0;i--)t(e[i])}e.Binder=class{constructor(e){this._bindings=[],this._modelBinders=[],this._depBinders=[],this.model=e}register(e){this._modelBinders.push(e)}registerDependant(e){this._depBinders.push(e)}unregisterDependant(e){const t=this._depBinders.indexOf(e);-1!=t&&this._depBinders.splice(t,1)}getBindValue(e){return"function"==typeof e?e(this.model):e}bind(e,t){if("function"==typeof e){const i={value:e,action:t,subscriptions:[],lastValue:void 0};this._bindings.push(i),i.value(this.createProxy(this.model,(e,t)=>(this.subscribe(e,t,i),!0)));const s=i.value(this.model);i.action(s,void 0,!1),i.lastValue=s}else t(e,void 0,!1)}unsubscribe(t,i){t.subscriptions.forEach(t=>{e.TypeCheck.isObservableList(t.source)?t.source.unsubscribe(t.handler):t.property.unsubscribe(t.handler)}),i&&t.lastValue&&(t.action(null,t.lastValue,!0,!0),t.lastValue=null),t.subscriptions=[]}subscribe(t,i,s){for(let e=0;e<s.subscriptions.length;e++){const n=s.subscriptions[e];if(n.source==t&&n.property.name==i)return}if(e.TypeCheck.isObservableList(t)){const e={onChanged:()=>{const e=s.value(this.model);e!=s.lastValue&&(s.action(e,s.lastValue,!0),s.lastValue=e)}};t.subscribe(e),s.subscriptions.push({source:t,property:null,handler:e})}else{const n=Object.getOwnPropertyDescriptor(t,i);if(!n||!n.writable&&!n.set)return void console.warn("Property ",i," for object ",t," not exists or is not writeable.");const a=e.Properties.getOrCreate(t,i),o=(e,t)=>{const i=s.value(this.model);i!=s.lastValue&&(this.unsubscribe(s,!1),s.value(this.createProxy(this.model,(e,t)=>(this.subscribe(e,t,s),!0))),s.action(i,s.lastValue,!0),s.lastValue=i)};a.subscribe(o),s.subscriptions.push({source:t,property:a,handler:o})}}getBindingProperty(t){if("function"!=typeof t)return null;let i;return t(this.createProxy(this.model,(e,t)=>(i={obj:e,propName:t},!0))),i&&i.obj?e.Properties.getOrCreate(i.obj,i.propName):void 0}createProxy(t,i){if(!t||"object"!=typeof t)return t;let s=[];const n={};if(e.TypeCheck.isObservableList(t)){const e=n;s.push("count"),e._innerProxies={},e.get=s=>(s in e._innerProxies||(i(t,s.toString())?e._innerProxies[s]=this.createProxy(t.get(s),i):e._innerProxies[s]=t.get(s)),e._innerProxies[s])}else for(let e in t)s.push(e);for(let e of s){let s,a,o=!1;Object.defineProperty(n,e,{get:()=>(o||(s=i(t,e)?this.createProxy(t[e],i):t[e],o=!0),s),set:n=>{a!=n&&(s=i(t,e)?this.createProxy(n,i):n,a=n,o=!0)}})}return n}cleanBindings(e){this._bindings.forEach(t=>this.unsubscribe(t,e)),this._modelBinders.forEach(t=>t.cleanBindings(e)),this._depBinders.forEach(t=>t.cleanBindings(e)),this._modelBinders=[],this._bindings=[],this._depBinders=[]}updateModel(e){this.model=e,t(this._bindings,t=>{const i=t.value(e);t.lastValue!=i&&(t.action(i,t.lastValue,!0),t.lastValue=i)}),t(this._modelBinders,t=>t.updateModel(e))}},e.forEachRev=t}(WebApp||(WebApp={})),function(e){e.ComputedProperty=class{constructor(e,t){this.isReadOnly=!0,this.get=e,this.name=t}get(){throw"Not implemented"}set(e){}notifyChanged(){const t=this.get();e.forEachRev(this._handlers,e=>e(t,void 0))}subscribe(e){return this._handlers||(this._handlers=[]),-1==this._handlers.indexOf(e)&&this._handlers.push(e),e}unsubscribe(e){if(!this._handlers)return;const t=this._handlers.indexOf(e);-1!=t&&this._handlers.splice(t,1)}}}(WebApp||(WebApp={})),function(e){e.model=function(t){return e.Properties.createAll(t),t},e.template=function(t,i,s){t.innerHTML="";const n=new e.TemplateBuilder(s,t);n.begin(),n.loadTemplate(i)(n),n.end()},e.setEnumerable=function(e,t,i){const s=Object.getOwnPropertyDescriptor(i,t);s.enumerable||(s.enumerable=!0,Object.defineProperty(e,t,s))}}(WebApp||(WebApp={})),function(e){e.ObservableList=class{constructor(e,t){this._items=[],this._items=e||[],this.equalityComparer=t}add(e){return this._items.push(e),this.invoke(t=>t.onItemAdded?t.onItemAdded(e,this._items.length-1,"add"):void 0),this.invoke(e=>e.onChanged?e.onChanged():void 0),e}addRange(e){for(let t of e)this._items.push(t),this.invoke(e=>e.onItemAdded?e.onItemAdded(t,this._items.length-1,"add"):void 0);this.invoke(e=>e.onChanged?e.onChanged():void 0)}insert(e,t){return this._items.splice(e,0,t),this.invoke(i=>i.onItemAdded?i.onItemAdded(t,e,"insert"):void 0),this.invoke(e=>e.onChanged?e.onChanged():void 0),t}remove(e){const t=this.indexOf(e);-1!=t&&this.removeAt(t)}removeWhen(e){for(let t=this._items.length-1;t>=0;t--)e(this._items[t])&&this.removeAt(t)}removeRange(e,t){const i=this._items.splice(e,t);let s=!1;for(let t=i.length-1;t>=0;t--)this.invoke(s=>s.onItemRemoved?s.onItemRemoved(i[t],e+t,"remove"):void 0),s=!0;return s&&this.invoke(e=>e.onChanged?e.onChanged():void 0),i}removeAt(e){const t=this._items.splice(e,1)[0];return this.invoke(i=>i.onItemRemoved?i.onItemRemoved(t,e,"remove"):void 0),this.invoke(e=>e.onChanged?e.onChanged():void 0),t}clear(){if(0!=this._items.length){for(let e=this._items.length-1;e>=0;e--)this.invoke(t=>t.onItemRemoved?t.onItemRemoved(this._items[e],e,"clear"):void 0);this._items.splice(0,this._items.length),this.invoke(e=>e.onClear?e.onClear():void 0),this.invoke(e=>e.onChanged?e.onChanged():void 0)}}contains(e){return-1!=this.indexOf(e)}indexOf(e){if(this.equalityComparer){for(let t=0;t<this._items.length;t++)if(this.equalityComparer(e,this._items[t]))return t;return-1}return this._items.indexOf(e)}*[Symbol.iterator](){for(let e of this._items)yield e}toArray(){return this._items}get(e){return this._items[e]}set(e,t){const i=this._items[e];i!=t&&(this.invoke(t=>t.onItemRemoved?t.onItemRemoved(i,e,"replace"):void 0),this._items[e]=t,this.invoke(i=>i.onItemAdded?i.onItemAdded(t,e,"replace"):void 0),this.invoke(s=>s.onItemReplaced?s.onItemReplaced(t,i,e):void 0),this.invoke(e=>e.onChanged?e.onChanged():void 0))}swap(e,t){const i=this._items[t];this._items[t]=this._items[e],this._items[e]=i,this.invoke(i=>i.onItemSwap?i.onItemSwap(e,t):void 0),this.invoke(e=>e.onChanged?e.onChanged():void 0)}subscribe(e){return this._handlers||(this._handlers=[]),-1==this._handlers.indexOf(e)&&this._handlers.push(e),e}unsubscribe(e){if(!this._handlers)return;const t=this._handlers.indexOf(e);-1!=t&&this._handlers.splice(t,1)}forEach(e){let t=0;for(let i of this)e(i,t),t++}invoke(e){this._handlers&&this._handlers.forEach(t=>e(t))}get count(){return this._items.length}}}(WebApp||(WebApp={})),function(e){e.ObservableProperty=class{constructor(e,t){this._descriptor=e,this.name=t}get(){return this._descriptor.get?this._descriptor.get():this._descriptor.value}set(t){const i=this.get();this._descriptor.set?this._descriptor.set(t):this._descriptor.value=t,i!=t&&this._handlers&&e.forEachRev(this._handlers,e=>e(t,i))}notifyChanged(){const t=this.get();e.forEachRev(this._handlers,e=>e(t,void 0))}subscribe(e){return this._handlers||(this._handlers=[]),-1==this._handlers.indexOf(e)&&this._handlers.push(e),e}unsubscribe(e){if(!this._handlers)return;const t=this._handlers.indexOf(e);-1!=t&&this._handlers.splice(t,1)}}}(WebApp||(WebApp={})),function(e){let t;!function(t){function i(t,i,s){let n=Object.getOwnPropertyDescriptor(t,i);return n||(console.warn("'",i,"' not defined in ",e.ObjectUtils.getTypeName(t)),n={}),s||(s=new e.ObservableProperty(n,i)),e.ObjectUtils.getOrCreate(t,"@props",{})[i]=s,Object.defineProperty(t,i,{get:()=>s.get(),set:e=>s.set(e)}),s}function s(t,i){if(e.ObjectUtils.hasProp(t,"@props")){const e=t["@props"][i];if(e)return e}}function n(e){return e&&"object"==typeof e&&"function"==typeof e.get&&0==e.get.length&&"function"==typeof e.set&&1==e.set.length}function a(t){return t instanceof e.ObservableProperty||t instanceof e.ComputedProperty}t.converter=function(e,t,i,s){let n;return{get:()=>(null==n&&(n=i(e[t])),n),set:i=>{n=i,s&&(e[t]=s(i))},name:t}},t.create=i,t.createAll=function(e){return Object.getOwnPropertyNames(e).forEach(t=>{if("_"==t[0]||"$"==t[0])return;const s=Object.getOwnPropertyDescriptor(e,t);s&&!s.writable||i(e,t)}),e},t.get=s,t.getOrCreate=function(e,t,n){const a=s(e,t);return a||i(e,t,n)},t.isProperty=n,t.isObservableProperty=a,t.bind=function(e,t,i){let s;n(t)?(a(t)&&t.subscribe(t=>{i?e.set(i.convertTo(t)):e.set(t)}),e.subscribe(e=>{i?t.set(i.convertFrom(e)):t.set(e)}),s=t.get()):s=t,i?e.set(i.convertTo(s)):e.set(s)}}(t=e.Properties||(e.Properties={}))}(WebApp||(WebApp={})),function(e){class t extends e.Binder{constructor(e,t,i){super(e),this._childCount=0,this._updateCount=0,this._updateNode=null,this.element=null,this.parent=null,this.isInline=!1,this.inlineMode="never",this.index=0,this.parent=i,this.element=t}beginTemplate(e,i,s="after",n){const a=new t(e,this.element,this);return a._lastElement=this._lastElement,a.begin(i,s,n),"explicit"==this.inlineMode&&(a.isInline=this.isInline,a.inlineMode="inherit"),a}endTemplate(e){e.end(),e.element==this.element&&(this._lastElement=e._lastElement)}beginUpdate(){0==this._updateCount&&this.element.parentNode&&(this._updateNode=document.createTextNode(""),this.element.parentNode.replaceChild(this._updateNode,this.element)),this._updateCount++}endUpdate(){this._updateCount--,0==this._updateCount&&this._updateNode&&(this._updateNode.parentNode.replaceChild(this.element,this._updateNode),this._updateNode=null)}begin(e,t,i){return this._startElement=i?document.createComment("begin-"+i):document.createTextNode(""),e?"after"==t?e.nextSibling?e.parentNode.insertBefore(this._startElement,e.nextSibling):e.parentNode.appendChild(this._startElement):"before"==t?e.parentNode.insertBefore(this._startElement,e):"inside"==t&&e.appendChild(this._startElement):this.appendChild(this._startElement),this._lastElement=this._startElement,this}end(){if(!this._endElement)return this._startElement.nodeType==Node.COMMENT_NODE?this._endElement=document.createComment(this._startElement.textContent.replace("begin-","end-")):this._endElement=document.createTextNode(""),this.appendChild(this._endElement),this}clear(e=!1){this._childCount=0,this._endElement||(console.warn("Missing end element: "+this.model),this.end());let t=this._endElement;for(;;){let i=!0;t!=this._startElement&&t!=this._endElement||e||(i=!1);const s=t.previousSibling;if(i&&i&&t.parentNode.removeChild(t),t==this._startElement)break;t=s}return e?(this._endElement=null,this._startElement=null,this._lastElement=null):this._lastElement=this._startElement,this.cleanBindings(!0),this}appendChild(e){return this._lastElement&&this._lastElement.parentNode?this._lastElement.nextSibling?this._lastElement.parentNode.insertBefore(e,this._lastElement.nextSibling):this._lastElement.parentNode.appendChild(e):this.element.appendChild(e),this._lastElement=e,this}foreach(e,t){const i=this.getBindValue(e);return Array.isArray(i)||!i?this.foreachArray(e,t):this.foreachList(e,t),this}foreachList(e,t){let i=[];const s=this.loadTemplate(t),n=document.createTextNode("");this.appendChild(n);let a={onClear:()=>{i.forEach(e=>e.clear(!0)),i=[]},onItemRemoved:(e,t,s)=>{"replace"!=s&&"clear"!=s&&(i[t].clear(!0),i.splice(t,1))},onItemSwap:(e,t)=>{},onItemReplaced:(e,t,s)=>{i[s].updateModel(e)},onItemAdded:(e,t,a)=>{if("replace"==a)return;let o;t==i.length?(o=0==t?this.beginTemplate(e,n,"after",this.createMarker(e)):this.beginTemplate(e,i[t-1]._endElement,"after",this.createMarker(e)),i.push(o)):(o=this.beginTemplate(e,i[t]._startElement,"before",this.createMarker(e)),i.splice(t,0,o)),o.index=t,s(o),this.endTemplate(o)}};return this.bind(e,(e,t,i,s)=>{if(!s){if(this.beginUpdate(),i&&a.onClear(),t&&t.unsubscribe(a),e){e.subscribe(a);for(let t=0;t<e.count;t++)a.onItemAdded(e.get(t),t,"add")}this.endUpdate()}}),this}foreachArray(e,t){let i=[];const s=this.loadTemplate(t),n=document.createTextNode("");return this.appendChild(n),this.bind(e,(e,t,a,o)=>{o||(a&&(i.forEach(e=>e.clear()),i=[]),e&&(this._lastElement=n,this.beginUpdate(),e.forEach(e=>{const t=this.beginTemplate(e);t.index=i.length,s(t),this.endTemplate(t),i.push(t)}),this.endUpdate()))}),this}if(e,t,i){const s=this.beginTemplate(this.model);return this.register(s),this.bind(e,(e,n,a,o)=>{o||(a&&s.clear(),e?s.template(t):i&&s.template(i))}),this.endTemplate(s),this}replaceContent(e){if(this.isInline)throw"'replaceContent' not supported in inline elements";this.clear();for(let t of e)this.appendChild(t)}extractContent(){const t=[];for(let i of e.linq(this.element.childNodes))i!=this._startElement&&i!=this._endElement&&t.push(i);return t}content(t,i=!1){const s=this.beginTemplate(void 0,void 0,void 0,this.createMarker(t));return s.isInline=i,s.inlineMode="explicit",this.bind(t,(t,i,n,a)=>{if(!a){if(this.beginUpdate(),!s.isInline&&e.TypeCheck.isHTMLContainer(t)&&t.nodes&&!0===t.isCacheEnabled)s.replaceContent(t.nodes);else{if(i&&t&&i.template==t.template)s.updateModel(t);else if(n&&s.clear(),t){const e=this.templateFor(t);if(!e)throw"Template '"+t.template+"' not found.";s.updateModel(t),e(s)}e.TypeCheck.isHTMLContainer(t)&&!0===t.isCacheEnabled&&(t.nodes=this.extractContent())}this.endUpdate()}}),this.endTemplate(s),this}templateFor(e){if("string"==typeof e||"number"==typeof e)return this.loadTemplate("Text");if("object"==typeof e&&"template"in e)return this.loadTemplate(e.template);throw"cannot determine template for model"}loadTemplate(t){if("string"==typeof t){const i=e.templateCatalog[t];return i||console.error("Template ",t," not found."),i}return t}template(e,t){const i=this.loadTemplate(e);if(t){const e=this.beginTemplate(void 0,void 0,void 0,this.createMarker(t,"template"));this.bind(t,(t,s,n,a)=>{a||(e.updateModel(t),n||i(e))}),this.endTemplate(e)}else i(this);return this}exec(e){return e(this),this}beginChild(e){if(this.isInline&&this._childCount>0)throw"In inline mode you must have a single root element for your template";const t=this.isInline&&e.toUpperCase()==this.element.tagName?this.element:document.createElement(e),s=new i(this.model,t,this);return t==this.element&&(s._lastElement=this._lastElement),this.register(s),this._childCount++,s}child(e,i){const s=new t(this.model,document.createElement(e),this);return this.register(s),"function"==typeof i?i(s):s.attribs(i),this.appendChild(s.element),this}set(e,t){return this.bind(t,t=>{null!=t?this.element.setAttribute(e,t):this.element.removeAttribute(e)}),this}on(e,t){return this.element.addEventListener(e,e=>t(this.model,e)),this}class(e,t){if(t){const i=e?e.split(" "):[];this.bind(t,e=>{e?i.forEach(e=>this.element.classList.add(e)):i.forEach(e=>this.element.classList.remove(e))})}else this.bind(e,(e,t)=>{t&&t.split(" ").forEach(e=>this.element.classList.remove(e)),e&&e.split(" ").forEach(e=>this.element.classList.add(e))});return this}visible(e){return this.bind(e,(e,t,i,s)=>{s||(e?(this.element.classList.add("visible"),this.element.classList.remove("hidden")):(this.element.classList.add("hidden"),this.element.classList.remove("visible")))}),this}text(e){const t=document.createTextNode("");return this.appendChild(t),this.bind(e,e=>t.textContent=e),this}html(e){return this.bind(e,e=>this.element.innerHTML=e),this}focus(e){const t=this.getBindingProperty(e);return t&&(this.element.addEventListener("focus",e=>t.set(!0)),this.element.addEventListener("focusout",e=>t.set(!1))),this.bind(e,e=>{e&&document.activeElement!=this.element&&this.element.focus()}),this}value(e){const t=this.element,i=this.getBindingProperty(e);return i&&("INPUT"==t.tagName||"TEXTAREA"==t.tagName?"checkbox"==t.type||"radio"==t.type?t.addEventListener("change",e=>{i.set(t.checked)}):(t.addEventListener("keyup",e=>{i.set(t.value)}),t.addEventListener("change",e=>{i.set(t.value)})):"SELECT"==t.tagName&&t.addEventListener("change",e=>{i.set(t.value)})),"INPUT"!=t.tagName&&"TEXTAREA"!=t.tagName&&"SELECT"!=t.tagName||("checkbox"==t.type||"radio"==t.type?this.bind(e,e=>t.checked=e):this.bind(e,e=>t.value=e||null)),this}style(e,t){return this.bind(t,t=>this.element.style[e]=t),this}behavoir(t){return"string"==typeof t?e.behavoirCatalog[t]().attach(this.element,this.model):t.attach(this.element,this.model),this}styles(e){for(let t in e)this.bind(e[t],e=>this.element.style[t]=e);return this}attribs(e){for(let t in e)this.set(t,e[t]);return this}debugger(){return this}createMarker(e,t=""){}}e.TemplateBuilder=t;class i extends t{constructor(e,t,i){super(e,t,i)}endChild(){return this.parent.element!=this.element?this.parent.appendChild(this.element):this._lastElement&&(this.parent._lastElement=this._lastElement),this.parent}}e.templateCatalog={}}(WebApp||(WebApp={})),function(e){e.behavoirCatalog={}}(WebApp||(WebApp={})),function(e){e.BaseSearch=class{searchAsync(t,i=25){t||(t="");let s=e.linq(t.toLowerCase().split(" ")).select(e=>e.trim()).where(e=>""!=e).toArray(),n=[];return s.length>0&&this.doSearch(s,n),e.linq(n).orderByDesc(e=>e.rank).select(e=>e.value).toArrayAsync(i)}macthWeight(e,t){if(!t)return 0;"string"!=typeof t&&(t=t.toString());const i=(t=t.toLowerCase()).indexOf(e);return-1==i?0:(t.length==e.length?1:(t.length-e.length-i)/(t.length-e.length))+(t.length-e.length)/t.length}matchValue(e,t){var i;if(0==t.length)return 1;let s=0;for(let n of t){let t=0;for(let s of this.getSearchParts(e))t+=null!==(i=this.macthWeight(n,s.text)*s.weight)&&void 0!==i?i:1;if(0==t)return 0;s+=t}return s}}}(WebApp||(WebApp={})),function(e){e.HistoryPageHost=class{constructor(t){this._isSyncing=!1,this._backSignal=new e.Signal,this.innerHost=t,this._startHistoryIndex=window.history.length,this._sessionId=(new Date).getTime().toString(),window.addEventListener("popstate",e=>this.onPopState(e.state))}onPopState(e){return __awaiter(this,void 0,void 0,(function*(){console.debug("begin popState: ",e," isSyncing: ",this._isSyncing),this._isSyncing||(e&&(yield this.goToAsync(e.index)),this._backSignal.set(),console.debug("end popState: ",e))}))}onStateChanged(e){this._isSyncing||e==this.current&&this.updateState()}updateState(t=!1){const i=e.app.formatTitle(this.current.title),s=this.current.url?e.Uri.absolute(e.Format.replaceArgs(this.current.url,e.app.startupArgs)):null;if(t){const e={sessionId:this._sessionId,index:this.currentIndex};window.history.pushState(e,i,s)}else window.history.replaceState(window.history.state,i,s);document.title=i}clearAsync(){return __awaiter(this,void 0,void 0,(function*(){yield this.innerHost.clearAsync(),yield this.syncHistoryAsync(),this._isSyncing=!0,window.history.pushState(null,null,null),window.history.go(-1),this._isSyncing=!1}))}get(e){return this.innerHost.get(e)}goBackAsync(){return __awaiter(this,void 0,void 0,(function*(){if(this.pageCount>1){console.debug("begin goBack"),this._backSignal.reset(),window.history.back();const t=yield this._backSignal.waitFor(e.TimeSpan.fromMilliseconds(500));console.debug("end goBack: ",t)}else yield this.clearAsync(),yield e.app.mainAsync()}))}goForwardAsync(){return window.history.forward(),Promise.resolve()}goToAsync(e){return __awaiter(this,void 0,void 0,(function*(){yield this.innerHost.goToAsync(e),this.updateState()}))}syncHistoryAsync(){return __awaiter(this,void 0,void 0,(function*(){if(!this._isSyncing){this._isSyncing=!0;try{let t=window.history.state;for(;t&&t.sessionId==this._sessionId&&t.index>0;)yield this.goBackAsync(),t=window.history.state;let i=0;for(;i<this.pageCount;){const s=this.get(i),n=e.app.formatTitle(s.title),a=s.url?e.Uri.absolute(e.Format.replaceArgs(s.url,e.app.startupArgs)):null;t={sessionId:this._sessionId,index:i},0==i?window.history.replaceState(t,n,a):window.history.pushState(t,n,a),i==this.currentIndex&&(document.title=n),i++}const s=this.currentIndex-(this.pageCount-1);s<0&&window.history.go(s)}finally{this._isSyncing=!1}}}))}loadAsync(e,t){return __awaiter(this,void 0,void 0,(function*(){const i=window.history.state,s=i&&i.sessionId==this._sessionId&&i.index==this.currentIndex;return yield this.innerHost.loadAsync(e,t),e.prop("title").subscribe(t=>this.onStateChanged(e)),e.prop("url").subscribe(t=>this.onStateChanged(e)),e.host=this,s?this.updateState(!0):yield this.syncHistoryAsync(),e}))}find(e){return this.innerHost.find(e)}bringFrontAsync(e){return __awaiter(this,void 0,void 0,(function*(){yield this.innerHost.bringFrontAsync(e),yield this.syncHistoryAsync()}))}get currentIndex(){return this.innerHost.currentIndex}set setCurrentIndex(e){this.innerHost.currentIndex=e,this.syncHistoryAsync()}get current(){return this.innerHost.current}get pageCount(){return this.innerHost.pageCount}get canGoBack(){return this.innerHost.canGoBack||e.app.hasMain}}}(WebApp||(WebApp={})),function(e){class t extends e.BindableObject{constructor(t){super(),this.template=null,this.parentView=null,this.bindConfig("template",t),this.template||(this.template=e.ObjectUtils.getTypeName(this)),t&&t.parentView&&(this.parentView=t.parentView)}}e.View=t}(WebApp||(WebApp={})),function(e){class t extends e.View{constructor(t){super(t),this.subOperations=listOf(),this.message=null,this.parentOperation=null,this.bindConfig("message",t),t.type?this._type=t.type:this._type=e.OperationType.Global,this.parentOperation=t.parentOperation}end(){e.Operation.end(this)}get type(){return this._type}get progress(){return this._progress}set progress(e){this._progress=e,this._progress?(console.log(this.getProgressDescription(this._progress)),this._progress.message&&(this.message=this._progress.message)):this.message=void 0}addSubOperation(e){this.subOperations.add(e)}removeSubOperation(e){this.subOperations.remove(e)}getProgressDescription(e){let t="Progress: ";return e.message&&(t+="'"+e.message+"'"),null!=e.current&&null!=e.totCount&&(t+=" - "+e.current+"/"+e.totCount+" ("+Math.round(100/e.totCount*e.current)+"%)"),t}}e.Operation=new class{constructor(){this._localCount=0,this.operations=listOf(),this.onBegin=e.event(),this.onEnd=e.event(),this.onProgress=e.event()}progress(t){e.TypeCheck.isString(t)&&(t={message:t}),this.current&&(this.current.progress=t)}begin(i){e.TypeCheck.isString(i)&&(i={message:i});const s=new t(i);return console.group("Begin operation: ",e.DynamicString.getValue(s.message)),s.progress=i,void 0===s.parentOperation&&(s.parentOperation=this.current),this.operations.add(s),s.parentOperation&&s.parentOperation.addSubOperation(s),s.type==e.OperationType.Local?this._localCount++:e.app.block(),s}end(t){console.groupEnd(),console.log("End operation: ",e.DynamicString.getValue(t.message)),this.operations.remove(t),t.parentOperation&&t.parentOperation.removeSubOperation(t),t.type==e.OperationType.Local?this._localCount--:e.app.unblock()}get current(){return this.operations.count>0?this.operations.get(this.operations.count-1):null}}}(WebApp||(WebApp={})),function(e){class t extends e.BindableObject{constructor(){super(),this.selectedItems=observableListOf(),this.actions=observableListOf(),this.selectionText=null,this.isActive=!1,this.selectedItems.subscribe({onChanged:()=>{this.updateView(),0==this.selectedItems.count&&this.close()}})}close(){this.isActive=!1;for(var e=this.selectedItems.count-1;e>=0;e--)this.selectedItems.get(e).isSelected=!1;this.selectedItems.clear(),this.actions.clear(),this.updateView()}open(){this.isActive=!0}addAction(t){const i=e.ActionView.fromItemAction(t,()=>this.selectedItems.toArray());return this.actions.add(i),i}updateView(){this.selectionText=e.DynamicString.getValue("selection-count",{params:[this.selectedItems.count],cardinality:this.selectedItems.count})}}e.SelectionManager=t}(WebApp||(WebApp={})),function(e){class t extends e.BindableObject{constructor(){super(),this._blockCount=0,this.pageHost=null,this.appName=null,this.view=null,this.language=null,this.prop("language").subscribe(()=>this.updateLanguage())}runAsync(t,i){return __awaiter(this,void 0,void 0,(function*(){window.addEventListener("error",e=>this.handleError(e.srcElement,e.error,e.message)),this._startupArgs=i,this._baseUrl=t,0!=this._baseUrl.length&&"/"==this._baseUrl[this._baseUrl.length-1]||(this._baseUrl+="/"),this.initServices(),yield this.configureServicesAsync(),this.isSelfHosted?(this.pageHost=new e.SelfHostedPageHost,this.view=this.pageHost):(this.pageHost=new e.HistoryPageHost(this.createPageHost()),this.view=this.pageHost.innerHost),e.Services.pageHost=this.pageHost,document.title=this.appName,e.template(document.body,this.view.template,this.view),this.onStarted()}))}updateLanguage(){document.documentElement.lang=this.language,e.StringTable.currentConfig={language:this.language}}onStarted(){}handleError(e,t,i){console.error("Source: ",e,"Error: ",t,"Message: ",i)}formatTitle(e){return this.appName&&e?this.appName+" - "+e:e||this.appName}createPageHost(){return new e.SlidePageHost}initServices(){e.Services.application=this,e.Services.pageManager=new e.DynamicPageManager,e.Services.httpClient=new e.XHRHttpClient,e.Services.cache=new e.LocalStorageCache,e.Services.itemsObserver=new e.ItemsObserver,e.Services.dbStorage=new e.DbStorage,e.behavoirCatalog.attach=()=>e.AttachBehavoir.instance,e.behavoirCatalog.ripple=()=>e.RippleClickBehavoir.instance,e.behavoirCatalog.vibrate=()=>e.VibrateClickBehavoir.instance,e.behavoirCatalog["scroll-check"]=()=>e.ScrollCheckBehavoir.instance,e.behavoirCatalog["long-press"]=()=>new e.LongPressBehavoir}configureServicesAsync(){return Promise.resolve()}block(){this._blockCount++,this._blocker?this.restoreBlock():(this._blocker=new e.Blocker,setTimeout(()=>this.restoreBlock()))}restoreBlock(){this._blockCount>0&&"show"!=this._blocker.status&&"showing"!=this._blocker.status&&this._blocker.showAsync()}unblock(e=!1){this._blocker&&(e?"show"!=this._blocker.status&&"showing"!=this._blocker.status||this._blocker.hideAsync():--this._blockCount<=0&&this._blocker.hideAsync())}mainAsync(){return Promise.resolve(null)}get baseUrl(){return this._baseUrl}set baseUrl(e){this._baseUrl=e}get startupArgs(){return this._startupArgs}get isSelfHosted(){return window.parent!=window&&window.parent.WebApp&&window.parent.WebApp.app}get hasMain(){return!1}}e.ViewApplication=t}(WebApp||(WebApp={})),function(e){let t;!function(e){e[e.Primary=0]="Primary",e[e.Secondary=1]="Secondary",e[e.Evidence=2]="Evidence"}(t=e.ActionPriority||(e.ActionPriority={}))}(WebApp||(WebApp={})),function(e){let t;!function(e){e[e.None=0]="None",e[e.Circle=1]="Circle"}(t=e.MapShapeType||(e.MapShapeType={}))}(WebApp||(WebApp={})),function(e){let t;!function(e){e[e.Default=0]="Default",e[e.WebView=1]="WebView"}(t=e.PageHostMode||(e.PageHostMode={}))}(WebApp||(WebApp={})),function(e){class t extends e.BindableObject{constructor(e){super(),this.url=null,this.host=null,this.view=null,this.title=null,this.subTitle=null,this.name=null,this.status="notloaded",this.args=null,this.bindConfig("url",e),this.bindConfigString("title",e),this.bindConfigString("subTitle",e),this.bindConfig("view",e),e&&e.name&&(this.name=e.name)}getState(){return{}}setState(e){}handleError(t,i){e.app.handleError(t,i)}loadAsync(){return __awaiter(this,void 0,void 0,(function*(){if("notloaded"==this.status||"error"==this.status){let t=e.Operation.begin({message:"Loading page: "+(this.title?this.title:this.url?this.url:e.ObjectUtils.getTypeName(this))});this.status="loading";try{yield this.loadWorkAsync()}catch(t){this.status="error",e.app.handleError(this,t)}finally{t.end(),this.status="loaded"}}}))}loadWorkAsync(){return Promise.resolve()}refreshAsync(){return Promise.resolve()}closeAsync(e){return __awaiter(this,void 0,void 0,(function*(){return"goBackAsync"in this.host&&(yield this.host.goBackAsync()),this.status="closed",!0}))}}e.Page=t}(WebApp||(WebApp={})),function(e){class t extends e.Page{constructor(t){super(t),this._viewItems=[],this.view=new e.Panel({name:e.ViewUtils.formatForCss(e.ObjectUtils.getTypeName(this)),styles:["vertical","activity","page","relative"]}),this.name&&this.view.styles.push(this.name)}get result(){return new Promise(e=>this._resultResolve=e)}activateAsync(){return Promise.resolve()}deactivateAsync(){return Promise.resolve()}closeAsync(t){return __awaiter(this,void 0,void 0,(function*(){const i=yield e.Page.prototype.closeAsync.call(this,t);return this._resultResolve&&this._resultResolve(t),i}))}loadWorkAsync(){return this.createAsync()}createAsync(){return Promise.resolve()}static isActivity(i){return e.ObjectUtils.isInstanceOf(i,t)}}e.Activity=t}(WebApp||(WebApp={})),function(e){let t;!function(e){e[e.Manual=1]="Manual",e[e.Tabs=2]="Tabs",e[e.BottomNav=3]="BottomNav"}(t=e.ContentSelector||(e.ContentSelector={}));class i extends e.Activity{constructor(e){super(e),this._isContentLoaded=!1,this._selector=t.Tabs,this.activeContent=null,this.activeContentProvider=null,this.providers=[],this.menu=null,this.actions=[],this.floatingStyle=["vertical","item-absolute","bottom","fill-h","center-items-h"],this.contentStyle=["vertical","scroll"],this.bindConfig("activeContent",e),e&&(e.providers&&(this.providers=e.providers),e.menu&&(this.menu=e.menu),e.selector&&(this._selector=e.selector),e.actions&&(this.actions=e.actions)),this.prop("host").subscribe(()=>{var e,t;"none"==(null===(e=this._actionBar)||void 0===e?void 0:e.mainAction)&&(null===(t=this.host)||void 0===t?void 0:t.canGoBack)&&(this._actionBar.mainAction="back")})}closeAsync(t){var i;return __awaiter(this,void 0,void 0,(function*(){return(null===(i=this.activeContentProvider)||void 0===i?void 0:i.deactivateAsync)&&(yield this.activeContentProvider.deactivateAsync()),yield e.Activity.prototype.closeAsync.call(this,t)}))}activateAsync(){var e,t;return this._isContentLoaded?(null===(e=this.activeContentProvider)||void 0===e?void 0:e.activateAsync)?null===(t=this.activeContentProvider)||void 0===t?void 0:t.activateAsync("refresh"):Promise.resolve():this.refreshAsync()}deactivateAsync(){var e;return(null===(e=this.activeContentProvider)||void 0===e?void 0:e.deactivateAsync)?this.activeContentProvider.deactivateAsync():Promise.resolve()}refreshAsync(){return this.activeContentProvider?this.loadContentAsync(this.activeContentProvider,!0):this.loadActiveContentAsync(!0)}notifyContentChanged(e){this.loadContentAsync(e,!0)}startSelection(){return this._actionBar.startSelection()}loadActiveContentAsync(t){return this.activeContentProvider=e.linq(this.providers).first(e=>e.info.name==this.activeContent),this.loadContentAsync(this.activeContentProvider,t)}loadWorkAsync(){return __awaiter(this,void 0,void 0,(function*(){yield this.createAsync(),this.activeContentProvider&&(this.activeContent=this.activeContentProvider.info.name)}))}loadContentAsync(t,i){var s,n;return __awaiter(this,void 0,void 0,(function*(){const a=this.activeContentProvider!=t;if(!a&&!i)return;if(a&&(null===(s=this.activeContentProvider)||void 0===s?void 0:s.deactivateAsync)&&(null===(n=this.activeContentProvider)||void 0===n||n.deactivateAsync()),this.activeContentProvider=t,!i&&("notloaded"==this.status||"loading"==this.status||"closed"==this.status))return void console.debug("Skip loading content: "+t.info.name);const o=e.Operation.begin({message:"Loading content: "+t.info.name});try{const i=yield t.getContentAsync(this);this.title=this.formatTitle(e.DynamicString.getValue(i.title,e.StringUsage.Title)),this._contentView.clear(),i.styles?this._contentView.styles=i.styles:this._contentView.styles=this.contentStyle,i.views&&i.views.forEach(e=>this._contentView.addView(e)),this._contentView.name=t.info.name,this._contentView.buildStyles(),this._actionBar.actions.clear(),this._floatingView&&this._floatingView.clear(),i.actions&&i.actions.forEach(t=>{null==t.priority||t.priority==e.ActionPriority.Secondary?this._actionBar.actions.add(this.createActionView(t)):t.priority==e.ActionPriority.Primary&&(this._floatingView.visible=!0,this._floatingView.addView(this.createActionView(t,{styles:e.ArrayUtils.merge(["floating"],t.styles)})))}),this._floatingView.visible=this._floatingView.content.count>0,this.actions.forEach(e=>this._actionBar.actions.add(e)),yield this._contentView.loadAsync(),(null==t?void 0:t.activateAsync)&&(yield t.activateAsync("loading")),this.onContentChanged(t),this._isContentLoaded=!0}catch(e){this.handleError(this,e)}finally{o.end()}}))}formatTitle(e){return e}createAsync(){if(this.menu?this._actionBar=this.view.addView(new e.ActionBar({title:this.prop("title"),mainAction:"menu",navigationMenu:this.menu})):this._actionBar=this.view.addView(new e.ActionBar({onBack:()=>this.closeAsync(),title:this.prop("title"),mainAction:this.host.canGoBack?"back":"none"})),this.providers.length>1)if(this._selector==t.Manual)this.prop("activeContent").subscribe(()=>this.loadActiveContentAsync(!1));else{let i,s,n;switch(this._selector){case t.Tabs:i="tab-view",s="TextView",n=["ripple"];break;case t.BottomNav:i="bottom-nav",s="IconTextView",n=["ripple"]}this._navBar=new e.NavBar({styles:[i],itemTemplate:s,onItemSelected:e=>this.loadContentAsync(e.content,!1),selectedItem:this.prop("activeContent"),itemBehavoirs:n,items:e.linq(this.providers).select(e=>({name:e.info.name,icon:e.info.icon,text:e.info.displayName,content:e})).toArray()})}this._navBar&&this._selector==t.Tabs&&this.view.addView(this._navBar);const i=this.view.addView(new e.Panel({name:"content"}));return this._contentView=i.addView(new e.Panel({name:"scroll-container",styles:this.contentStyle})),this._floatingView=i.addView(new e.Panel({name:"floating-container",template:"ItemsViewWrapped",visible:!1,styles:this.floatingStyle})),this._navBar&&this._selector==t.BottomNav&&this.view.addView(this._navBar),1==this.providers.length&&(this.activeContentProvider=this.providers[0]),this.status="created",Promise.resolve()}createActionView(t,i){return e.ActionView.fromAction(t,i)}onContentChanged(e){}}e.ContentActivity=i}(WebApp||(WebApp={})),function(e){class t extends e.Activity{constructor(e){super(e),this.searchText=null,this.tooltip=null,this.pageSize=0,this.listStyles=["vertical","scroll","compact"],this.noMatchingText=null,this.bindConfigString("tooltip",e),this.bindConfig("pageSize",e),this.bindConfig("noMatchingText",e),e&&(e.createItemView&&(this.createItemView=e.createItemView),e.searchAsync&&(this.searchWorkAsync=e.searchAsync),e.query&&(this.searchText=e.query),e.listStyles&&e.listStyles.forEach(e=>this.listStyles.push(e)))}refreshAsync(){return this._listView.refreshAsync()}createAsync(){return __awaiter(this,void 0,void 0,(function*(){this._actionBar=this.view.addView(new e.ActionBar({onBack:()=>this.closeAsync(),title:this.prop("title"),mainAction:"back"})),this._searchView=new e.SearchView({name:"search-expanded",tooltip:this.prop("tooltip"),isExpanded:!0,searchText:this.prop("searchText"),searchAsync:e=>this._listView.refreshAsync()}),this._actionBar.actions.add(this._searchView),this._emptyView=new e.IconTextView({styles:["empty-view"],visible:!1}),this._listView=this.view.addView(new e.ListView(Object.assign({name:"content",styles:this.listStyles,template:"ListViewInline",header:[this._emptyView],itemsSource:new e.ItemsSource({getItemsAsync:()=>__awaiter(this,void 0,void 0,(function*(){const e=this.searchText,t=yield this.searchWorkAsync(e);return this.updateView((null==t?void 0:t.length)>0,e),t}))}),itemsLoader:this.pageSize?new e.PagedItemsLoader({getFilter:(e,t)=>this.getFilter(this.searchText,e,t),pageSize:this.pageSize}):void 0,createItemView:e=>this.createItemView(e)},this.configureListView()))),setTimeout(()=>this._searchView.hasFocus=!0,500),yield this.refreshAsync()}))}updateView(t,i){t?this._emptyView.visible=!1:(this._emptyView.visible=!0,this.searchText?(this._emptyView.icon="far fa-sad-cry",this.noMatchingText&&(this._emptyView.text=e.DynamicString.getValue(this.noMatchingText,{params:[i]}))):(this._emptyView.icon="fas fa-microscope",this._emptyView.text=""))}configureListView(){return{}}createItemView(e){throw"Not Implemented"}searchWorkAsync(e,t,i){throw"Not Implemented"}getFilter(e,t,i){return{}}}e.SearchActivity=t}(WebApp||(WebApp={})),function(e){class t extends e.SearchActivity{constructor(t){super(t),this.canAdd=!1,this.showEmptyItem=!1,this.emptyLabel="[None]",this.itemsSource=null,this.addLabel="Add New",this.filters=observableListOf(),this.selectedItems=observableListOf(),this.bindConfig("canAdd",t),this.bindConfigString("emptyLabel",t,e.StringUsage.Title),this.bindConfig("showEmptyItem",t),this.bindConfig("itemsSource",t),this.bindConfigString("addLabel",t),t&&(t.createItemView&&(this.createItemContentView=t.createItemContentView),t.createItemListView&&(this.createItemListView=t.createItemListView),t.createItemEditor&&(this.createItemEditor=t.createItemEditor),t.filters&&this.filters.addRange(t.filters),t.selectedItems&&this.setSelectedItems(t.selectedItems)),(null==t?void 0:t.tooltip)||(this.tooltip=e.Strings["select-item"]({params:[this.itemsSource.displayName],number:e.WordNumber.Plural,usage:e.StringUsage.Tooltip})),(null==t?void 0:t.addLabel)||(this.addLabel=e.Strings["new-item"]({params:[this.itemsSource.displayName],usage:e.StringUsage.Action}))}setSelectedItems(e){this.selectedItems.clear(),e&&e.forEach(e=>this.addSelection(e))}createAsync(){return __awaiter(this,void 0,void 0,(function*(){yield e.SearchActivity.prototype.createAsync.call(this),this._actionBar.addAction({name:"confirm",icon:"fas fa-check",displayName:"confirm",executeAsync:()=>this.confirmAsync(),priority:e.ActionPriority.Primary}),this._bottomSheet=new e.BottomSheet({headHeight:50,content:new e.ItemsView({styles:["padding","horizontal-wrap"],content:this.selectedItems})}),this.view.addView(this._bottomSheet),this.updateView()}))}confirmAsync(){return __awaiter(this,void 0,void 0,(function*(){yield this.closeAsync(e.linq(this.selectedItems).select(e=>e.item).toArray())}))}configureListView(){const t=[];this.canAdd&&t.push(e.ActionView.fromAction({name:"add-item",icon:"fas fa-plus",operation:e.OperationType.Local,executeAsync:()=>this.addItemAsync(),displayName:this.addLabel})),this.showEmptyItem&&(this._emptyItem=new e.SelectableItemView({content:new e.TextView({content:this.emptyLabel}),item:null}),this._emptyItem.toggle=()=>this.closeAsync([]),t.push(this._emptyItem));const i={header:t,selectionMode:"multiple"};return this.pageSize>0&&(i.itemsSource=this.itemsSource),i}searchWorkAsync(e){return this.itemsSource.getItemsAsync(this.getFilter(e))}getFilter(e,t,i){let s=this.itemsSource.getFilter(e,t,i);return 1==this.filters.count&&(s=Object.assign(Object.assign({},s),this.filters.get(0).content)),s}createItemListView(t){return new e.TextView({content:this.itemsSource.getItemText(t)})}createItemContentView(t){return new e.TextView({content:this.itemsSource.getItemText(t)})}createItemEditor(){throw"Not Supported"}createItemView(t){const i=new e.SelectableItemView({content:this.createItemListView(t),item:t});return i.prop("isSelected").subscribe(e=>this.updateSelection(i,t,e)),null!=this.findItem(t)&&(i.isSelected=!0),i}updateSelection(e,t,i){i?this.addSelection(t,e):this.removeSelection(t),this.updateView()}updateView(){this._bottomSheet&&(this.selectedItems.count>0?this._bottomSheet.open():this._bottomSheet.close())}removeSelection(e){const t=this.findItem(e);t&&this.selectedItems.remove(t)}addSelection(t,i){if(this.findItem(t))return;const s=new e.RemovableItemView({content:this.createItemContentView(t),removeAsync:()=>{this.selectedItems.remove(s);const e=this.findSelectable(t);return e&&(e.isSelected=!1),Promise.resolve()},item:t});return this.selectedItems.add(s),s}findItem(t){return e.linq(this.selectedItems).first(e=>this.itemsSource.itemComparer(e.item,t))}findSelectable(t){return e.linq(this._listView.content).first(e=>this.itemsSource.itemComparer(e.item,t))}addItemAsync(){return __awaiter(this,void 0,void 0,(function*(){const t=this.createItemEditor();let i;if(e.TypeCheck.isAsyncEditor(t))i=yield t.editAsync(this.itemsSource.newItem());else{const s=new e.ActivityEditor({editor:t,title:this.addLabel});i=yield s.editAsync(this.itemsSource.newItem())}if(!i)return;const s=yield this.itemsSource.addItemAsync(i);if(!s)return;const n=this.createItemView(s);n.isSelected=!0,this._listView.content.insert(0,n)}))}}e.SelectMultipleItemsActivity=t}(WebApp||(WebApp={})),function(e){class t extends e.SearchActivity{constructor(t){super(t),this.canAdd=!1,this.itemsSource=null,this.addLabel="Add New",this.filters=observableListOf(),this.selectedValue=null,this.bindConfig("canAdd",t),this.bindConfig("itemsSource",t),this.bindConfig("selectedValue",t),this.bindConfigString("addLabel",t),t&&(t.createItemView&&(this.createItemContentView=t.createItemContentView),t.createItemEditor&&(this.createItemEditor=t.createItemEditor),t.filters&&this.filters.addRange(t.filters)),(null==t?void 0:t.tooltip)||(this.tooltip=e.Strings["select-item"]({params:[this.itemsSource.displayName],usage:e.StringUsage.Tooltip})),(null==t?void 0:t.addLabel)||(this.addLabel=e.Strings["new-item"]({params:[this.itemsSource.displayName],usage:e.StringUsage.Action}))}createAsync(){return __awaiter(this,void 0,void 0,(function*(){yield e.SearchActivity.prototype.createAsync.call(this),this._actionBar.addAction({name:"confirm",icon:"fas fa-check",displayName:"confirm",executeAsync:()=>this.confirmAsync(),priority:e.ActionPriority.Primary})}))}confirmAsync(){return __awaiter(this,void 0,void 0,(function*(){yield this.closeAsync()}))}configureListView(){const t=[];this.canAdd&&t.push(e.ActionView.fromAction({name:"add-item",icon:"fas fa-plus",operation:e.OperationType.Local,executeAsync:()=>this.addItemAsync(),displayName:this.addLabel}));const i={header:t};return this.pageSize>0&&(i.itemsSource=this.itemsSource),i}searchWorkAsync(e){return this.itemsSource.getItemsAsync(this.getFilter(e))}getFilter(e,t,i){let s=this.itemsSource.getFilter(e,t,i);return 1==this.filters.count&&(s=Object.assign(Object.assign({},s),this.filters.get(0).content)),s}createItemContentView(t){return new e.TextView({content:this.itemsSource.getItemText(t)})}createItemEditor(){throw"Not Supported"}createItemView(t){const i=new e.SelectableItemView({content:this.createItemContentView(t),styles:["single"],item:t});return this.itemsSource.equals(this.itemsSource.getItemValue(t),this.selectedValue)&&(i.isSelected=!0),i.prop("isSelected").subscribe(e=>{e&&this.setSelectionAsync(t)}),i}setSelectionAsync(e){return this.closeAsync(e)}addItemAsync(){return __awaiter(this,void 0,void 0,(function*(){const t=this.createItemEditor();let i;if(e.TypeCheck.isAsyncEditor(t))i=yield t.editAsync(this.itemsSource.newItem());else{const s=new e.ActivityEditor({editor:t,title:this.addLabel});i=yield s.editAsync(this.itemsSource.newItem())}if(!i)return;const s=yield this.itemsSource.addItemAsync(i);s&&(yield this.setSelectionAsync(s))}))}}e.SelectSingleItemActivity=t}(WebApp||(WebApp={})),function(e){class t{attach(e,t){"attach"in t&&setTimeout(()=>t.attach(e))}detach(e,t){}}t.instance=new t,e.AttachBehavoir=t}(WebApp||(WebApp={})),function(e){e.LongPressBehavoir=class{constructor(){this._isLongPress=!1}attach(e,t){this._handler=t,this._element=e,this._cancelHandler=e=>this.cancelTimer(e),e.addEventListener("touchstart",e=>this.startTimer(e),{passive:!0}),e.addEventListener("mousedown",e=>this.startTimer(e)),e.addEventListener("selectstart",()=>!1)}detach(e){}startTimer(e){this._isLongPress=!1,this._element.addEventListener("touchmove",this._cancelHandler),this._element.addEventListener("touchend",this._cancelHandler),this._element.addEventListener("mousemove",this._cancelHandler),this._element.addEventListener("mouseup",this._cancelHandler),this._timer=window.setTimeout(()=>{this._isLongPress=!0,"vibrate"in navigator&&navigator.vibrate(50),this._handler.onLongPress(e),this._timer=null},490)}cancelTimer(e){this._isLongPress&&e.stopPropagation(),this._timer&&(clearTimeout(this._timer),this._timer=null),this._element.removeEventListener("touchmove",this._cancelHandler),this._element.removeEventListener("touchend",this._cancelHandler),this._element.removeEventListener("mousemove",this._cancelHandler),this._element.removeEventListener("mouseup",this._cancelHandler)}}}(WebApp||(WebApp={})),function(e){class t{attach(e){e.addEventListener("mousedown",this.onClick),e.classList.add("ripple")}detach(e){e.removeEventListener("mousedown",this.onClick)}onClick(e){const t=e.currentTarget;t.classList.remove("activated"),setTimeout(()=>t.classList.add("activated"))}}t.instance=new t,e.RippleClickBehavoir=t}(WebApp||(WebApp={})),function(e){class t{attach(t,i){setTimeout(()=>{const s=t.classList.contains("scroll")?t:e.DomUtils.parentOfClass(t,"scroll");null!=s&&s.addEventListener("scroll",(function e(){if(!i.isScrollCheckActive)return;let n=t,a=!1;for(;null!=n;){if(n==s){a=!0;break}n=n.parentNode}a?i.onScroll({offsetTop:s.scrollTop,offsetBottom:s.scrollHeight-(s.scrollTop+s.clientHeight),pageBottom:(s.scrollHeight-(s.scrollTop+s.clientHeight))/s.clientHeight,pageTop:s.scrollTop/s.clientHeight,totPages:s.scrollHeight/s.clientHeight}):s.removeEventListener("scroll",e)}),{passive:!0})})}detach(e,t){}}t.instance=new t,e.ScrollCheckBehavoir=t}(WebApp||(WebApp={})),function(e){class t{attach(e){e.addEventListener("click",this.onClick)}detach(e){e.removeEventListener("click",this.onClick)}onClick(e){"vibrate"in navigator&&navigator.vibrate(50)}}t.instance=new t,e.VibrateClickBehavoir=t}(WebApp||(WebApp={})),function(e){class t extends e.View{constructor(e){super(e),this.enabled=!0,this.visible=!0,this.styles=[],this.name=null,this.nodes=null,this.isCacheEnabled=!1,this.status="",this.bindConfig("enabled",e),this.bindConfig("visible",e),e&&(e.styles&&(this.styles=e.styles),e.name&&(this.name=e.name)),this.prop("styles").subscribe(()=>this.buildStyles()),this.buildStyles()}buildStyles(){let i="",s=e.ObjectUtils.getType(this);for(;s!=t;){let t=e.ObjectUtils.getTypeName(s);i+=e.ViewUtils.formatForCss(t)+" ",s=e.ObjectUtils.getBaseType(s)}this.name&&(i+=e.ViewUtils.formatForCss(this.name)+" "),this.styles&&(i+=this.styles.join(" ")),this.className=i.trim()}get debugName(){return e.ObjectUtils.getTypeName(this)+": "+this.name}}e.ViewComponent=t}(WebApp||(WebApp={})),function(e){class t extends e.ViewComponent{constructor(t){super(t),this.actions=observableListOf(),this.mainAction="none",this.navigationMenu=null,this.title=null,this.icon=null,this.selectionManager=null,this.bindConfig("mainAction",t),this.bindConfig("navigationMenu",t),this.bindConfigString("title",t,e.StringUsage.Title),this.bindConfig("icon",t),this.actions.subscribe({onItemAdded:this.onActionAdded.bind(this),onItemRemoved:this.onActionRemoved.bind(this)}),t&&(t.actions&&t.actions.forEach(e=>this.addAction(e)),t.onBack&&(this.back=t.onBack))}onActionRemoved(e){e&&e.parentView==this&&(e.parentView=null)}onActionAdded(e){e&&(e.parentView=this)}showNavigationMenu(){return __awaiter(this,void 0,void 0,(function*(){this.navigationMenu&&(yield this.navigationMenu.showAsync())}))}addAction(t){this.actions.add(e.ActionView.fromActionIcon(t))}back(){}startSelection(){return this.selectionManager||(this.selectionManager=new e.SelectionManager),this.selectionManager.isActive=!0,this.selectionManager}}e.ActionBar=t}(WebApp||(WebApp={})),function(e){class t extends e.ViewComponent{constructor(e){super(e),this.content=null,this.contentTemplate=null,this.bindConfig("content",e,null,()=>this.onContentChanged()),this.bindConfig("contentTemplate",e)}onContentChanged(){e.TypeCheck.isView(this.content)&&(this.content.parentView=this)}}e.ContentView=t}(WebApp||(WebApp={})),function(e){let t;!function(e){e[e.None=0]="None",e[e.Parallel=1]="Parallel",e[e.Serial=2]="Serial"}(t=e.AggregationMode||(e.AggregationMode={}));class i extends e.ContentView{constructor(s){super(Object.assign({template:"ActionLink"},s)),this.tooltip=null,this.operation=e.OperationType.Global,this.canAggregate=t.None,this.subActions=observableListOf(),this.bindConfigString("tooltip",s,e.StringUsage.Tooltip),this.bindConfig("operation",s),this.bindConfig("canAggregate",s),s&&(s.executeAsync&&(this.executeWorkAsync=s.executeAsync),s.subActions&&s.subActions.forEach(e=>this.subActions.add(new i(e))))}executeAsync(){return __awaiter(this,void 0,void 0,(function*(){window.event&&window.event.stopPropagation();var t=e.Operation.begin({message:"Executing "+this.name,type:this.operation});this.status="executing";try{if(yield this.executeWorkAsync(),this.subActions.count>0){let t=new e.ContextMenu;this.subActions.forEach(e=>t.actions.add(e)),t.showAsync(window.event.srcElement)}}catch(t){throw e.app.handleError(this,t),t}finally{this.status="",t.end()}}))}executeWorkAsync(){return Promise.resolve()}static fromAction(t,s){var n;const a=new i(Object.assign({name:t.name,operation:t.operation,styles:t.styles,template:"ActionLink",content:new e.IconTextView({template:"IconTextViewInline",text:e.Format.action(null!==(n=t.displayName)&&void 0!==n?n:t.name),icon:t.icon}),executeAsync:t.executeAsync},s));return t.canExecute&&e.Properties.converter(a,"visible",()=>t.canExecute()),a}static fromItemAction(t,s,n){var a;const o=new i(Object.assign({name:t.name,operation:t.operation,styles:t.styles,content:new e.IconTextView({template:"IconTextViewInline",text:e.Format.action(null!==(a=t.displayName)&&void 0!==a?a:t.name),icon:t.icon}),executeAsync:()=>t.executeAsync(s())},n));return t.canExecute&&o.bind("visible",o.createComputed(()=>t.canExecute(s()))),o}static fromActionIcon(e,t){var s;const n=new i(Object.assign({name:e.name,styles:e.styles,operation:e.operation,template:"ActionIcon",content:e.icon,tooltip:null!==(s=e.displayName)&&void 0!==s?s:e.name,executeAsync:e.executeAsync},t));return e.canExecute&&n.bind("visible",n.createComputed(()=>e.canExecute())),n}}e.ActionView=i}(WebApp||(WebApp={})),function(e){class t extends e.View{constructor(e){super(e),this._isVisible=!1,this.className=null,this.bindConfig("className",e),this._container=document.createElement("DIV"),this._container.className=this.className+"-container"}showAsync(){return __awaiter(this,void 0,void 0,(function*(){if(this._isVisible)return;return this._isVisible=!0,e.app.unblock(!0),new e.TemplateBuilder(this,this._container).template(this.template,e=>e),document.body.appendChild(this._container),yield e.PromiseUtils.delay(0),this._container.classList.add("visible"),new Promise(e=>this._showResolve=e)}))}hide(t){this._isVisible&&(this._isVisible=!1,e.app.restoreBlock(),this._container.classList.remove("visible"),this._showResolve&&(this._showResolve(t),this._showResolve=null),setTimeout(()=>{this._isVisible||document.body.removeChild(this._container)},500))}}e.BasePopUpMessage=t}(WebApp||(WebApp={})),function(e){class t extends e.ViewComponent{constructor(){super(),this.status="hide",new e.TemplateBuilder(this,document.body).content(this)}attach(e){this._element=e,e.onmousedown=e=>e.preventDefault(),e.ontouchstart=e=>e.preventDefault(),"hide"==this.status&&(this._element.style.display="none")}showAsync(){return __awaiter(this,void 0,void 0,(function*(){this._element&&this._element.style.removeProperty("display"),this.status="showing",yield e.PromiseUtils.delay(0),"showing"==this.status&&(this.status="show")}))}hideAsync(){return __awaiter(this,void 0,void 0,(function*(){this.status="hiding",yield e.PromiseUtils.delay(500),"hiding"==this.status&&(this.status="hide",this._element&&(this._element.style.display="none"))}))}}e.Blocker=t}(WebApp||(WebApp={})),function(e){class t extends e.ContentView{constructor(e){super(Object.assign({template:"BottomSheet"},e)),this._margin=20,this._isAnimating=0,this.isShowOpener=!1,this.headHeight=100,this.headSelector=null,this.status="close",this.bindConfig("headHeight",e),this.bindConfig("headSelector",e),this.bindConfig("isShowOpener",e)}attach(e){this._element=e;let t=new Hammer(e,{recognizers:[[Hammer.Pan,{direction:Hammer.DIRECTION_VERTICAL}]]}),i=0,s=this.status,n=0;switch(t.on("panstart",t=>{s=this.status,this.status="moving",n=e.scrollTop,i=e.clientHeight}),t.on("panend",t=>{e.clientHeight<this.headHeight-this._margin?this.close():"open"==s?t.deltaY>this._margin&&this._element.scrollTop<=0?this.head():this.open():e.clientHeight>this.headHeight+this._margin?this.open():this.head()}),t.on("panmove",t=>{let a=t.deltaY;if("open"==s){let e=n-a;if(a<0)return void(this._element.scrollTop=e);if(e>=0)return void(this._element.scrollTop=e);this._element.scrollTop=0,a=-e}let o=i-a,r=o,l=!1;o<this._margin?o=0:o>e.parentNode.clientHeight-this._margin&&o<this._element.scrollHeight?(o=e.parentNode.clientHeight,l=!0):o>this._element.scrollHeight?o=this._element.scrollHeight:o>this.headHeight-this._margin&&o<this.headHeight+this._margin&&(o=this.headHeight),e.style.height=o+"px",this._element.scrollTop=r-o>0&&l?r-o:0}),this.status){case"head":this.head();break;case"open":this.open();break;case"close":this.close()}}setHeightAsync(t){return __awaiter(this,void 0,void 0,(function*(){this._isAnimating++,1==this._isAnimating&&this._element.classList.add("animate"),yield e.PromiseUtils.delay(0),this._element.style.height=t.toString()+"px",yield e.PromiseUtils.delay(500),this._isAnimating--,0==this._isAnimating&&this._element.classList.remove("animate")}))}toggle(){"open"==this.status||"close"==this.status?this.head():this.open()}open(){this.status="open",this._element&&this.setHeightAsync(this._element.scrollHeight)}head(){if(this.status="head",this._element){if(this.headSelector){let e=this._element.querySelector(this.headSelector);e&&(this.headHeight=e.clientHeight,this.isShowOpener&&(this.headHeight+=this._element.querySelector(".opener").clientHeight))}this.setHeightAsync(this.headHeight)}}close(){this.status="close",this._element&&this.setHeightAsync(0)}}e.BottomSheet=t}(WebApp||(WebApp={})),function(e){class t extends e.View{constructor(e){super(),this.content=e}}class i extends t{constructor(e,...t){super(t),this.type=e,this.template="ConsoleMessageView"}}e.ConsoleMessageView=i;class s extends t{constructor(...e){super(e),this.items=observableListOf(),this.template="ConsoleGroupView"}}e.ConsoleGroupView=s;class n extends e.ViewComponent{constructor(){super(),this._groups=[],this._isCreated=!1,this.root=new s,this._activeGroup=this.root}show(){this._isCreated||new e.TemplateBuilder(this,document.body).content(this);this.visible=!0}hide(){this.visible=!1}attach(){if(!this._oldConsole){this._oldConsole={};for(let e in console)this._oldConsole[e]=console[e];console.log=(...e)=>this.write("log",e),console.warn=(...e)=>this.write("warn",e),console.info=(...e)=>this.write("info",e),console.trace=(...e)=>this.write("trace",e),console.error=(...e)=>this.write("error",e),console.debug=(...e)=>this.write("debug",e),console.clear=()=>this.clear(),console.group=(...e)=>this.group(e),console.groupEnd=()=>this.groupEnd()}}detach(){if(this._oldConsole){for(let e in console)console[e]=this._oldConsole[e];this._oldConsole=null}}write(e,t){this._oldConsole[e].apply(console,t),this._activeGroup.items.add(new i(e,t)),"error"==e&&this._activeGroup.items.add(new i(e,(new Error).stack))}group(e){this._oldConsole.group.apply(console,e);const t=new s(e);this._activeGroup.items.add(t),this._groups.push(t),this._activeGroup=t}groupEnd(){this._oldConsole.groupEnd.apply(console),this._groups.length>0&&(this._activeGroup=this._groups.pop())}clear(){this._oldConsole.clear.apply(console),this._groups=[],this.root.items.clear(),this._activeGroup=this.root}}e.ConsoleView=n}(WebApp||(WebApp={})),function(e){class t extends e.ContentView{constructor(t){super(Object.assign({template:"Container"},t)),this.title="",this.isOverflow=!0,this.canExpand=!1,this.isExpanded=!0,this.bindConfigString("title",t,e.StringUsage.Title),this.bindConfig("isExpanded",t),this.bindConfig("canExpand",t),this.prop("content").subscribe(()=>this.checkOverflow())}attach(e){this._element=e,this.canExpand&&(this._element.addEventListener("resize",()=>this.checkOverflow()),this.checkOverflow())}checkOverflow(){if(null!=this._element){const e=this._element.querySelector(".content-wrapper");null!=e&&(this.isOverflow=e.scrollHeight>e.clientHeight,this.isOverflow||(this.isExpanded=!0))}}onContentChanged(){}toggleExpand(){this.isExpanded=!this.isExpanded}}e.Container=t}(WebApp||(WebApp={})),function(e){class t extends e.ContentView{constructor(e){super(Object.assign({content:observableListOf()},e)),this._updateCount=0,this.emptyView=null,this.content.subscribe({onItemAdded:e=>{0==this._updateCount&&this.onItemAdded(e)},onItemRemoved:e=>{0==this._updateCount&&this.onItemRemoved(e)}}),this.bindConfig("emptyView",e)}initItems(){this.content&&this.content.toArray().forEach(e=>this.onItemAdded(e))}beginUpdate(){this._updateCount++}endUpdate(){this._updateCount--}onItemAdded(e){}onItemRemoved(e){}}e.ItemsView=t}(WebApp||(WebApp={})),function(e){class t extends e.ItemsView{constructor(e){super(Object.assign({template:"ItemsView"},e)),(null==e?void 0:e.viewContent)&&(Array.isArray(e.viewContent)?e.viewContent.forEach(e=>this.addView(e)):this.addView(e.viewContent))}loadAsync(){return e.ViewUtils.loadAllAsync(this.content)}clear(){this.content.clear()}addView(e){return this.content.add(e),e}removeView(e){this.content.remove(e)}replaceView(t,i){let s;s=e.TypeCheck.isString(t)?e.linq(this.content).indexOf(e=>"name"in e&&e.name==t):this.content.indexOf(t),-1!=s&&this.content.set(s,i)}onItemAdded(e){e&&(e.parentView=this)}onItemRemoved(e){e&&e.parentView==this&&(e.parentView=null)}}e.Panel=t}(WebApp||(WebApp={})),function(e){class t extends e.Panel{constructor(t){super(Object.assign({},t)),this.title=null,this.actionTemplate="ActionButton",this.contentProvider=null,this.bindConfig("contentProvider",t),this.bindConfig("actionTemplate",t),this._body=new e.Panel({name:"body"}),this._actions=new e.Panel({name:"actions"}),this.addView(this._body),this.addView(this._actions),this._body.emptyView=this.emptyView,this.emptyView=null}loadAsync(){return __awaiter(this,void 0,void 0,(function*(){if(this.contentProvider){yield this.closeAsync();const t=yield this.contentProvider.getContentAsync(this);t.styles&&(this._body.styles=t.styles),this.name=this.contentProvider.info.name,this.title=e.Format.title(t.title),t.views.forEach(e=>this._body.addView(e)),t.actions&&t.actions.forEach(e=>this.addAction(e)),yield e.Panel.prototype.loadAsync.call(this),this.contentProvider.activateAsync&&(yield this.contentProvider.activateAsync())}this._actions.visible=this._actions.content.count>0}))}addAction(t){this._actions.addView(e.ActionView.fromAction(t,{template:this.actionTemplate}))}notifyContentChanged(e){this.loadAsync()}closeAsync(e){var t;return __awaiter(this,void 0,void 0,(function*(){return(null===(t=this.contentProvider)||void 0===t?void 0:t.deactivateAsync)&&(yield this.contentProvider.deactivateAsync()),this._body.clear(),this._actions.clear(),this.title=null,!0}))}}e.ContentHostView=t}(WebApp||(WebApp={})),function(e){class t extends e.BindableObject{constructor(e){super(),this.actions=observableListOf(),this.className="context-menu",e&&e.actions&&e.actions.forEach(e=>this.addAction(e)),this._menuContainer=document.createElement("DIV"),this._menuContainer.className="popup-container",this._clickHandler=this.onClick.bind(this)}addAction(t){this.actions.add(e.ActionView.fromAction(t))}showAsync(t,i){return __awaiter(this,void 0,void 0,(function*(){let s={x:0,y:0};!t&&i&&(t=i.srcElement,s.x=i.offsetX,s.y=i.offsetY),new e.TemplateBuilder(this,this._menuContainer).template("ContextMenu",e=>e),document.body.appendChild(this._menuContainer),yield e.PromiseUtils.delay(0),window.addEventListener("mouseup",this._clickHandler);let n=t,a=t;for(;n;)n==a&&(s.y+=n.offsetTop,s.x+=n.offsetLeft,a=n.offsetParent),s.y-=n.scrollTop,s.x-=n.scrollLeft,n=n.parentElement;let o="",r="";s.x+this._menuContainer.clientWidth>document.body.clientWidth?(s.x-=this._menuContainer.clientWidth,o="right"):o="left",s.y+this._menuContainer.clientHeight>document.body.clientHeight?(s.y-=this._menuContainer.clientHeight,r="bottom"):r="top",this._menuContainer.style.top=s.y+"px",this._menuContainer.style.left=s.x+"px",this._menuContainer.style.transformOrigin=o+" "+r,yield e.PromiseUtils.delay(0),this._menuContainer.classList.add("visible")}))}hide(){this._menuContainer.classList.remove("visible"),window.removeEventListener("mouseup",this._clickHandler),setTimeout(()=>document.body.removeChild(this._menuContainer),500)}onClick(e){setTimeout(()=>this.hide(),0)}}e.ContextMenu=t}(WebApp||(WebApp={})),function(e){class t extends e.ContentView{constructor(e){super(Object.assign({template:"CounterView"},e)),this.title=null,this.value=0,this.bindConfig("value",e),this.bindConfig("title",e),this.prop("value").subscribe(()=>this.animate()),null!=this.value&&this.animate()}animate(){this.content=0;let t=this.value/200;return e.Animation.animate({timeFunction:e.Animation.linear(),duration:isNaN(t)||t<1?1:t,stepTime:.05,step:e=>this.content=Math.round(this.value*e)})}}e.CounterView=t}(WebApp||(WebApp={})),function(e){class t{constructor(t,i){this.actions=observableListOf(),this.label=null,this._host=t,i&&(this.label=e.DynamicString.getValue(i.label),i.actions.forEach(e=>this.addAction(e)))}addAction(t){const i=e.ActionView.fromAction(t,{executeAsync:()=>__awaiter(this,void 0,void 0,(function*(){this._host.hideAsync(),yield t.executeAsync()}))});return this.actions.add(i),i}}e.DrawerGroup=t;class i extends e.View{constructor(e){super(Object.assign({template:"Drawer"},e)),this.status="hidden",this.header=null,this.groups=observableListOf(),this.bindConfig("header",e),e&&e.groups.forEach(e=>this.addGroup(e))}addGroup(e){const i=new t(this,e);return this.groups.add(i),i}attach(e){let t=e.querySelector(".drawer");new Hammer(t,{recognizers:[[Hammer.Swipe,{direction:Hammer.DIRECTION_HORIZONTAL}]]}).on("swipeleft",e=>{this.hideAsync()}),e.addEventListener("click",e=>{e.srcElement==e.currentTarget&&this.hideAsync()})}showAsync(t){return __awaiter(this,void 0,void 0,(function*(){this.status="showing",yield e.PromiseUtils.delay(0),this.status="visible"}))}hideAsync(){return __awaiter(this,void 0,void 0,(function*(){this.status="hiding",yield e.PromiseUtils.delay(500),"hiding"==this.status&&(this.status="hidden")}))}}e.Drawer=i}(WebApp||(WebApp={})),function(e){class t extends e.ViewComponent{constructor(e){super(e),this.progress=0,this.text=null,this.progressText=null,this.status="empty",this.error=null,this.isSelected=!1,this._input=document.createElement("input"),this._input.type="file",this._input.addEventListener("change",()=>{this.update(),(null==e?void 0:e.onChanged)&&e.onChanged()}),this.update()}update(){let e=this._input.files[0];e?(this.text=e.name,this.status="selected"):(this.text="Seleziona file",this.status="empty"),this.isSelected=null!=this._input.files[0]}select(){this._input.click()}remove(){}uploadAsync(t){return __awaiter(this,void 0,void 0,(function*(){this.status="uploading";let i=yield e.Http.postBinaryAsync(t,this._input.files[0],e=>{this.progress=e.loaded/e.total});return this.status="uploaded",i}))}get file(){return this._input.files&&0!=this._input.files.length?this._input.files[0]:null}}e.FileUploadView=t}(WebApp||(WebApp={})),function(e){class t extends e.ItemsView{constructor(t){super(Object.assign({template:"ListView",styles:["default"]},t)),this._isLoaded=!1,this._itemViewMap=new Map,this.header=observableListOf(),this.footer=observableListOf(),this.itemsSource=null,this.itemsLoader=null,this.items=null,this.selectedItem=null,this.status="",this.selectionMode="none",this.showSeparator=!1,this.filter=null,this.bindConfig("itemsSource",t),this.bindConfig("items",t),this.bindConfig("filter",t),this.bindConfig("selectionMode",t),t&&(t.itemsLoader&&(this.itemsLoader=t.itemsLoader),void 0!==t.showSeparator&&(this.showSeparator=t.showSeparator),t.createItemView&&(this.createItemViewWork=t.createItemView),t.header&&this.header.addRange(t.header),t.footer&&this.footer.addRange(t.footer)),(null==t?void 0:t.items)||(this.items=observableListOf()),!this.itemsLoader&&this.itemsSource&&(this.itemsLoader=e.FullItemsLoader.instance),t&&t.isAutoLoad&&this.loadAsync();const i={onClear:()=>{this.selectedItem=null,this._itemViewMap.clear(),this.content.clear()},onItemAdded:(e,t,i)=>{"replace"!=i&&this.content.insert(t,this.createItemView(e))},onItemRemoved:(e,t,i)=>{"remove"==i&&this.content.removeAt(t)},onItemReplaced:(e,t,i)=>this.content.set(i,this.createItemView(e)),onItemSwap:(e,t)=>this.content.swap(e,t)};this.prop("items").subscribe((e,t)=>{if(null!=t&&t.unsubscribe(i),this.content.clear(),e){e.subscribe(i);for(let t of e)this.content.add(this.createItemView(t));this.status="loaded"}}),this.prop("items").notifyChanged(),this.prop("selectedItem").subscribe((e,i)=>{"single"==this.selectionMode&&this.updateItemSelection(i,!1),"none"!=this.selectionMode&&(this.updateItemSelection(e,!0),(null==t?void 0:t.onSelectdItemChanged)&&t.onSelectdItemChanged(e))}),(null==t?void 0:t.isListenerActive)&&this.activateListener()}activateListener(){var t;(null===(t=this.itemsSource)||void 0===t?void 0:t.typeName)&&(this._listener||(this._listener={onItemAdded:e=>this.refreshAsync(),onItemRemoved:e=>{e.value&&this.items.removeWhen(t=>this.itemsSource.equals(this.itemsSource.getItemValue(t),e.value))},onItemChanged:t=>__awaiter(this,void 0,void 0,(function*(){let i=e.linq(this.items).indexOf(e=>this.itemsSource.equals(this.itemsSource.getItemValue(e),t.value));if(-1!=i){const e=yield this.itemsSource.getItemByValueAsync(t.value);e&&this.items.set(i,e)}}))}),e.Services.itemsObserver.register(this.itemsSource.typeName,this._listener))}deactivateListener(){this._listener&&e.Services.itemsObserver.unregister(this.itemsSource.typeName,this._listener)}updateItemSelection(t,i){let s=this.findItemView(t);e.TypeCheck.isSelectable(s)&&(s.isSelected=i)}findItemView(t){return t?e.linq(this._itemViewMap.entries()).where(e=>e[1]==t).select(e=>e[0]).first():null}addItem(e){this.items.add(e)}clear(){this.items.clear()}loadAsync(){return __awaiter(this,void 0,void 0,(function*(){this._isLoaded||this.refreshAsync()}))}refreshAsync(){return __awaiter(this,void 0,void 0,(function*(){let t=this.selectedItem;this.itemsLoader&&(this.beginUpdate(),yield this.itemsLoader.loadItemsAsync(this,25),this.endUpdate()),this._isLoaded=!0,t&&this.itemsSource?this.selectedItem=e.linq(this.items).first(e=>this.itemsSource.itemComparer(e,t)):this.selectedItem=null}))}onItemRemoved(e){if(e){e.parentView==this&&(e.parentView=null),this._itemViewMap.get(e)==this.selectedItem&&(this.selectedItem=null),this._itemViewMap.delete(e)}}createItemView(t){let i=this.createItemViewWork(t);return i&&(i.parentView=this,this._itemViewMap.set(i,t),e.TypeCheck.isSelectable(i)&&i.prop("isSelected").subscribe(e=>{e&&(this.selectedItem=t)})),i}createItemViewWork(t){let i=e.Services.views[e.ObjectUtils.getTypeName(t)];return i?i(t):new e.TextView({content:this.itemsSource?this.itemsSource.getItemText(t):t.toString()})}onScroll(e){"onScroll"in this.itemsLoader&&this.itemsLoader.onScroll(e)}get itemsCount(){return this.content.count}get isScrollCheckActive(){return this.itemsLoader&&"onScroll"in this.itemsLoader}}e.ListView=t}(WebApp||(WebApp={})),function(e){class t extends e.ListView{constructor(e){super(Object.assign({styles:["grid"]},e)),this.colsCount=0,this.rowsCount=0,this.bindConfig("colsCount",e),this.bindConfig("rowsCount",e)}}e.GridView=t}(WebApp||(WebApp={})),function(e){class t extends e.ContentView{constructor(e){super(e),this.header=null,this.headerTemplate=null,this.bindConfig("header",e)}}e.HeadedContentView=t}(WebApp||(WebApp={})),function(e){class t extends e.ContentView{constructor(e){super(Object.assign({template:"Html"},e))}}e.HtmlView=t}(WebApp||(WebApp={})),function(e){class t extends e.ViewComponent{constructor(e){super(e),this.icon=null,this.text=null,this.bindConfig("icon",e),this.bindConfigString("text",e)}}e.IconTextView=t}(WebApp||(WebApp={})),function(e){class t extends e.ContentView{constructor(e){super(Object.assign({template:"Image"},e))}loadAsync(){return this.content?e.ImageLoader.loadAsync(this.content):Promise.resolve()}}e.ImageView=t}(WebApp||(WebApp={})),function(e){class t extends e.Panel{constructor(t){super(Object.assign({template:"ItemView"},t)),this.item=null,this.contextActions=[],this.mainActions=[],this.status=null,this.canOpen=!1,this.hasActions=null,this.bindConfig("item",t),this.bindConfig("canOpen",t),t&&(t.open&&(this.openWork=t.open),t.actions&&t.actions.forEach(e=>this.addAction(e)),t.itemTemplate&&this.content.add(new e.View({template:e=>e.template(t.itemTemplate,this)}))),this.computed("hasActions",t=>e.linq(t.contextActions).any(e=>e.visible)),this.create()}addAction(t){const i=e.ActionView.fromItemAction(t,()=>this.item);t.priority==e.ActionPriority.Primary?this.mainActions.length>=3?(this._otherAction||(this._otherAction=e.ActionView.fromAction({name:"other",icon:"fas fa-ellipsis-h",operation:e.OperationType.Local,executeAsync:()=>Promise.resolve()}),this._otherAction.subActions.add(this.mainActions.pop()),this.mainActions.push(this._otherAction)),this._otherAction.subActions.add(i)):this.mainActions.push(i):(this.contextActions.push(i),this.prop("hasActions").notifyChanged())}create(){}open(){this.canOpen&&this.openWork()}openWork(){}showMenu(){let t=new e.ContextMenu;this.contextActions.forEach(e=>t.actions.add(e)),t.showAsync(window.event.srcElement)}}e.ItemView=t}(WebApp||(WebApp={})),function(e){class t extends e.ContentView{constructor(e){super(Object.assign({template:"LocationView"},e)),this.mapSize={width:1280,height:720},this.zoomLevel=16,e&&(e.mapSize&&(this.mapSize=e.mapSize),e.zoomLevel&&(this.zoomLevel=e.zoomLevel)),this.updateAsync()}onContentChanged(){this.updateAsync()}showMap(){e.Actions.maps(this.content)}updateAsync(){return __awaiter(this,void 0,void 0,(function*(){let t=e.Services.mapManager(),i=this.content.position;i||(i=yield t.getLocationAsync(this.content.address)),this.map=t.staticMap({center:i,size:this.mapSize,zoomLevel:this.zoomLevel,pins:[{center:i,icon:113,name:this.content.name}]})}))}}e.LocationView=t}(WebApp||(WebApp={})),function(e){class t extends e.ItemsView{constructor(t){super(Object.assign({template:"Attach"},t)),this.itemsSource=null,this.status="",this.selectedItem=null,this.mapReady=new e.Signal,this.bindConfig("itemsSource",t),t&&(t.manager&&(this._manager=t.manager),t.createMapItem&&(this.createMapItem=t.createMapItem)),this._manager||(this._manager=e.Services.mapManager()),this.prop("selectedItem").subscribe(e=>{this._manager.selectedItem=e?e["@mapItem"]:null,t&&t.onItemSelected&&t.onItemSelected(e)}),this._manager.onSelectionChanged=()=>{this._manager.selectedItem?this.selectedItem=this._manager.selectedItem["@item"]:this.selectedItem=null}}loadItemsAsync(t){return __awaiter(this,void 0,void 0,(function*(){if(!this.itemsSource)return;this.beginUpdate(),this.content.clear(),this.status="loading";let i=e.Operation.begin({message:"Loading items",type:e.OperationType.Local});try{let e=yield this.itemsSource.getItemsAsync(t);e&&e.forEach(e=>this.content.add(e)),this.mapReady.isSet&&this.initItems()}finally{i.end(),this.status="",this.endUpdate()}}))}attach(t){e.Operation.progress("Map attacched"),this._manager&&this._manager.attach(t),this.mapReady.set(),"loading"!=this.status&&this.initItems()}initItems(){let t=e.linq(this.content).select(e=>this.createMapItem(e)).toArray(),i=this._manager.addItems(t);for(let t=0;t<i.length;t++)e.ObjectUtils.set(this.content.get(t),"@mapItem",i[t]),e.ObjectUtils.set(i[t],"@item",this.content.get(t))}createMapItem(e){}onItemAdded(t){if(!this.mapReady.isSet)return;let i=this.createMapItem(t);if(!i.location||isNaN(i.location.latitude)||isNaN(i.location.longitude))return void console.warn("Invalid location for "+i.title);let s=this._manager.addItems([i]);e.ObjectUtils.set(t,"@mapItem",s),e.ObjectUtils.set(s,"@item",t)}onItemRemoved(t){if(!this.mapReady.isSet)return;let i=e.ObjectUtils.get(t,"@mapItem");i&&this._manager.removeItem(i)}get manager(){return this._manager}}e.MapItemsView=t}(WebApp||(WebApp={})),function(e){class t extends e.ViewComponent{constructor(t){super(Object.assign({template:"Attach"},t)),this.mapReady=new e.Signal,t&&(t.onMapLoaded&&(this.onMapLoaded=t.onMapLoaded),t.manager&&(this.manager=t.manager)),this.manager||(this.manager=e.Services.mapManager())}attach(e){this.manager&&this.manager.attach(e),this.mapReady.set(),this.onMapLoaded()}onMapLoaded(){}}e.MapView=t}(WebApp||(WebApp={})),function(e){class t extends e.ContentView{constructor(e){super(Object.assign({template:"MediaView"},e)),this._imageConfig={},this._videoConfig={},this.activeView=null,e&&(e.image&&(this._imageConfig=e.image),e.video&&(this._videoConfig=e.video)),this.updateContent()}loadAsync(){return this.activeView?this.activeView.loadAsync():Promise.resolve()}onContentChanged(){this.updateContent()}updateContent(){this.content&&"image"==this.content.type&&(this.activeView=new e.ImageView(Object.assign(Object.assign({},this._imageConfig),{content:this.content.src}))),this.content&&"video"==this.content.type&&(this.activeView=new e.VideoView(Object.assign(Object.assign({},this._videoConfig),{content:this.content.src})))}}e.MediaView=t}(WebApp||(WebApp={})),function(e){class t extends e.BasePopUpMessage{constructor(t){super(Object.assign({template:"MessageBox",className:"message-box"},t)),this.actions=observableListOf(),this.message=null,this.title=null,this.icon=null,this.bindConfigString("title",t,e.StringUsage.Title),this.bindConfigString("message",t,e.StringUsage.Message),this.bindConfig("icon",t),t&&t.actions&&t.actions.forEach(e=>this.addAction(e))}addAction(t){const i=[];t.priority==e.ActionPriority.Evidence&&i.push("primary"),this.actions.add(e.ActionView.fromAction(t,{template:"ActionButton",styles:i,executeAsync:()=>__awaiter(this,void 0,void 0,(function*(){yield t.executeAsync(),this.hide(t.name)}))}))}}e.MessageBox=t}(WebApp||(WebApp={})),function(e){class t extends e.IconTextView{constructor(e){super(e),this.name=null,this.status="",this.badge=null,this.behavoirs=[],this.content=null,this.prop("status"),this.bindConfig("badge",e),this.bindConfig("behavoirs",e),this.bindConfig("content",e),e&&(this.name=e.name)}select(){throw"Not implemented"}}e.NavBarItem=t;class i extends e.ItemsView{constructor(e){super(e),this.selectedItem=null,this.itemTemplate="IconTextView",this.itemBehavoirs=[],this.bindConfig("itemTemplate",e),this.bindConfig("itemBehavoirs",e),e&&(e.items&&e.items.forEach(e=>this.addItem(e)),e.onItemSelected&&(this.onSelectedItemChanged=(t,s)=>{i.prototype.onSelectedItemChanged.bind(this)(t,s),e.onItemSelected(t)})),this.bindConfig("selectedItem",e,{convertTo:e=>this.getItem(e),convertFrom:e=>e?e.name:void 0},this.onSelectedItemChanged)}getItem(t){return e.linq(this.content).first(e=>e.name==t)}selectItem(e){this.selectedItem=this.getItem(e)}addItem(e){let t=this.createItem(e);return this.content.add(t),t}createItem(e){let i=new t(Object.assign({template:this.prop("itemTemplate"),behavoirs:this.prop("itemBehavoirs")},e));return i.parentView=this,i.select=()=>this.selectedItem=i,i}onSelectedItemChanged(e,t){t&&(t.status=""),e&&(e.status="active")}}e.NavBar=i}(WebApp||(WebApp={})),function(e){class t extends e.BasePopUpMessage{constructor(t){super(Object.assign({template:"PopUpContent",className:"pop-up-content"},t)),this.contentProvider=null,this.actions=observableListOf(),this.contentView=new e.Panel,this.title=null,this.contentStyle=["vertical","fill-h","fit-items-h"],this.closeLabel="Cancel",this.bindConfig("contentProvider",t),this.bindConfig("contentStyle",t),this.bindConfigString("title",t),this.bindConfigString("closeLabel",t)}createAsync(){return __awaiter(this,void 0,void 0,(function*(){const t=yield this.contentProvider.getContentAsync(this);t.actions&&(this.addAction({name:"close",icon:"fas fa-close",displayName:this.closeLabel,executeAsync:()=>this.closeAsync()}),t.actions.forEach(e=>this.addAction(e))),t.title&&(this.title=e.DynamicString.getValue(t.title)),this.contentView.content.clear(),t.views&&t.views.forEach(e=>this.contentView.addView(e)),t.styles&&t.styles.length>0?this.contentView.styles=t.styles:this.contentView.styles=this.contentStyle}))}get result(){return new Promise(e=>this._resultResolve=e)}openAsync(){return __awaiter(this,void 0,void 0,(function*(){return yield this.createAsync(),this.showAsync(),this}))}notifyContentChanged(e){this.createAsync()}closeAsync(e){return this._resultResolve&&this._resultResolve(e),this.hide(""),Promise.resolve(!0)}addAction(t){let i=e.ActionView.fromAction(t);return t.priority==e.ActionPriority.Evidence&&(i.styles.push("primary"),i.buildStyles()),this.actions.add(i),i}}e.PopUpContent=t}(WebApp||(WebApp={})),function(e){class t extends e.ViewComponent{constructor(e){super(e)}}e.ProgressView=t}(WebApp||(WebApp={})),function(e){class t extends e.ViewComponent{constructor(t){super(Object.assign({template:"PropertyView"},t)),this._lastValidationValue=void 0,this.isDirty=null,this.isValid=!0,this.value=null,this.editor=null,this.error=null,this.label=null,this.readonly=!1,this.showLabel=!0,this.validators=[],this.bindConfig("editor",t),this.bindConfig("readonly",t),this.bindConfig("showLabel",t),this.bindConfig("value",t),this.bindConfigString("label",t,e.StringUsage.Label),this.prop("error"),t&&(t.onValueChanged&&this.prop("value").subscribe((e,i)=>t.onValueChanged(e,i)),t.validators&&(this.validators=t.validators)),this.prop("editor").subscribe(()=>this.bindEditor()),this.bindEditor()}bindEditor(){this.editor&&(this.editor.name=this.name,this.editor.value=this.value,this.bind("value",this.editor.prop("value")),this.bind("isDirty",this.editor.prop("isDirty")),"label"in this.editor&&(this.bind("label",this.editor.prop("label")),this.showLabel=!1),this.editor.prop("isValid").subscribe(e=>{e||(this.isValid=!1),this.error=this.editor.error}))}clearError(){this.editor.error=null,this.error=null}validateAsync(t,i){return __awaiter(this,void 0,void 0,(function*(){console.group("begin validation: "+this.label," - needValidation: ",this.isDirty);try{const s=this.editor instanceof e.NumberEditor?this.editor.value:this.editor.editValue;if(!i&&void 0!==this._lastValidationValue&&e.ObjectUtils.equals(this._lastValidationValue,s))return this.isValid;if(this.clearError(),this._lastValidationValue=s,!(yield this.editor.validateAsync(i)))return this.isValid=!1,this.error=this.editor.error,!1;const n={value:s,fieldName:this.label,target:t};for(let t of this.validators){const i=yield t.validateAsync(n);if(!i.isValid)return this.error=e.DynamicString.getValue(i.error,e.StringUsage.Message),this.isValid=!1,!1}return this.isValid=!0,!0}finally{console.groupEnd()}}))}loadAsync(){return this.editor.loadAsync()}clear(){this.editor.clear(),this.clearError()}}e.PropertyView=t}(WebApp||(WebApp={})),function(e){class t extends e.ContentView{constructor(e){super(e),this.item=null,this.bindConfig("item",e),e&&e.removeAsync&&(this.removeWorkAsync=e.removeAsync)}removeAsync(){return __awaiter(this,void 0,void 0,(function*(){this.status="removed",yield e.PromiseUtils.delay(150),yield this.removeWorkAsync()}))}removeWorkAsync(){throw"Not supported"}}e.RemovableItemView=t}(WebApp||(WebApp={})),function(e){class t extends e.ActionView{constructor(e){super(Object.assign({name:"search",template:"SearchView",content:"fas fa-search",tooltip:"Ricerca"},e)),this._lastSearchText=null,this.searchText=null,this.isExpanded=!1,this.hasFocus=!1,this.poolInterval=200,this.bindConfig("isExpanded",e),this.bindConfig("searchText",e),this.prop("hasFocus").subscribe(e=>this.onFocusChanged(e)),e&&(e.poolInterval&&(this.poolInterval=e.poolInterval),e.searchAsync&&(this.doSearchAsync=e.searchAsync))}onFocusChanged(e){e&&(this._lastSearchText=this.searchText,this.poolSearchTextAsync())}poolSearchTextAsync(){return __awaiter(this,void 0,void 0,(function*(){for(;this.hasFocus;)this.searchText!=this._lastSearchText&&(this._lastSearchText=this.searchText,yield this.searchAsync(this._lastSearchText)),yield e.PromiseUtils.delay(this.poolInterval)}))}executeWorkAsync(){return this.isExpanded||(this.isExpanded=!0,this.hasFocus=!0),Promise.resolve()}searchAsync(t){return __awaiter(this,void 0,void 0,(function*(){this.status="searching",yield e.PromiseUtils.delay(0);try{yield this.doSearchAsync(t)}finally{this.status="loaded"}}))}doSearchAsync(e){return Promise.resolve()}clear(){this.searchText=""}close(){this.isExpanded=!1}}e.SearchView=t}(WebApp||(WebApp={})),function(e){class t extends e.ContentView{constructor(t){super(t),"string"==typeof(null==t?void 0:t.header)&&(this.header=new e.TextView({content:t.header}))}}e.SectionView=t;class i extends e.ItemsView{constructor(e){super(e),(null==e?void 0:e.sections)&&e.sections.forEach(e=>this.content.add(new t(e)))}section(t){return e.linq(this.content).first(e=>e.name==t)}}e.SectionsView=i}(WebApp||(WebApp={})),function(e){class t extends e.ContentView{constructor(e){super(e),this.isSelected=!1,this.item=null,this.bindConfig("isSelected",e),this.bindConfig("item",e)}select(){this.isSelected=!0}toggle(){this.isSelected=!this.isSelected}}e.SelectableItemView=t}(WebApp||(WebApp={})),function(e){class t extends e.View{constructor(e){super(Object.assign({template:"SinglePageHost"},e)),this._parentHost=window.parent.WebApp.app.pageHost,this._parentPage=this._parentHost.current}get(e){return this._parentHost.get(e)}clearAsync(){return this.current=null,Promise.resolve()}goBackAsync(){return this._parentHost.goBackAsync()}goForwardAsync(){return this._parentHost.goForwardAsync()}bringFrontAsync(e){return e==this.current?Promise.resolve():this._parentHost.bringFrontAsync(e)}loadAsync(e,t){return this.current?this._parentHost.loadAsync(e,t):(e.host=this,this.current=e,e.loadAsync(),e.status="active",Promise.resolve(e))}find(t){if(this.current){if(e.TypeCheck.isString(t)&&t==e.ObjectUtils.getTypeName(this.current))return this.current;if(e.ObjectUtils.getType(this.current)==t)return this.current}return this._parentHost.find(t)}goToAsync(e){return __awaiter(this,void 0,void 0,(function*(){return this._parentHost.currentIndex=e,Promise.resolve()}))}get canGoBack(){return this._parentHost.canGoBack}get currentIndex(){return this._parentHost.currentIndex}set currentIndex(e){this._parentHost.currentIndex=e}get pageCount(){return this._parentHost.pageCount}}e.SelfHostedPageHost=t}(WebApp||(WebApp={})),function(e){class t extends e.IconTextView{constructor(e){super(e),this.subText=null,this.status=null,this.item=null,this.bindConfigString("subText",e),this.bindConfig("status",e),this.bindConfig("item",e)}}e.SimpleItemView=t}(WebApp||(WebApp={})),function(e){class t extends e.View{constructor(e){super(e),this._activeViewIndex=0,this.defaultTransaction="pop-up-down",this.activeTransaction="none",this.pageViews=[{content:null,className:null},{content:null,className:null}],this.clearAsync(),e&&e.defaultTransaction&&(this.defaultTransaction=e.defaultTransaction)}clearAsync(){this._pageStack=[],this._currentIndex=-1,this._activeViewIndex=0,this.pageViews[0].content=null,this.pageViews[0].className="immediate next",this.pageViews[1].content=null,this.pageViews[1].className="immediate prev"}goBackAsync(){return __awaiter(this,void 0,void 0,(function*(){this._currentIndex>0&&(yield this.goToAsync(this._currentIndex-1))}))}goForwardAsync(){return __awaiter(this,void 0,void 0,(function*(){this._currentIndex>0&&(yield this.goToAsync(this._currentIndex+1))}))}bringFrontAsync(t){return __awaiter(this,void 0,void 0,(function*(){let i=e.linq(this._pageStack).indexOf(e=>e.page==t);-1!=i&&(yield t.host.goToAsync(i))}))}loadAsync(t,i){return __awaiter(this,void 0,void 0,(function*(){if(this.current==t)return yield t.refreshAsync(),t;this.cancelHidePrev();let s=e.Operation.begin("Hosting new page");try{for(this.current&&e.Activity.isActivity(this.current)&&(yield this.current.deactivateAsync()),"clear"==(null==i?void 0:i.loadMode)&&(this._currentIndex=-1),"replace"==(null==i?void 0:i.loadMode)&&this.currentIndex>=0&&this._currentIndex--;this._pageStack.length>this._currentIndex+1;)this._pageStack.splice(this._pageStack.length-1,1);this._pageStack.push({page:t,options:i}),i&&i.transaction?this.activeTransaction=i.transaction:this.activeTransaction=this.defaultTransaction,this._currentIndex++,t.host=this,t.view.parentView=this,this.pageViews[this.backIndex].className="immediate next",yield e.PromiseUtils.delay(0),yield t.loadAsync(),this._currentIndex>0?(this.pageViews[this.backIndex].content=t.view,yield e.PromiseUtils.delay(0),this.pageViews[this.frontIndex].className="animate prev",this.pageViews[this.backIndex].className="animate active",this._activeViewIndex=this.backIndex,this.hidePrev()):(this.pageViews[this.frontIndex].content=t.view,this.pageViews[this.frontIndex].className="active"),t.status="active",e.Activity.isActivity(this.current)&&(yield this.current.activateAsync())}catch(t){e.app.handleError(this,t)}finally{s.end()}return t}))}get(e){return this._pageStack[e].page}goToAsync(t){return __awaiter(this,void 0,void 0,(function*(){if(t<0||t>=this._pageStack.length||t==this._currentIndex)return;this.cancelHidePrev();let i=e.Operation.begin("Going to "+t);try{e.Activity.isActivity(this.current)&&(yield this.current.deactivateAsync()),this.current.status="hidden";let s=this._pageStack[this._currentIndex].options;s&&s.transaction?this.activeTransaction=s.transaction:this.activeTransaction=this.defaultTransaction,this._currentIndex=t,this.current.view.parentView==this&&(this.current.view.parentView=null),this.pageViews[this.backIndex].content=this._pageStack[this._currentIndex].page.view,this.pageViews[this.backIndex].className="immmediate prev",yield e.PromiseUtils.delay(0),this.pageViews[this.frontIndex].className="animate next",this.pageViews[this.backIndex].className="animate active",this._activeViewIndex=this.backIndex,this.current.status="active",e.Activity.isActivity(this.current)&&(yield this.current.activateAsync()),this.hidePrev()}catch(t){e.app.handleError(this,t)}finally{i.end()}}))}cancelHidePrev(){this._hideTimerId&&(clearTimeout(this._hideTimerId),this._hideTimerId=null)}hidePrev(){this._hideTimerId=window.setTimeout(()=>{this._hideTimerId&&(this.pageViews[this.backIndex].className="prev hide")},4e3)}onActivePageChanged(){}onTransactionEnd(){}find(t){let i;if(i="string"==typeof t?e.linq(this._pageStack).first(e=>e.page.name==t):e.linq(this._pageStack).first(e=>Object.getPrototypeOf(e.page).constructor==t),i)return i.page}get current(){return-1==this._currentIndex?void 0:this._pageStack[this._currentIndex].page}get canGoBack(){return this._currentIndex>0}get frontIndex(){return this._activeViewIndex}get backIndex(){return(this._activeViewIndex+1)%2}get currentIndex(){return this._currentIndex}set currentIndex(e){this._currentIndex!=e&&this.goToAsync(e)}get pageCount(){return this._pageStack.length}}e.SlidePageHost=t}(WebApp||(WebApp={})),function(e){class t extends e.ViewComponent{constructor(){super({template:"SnackBar"}),this.action=null,this.content=null,this.showTime=e.TimeSpan.fromSeconds(0),this.instanceId=null,this.status="close",new e.TemplateBuilder(this,document.body).content(this)}showAsync(){return __awaiter(this,void 0,void 0,(function*(){if("open"!=this.status)return e.app.unblock(!0),yield e.PromiseUtils.delay(0),this.status="open",new Promise(e=>this._showResolve=e)}))}hide(t){"open"==this.status&&(this.status="close",e.app.restoreBlock(),this._showResolve&&(this._showResolve(t),this._showResolve=null))}static showAsync(i){const s=(new Date).valueOf();if(t.instance||(t.instance=new t),t.instance.content=i.content,t.instance.instanceId=s,i.action){let s;s="string"==typeof i.action?{name:i.action,executeAsync:()=>Promise.resolve()}:i.action,t.instance.action=e.ActionView.fromAction(s,{executeAsync:()=>__awaiter(this,void 0,void 0,(function*(){yield s.executeAsync(),t.instance.hide(s.name)}))})}else t.instance.action=null;return i.showTime&&setTimeout(()=>{t.instance.instanceId==s&&t.instance._isVisible&&t.instance.hide(null)},i.showTime.totalMilliseconds),t.instance.showAsync()}}t.instance=null,e.SnackBar=t}(WebApp||(WebApp={})),function(e){class t extends e.ViewComponent{constructor(e){super(Object.assign({template:"ImageView"},e)),this.bindConfig("options",e),this.update()}update(){this.content=e.Services.mapManager().staticMap(this.options)}}e.StaticMapView=t}(WebApp||(WebApp={})),function(e){class t extends e.ContentView{constructor(e){super(Object.assign({template:"TextContent"},e))}}e.TextView=t}(WebApp||(WebApp={})),function(e){class t extends e.ViewComponent{constructor(i){super(Object.assign({template:"Toast",visible:!1},i)),this.message=null,this.showTime=e.TimeSpan.fromSeconds(0),null==t._container&&t.init(),this.bindConfigString("message",i,e.StringUsage.Tooltip),this.bindConfig("showTime",i)}static init(){t._container=document.createElement("div"),t._container.className="toast-container",new e.TemplateBuilder(t._items,t._container).template("ToastContainer",e=>e),document.body.appendChild(t._container)}showAsync(){return __awaiter(this,void 0,void 0,(function*(){t._items.add(this),yield e.PromiseUtils.delay(10),this.visible=!0;let i=this.showTime.totalMilliseconds;return 0==i&&(i=Math.min(Math.max(70*this.message.length,2e3),7e3)),setTimeout(()=>this.hideAsync(),i),new Promise(e=>this._showResolve=e)}))}hideAsync(){return __awaiter(this,void 0,void 0,(function*(){this.visible=!1,yield e.PromiseUtils.delay(600),t._items.remove(this),this._showResolve&&(this._showResolve(),this._showResolve=null)}))}}t._items=observableListOf(),e.Toast=t}(WebApp||(WebApp={})),function(e){class t extends e.ContentView{constructor(e){super(Object.assign({template:"VideoView"},e)),this.isAutoPlay=!0,this.isMuted=!0,this.showControls=!1,this.isLoop=!0,this.bindConfig("isAutoPlay",e),this.bindConfig("isMuted",e),this.bindConfig("showControls",e),this.bindConfig("isLoop",e)}onContentChanged(){this.updateVideo()}attach(e){this._video=e,this.updateVideo()}loadAsync(){return this.content?this._video?e.VideoLoader.loadIntoAsync(this.content,this._video):e.VideoLoader.loadAsync(this.content):Promise.resolve()}updateVideo(){this._video&&(this._video.muted=this.isMuted,this._video.autoplay=this.isAutoPlay,this._video.controls=this.showControls,this._video.loop=this.isLoop,this.content&&this._video.load())}play(){this._video&&this._video.play()}pause(){this._video&&this._video.pause()}}e.VideoView=t}(WebApp||(WebApp={})),function(e){class t extends e.Page{constructor(t){super(t),this.view=new e.WebView,this.updateUrl(),this.prop("url").subscribe(()=>this.updateUrl())}updateUrl(){this.view.content=e.Uri.absolute(e.Format.replaceArgs(this.url,e.app.startupArgs))}loadWorkAsync(){return this.view.window&&"complete"!=this.view.window.document.readyState?new Promise((e,t)=>{this.view.window.addEventListener("load",(function t(i){this.view.window.removeEventListener("load",t),e()})),this.view.window.addEventListener("error",(function e(i){this.view.window.removeEventListener("error",e),t()}))}):Promise.resolve()}refreshAsync(){return this.view.window?new Promise((e,t)=>{this.view.window.addEventListener("load",(function t(i){this.view.window.removeEventListener("load",t),e()})),this.view.window.addEventListener("error",(function e(i){this.view.window.removeEventListener("error",e),t()})),this.view.window.document.location.reload()}):Promise.resolve()}closeAsync(){return __awaiter(this,void 0,void 0,(function*(){return this.view.window.close(),"goBackAsync"in this.host&&(yield this.host.goBackAsync()),!0}))}}e.WebPage=t}(WebApp||(WebApp={})),function(e){class t extends e.ContentView{constructor(e){super(Object.assign({template:"WebView"},e))}attach(e){this.window=e.contentWindow}}e.WebView=t}(WebApp||(WebApp={})),function(e){class t extends e.ContentView{constructor(t){super(Object.assign({template:"ContentView"},t)),this.error=null,this.isValid=!0,this.index=0,this.title="",this.isActive=!1,this.nextLabel=null,this.coverImage=null,this.actions=observableListOf(),this.bindConfig("index",t),this.bindConfig("coverImage",t),this.bindConfigString("title",t,e.StringUsage.Title),this.bindConfigString("nextLabel",t,e.StringUsage.Action),t&&(t.loadAsync&&(this.loadAsync=()=>t.loadAsync(this)),t.validateAsync&&(this.validateAsync=e=>t.validateAsync(this)),t.actions&&t.actions.forEach(e=>this.addAction(e)))}addAction(t){let i=e.ActionView.fromAction(t,{template:"ActionButton",styles:["primary"]});return this.actions.add(i),i}loadAsync(){return e.TypeCheck.isAsyncLoad(this.content)?this.content.loadAsync():Promise.resolve()}validateAsync(t){return __awaiter(this,void 0,void 0,(function*(){return e.TypeCheck.isValidable(this.content)&&(this.isValid=yield this.content.validateAsync(t)),this.isValid}))}select(){this.parentView.selectStepAsync(this.index)}}e.WizardStepView=t;class i extends e.ItemsView{constructor(i){super(Object.assign({template:"WizardView"},i)),this.currentStepIndex=-1,this.nextLabel="Next",this.prevLabel="Previous",this.finishLabel="Finish",this.actions={next:new e.ActionView({name:"next",template:"ActionButton",styles:["secondary"],content:new e.IconTextView({template:"IconTextViewInline",text:this.prop("nextLabel")}),executeAsync:()=>this.nextAsync()}),prev:new e.ActionView({name:"prev",template:"ActionButton",styles:["secondary"],content:new e.IconTextView({template:"IconTextViewInline",text:this.prop("prevLabel")}),executeAsync:()=>this.previousAsync()}),finish:new e.ActionView({name:"finish",template:"ActionButton",styles:["secondary"],content:new e.IconTextView({template:"IconTextViewInline",text:this.prop("finishLabel")}),executeAsync:()=>this.finishAsync()})},this.prop("currentStepIndex").subscribe((t,s)=>{var n;-1!=s&&(this.content.get(s).isActive=!1),this.content.get(t).isActive=!0,this.currentView=this.content.get(t),this.actions.next.visible=this.hasNextStep(),this.actions.prev.visible=this.hasPrevStep(),this.actions.finish.visible=!this.hasNextStep(),this.currentView.nextLabel?this.nextLabel=this.currentView.nextLabel:this.nextLabel=e.DynamicString.getValue(null!==(n=null==i?void 0:i.nextLabel)&&void 0!==n?n:e.Strings["wizard-next"],e.StringUsage.Action)}),this.bindConfigString("nextLabel",i,e.StringUsage.Action),this.bindConfigString("prevLabel",i,e.StringUsage.Action),this.bindConfigString("finishLabel",i,e.StringUsage.Action),i&&(i.steps&&(i.steps.forEach((e,i)=>this.content.add(new t(Object.assign(Object.assign({},e),{index:i})))),this.currentStepIndex=0),i.finishAsync&&(this.doFinishAsync=i.finishAsync)),(null==i?void 0:i.prevLabel)||(this.prevLabel=e.DynamicString.getValue(e.Strings["wizard-prev"],e.StringUsage.Action)),(null==i?void 0:i.finishLabel)||(this.prevLabel=e.DynamicString.getValue(e.Strings["wizard-finish"],e.StringUsage.Action))}finishAsync(){return __awaiter(this,void 0,void 0,(function*(){!0===(yield this.validateUntilAsync(this.content.count-1))&&(yield this.doFinishAsync())}))}doFinishAsync(){return __awaiter(this,void 0,void 0,(function*(){return Promise.resolve()}))}clearErrors(){}validateUntilAsync(e){return __awaiter(this,void 0,void 0,(function*(){let t=this.currentStepIndex;for(;t<=e;){if(!(yield this.content.get(t).validateAsync()))return t;t++}return!0}))}selectStepAsync(e){return __awaiter(this,void 0,void 0,(function*(){if(e!=this.currentStepIndex)if(this.clearErrors(),e>this.currentStepIndex){let t=yield this.validateUntilAsync(e-1);!0===t?(this.currentStepIndex=e,yield this.content.get(e).loadAsync()):(this.currentStepIndex=t,t!=this.currentStepIndex&&(yield this.content.get(t).loadAsync()))}else this.currentStepIndex=e}))}nextAsync(){return __awaiter(this,void 0,void 0,(function*(){this.currentStepIndex+1<this.content.count&&(yield this.selectStepAsync(this.currentStepIndex+1))}))}previousAsync(){return __awaiter(this,void 0,void 0,(function*(){this.currentStepIndex>0&&(yield this.selectStepAsync(this.currentStepIndex-1))}))}endAsync(){return __awaiter(this,void 0,void 0,(function*(){yield this.selectStepAsync(this.content.count-1)}))}hasPrevStep(){let e=this.currentStepIndex-1;for(;e>=0;){if(this.content.get(e).visible)return!0;e--}return!1}hasNextStep(){let e=this.currentStepIndex+1;for(;e<=this.content.count-1;){if(this.content.get(e).visible)return!0;e++}return!1}isComplete(){return!this.hasNextStep()}}e.WizardView=i}(WebApp||(WebApp={})),function(e){class t extends e.BindableObject{constructor(t){super(),this.editor=null,this.title=null,this.value=null,this.saveLabel="Save",this.saveOnCommit=!1,this.savePriority=null,this.styles=["vertical","scroll","fill-h","fit-items-h"],this.info={name:"item-edit",icon:"fas fa-edit",displayName:"Edit"},this.bindConfig("editor",t),this.bindConfig("value",t),this.bindConfig("styles",t),this.bindConfig("savePriority",t),this.bindConfig("saveOnCommit",t),this.bindConfigString("title",t,e.StringUsage.Title),this.bindConfigString("saveLabel",t,e.StringUsage.Action),t&&t.saveItemAsync&&(this.saveItemAsync=t.saveItemAsync)}getContentAsync(t){return __awaiter(this,void 0,void 0,(function*(){this._host=t,yield this.editor.beginEditAsync(this.value);const i=new e.Container({name:"editor-container",title:this.title,content:this.editor.view});e.TypeCheck.isActivable(this.editor)&&setTimeout(()=>this.editor.activateAsync(),200);const s=[];return this.saveOnCommit?this.editor.prop("value").subscribe(e=>this.saveAsync()):s.push({name:"save",icon:"fas fa-save",displayName:this.saveLabel,priority:this.savePriority,executeAsync:()=>this.saveAsync()}),Promise.resolve({views:[i],actions:s,styles:this.styles,title:this.title})}))}saveItemAsync(e){return Promise.resolve(e)}saveAsync(){return __awaiter(this,void 0,void 0,(function*(){if(this.saveOnCommit){if(!this.editor.isValid)return}else if(!(yield this.editor.commitAsync(!0)))return;const e=yield this.saveItemAsync(this.editor.value);null!=e&&(yield this._host.closeAsync(e))}))}}e.ItemEditContent=t}(WebApp||(WebApp={})),function(e){class t extends e.BindableObject{constructor(){super(),this._isRefreshing=!1}refreshAsync(){return __awaiter(this,void 0,void 0,(function*(){this._isRefreshing=!0;try{yield this._listView.refreshAsync()}finally{this._isRefreshing=!1}}))}deactivateAsync(){var e;return null===(e=this._listView)||void 0===e||e.deactivateListener(),Promise.resolve()}activateAsync(e){var t;return null===(t=this._listView)||void 0===t||t.activateListener(),this.refreshAsync()}getContentAsync(t){var i;return __awaiter(this,void 0,void 0,(function*(){const s=[],n=yield this.configureAsync(t);return this._listView=new e.ListView(Object.assign({itemsSource:n.itemsSource,itemsLoader:n.pageSize?new e.PagedItemsLoader({pageSize:n.pageSize}):void 0},n.listView)),n.filters&&(n.filters.length>1?(this._tabView=new e.NavBar({styles:["tab-view"],itemTemplate:"TextView",itemBehavoirs:["ripple"],onItemSelected:e=>{this._listView.filter=e.content,this.refreshAsync()},items:e.linq(n.filters).select(e=>({text:e.name,content:e.content})).toArray()}),s.push(this._tabView)):1==n.filters.length&&(this._listView.filter=n.filters[0].content)),s.push(this._listView),this._tabView&&(this._tabView.selectedItem=this._tabView.content.get(0)),n.footer&&n.footer.forEach(e=>s.push(e)),this._listView.activateListener(),Promise.resolve({title:null!==(i=n.title)&&void 0!==i?i:this.info.displayName,actions:n.actions,styles:n.styles,views:s})}))}}e.ItemListContent=t}(WebApp||(WebApp={})),function(e){e.MapContent=class{constructor(){}refreshAsync(){return null}getContentAsync(t){return __awaiter(this,void 0,void 0,(function*(){return this._mapView=new e.MapView({onMapLoaded:()=>this.onMapLoaded(),manager:e.Services.mapManager()}),this._progress=new e.ProgressView,{views:[this._mapView,this._progress],title:this.info.displayName}}))}createMapAsync(e){return Promise.resolve()}onMapLoaded(){return __awaiter(this,void 0,void 0,(function*(){yield this.createMapAsync(this._mapView.manager),this._progress.visible=!1}))}}}(WebApp||(WebApp={})),function(e){class t extends e.BindableObject{constructor(e){super(),this.details=null,this.minWidth=400,this.masterContent=null,this.styles=["horizontal","fill-v","fill-h","fill-items-v","master-details"],this.mode="auto",this.itemDisplayName=null,this.bindConfig("mode",e),this.bindConfig("masterContent",e),this.bindConfig("itemDisplayName",e),this.bindConfig("minWidth",e),null!=e&&e.styles&&e.styles.forEach(e=>this.styles.push(e)),this.masterContent&&(this.masterContent.masterHost=this)}activateAsync(e){return this.masterContent.activateAsync?this.masterContent.activateAsync(e):Promise.resolve()}deactivateAsync(){return this.masterContent.deactivateAsync?this.masterContent.deactivateAsync():Promise.resolve()}getContentAsync(t){return __awaiter(this,void 0,void 0,(function*(){if(this._host=t,"auto"==this.mode){document.body.clientWidth/window.devicePixelRatio>this.minWidth?this.mode="split-h":this.mode="separate"}if("separate"!=this.mode){let t=[];return this._masterContainer=new e.ContentHostView({name:"master",contentProvider:this.masterContent}),this._detailsContainer=new e.ContentHostView({name:"details",emptyView:new e.IconTextView({styles:["empty-view"],icon:this.info.icon,text:e.Format.message("msg-select-an-item",this.itemDisplayName)})}),t.push(this._masterContainer),t.push(this._detailsContainer),Promise.resolve({views:t,styles:e.ArrayUtils.merge(this.styles,[this.mode]),title:this.info.displayName})}return this.masterContent.getContentAsync(t)}))}showDetailsAsync(t){return __awaiter(this,void 0,void 0,(function*(){if(t){const i=yield this.masterContent.getDetailsAsync(t);if(!i)return;"separate"!=this.mode?(this._detailsContainer.contentProvider=i,yield this._detailsContainer.loadAsync()):yield e.Actions.loadPageAsync(new e.ContentActivity({providers:[i],name:i.info.name}))}else"separate"!=this.mode&&(yield this._detailsContainer.closeAsync())}))}get info(){return this.masterContent.info}}e.MasterDetailsContent=t}(WebApp||(WebApp={})),function(e){e.MessageContent=class{constructor(e){this._options=e}getContentAsync(t){return __awaiter(this,void 0,void 0,(function*(){const i=[];return i.push(new e.IconTextView({icon:this._options.icon,text:this._options.message,styles:["message-view"]})),this._options.customActions&&this._options.customActions.forEach(s=>i.push(new e.ActionView({name:s.name,template:"ActionButton",styles:["primary"],content:new e.TextView({content:e.DynamicString.getValue(s.displayName,e.StringUsage.Action)}),executeAsync:()=>__awaiter(this,void 0,void 0,(function*(){yield t.closeAsync(),yield s.executeAsync()}))}))),Promise.resolve({views:i,title:this._options.title,styles:["vertical","margin-items-v","scroll","fit-items-h","surface","padding"]})}))}get info(){return{name:"message",icon:null,displayName:this._options.title}}}}(WebApp||(WebApp={})),function(e){class t extends e.BindableObject{constructor(e){super(),this.editor=null,this.title="Edit",this.bindConfig("editor",e),this.bindConfigString("title",e),e&&e.editToItemAsync&&(this.editToItemAsync=e.editToItemAsync)}editAsync(t,i){return __awaiter(this,void 0,void 0,(function*(){const s=new e.ContentActivity({providers:[new e.ItemEditContent({editor:this.editor,title:this.title,value:t,saveItemAsync:e=>__awaiter(this,void 0,void 0,(function*(){if(i){if(null==(yield i(e)))return null}return yield this.editToItemAsync(e)}))})]});return null==(yield(yield e.Actions.loadPageAsync(s,{loadMode:"add"})).result)?null:this.editor.value}))}editToItemAsync(e){return Promise.resolve(e)}}e.ActivityEditor=t}(WebApp||(WebApp={})),function(e){class t extends e.ViewComponent{constructor(i){super(Object.assign({},i)),this._needValidation=!1,this._isEditing=0,this._editValue=null,this.isValid=!0,this.status="none",this.commitMode="onchange",this.validationMode="onchanged",this.allowNull=!0,this.displayValue=null,this.value=null,this.hasFocus=!1,this.isDirty=!1,this.uid=null,this.error=null,e.setEnumerable(this,"editValue",t.prototype),this._onCommit=null==i?void 0:i.onCommit,this.bindConfig("hasFocus",i),this.bindConfig("value",i),this.bindConfig("commitMode",i),this.bindConfig("validationMode",i),this.prop("displayValue"),this.prop("value").subscribe((e,t)=>this.onValueChanged(e,t)),this.prop("name").subscribe(()=>this.updateUid()),this.updateUid()}updateUid(){var t;this.uid=e.Identifier.generate(e.ViewUtils.formatForCss(null!==(t=this.name)&&void 0!==t?t:e.ObjectUtils.getTypeName(this)))}createEditValueProp(){this.prop("editValue").subscribe(()=>this.notifyEditValueChangedAsync())}notifyEditValueChangedAsync(){return __awaiter(this,void 0,void 0,(function*(){console.debug("value changed: ",this.debugName),this._needValidation=!0,this.isDirty=!0,this._isEditing||("onchange"==this.commitMode?yield this.commitAsync():yield this.validateAsync())}))}onValueChanged(e,t){"commiting"!=this.status&&this.beginEditAsync(e)}clear(){this.value=null}loadAsync(){return __awaiter(this,void 0,void 0,(function*(){console.group("begin load: ",this.debugName," - status: ",this.status);try{if("none"!=this.status)return;this.status="loading";try{yield this.loadAsyncWork()}finally{this.status="loaded"}}finally{console.groupEnd()}}))}clearError(){this.error=null}loadAsyncWork(){return Promise.resolve()}beginEditAsync(e){return __awaiter(this,void 0,void 0,(function*(){if(!this._isEditing){console.group("begin edit: ",this.debugName),this._isEditing++;try{"none"==this.status&&(yield this.loadAsync()),this.value=e,this.editValue=this.valueToEdit(e),yield this.beginEditWorkAsync(e),this._needValidation=!0}finally{this._isEditing--,console.groupEnd()}}}))}valueToEdit(e){return e}editToValue(e){return e}beginEditWorkAsync(e){return Promise.resolve()}validateAsync(e){return __awaiter(this,void 0,void 0,(function*(){console.group("begin validation: "+this.debugName," - needValidation: ",this._needValidation);try{if(this._isEditing)return;if(!this._needValidation&&"onchanged"==this.validationMode&&!e)return this.isValid;this.clearError();const t=yield this.validateAsyncWork(e);return void 0!==t&&(this.isValid=t,this._needValidation=!1),console.debug("validation: ",this.debugName," = ",this.isValid),this.isValid}finally{console.groupEnd()}}))}validateAsyncWork(e){return Promise.resolve(!0)}commitAsync(e){return __awaiter(this,void 0,void 0,(function*(){console.group("begin commit: ",this.debugName," isDirty: ",this.isDirty," - status: ",this.status);try{if(this._isEditing)return!1;if(!e&&"manual"!=this.commitMode&&!this.isDirty)return!0;if("loaded"!=this.status)return"commiting"==this.status;this.status="commiting";try{if(!(yield this.validateAsync(e)))return!1;if(!(yield this.commitAsyncWork(e)))return!1;const t=this.editToValue(this.editValue);return void 0!==t&&(this.value=t),this._onCommit&&this._onCommit(this),this.isDirty=!1,!0}finally{this.status="loaded"}}finally{console.groupEnd()}}))}activateAsync(){return Promise.resolve()}commitAsyncWork(e){return Promise.resolve(!0)}rollback(){this.editValue=this.valueToEdit(this.value)}get view(){return this}get editValue(){return this._editValue}set editValue(e){this._editValue=e}}e.BaseEditor=t}(WebApp||(WebApp={})),function(e){class t extends e.BindableObject{constructor(e){super(),this.view=null,this.value=null,this.isValid=null}beginEditAsync(e){throw"Not implemented"}commitAsync(e){throw"Not implemented"}}e.BaseItemEditor=t}(WebApp||(WebApp={})),function(e){class t extends e.BaseEditor{constructor(t){super(t),this.canAdd=!1,this.addLabel="Add",this.pickLabel="Select",this.selectAction=null,this.itemsSource=null,this.pageSize=0,this.filters=observableListOf(),this.bindConfig("canAdd",t),this.bindConfig("itemsSource",t),this.bindConfig("pageSize",t),this.bindConfigString("addLabel",t),this.bindConfigString("pickLabel",t),t&&(t.filters&&this.filters.addRange(t.filters),t.createItemView&&(this.createItemView=t.createItemView),t.createItemListView&&(this.createItemListView=t.createItemListView),t.createItemEditor&&(this.createItemEditor=t.createItemEditor)),(null==t?void 0:t.addLabel)||(this.addLabel=e.Strings["new-item"]({params:[this.itemsSource.displayName],usage:e.StringUsage.Title})),(null==t?void 0:t.pickLabel)||(this.pickLabel=e.Strings["select-item"]({params:[this.itemsSource.displayName],usage:e.StringUsage.Title})),this.createEditValueProp(),this.selectAction=e.ActionView.fromActionIcon({name:"select",icon:"fas fa-list",operation:e.OperationType.Local,displayName:this.pickLabel,executeAsync:()=>this.selectAsync()})}createItemEditor(){throw"Not Supported"}createItemView(t){return new e.TextView({content:this.itemsSource.getItemText(t)})}createItemListView(e){return this.createItemView(e)}notifyEditValueChangedAsync(){return __awaiter(this,void 0,void 0,(function*(){yield e.BaseEditor.prototype.notifyEditValueChangedAsync.call(this),yield this.updateViewAsync()}))}}e.BasePicker=t}(WebApp||(WebApp={})),function(e){class t extends e.BaseEditor{constructor(e){super(e),this.trackMode="onlostfocus",this.bindConfig("trackMode",e),this.prop("hasFocus").subscribe(e=>this.onFocusChanged(e))}attach(e){this._element=e}activateAsync(){var t;return __awaiter(this,void 0,void 0,(function*(){if("INPUT"==this._element.nodeName||"TEXTAREA"==this._element.nodeName)for(;;){const i=this._element;if(i.selectionStart=0,i.selectionEnd=null===(t=i.value)||void 0===t?void 0:t.length,this._element.focus(),this.hasFocus)break;yield e.PromiseUtils.delay(100)}}))}onFocusChanged(e){e||"onlostfocus"!=this.trackMode||this.notifyEditValueChangedAsync()}notifyEditValueChangedAsync(){return this.hasFocus&&"onlostfocus"==this.trackMode?(this._needValidation=!0,this.isDirty=!0,Promise.resolve()):super.notifyEditValueChangedAsync()}}e.BaseTextEditor=t}(WebApp||(WebApp={})),function(e){class t extends e.BaseEditor{constructor(t){super(Object.assign({template:"CheckBox"},t)),this.trueLabel=null,this.falseLabel=null,this.label=null,this.bindConfigString("trueLabel",t),this.bindConfigString("falseLabel",t),this.bindConfigString("label",t,e.StringUsage.Action),this.createEditValueProp()}toggle(){window.event&&window.event.stopPropagation(),this.editValue=!this.editValue}}e.BooleanEditor=t}(WebApp||(WebApp={})),function(e){class t extends e.BaseEditor{constructor(e){super(Object.assign({template:"DateEditor"},e)),this.placeholder=null,this.bindConfig("placeholder",e),this.createEditValueProp()}get textValue(){return""}set textValue(e){}}e.DateEditor=t}(WebApp||(WebApp={})),function(e){class t extends e.BaseEditor{constructor(i){var s,n;super(i),this.selectedDay=null,this.selectedMonth=null,this.selectedYear=null,this.days=[],this.months=[],this.years=[],e.setEnumerable(this,"editValue",t.prototype);for(let e=1;e<=31;e++)this.days.push(e.toString());for(let t=1;t<=12;t++)this.months.push({number:t.toString(),name:e.DateUtils.MONTHS[t-1]});const a=null!==(s=null==i?void 0:i.maxYear)&&void 0!==s?s:(new Date).getFullYear();for(let e=null!==(n=null==i?void 0:i.minYear)&&void 0!==n?n:(new Date).getFullYear()-100;e<=a;e++)this.years.push(e.toString());this.prop("selectedDay").subscribe(()=>this.tryCommit()),this.prop("selectedMonth").subscribe(()=>this.tryCommit()),this.prop("selectedYear").subscribe(()=>this.tryCommit())}tryCommit(){this.commitAsync()}commitAsync(e){var t,i;return(null===(t=this.editValue)||void 0===t?void 0:t.getTime())!=(null===(i=this.value)||void 0===i?void 0:i.getTime())&&(this.value=this.editValue),Promise.resolve(!0)}get editValue(){return this.selectedDay&&this.selectedMonth&&this.selectedYear?new Date(parseInt(this.selectedYear),parseInt(this.selectedMonth)-1,parseInt(this.selectedDay)):null}set editValue(e){var t;(null==e?void 0:e.getTime())!=(null===(t=this.editValue)||void 0===t?void 0:t.getTime())&&(e?(this.selectedDay=e.getDate().toString(),this.selectedMonth=(e.getMonth()+1).toString(),this.selectedYear=e.getFullYear().toString()):(this.selectedDay=null,this.selectedMonth=null,this.selectedYear=null))}}e.DateEditorCombo=t}(WebApp||(WebApp={})),function(e){class t extends e.BindableObject{constructor(e){super(),this.editor=null,this.bindConfig("editor",e),e&&(e.itemToEdit&&(this.itemToEdit=e.itemToEdit),e.editToItem&&(this.editToItem=e.editToItem))}activateAsync(){return e.TypeCheck.isActivable(this.editor)?this.editor.activateAsync():Promise.resolve()}beginEditAsync(e){return this._item=e,this.editor.beginEditAsync(this.itemToEdit(e))}commitAsync(e){return __awaiter(this,void 0,void 0,(function*(){return!!(yield this.editor.commitAsync(e))&&(this.editToItem(this._item,this.editor.value),!0)}))}itemToEdit(e){throw"Not supported"}editToItem(e,t){}get value(){return this.editor.value}get view(){return this.editor}get isValid(){return this.editor.isValid}}e.ItemEditorConverter=t}(WebApp||(WebApp={})),function(e){class t extends e.ItemView{constructor(t){super(Object.assign({},t)),this.error=null,this.addTitle=null,this.editTitle=null,this.editor=null,this.view=null,this.value=null,this.status="unchanged",this.editMode="external",this.isEdit=!1,t.canEdit&&this.addAction({name:"edit-item",icon:"fas fa-edit",operation:e.OperationType.Local,priority:e.BindableObject.bindValue(t.editActionsPriority),displayName:t.editActionLabel,executeAsync:()=>this.editAsync()}),t.canRemove&&this.addAction({name:"remove-item",icon:"fas fa-trash",operation:e.OperationType.Local,priority:e.BindableObject.bindValue(t.editActionsPriority),displayName:t.removeActionLabel,executeAsync:()=>this.removeAsync()}),t.itemActions&&t.itemActions.forEach(i=>this.addAction({name:i.name,icon:i.icon,priority:i.priority,operation:i.operation,displayName:e.Format.action(i.displayName,t.itemsSource.displayName),canExecute:i.canExecute?()=>i.canExecute(this):void 0,executeAsync:()=>i.executeAsync(this)})),this.value=t.value}updateView(){this.content.clear(),this.isEdit&&"inline"==this.editMode&&!e.TypeCheck.isAsyncEditor(this.editor)?this.content.add(this.editor.view):this.content.add(this.view)}updateValueAsync(){throw"Not implemented"}createUpdateEditor(){throw"Not implemented"}createAddEditor(){throw"Not implemented"}executeUpdateAsync(e){throw"Not implemented"}executeAddAsync(e){throw"Not implemented"}editAsync(){return __awaiter(this,void 0,void 0,(function*(){if(this.isEdit)return!1;if(this.editor||("added"==this.status?this.editor=this.createAddEditor():this.editor=this.createUpdateEditor()),this.isEdit=!0,"external"==this.editMode){let t=null;if(e.TypeCheck.isAsyncEditor(this.editor)){const e=yield this.editor.editAsync(this.item);e&&(t="added"==this.status?yield this.executeAddAsync(e):yield this.executeUpdateAsync(e))}else{const i=new e.ContentActivity({providers:[new e.ItemEditContent({editor:this.editor,title:e=>"added"==this.status?this.addTitle:this.editTitle,value:this.item,saveItemAsync:e=>"added"==this.status?this.executeAddAsync(e):this.executeUpdateAsync(e)})]});t=yield(yield e.Actions.loadPageAsync(i)).result}return t?(this.item=t,this.status="unchanged",this.isEdit=!1,yield this.updateValueAsync()):this.isEdit=!1,this.editor=null,null!=t}return!1}))}cancelEdit(){this.isEdit=!1}removeAsync(){throw"Not implemented"}clearErrors(){this.error=null}validateAsync(t){return __awaiter(this,void 0,void 0,(function*(){if(this.isEdit){if(e.TypeCheck.isValidable(this.editor))return yield this.editor.validateAsync()}else if(e.TypeCheck.isValidable(this.view))return yield this.view.validateAsync();return!0}))}loadAsync(){return __awaiter(this,void 0,void 0,(function*(){this.updateView()}))}get itemsEditor(){return this.parentView}}e.ItemsEditorItemView=t;class i extends e.BaseEditor{constructor(t){var s;super(Object.assign({template:"ItemsEditor"},t)),this._changesCount=0,this._isUpdating=0,this.content=observableListOf(),this.editActionsPriority=e.ActionPriority.Secondary,this.editActionLabel="Edit",this.removeActionLabel="Remove",this.canAdd=!0,this.canRemove=!0,this.canEdit=!1,this.canOpen=!1,this.editMode="inline",this.itemActions=[],this.itemsSource=null,this.isConfirmRemove=!0,e.setEnumerable(this,"editValue",i.prototype),this.bindConfig("editMode",t),this.bindConfig("canAdd",t),this.bindConfig("canOpen",t),this.bindConfig("canRemove",t),this.bindConfig("isConfirmRemove",t),this.bindConfig("canEdit",t),this.bindConfig("itemsSource",t),this.bindConfig("itemActions",t),this.bindConfig("editActionsPriority",t),this.bindConfig("removeActionLabel",t),this.bindConfig("editActionLabel",t),t&&(t.editActionLabel||(this.editActionLabel=e.Format.action("edit-item",this.itemsSource.displayName)),t.removeActionLabel||(this.removeActionLabel=e.Format.action("remove-item",this.itemsSource.displayName)),t.createItemAddEditor&&(this.createItemAddEditor=t.createItemAddEditor),t.createItemUpdateEditor&&(this.createItemUpdateEditor=t.createItemUpdateEditor),t.createItemView&&(this.createItemView=t.createItemView),t.attachItem&&(this.attachItem=t.attachItem),t.newItem&&(this.newItem=t.newItem),t.openItem&&(this.openItem=t.openItem,null==t.canOpen&&(this.canOpen=!0))),this.itemsSource||(this.itemsSource=new e.EditableItemsSource),this.addAction=e.ActionView.fromAction({name:"add-item",icon:"fas fa-plus",operation:e.OperationType.Local,displayName:null!==(s=null==t?void 0:t.addActionLabel)&&void 0!==s?s:e.Format.action("add-item",this.itemsSource.displayName),executeAsync:()=>__awaiter(this,void 0,void 0,(function*(){return yield this.addAsync()}))}),this.value&&this.beginEditAsync(this.value)}loadAsyncWork(){return __awaiter(this,void 0,void 0,(function*(){const e=[];for(let t of this.content)e.push(t.loadAsync());yield Promise.all(e)}))}clear(){this.content.clear()}clearErrors(){for(let e of this.content)e.clearErrors()}insert(){}addAsync(){return __awaiter(this,void 0,void 0,(function*(){const t=this.newItem();this.attachItem(t,!0);const i=this.createItem(this.itemToValue(t),t);if(i.item=t,i.status="added",yield i.editAsync()){if(e.linq(this.content).any(e=>this.itemsSource.itemComparer(e.item,i.item)))return;this.content.add(i),yield this.notifyEditValueChangedAsync()}}))}openItem(e){}attachItem(e,t){}isCapable(e,t){return"boolean"==typeof e?e:e(t)}createItem(i,s){const n=new t({value:i,item:s,addTitle:e.Format.title("add-item",this.itemsSource.displayName),editTitle:"",itemsSource:this.itemsSource,editActionsPriority:this.editActionsPriority,editActionLabel:this.editActionLabel,removeActionLabel:this.removeActionLabel,itemActions:this.itemActions,canRemove:this.isCapable(this.canRemove,s),canEdit:this.isCapable(this.canEdit,s),canOpen:this.isCapable(this.canOpen,s),open:()=>this.openItem(n.item)});return n.parentView=this,n.isConfirmRemove=this.isConfirmRemove,n.createAddEditor=()=>this.createItemAddEditor(n.item),n.createUpdateEditor=()=>this.createItemUpdateEditor(n.item),n.executeAddAsync=e=>this.itemsSource.addItemAsync(e),n.executeUpdateAsync=e=>this.itemsSource.updateItemAsync(e,n.item),n.loadAsync=()=>__awaiter(this,void 0,void 0,(function*(){n.item||(n.item=yield this.valueToItemAsync(n.value),n.canOpen=this.isCapable(this.canOpen,n.item),n.editTitle=e.Format.title("edit-item",this.itemsSource.getItemText(n.item)),this.attachItem(n.item,"added"!=n.status)),n.view=this.createItemView(n.item),n.updateView()})),n.updateValueAsync=()=>__awaiter(this,void 0,void 0,(function*(){n.canOpen=this.isCapable(this.canOpen,n.item),n.value=this.itemToValue(n.item),n.view=this.createItemView(n.item),n.editTitle=e.Format.title("edit-item",this.itemsSource.getItemText(n.item)),n.updateView(),yield this.notifyEditValueChangedAsync()})),n.removeAsync=()=>__awaiter(this,void 0,void 0,(function*(){if("added"==n.status)this.content.remove(n);else{if(this.isConfirmRemove&&!(yield e.Interaction.confirmAsync(e.Format.message("msg-remove-confirm",this.itemsSource.displayName))))return;"none"==this.status&&(this.status="loaded"),n.status="removed",yield this.notifyEditValueChangedAsync()}})),n.value=i,"none"!=this.status&&n.loadAsync(),n}itemToValue(e){return e}valueToItemAsync(e){return Promise.resolve(e)}onItemChanged(e,t){this._needValidation=!0,this._isUpdating?this._changesCount++:this.notifyEditValueChangedAsync()}set editValue(e){if(this.content&&!this._isUpdating){this._isUpdating++,this._changesCount=0,this.content.clear();try{if(e)for(let t of e)this.content.add(this.createItem(t))}finally{this._isUpdating--}this._changesCount>0&&this.notifyEditValueChangedAsync()}}get editValue(){const e=[];for(let t of this.content)"removed"!=t.status&&e.push(t.value);return e}validateAsyncWork(e){return __awaiter(this,void 0,void 0,(function*(){let t=!0;for(let i of this.content)(yield i.validateAsync(e))||(t=!1);return t}))}commitAsyncWork(t){return __awaiter(this,void 0,void 0,(function*(){let t=!0,i=!1;if(!t)return!1;for(let s=this.content.count-1;s>=0;s--){const n=this.content.get(s);if(n.clearErrors(),"removed"==n.status)(yield this.itemsSource.removeItemAsync(n.item))?this.content.removeAt(s):(this.error="",t=!1),i=!0;else if("modified"!=n.status||e.TypeCheck.isAsyncEditor(n.editor)){if("added"==n.status&&!e.TypeCheck.isAsyncEditor(n.editor)){const e=yield this.itemsSource.addItemAsync(n.editor.value);e?(n.item=e,n.status="unchanged",n.updateView()):(this.error="",t=!1),i=!0}}else{const e=yield this.itemsSource.updateItemAsync(n.editor.value,n.item);e?(n.item=e,n.status="unchanged",n.updateView()):(this.error="",t=!1),i=!0}}return t&&i&&this.onValueChanged(this.editValue),t}))}newItem(){return this.itemsSource.newItem()}getItemViewContent(e){return this.itemsSource?this.itemsSource.getItemText(e):e.toString()}createItemView(t){return new e.TextView({content:this.getItemViewContent(t)})}createItemUpdateEditor(e){throw"Not Supported"}createItemAddEditor(e){throw"Not Supported"}}e.ItemsEditor=i}(WebApp||(WebApp={})),function(e){class t extends e.BaseEditor{constructor(t){super(Object.assign({template:"MediaEditor"},t)),this.fileUpload=null,this.mediaView=null,this.noMediaUrl=null,this.maxFileSize=null,this.validMedias=["video","image"],this.bindConfig("noMediaUrl",t),this.bindConfig("maxFileSize",t),this.bindConfig("validMedias",t),t&&(t.getUploadUrl&&(this.getUploadUrl=t.getUploadUrl),t.getMediaUrl&&(this.getMediaUrl=()=>t.getMediaUrl(this.editValue))),this.mediaView=new e.MediaView(Object.assign({image:{template:"ImageInline"},video:{template:"VideoViewInline"}},null==t?void 0:t.mediaView)),this.fileUpload=new e.FileUploadView({onChanged:()=>this.notifyEditValueChangedAsync()}),this.fileUpload.visible=!1,this.mediaView.content={type:"empty"}}getUploadUrl(e){throw"Not implemented"}validateAsyncWork(t){return"selected"==this.fileUpload.status&&(-1!=this.validMedias.indexOf("image")&&this.fileUpload.file.type.startsWith("image/")?this.mediaView.content.type="image":-1!=this.validMedias.indexOf("video")&&this.fileUpload.file.type.startsWith("video/")?this.mediaView.content.type="video":this.error=e.Strings["msg-invalid-media"]({usage:e.StringUsage.Message}),this.maxFileSize&&this.fileUpload.file.size>this.maxFileSize&&(this.error=e.Strings["msg-max-size"]({usage:e.StringUsage.Message,params:[(this.maxFileSize/1024/1024).toString()]}))),Promise.resolve(!this.error)}commitAsyncWork(e){return __awaiter(this,void 0,void 0,(function*(){if("selected"==this.fileUpload.status){const e=yield this.fileUpload.uploadAsync(this.getUploadUrl(this.fileUpload.file.name));this.editValue.id=e,this.editValue.status="new",this.editValue.type=this.mediaView.content.type,this.mediaView.content={src:this.getMediaUrl(),type:this.mediaView.content.type},this.notifyEditValueChangedAsync()}return!0}))}getMediaUrl(){throw"Not Implemented"}beginEditAsync(t){return __awaiter(this,void 0,void 0,(function*(){yield e.BaseEditor.prototype.beginEditAsync.call(this,t),this.editValue||(this.editValue={id:null,type:"empty",status:"empty"}),"empty"==this.editValue.status?this.mediaView.content={type:"image",src:this.noMediaUrl}:this.mediaView.content={type:this.editValue.type,src:this.getMediaUrl()}}))}change(){this.fileUpload.visible=!0,this.fileUpload.select()}remove(){this.editValue.status="deleted",this.mediaView.content={type:"image",src:this.noMediaUrl},this.notifyEditValueChangedAsync()}showMenu(){const t=new e.ContextMenu;("new"==this.editValue.status||this.editValue.id)&&t.addAction({name:"remove-item",icon:"fas fa-trash",displayName:"delete",executeAsync:()=>__awaiter(this,void 0,void 0,(function*(){return this.remove()}))}),t.addAction({name:"edit-item",icon:"fas fa-edit",displayName:"change",executeAsync:()=>__awaiter(this,void 0,void 0,(function*(){return this.change()}))}),t.showAsync(void 0,window.event)}}e.MediaEditor=t}(WebApp||(WebApp={})),function(e){class t extends e.BasePicker{constructor(e){super(e),this.selector=null,this.items=observableListOf()}selectAsync(){return __awaiter(this,void 0,void 0,(function*(){let t=!1;null==this.selector?(this.selector=new e.SelectMultipleItemsActivity({createItemEditor:()=>this.createItemEditor(),createItemContentView:e=>this.createItemView(e),createItemListView:e=>this.createItemListView(e),itemsSource:this.itemsSource,addLabel:this.addLabel,tooltip:this.pickLabel,canAdd:this.canAdd}),this.selector.filters=this.filters):t=!0,this.selector.setSelectedItems(e.linq(this.items).select(e=>e.item).toArray()),t&&(yield this.selector.refreshAsync());const i=yield(yield e.Actions.loadPageAsync(this.selector)).result;if(null!=i){const t=e.linq(i).select(e=>this.itemsSource.getItemValue(e)).toArray();e.ArrayUtils.equals(t,this.editValue)||(this.editValue=t)}}))}valueToEdit(e){return e?e.slice():[]}editToValue(e){return e?e.slice():[]}updateViewAsync(){return __awaiter(this,void 0,void 0,(function*(){if("loading"!=this.status&&(this.items.clear(),this.editValue)){this.status="loading";try{for(let t of this.editValue){const i=yield this.itemsSource.getItemByValueAsync(t);if(!i)continue;const s=new e.RemovableItemView({item:i,content:this.createItemView(i),removeAsync:()=>__awaiter(this,void 0,void 0,(function*(){this.items.remove(s),this.editValue.splice(this.editValue.indexOf(this.itemsSource.getItemValue(s.item)),1),yield this.notifyEditValueChangedAsync()}))});this.items.add(s)}}finally{this.status="loaded"}}}))}}e.MultiItemPicker=t}(WebApp||(WebApp={})),function(e){class t extends e.BaseTextEditor{constructor(e){super(Object.assign({template:"NumberEditor"},e)),this.placeholder=null,this.min=null,this.max=null,this.precision=null,this.bindConfig("placeholder",e),this.bindConfig("precision",e),this.createEditValueProp()}valueToEdit(e){return null==e||null==e?"":(null!=this.precision?e.toFixed(this.precision):e.toString()).replace(".",",")}editToValue(e){return e?parseFloat(e.replace(",",".")):null}}e.NumberEditor=t}(WebApp||(WebApp={})),function(e){class t extends e.BaseEditor{constructor(i){if(super(Object.assign({template:"ItemsViewForm",validationMode:"always",commitMode:"manual"},i)),this._changesCount=0,this._isUpdating=0,this.properties={},this.defaultProperty=null,this.propertyTemplateName="PropertyView",this.emptyView=null,this.content=observableListOf(),e.setEnumerable(this,"editValue",t.prototype),this.bindConfig("propertyTemplateName",i),this.bindConfig("defaultProperty",i),this.bindConfig("emptyView",i),this.prop("content"),i&&(this._onPropertyChanged=i.onPropertyChanged,i.properties))for(let e in i.properties)i.properties[e].name=e,this.addProperty(i.properties[e]);this.createProxy(),e.ObjectUtils.isEmpty(this.value)||this.beginEditAsync(this.value)}addProperty(t){const i=new e.PropertyView(Object.assign({name:t.name,template:this.prop("propertyTemplateName")},t));return this.properties[t.name]=i,i}beginEditWorkAsync(e){return __awaiter(this,void 0,void 0,(function*(){this.value||(this.value={}),this.isDirty=!0;for(let e in this.properties){const t=this.properties[e];null!=t.value&&(yield t.editor.beginEditAsync(t.value))}}))}clearErrors(){for(let e in this.properties)this.properties[e].error=null}validateAsyncWork(e){return __awaiter(this,void 0,void 0,(function*(){let t=!0;const i=this.editValue;for(let s in this.properties){const n=this.properties[s];(yield n.validateAsync(i,e))||(this.isValid=!1,t=!1)}return t}))}createProxy(){this._proxy={},this.content.clear();for(let e in this.properties){const t=this.properties[e];t.prop("value").subscribe((t,i)=>this.onPropertyValueChanged(e,t,i)),t.prop("isValid").subscribe(e=>{e||(this.isValid=!1)}),t.prop("isDirty").subscribe(e=>{e&&(this.isDirty=!0)}),this.content.add(t),Object.defineProperty(this._proxy,e,{enumerable:!0,get:()=>t.value,set:e=>t.value=e})}}activateAsync(){return this.defaultProperty?this.editor(this.defaultProperty).activateAsync():Promise.resolve()}loadAsyncWork(){return __awaiter(this,void 0,void 0,(function*(){const e=[];for(let t in this.properties)e.push(this.properties[t].loadAsync());yield Promise.all(e)}))}clear(){this._isUpdating++;try{for(let e in this.properties)this.property(e).clear()}finally{this._isUpdating--}}editToValue(e){}commitAsyncWork(e){return __awaiter(this,void 0,void 0,(function*(){let e=!1,t=!0;for(let i in this.properties){const s=yield this.commitPropertyAsync(i,!1);s.isValid||(t=!1),s.isChanged||(e=!0)}return t&&e&&this.onValueChanged(this.value),t}))}commitPropertyAsync(t,i){return __awaiter(this,void 0,void 0,(function*(){const s={isValid:!0,isChanged:!1},n=this.property(t);return i&&!(yield n.validateAsync(this.editValue,!1))?s.isValid=!1:(yield n.editor.commitAsync())?e.ObjectUtils.equals(n.value,this.value[t])||(this.value[t]=n.value,s.isChanged=!0):s.isValid=!1,s}))}editor(e){return this.properties[e].editor}property(e){return this.properties[e]}onPropertyValueChanged(e,t,i){return __awaiter(this,void 0,void 0,(function*(){if(this._needValidation=!0,this._isUpdating||this._isEditing)this._changesCount++;else{if("onchange"==this.commitMode){(yield this.commitPropertyAsync(e,!0)).isChanged&&(this._needValidation=!0,this.isDirty=!0)}else yield this.notifyEditValueChangedAsync();this._onPropertyChanged&&this._onPropertyChanged(e,t,i)}}))}set editValue(t){if(!this._isUpdating){this._isUpdating++,this._changesCount=0;try{if(e.ObjectUtils.isEmpty(t))this.clear();else for(let e in this.properties)this._proxy[e]=t[e]}finally{this._isUpdating--}this._changesCount>0&&this.notifyEditValueChangedAsync()}}get editValue(){return this._proxy}}e.ObjectEditor=t}(WebApp||(WebApp={})),function(e){class t extends e.BindableObject{constructor(t){super(),this.editor=null,this.title="Edit",this.saveLabel=null,this.savePriority=null,this.closeLabel=null,this.saveOnCommit=!1,this.styles=[],this.name=null,this.bindConfig("name",t),this.bindConfig("editor",t),this.bindConfig("styles",t),this.bindConfig("saveOnCommit",t),this.bindConfig("savePriority",t),this.bindConfigString("title",t,e.StringUsage.Title),this.bindConfigString("closeLabel",t,e.StringUsage.Action),this.bindConfigString("saveLabel",t,e.StringUsage.Action),t&&t.editToItemAsync&&(this.editToItemAsync=t.editToItemAsync),this.closeLabel||(this.closeLabel=e.Format.action("cancel")),this.saveLabel||(this.saveLabel=e.Format.action("ok"))}editAsync(t,i){return __awaiter(this,void 0,void 0,(function*(){const s=new e.PopUpContent({title:this.title,contentProvider:new e.ItemEditContent({editor:this.editor,value:t,styles:this.styles,savePriority:this.savePriority,saveOnCommit:this.saveOnCommit,saveLabel:this.saveLabel,saveItemAsync:e=>__awaiter(this,void 0,void 0,(function*(){if(i){if(null==(yield i(e)))return null}return yield this.editToItemAsync(e)}))}),closeLabel:this.closeLabel});return(yield(yield s.openAsync()).result)?this.editor.value:null}))}editToItemAsync(e){return Promise.resolve(e)}}e.PopUpEditor=t}(WebApp||(WebApp={})),function(e){class t extends e.BaseTextEditor{constructor(i){super(Object.assign({template:"Attach"},i)),e.setEnumerable(this,"editValue",t.prototype)}attach(e){this.editor=new Quill(e,{theme:"snow"}),this.editor.root.innerHTML=this.value,this.editor.on("text-change",()=>this.notifyEditValueChangedAsync())}set editValue(e){this.editor&&(this.editor.root.innerHTML=e)}get editValue(){return this.editor?this.editor.root.innerHTML:this.value}}e.RichTextEditor=t}(WebApp||(WebApp={})),function(e){class t extends e.ViewComponent{constructor(e){super(e),this.title=null,this.bindConfig("editor",e),this.bindConfigString("title",e)}}class i extends e.BaseEditor{constructor(t){super(Object.assign({template:"SectionEditor"},t)),this.sections=observableListOf(),this.activeSectionName=null,this.navBar=new e.NavBar({styles:["tab-view","surface"],itemTemplate:"TextView",itemBehavoirs:["ripple"],selectedItem:this.prop("activeSectionName")}),t&&t.sections&&t.sections.forEach(e=>this.addSection(e)),this.sections.count>0&&(this.activeSectionName=this.sections.get(0).name),this.createEditValueProp()}loadAsyncWork(){return __awaiter(this,void 0,void 0,(function*(){for(let e of this.sections)e.editor&&(yield e.editor.loadAsync())}))}beginEditWorkAsync(e){return __awaiter(this,void 0,void 0,(function*(){for(let t of this.sections)t.editor&&(yield t.editor.beginEditAsync(e))}))}validateAsyncWork(e){return __awaiter(this,void 0,void 0,(function*(){let t=!0;for(let i of this.sections)i.editor&&((yield i.editor.validateAsync(e))||(t=!1,this.activeSectionName=i.name));return t}))}commitAsyncWork(e){return __awaiter(this,void 0,void 0,(function*(){let t=!0;for(let i of this.sections)i.editor&&((yield i.editor.commitAsync(e))||(t=!1));return t}))}getSection(t){return e.linq(this.sections).first(e=>e.name==t)}addSection(e){const i=new t(e);return this.sections.add(i),this.navBar.addItem({text:i.prop("title"),name:i.name,content:i}),i}}e.SectionEditor=i}(WebApp||(WebApp={})),function(e){class t extends e.BasePicker{constructor(t){super(t),this.selector=null,this.contentView=null,this.clearAction=null,this.clearAction=e.ActionView.fromActionIcon({name:"clear",icon:"fas fa-times",displayName:e.Strings.clear,executeAsync:()=>Promise.resolve(this.clear())})}selectAsync(){return __awaiter(this,void 0,void 0,(function*(){let t=!1;null==this.selector?(this.selector=new e.SelectSingleItemActivity({itemsSource:this.itemsSource,createItemEditor:()=>this.createItemEditor(),createItemContentView:e=>this.createItemListView(e),pageSize:this.pageSize,addLabel:this.addLabel,tooltip:this.pickLabel,canAdd:this.canAdd}),this.selector.filters=this.filters):t=!0,this.selector.selectedValue=this.editValue,t&&(yield this.selector.refreshAsync());const i=yield(yield e.Actions.loadPageAsync(this.selector)).result;null!=i&&(this.editValue=this.itemsSource.getItemValue(i))}))}createItemEditor(){throw"Not Supported"}updateViewAsync(){return __awaiter(this,void 0,void 0,(function*(){if("loading"!=this.status)if(this.editValue){this.status="loading";try{const e=yield this.itemsSource.getItemByValueAsync(this.editValue);this.contentView=this.createItemView(e)}finally{this.status="loaded"}}else this.contentView=null}))}}e.SingleItemPicker=t}(WebApp||(WebApp={})),function(e){class t extends e.ContentView{constructor(e){super(Object.assign({template:"SelectorItemView"},e)),this.isSelected=!1,this.value=null,this.bindConfig("value",e),this.bindConfig("isSelected",e)}select(){this.isSelected=!0}}e.SelectorItemView=t;class i extends e.BaseEditor{constructor(t){super(Object.assign({template:"SelectEditor"},t)),this.itemTemplate="SelectorItemCheckBox",this.placeholder=null,this.emptyText=null,this.selectedItem=null,this.selectedIndex=-1,this.itemsSource=null,this.items=observableListOf(),e.setEnumerable(this,"editValue",i.prototype),this.bindConfig("itemsSource",t),this.bindConfig("itemTemplate",t),this.bindConfigString("placeholder",t),this.bindConfigString("emptyText",t,e.StringUsage.Title),(null==t?void 0:t.createItemView)&&(this.createItemViewWork=null==t?void 0:t.createItemView),(null==t?void 0:t.items)&&(this.emptyText&&this.items.add(this.createEmptyItem()),t.items.forEach(e=>this.items.add(this.createItemView(e))),this.status="loaded"),this.prop("selectedItem").subscribe((e,t)=>__awaiter(this,void 0,void 0,(function*(){if(!this._isSelecting)if(e||!this.emptyText){this._isSelecting=!0;try{t&&(t.isSelected=!1),e&&(e.isSelected=!0),this.selectedIndex=this.items.indexOf(e),"loading"!=this.status&&(yield this.notifyEditValueChangedAsync())}finally{this._isSelecting=!1}}else this.selectedItem=this.items.get(0)}))),this.prop("selectedIndex").subscribe(e=>{var t;-1==e&&this.emptyText?this.selectedIndex=0:(this.selectedItem=-1==e?null:this.items.get(e),"SELECT"==(null===(t=this._element)||void 0===t?void 0:t.tagName)&&(this._element.selectedIndex=e))})}attach(e){this._element=e,"SELECT"==e.tagName&&(this._element.selectedIndex=this.selectedIndex,this._element.addEventListener("change",()=>this.selectedIndex=e.selectedIndex))}findItemByValue(t){return this.itemsSource?e.linq(this.items).first(e=>this.itemsSource.equals(e.value,t)):e.linq(this.items).first(e=>e.value==t)}set editValue(e){this.editValue!=e&&(null==e&&this.emptyText?this.selectedItem=this.items[0]:this.selectedItem=this.findItemByValue(e))}get editValue(){var e;return null===(e=this.selectedItem)||void 0===e?void 0:e.value}loadAsyncWork(){return __awaiter(this,void 0,void 0,(function*(){if(this.itemsSource){this.items.clear(),this.emptyText&&this.items.add(this.createEmptyItem());const e=yield this.itemsSource.getItemsAsync(this.itemsSource.getFilter());e&&e.forEach(e=>this.items.add(this.createItemView(e)))}this.selectedIndex=0,this.isDirty=!0}))}createEmptyItem(){const e=new t({value:null,content:this.emptyText,template:this.itemTemplate});return e.prop("isSelected").subscribe(e=>{e&&(this.selectedItem=null)}),e}createItemViewWork(e){if(this.itemsSource)return new t({value:this.itemsSource.getItemValue(e),content:this.itemsSource.getItemText(e),template:this.itemTemplate})}createItemView(e){const t=this.createItemViewWork(e);return t.prop("isSelected").subscribe(e=>{e&&(this.selectedItem=t)}),t}}e.SingleItemSelector=i}(WebApp||(WebApp={})),function(e){class t extends e.BaseTextEditor{constructor(t){super(Object.assign({template:"TextEditor"},t)),this.placeholder=null,this.lineCount=1,this.maxLength=null,this.bindConfigString("placeholder",t,e.StringUsage.Tooltip),this.bindConfig("lineCount",t),this.bindConfig("maxLength",t),this.bindConfig("trackMode",t),this.createEditValueProp()}}e.TextEditor=t}(WebApp||(WebApp={})),function(e){let t;!function(t){function i(t,i){return e.app.pageHost.loadAsync(t,i)}t.loadPageAsync=i,t.call=function(e){return window.location.href="tel:"+e,Promise.resolve()},t.email=function(e){return window.location.href="mailto:"+e,Promise.resolve()},t.webPage=function(t){return i(new e.WebPage({url:t}))},t.navigate=function(e){return new Promise((t,i)=>{const s=window.open(e,"_blank");s.addEventListener("load",e=>{t()}),s.addEventListener("error",e=>{i()})})},t.facebookPage=function(e){return window.location.href="fb://page/"+e,Promise.resolve()},t.maps=function(e,t=17){return e.position?window.location.href="https://www.google.com/maps/search/?api=1&query="+e.position.latitude+","+e.position.longitude:window.location.href="https://www.google.com/maps/search/?api=1&query="+encodeURIComponent(e.address),Promise.resolve()}}(t=e.Actions||(e.Actions={}))}(WebApp||(WebApp={})),function(e){let t;!function(e){e.cubic=function(e,t,i,s){return n=>Math.pow(1-n,3)*e+3*Math.pow(1-n,2)*n*t+3*(1-n)*Math.pow(n,2)*i+Math.pow(n,3)*s},e.linear=function(){return e=>e},e.animate=function(e){let t=0;const i=setInterval(()=>{t>e.duration&&(t=e.duration),e.step(e.timeFunction(t/e.duration)),t==e.duration&&clearInterval(i),t+=e.stepTime},e.stepTime)}}(t=e.Animation||(e.Animation={}))}(WebApp||(WebApp={})),function(e){let t;!function(t){t.sections=function(t){return new e.SectionsView(t)}}(t=e.Components||(e.Components={}))}(WebApp||(WebApp={})),function(e){e.observable=function(){return function(e,t){}}}(WebApp||(WebApp={})),function(e){let t;!function(t){t.richText=function(){return new e.RichTextEditor},t.currency=function(){return new e.NumberEditor({allowNull:!1,min:.01})},t.converter=function(t,i,s){return new e.ItemEditorConverter({editor:t,editToItem:s,itemToEdit:i})},t.items=function(t){return new e.ItemsEditor(Object.assign({},t))},t.text=function(t){return new e.TextEditor(Object.assign({},t))},t.textMultiLine=function(t){return new e.TextEditor(Object.assign({template:"TextEditorMultiLine"},t))},t.number=function(t){return new e.NumberEditor(Object.assign({},t))},t.boolean=function(t){return new e.BooleanEditor(Object.assign({},t))},t.password=function(t){return new e.TextEditor(Object.assign({template:"PasswordEditor"},t))},t.object=function(t){return new e.ObjectEditor(t)},t.address=function(t){return new e.TextEditor(Object.assign({template:"TextEditorMultiLine"},t))},t.birthDate=function(t,i){return new e.DateEditorCombo({maxYear:(new Date).getFullYear()-(null!=t?t:0),minYear:(new Date).getFullYear()-100})},t.singleItemSelector=function(t){return new e.SingleItemSelector(t)}}(t=e.Editors||(e.Editors={}))}(WebApp||(WebApp={})),function(e){e.ImageLoader=class{static loadAsync(t){const i=e.Operation.begin({message:"Loading image: "+t,type:e.OperationType.Local});return new Promise((e,s)=>{const n=document.createElement("img");n.addEventListener("load",()=>{e(n),i.end()}),n.addEventListener("error",e=>{s(e.error),i.end()}),n.src=t})}}}(WebApp||(WebApp={})),function(e){let t;!function(t){function i(t){var i;return __awaiter(this,void 0,void 0,(function*(){const s=null!==(i=t.actions)&&void 0!==i?i:["ok"],n=new e.MessageBox({message:t.message,icon:t.icon,title:t.title});return s.forEach(t=>{n.addAction({name:t,displayName:e.Format.action(t),executeAsync:()=>Promise.resolve()})}),t.customActions&&t.customActions.forEach(e=>n.addAction(e)),yield n.showAsync()}))}t.showMessageAsync=i,t.confirmAsync=function(t){return __awaiter(this,void 0,void 0,(function*(){return"yes"==(yield i({message:t,title:e.Strings.confirm,actions:["yes","no"]}))}))},t.info=function(t){new e.Toast({message:t}).showAsync()},t.warning=function(t){new e.Toast({message:t,styles:["warning"]}).showAsync()},t.succeed=function(t){return e.Actions.loadPageAsync(new e.ContentActivity({providers:[new e.MessageContent(Object.assign({icon:"far fa-smile",customActions:[{name:"close",displayName:"close",executeAsync:()=>Promise.resolve()}]},t))],name:"message"}))},t.fail=function(t){return e.Actions.loadPageAsync(new e.ContentActivity({providers:[new e.MessageContent(Object.assign({icon:"far fa-sad-tear",customActions:[{name:"close",displayName:"close",executeAsync:()=>Promise.resolve()}]},t))],name:"message"}))}}(t=e.Interaction||(e.Interaction={}))}(WebApp||(WebApp={})),function(e){let t;!function(t){t.static=function(t,i=!1){return new e.ItemsSource({typeName:"WebApp.ISimpleItem",getItemValue:e=>e.value,getItemText:t=>e.Format.title(t.text),getItemsAsync:()=>Promise.resolve(t),getItemByValueAsync:i=>Promise.resolve(e.linq(t).first(e=>e.value==i)),allowZero:i})},t.array=function(t){return new e.ItemsSource({getItemsAsync:()=>Promise.resolve(t)})},t.actions=function(t){return new e.ItemsSource({typeName:"WebApp.IAction",getItemText:t=>e.DynamicString.getValue(t.displayName),getItemsAsync:()=>Promise.resolve(t),allowZero:!1})}}(t=e.ItemsSources||(e.ItemsSources={}))}(WebApp||(WebApp={})),function(e){e.ScriptLoader=class{constructor(t){this.src=e.Uri.absolute(t.replace("~/","./"))}isLoaded(){return".ts"==this.src.substr(this.src.length-3)||e.linq(document.scripts).any(e=>e.src.toLowerCase().startsWith(this.src.toLowerCase()))}loadAsync(t){return this.isLoaded()?Promise.resolve(!0):new Promise((i,s)=>{const n=e.Operation.begin({parentOperation:t,message:"Loading script "+this.src}),a=document.createElement("script");a.onload=()=>{n.end(),i(!0)},a.onerror=()=>{n.end(),i(!1)},a.type="text/javascript",a.src=this.src,document.body.appendChild(a)})}};e.StyleLoader=class{constructor(t){this.src=e.Uri.absolute(t.replace("~/","./"))}isLoaded(){return e.linq(document.styleSheets).any(e=>e.href&&e.href.toLowerCase().startsWith(this.src.toLowerCase()))}loadAsync(t){return this.isLoaded()?Promise.resolve(!0):new Promise((i,s)=>{const n=e.Operation.begin({parentOperation:t,message:"Loading style "+this.src}),a=document.createElement("link");a.onload=()=>{n.end(),i(!0)},a.onerror=()=>{n.end(),i(!1)},a.rel="stylesheet",a.href=this.src,document.body.appendChild(a)})}}}(WebApp||(WebApp={})),function(e){let t;!function(e){e.views={},e.permissionManager=null,e.itemsObserver=null}(t=e.Services||(e.Services={}))}(WebApp||(WebApp={})),function(e){let t;!function(e){e.isAsyncEditor=function(e){return e&&"object"==typeof e&&"editAsync"in e&&"function"==typeof e.editAsync},e.isView=function(e){return e&&"object"==typeof e&&"parentView"in e&&"template"in e},e.isActivable=function(e){return e&&"object"==typeof e&&"function"==typeof e.activateAsync&&0==e.activateAsync.length},e.isSelectable=function(e){return e&&"object"==typeof e&&"isSelected"in e&&"select"in e&&"function"==typeof e.select},e.isSingleItemSelector=function(e){return e&&"object"==typeof e&&"selectedItem"in e},e.isAsyncLoad=function(e){return e&&"object"==typeof e&&"function"==typeof e.loadAsync&&0==e.loadAsync.length},e.isValidable=function(e){return e&&"object"==typeof e&&"function"==typeof e.validateAsync&&e.validateAsync.length<2},e.isHTMLContainer=function(e){return e&&"object"==typeof e&&"nodes"in e},e.isEditable=function(e){return e&&"object"==typeof e&&"createEditor"in e&&"function"==typeof e.createEditor}}(t=e.TypeCheck||(e.TypeCheck={}))}(WebApp||(WebApp={})),function(e){let t;!function(t){var i=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;t.required={validateAsync:t=>Promise.resolve({isValid:null!=t.value&&""!=t.value&&(!Array.isArray(t.value)||t.value.length>0),error:e.Strings["msg-specify-value"]({params:[t.fieldName]})})},t.minValue=function(t){return{validateAsync:i=>Promise.resolve({isValid:i.value>=t,error:e.Strings["msg-insert-greater-than"]({params:[t.toString()]})})}},t.maxValue=function(t){return{validateAsync:i=>Promise.resolve({isValid:i.value<=t,error:e.Strings["msg-insert-less-than"]({params:[t.toString()]})})}},t.email={validateAsync:t=>Promise.resolve({isValid:t.value&&i.test(t.value.toLowerCase()),error:e.Strings["msg-invalid-email"]({params:[t.value]})})},t.custom=function(e){return{validateAsync:t=>__awaiter(this,void 0,void 0,(function*(){return yield e(t)}))}}}(t=e.Validators||(e.Validators={}))}(WebApp||(WebApp={})),function(e){e.VideoLoader=class{static loadAsync(t){const i=e.Operation.begin({message:"Loading image: "+t,type:e.OperationType.Local});return new Promise((e,s)=>{const n=document.createElement("video");n.addEventListener("playing",()=>{n.pause(),i.end(),e(n)}),n.addEventListener("error",e=>{i.end(),s(e.error)}),n.src=t,n.play(),n.readyState>=2&&e(n)})}static loadIntoAsync(t,i){if(!i.paused||i.played)return Promise.resolve();const s=e.Operation.begin({message:"Loading image: "+t,type:e.OperationType.Local});return new Promise((e,n)=>{function a(){i.removeEventListener("playing",o),i.removeEventListener("error",r)}const o=()=>{s.end(),a(),e(void 0)},r=e=>{s.end(),a(),n(e.error)};i.addEventListener("playing",o),i.addEventListener("error",r),i.src=t,i.play()})}}}(WebApp||(WebApp={})),function(e){let t;!function(t){t.loadAllAsync=function(t){return __awaiter(this,void 0,void 0,(function*(){const i=e.linq(t).ofType(t=>e.TypeCheck.isAsyncLoad(t)).select(e=>e.loadAsync()).toArray();return yield Promise.all(i)}))},t.formatForCss=function(t){let i=0,s="";for(let n=0;n<t.length;n++){const a=t.charAt(n);switch(i){case 0:s+=a.toLowerCase(),e.StringUtils.isUpperCase(a)&&"-"!=a||(i=1);break;case 1:e.StringUtils.isUpperCase(a)&&"-"!=a&&(s+="-",i=0),s+=a.toLowerCase()}}return s}}(t=e.ViewUtils||(e.ViewUtils={}))}(WebApp||(WebApp={})),function(e){e.ItemsSource=class{constructor(t){t&&(t.getItemsAsync&&(this.getItemsAsync=t.getItemsAsync),void 0!==t.allowZero&&(this._allowZero=t.allowZero),t.getItemValue&&(this.getItemValue=(i,s)=>!1===s?t.getItemValue(i):i||0===i&&t.allowZero?e.Item.create({type:this.typeName,value:t.getItemValue(i),text:this.getItemText(i),item:i}):void 0),t.getItemText&&(this.getItemText=t.getItemText),t.getFilter&&(this.getFilter=t.getFilter),t.getItemByValueAsync&&(this.getItemByValueAsync=i=>{const s=e.Item.getItem(i);return s?Promise.resolve(s):t.getItemByValueAsync(i)}),t.equals&&(this.equals=t.equals),this._typeName=t.typeName,this.displayName=t.displayName)}getItemsAsync(e){return Promise.resolve([])}getItemText(e){if(e)return e.toString()}getItemValue(e,t){return e}getFilter(e,t,i){return{}}countAsync(e){return __awaiter(this,void 0,void 0,(function*(){return(yield this.getItemsAsync(e)).length}))}getItemByValueAsync(t){const i=e.Item.getItem(t);return i?Promise.resolve(i):Promise.resolve(t)}equals(e,t){return e==t||!(null==e||!e.valueOf||null==t||!t.valueOf)&&e.valueOf()==t.valueOf()}get itemComparer(){return(e,t)=>this.equals(this.getItemValue(e),this.getItemValue(t))}get typeName(){return this._typeName}get allowZero(){return this._allowZero}}}(WebApp||(WebApp={})),function(e){class t extends e.ItemsSource{constructor(e){super(e),e&&(e.addItemAsync&&(this.addItemAsync=e.addItemAsync),e.updateItemAsync&&(this.updateItemAsync=e.updateItemAsync),e.removeItemAsync&&(this.removeItemAsync=e.removeItemAsync),e.newItem&&(this.newItem=e.newItem))}newItem(){return{}}addItemAsync(e){return Promise.resolve(e)}updateItemAsync(e,t){return Promise.resolve(t)}removeItemAsync(e){return Promise.resolve(!0)}}e.EditableItemsSource=t}(WebApp||(WebApp={})),function(e){class t extends e.EditableItemsSource{constructor(t){super(),this.source=null,this.cache=null,this.filter=null,t&&(this.source=t.source,this.cache=t.cache,t.filterItem&&(this.filterItem=(e,i)=>t.filterItem(e,i,this.items)),t.finalize&&(this.finalize=t.finalize)),this.cache||(this.cache={key:(new Date).getTime().toString(),lastUpdateTime:null,value:null}),this.cache.updateComplete||(this.cache.updateComplete=new e.Signal(!0)),this.cache.value?this.cache.value.size>0&&(this.cache.lastUpdateTime=new Date):this.cache.value=new Map}getItemText(e){return this.source.getItemText(e)}getItemValue(e,t){return this.source.getItemValue(e,t)}getFilter(e,t,i){return this.source.getFilter(e,t,i)}equals(e,t){return this.source.equals(e,t)}newItem(){return this.source.newItem()}finalize(e,t){}countAsync(t){return __awaiter(this,void 0,void 0,(function*(){return e.linq(this.items.entries()).select(e=>e[1]).where(e=>this.filterItem(t,e)).count()}))}getItemsAsync(t){return __awaiter(this,void 0,void 0,(function*(){yield this.updateCacheAsync(!1);const i=yield e.linq(this.items.entries()).select(e=>e[1]).where(e=>this.filterItem(t,e)).toArrayAsync(10);return this.finalize(t,i),i}))}getItemByValueAsync(e){return __awaiter(this,void 0,void 0,(function*(){return yield this.updateCacheAsync(!1),null==e?null:("object"==typeof e&&"function"==typeof e.valueOf&&(e=e.valueOf()),Promise.resolve(this.items.get(e)))}))}addItemAsync(e){return __awaiter(this,void 0,void 0,(function*(){const t=yield this.source.addItemAsync(e);return null!=t&&this.items.set(this.getItemValue(t,!1),t),t}))}updateItemAsync(e){return __awaiter(this,void 0,void 0,(function*(){const t=yield this.source.updateItemAsync(e);return null!=t&&this.items.set(this.getItemValue(t,!1),t),t}))}removeItemAsync(e){return __awaiter(this,void 0,void 0,(function*(){const t=yield this.source.removeItemAsync(e);return t&&this.items.delete(this.getItemValue(e,!1)),t}))}filterItem(e,t){return!0}readCacheAsync(){return __awaiter(this,void 0,void 0,(function*(){if(this.cache.key)return yield e.Services.dbStorage.getItem(this.cache.key)}))}writeCacheAsync(t){return __awaiter(this,void 0,void 0,(function*(){this.cache.key&&(yield e.Services.dbStorage.setItem(this.cache.key,t))}))}updateCacheAsync(e){return __awaiter(this,void 0,void 0,(function*(){if(!this.cache.lastUpdateTime||e)if(this.cache.updateComplete.isSet){this.cache.updateComplete.reset();try{let e;try{e=yield this.source.getItemsAsync(this.filter)}catch(e){console.error(e)}let t=!0;if(null==e&&(e=yield this.readCacheAsync(),t=!1),null!=e){this.items.clear();for(let t of e)this.items.set(this.getItemValue(t,!1),t);this.cache.lastUpdateTime=new Date,t&&(yield this.writeCacheAsync(e))}}finally{this.cache.updateComplete.set()}}else yield this.cache.updateComplete.waitFor()}))}get typeName(){return this.source.typeName}get allowZero(){return this.source.allowZero}get itemComparer(){return this.source.itemComparer}get items(){return this.cache.value}}e.CachedEditableItemsSource=t}(WebApp||(WebApp={})),function(e){class t{loadItemsAsync(t,i){return __awaiter(this,void 0,void 0,(function*(){t.status="loading";const s=e.Operation.begin({message:"Loading items",type:e.OperationType.Local});try{const n=yield t.itemsSource.getItemsAsync(t.filter);t.clear(),n&&(yield e.ArrayUtils.forEachAsync(n,i,e=>t.addItem(e)))}finally{s.end(),t.status="loaded"}}))}}t.instance=new t,e.FullItemsLoader=t}(WebApp||(WebApp={})),function(e){e.Item=class{static create(t){let i=t.value;return"string"==typeof i?i=new String(i):"number"==typeof i?i=new Number(i):"boolean"==typeof i&&(i=new Boolean(i)),t.item&&(t.item.valueOf=()=>t.value,t.value&&(t.item.toJSON=()=>t.value),t.text&&(t.item.toString=()=>t.text),t.type&&(t.item.$type=()=>t.type)),i&&(t.text&&(i.toString=()=>t.text),t.type&&e.ObjectUtils.setTypeName(i,t.type),void 0!==t.item&&e.ObjectUtils.set(i,"@item",t.item),i.toJSON=()=>t.value),i||t.item}static getText(e){if(null==e||null==e)return"";const t=this.getItem(e);return t!==e?t.toString():e.toString()}static getType(t){return e.ObjectUtils.getTypeName(t)}static getValue(e){if(e)return e.valueOf?e.valueOf():e}static getItem(t){if(!t)return;const i=e.ObjectUtils.get(t,"@item");return i||void 0}}}(WebApp||(WebApp={})),function(e){e.ItemsObserver=class{constructor(){this._listener={}}unregister(e,t){if(e in this._listener){const i=this._listener[e],s=i.indexOf(t);s-1&&i.splice(s,1)}}register(e,t){e in this._listener?-1==this._listener[e].indexOf(t)&&this._listener[e].push(t):this._listener[e]=[t]}clear(){this._listener={}}notifyAdded(e){e.itemType in this._listener&&this._listener[e.itemType].forEach(t=>t.onItemAdded?t.onItemAdded(e):void 0)}notifyRemoved(e){e.itemType in this._listener&&this._listener[e.itemType].forEach(t=>t.onItemRemoved?t.onItemRemoved(e):void 0)}notifyChanged(e){e.itemType in this._listener&&this._listener[e.itemType].forEach(t=>t.onItemChanged?t.onItemChanged(e):void 0)}}}(WebApp||(WebApp={})),function(e){class t extends e.BindableObject{constructor(e){super(),this._hasMoreItems=!0,this.pageSize=20,this.isScrollCheckActive=!0,this.bindConfig("pageSize",e),e&&e.getFilter&&(this.getFilter=e.getFilter)}loadItemsAsync(e,t){return this._container=e,this._hasMoreItems=!0,this._container.clear(),this.loadNextPageAsync()}loadNextPageAsync(){return __awaiter(this,void 0,void 0,(function*(){if(this.canLoadNextPage&&this._container.itemsSource){const t=this.getFilter(this._container.itemsCount,this.pageSize),i=e.Operation.begin({message:"Laoding items from "+this._container.itemsCount,type:e.OperationType.Local});try{this._container.status="loading";const e=yield this._container.itemsSource.getItemsAsync(Object.assign(Object.assign({},t),this._container.filter));e&&0!=e.length?(e.forEach(e=>this._container.addItem(e)),this._hasMoreItems=e.length==this.pageSize):this._hasMoreItems=!1}finally{i.end(),this._container.status="loaded"}}}))}onScroll(e){e.pageBottom<1&&this.canLoadNextPage&&this.loadNextPageAsync()}getFilter(e,t){return this._container.itemsSource.getFilter(null,e,t)}get canLoadNextPage(){return this._hasMoreItems&&"loading"!=this._container.status}}e.PagedItemsLoader=t}(WebApp||(WebApp={})),function(e){e.AppContentManager=class{constructor(e){this.contents=e}get(t){return e.linq(this.contents).first(e=>e.name==t)}actionFor(e){const t=this.get(e);return{executeAsync:t.openAsync,name:t.name,displayName:t.displayName,icon:t.icon}}}}(WebApp||(WebApp={})),function(WebApp){class DynamicPageManager{createPageAsync(pageInfo){return __awaiter(this,void 0,void 0,(function*(){const curOperation=WebApp.Operation.begin({message:"Loading page '"+pageInfo.name+"'..."}),clientPage=yield this.getClientPageAsync(pageInfo.name,curOperation);clientPage.isLoded||(yield this.loadClientPageAsync(clientPage,curOperation));const result=eval(clientPage.action);let page;return result instanceof Promise&&(yield result),null!=page&&(page.url=WebApp.Format.replaceArgs(WebApp.app.baseUrl+clientPage.url,pageInfo.args)),page.args=pageInfo.args,curOperation.end(),page}))}loadComponentsAsync(e){return __awaiter(this,void 0,void 0,(function*(){const t=WebApp.Operation.begin({message:"Loading page '"+e+"'..."}),i=yield this.getClientPageAsync(e,t);i&&!i.isLoded&&(yield this.loadClientPageAsync(i,t)),t.end()}))}loadAppStructureAsync(e){return __awaiter(this,void 0,void 0,(function*(){null==this._struture&&(this._struture=yield WebApp.Http.getJsonAsync("~/app.json"))}))}loadClientPageAsync(e,t){return __awaiter(this,void 0,void 0,(function*(){const i=[];e.isLoded=!0,e.scripts&&e.scripts.forEach(e=>i.push(new WebApp.ScriptLoader(e))),e.styles&&e.styles.forEach(e=>i.push(new WebApp.StyleLoader(e))),yield Promise.all(WebApp.linq(i).select(e=>e.loadAsync(t)).toArray())}))}getClientPageAsync(e,t){return __awaiter(this,void 0,void 0,(function*(){yield this.loadAppStructureAsync(t);const i={},s=this._struture.pages[e];return i.styles=[],i.scripts=[],i.action=s.action,i.url=s.url,this.includeClientPage(i,s.include),i}))}includeClientPage(e,t){t&&(t.components&&t.components.forEach(t=>this.includeClientPage(e,this._struture.components[t].include)),t.styles&&t.styles.forEach(t=>{-1==e.styles.indexOf(t)&&e.styles.push(t)}),t.scripts&&t.scripts.forEach(t=>{-1==e.scripts.indexOf(t)&&e.scripts.push(t)}))}}WebApp.DynamicPageManager=DynamicPageManager}(WebApp||(WebApp={})),function(e){class t extends e.ViewComponent{constructor(t){super(),this.value=null,this.switchView=null,this.isShowInfo=!1,this.value=t,this.switchView=new e.BooleanEditor({label:this.value.permission.name,template:"Switch",styles:["primary"]})}}e.PermissionRequestItemView=t;class i extends e.BindableObject{constructor(){super(...arguments),this._listView=null,this.view=null,this.value=null,this.isValid=!0}beginEditAsync(i){const s=new e.Panel({styles:["vertical"]});return this._listView=s.addView(new e.ListView({styles:["surface"],items:observableListOf(i),isAutoLoad:!0,createItemView:e=>new t(e)})),s.addView(new e.IconTextView({text:"msg-permission-request",styles:["message warning"]})),this.view=s,this.value=i,Promise.resolve()}commitAsync(e){for(let e of this._listView.content)e.value.granted=e.switchView.editValue;return Promise.resolve(!0)}}e.PermissionManager=class{constructor(){this.geolocation={name:"geolocation",ask:()=>new Promise(e=>{function t(t){localStorage.setItem("geolocation",t?"granted":"denied"),e(t)}navigator.geolocation.getCurrentPosition(()=>t(!0),e=>t(e.code!=e.PERMISSION_DENIED),{maximumAge:1/0,timeout:2e3})}),isGranted:()=>__awaiter(this,void 0,void 0,(function*(){return"permissions"in navigator?"granted"==(yield navigator.permissions.query({name:"geolocation"})).state:"granted"==localStorage.getItem("geolocation")}))},this.notification={name:"notification",ask:()=>new Promise(e=>{"Notification"in window||(console.warn("Notification not supported"),e(!1)),Notification.requestPermission(t=>{e("granted"==t)})}),isGranted:()=>Promise.resolve(!("Notification"in window)||"granted"==Notification.permission)}}requireAsync(...t){return __awaiter(this,void 0,void 0,(function*(){let s=[],n={};for(let e of t)(yield e.permission.isGranted())?n[e.permission.name]=!0:s.push(e);if(s.length>0){const t=new e.PopUpEditor({editor:new i,saveLabel:"accept",savePriority:e.ActionPriority.Evidence,title:"permission-request"}),a=yield t.editAsync(s);if(a)for(let e of a)e.granted&&(e.granted=yield e.permission.ask()),n[e.permission.name]=e.granted}return n}))}}}(WebApp||(WebApp={})),WebApp.templateCatalog.ActionBar=e=>{e.beginChild("div").class(e=>e.className).visible(e=>e.visible).set("enabled",e=>e.enabled).class("context-mode",e=>{var t;return null===(t=e.selectionManager)||void 0===t?void 0:t.isActive}).beginChild("ul").set("class","nav main").if(e=>null!=e.icon,e=>e.beginChild("li").set("class","icon").template("Icon",e=>e.icon).endChild()).if(e=>"menu"==e.mainAction,e=>e.beginChild("li").set("class","main-action menu").on("click",e=>e.showNavigationMenu()).behavoir("ripple").beginChild("i").set("class","icon fas fa-bars").endChild().endChild()).if(e=>"back"==e.mainAction,e=>e.beginChild("li").set("class","main-action back").on("click",e=>e.back()).behavoir("ripple").beginChild("i").set("class","icon fas fa-chevron-left").endChild().endChild()).if(e=>null!=e.title,e=>e.beginChild("li").set("class","title").text(e=>e.title).endChild()).foreach(e=>e.actions,e=>e.beginChild("li").set("class","action-item").class(e=>e.name).content(e=>e).endChild()).endChild().beginChild("ul").set("class","nav context").beginChild("li").set("class","main-action close").on("click",e=>{var t;return null===(t=e.selectionManager)||void 0===t?void 0:t.close()}).behavoir("ripple").beginChild("i").set("class","icon fas fa-times").endChild().endChild().if(e=>null!=e.selectionManager,e=>e.beginChild("li").set("class","title").text(e=>e.selectionManager.selectionText).endChild().foreach(e=>e.selectionManager.actions,e=>e.beginChild("li").set("class","action-item").class(e=>e.name).content(e=>e).endChild())).endChild().endChild().content(e=>e.navigationMenu)},WebApp.templateCatalog.ActionIcon=e=>{e.beginChild("button").set("type","button").set("class","action button-text").set("tooltip",e=>e.tooltip).on("click",e=>e.executeAsync()).class(e=>e.className).visible(e=>e.visible).set("enabled",e=>e.enabled).behavoir("ripple").template("Icon",e=>e.content).endChild()},WebApp.templateCatalog.ActionLink=e=>{e.beginChild("button").set("type","button").set("class","action button-text").on("click",e=>e.executeAsync()).class(e=>e.className).visible(e=>e.visible).set("enabled",e=>e.enabled).behavoir("ripple").content(e=>e.content).endChild()},WebApp.templateCatalog.ActionButton=e=>{e.beginChild("button").set("type","button").set("class","action button").on("click",e=>e.executeAsync()).class(e=>e.className).visible(e=>e.visible).set("enabled",e=>e.enabled).behavoir("ripple").content(e=>e.content).endChild()},WebApp.templateCatalog.Attach=e=>{e.beginChild("div").class(e=>e.className).visible(e=>e.visible).set("enabled",e=>e.enabled).behavoir("attach").endChild()},WebApp.templateCatalog.Blocker=e=>{e.beginChild("div").class(e=>e.className).visible(e=>e.visible).class(e=>e.status).behavoir("attach").beginChild("div").set("class","spinner-container").beginChild("i").set("class","spinner fas fa-circle-notch fa-spin fa-3x fa-fw").endChild().endChild().endChild()},WebApp.templateCatalog.DefaultCheckBox=e=>{e.beginChild("label").beginChild("input").set("type","checkbox").value(e=>e.editValue).focus(e=>e.hasFocus).class(e=>e.className).visible(e=>e.visible).set("enabled",e=>e.enabled).set("id",e=>e.uid).endChild().beginChild("span").text(e=>e.label).endChild().endChild()},WebApp.templateCatalog.Switch=e=>{e.beginChild("div").set("class","switch").class(e=>e.className).visible(e=>e.visible).set("enabled",e=>e.enabled).set("id",e=>e.uid).class("selected",e=>e.editValue).beginChild("div").set("class","checkbox-container").beginChild("div").set("class","unselected-half").on("click",e=>e.editValue=!1).endChild().beginChild("div").set("class","selected-half").on("click",e=>e.editValue=!0).endChild().beginChild("div").set("class","switch-button").endChild().endChild().if(e=>null!=e.label,e=>e.beginChild("label").text(e=>e.label).endChild()).endChild()},WebApp.templateCatalog.CheckBox=e=>{e.beginChild("div").set("class","checkbox").class(e=>e.className).visible(e=>e.visible).set("enabled",e=>e.enabled).set("id",e=>e.uid).on("click",e=>e.toggle()).class("selected",e=>e.editValue).beginChild("div").set("class","checkbox-container").beginChild("i").set("class","fas fa-check").endChild().endChild().if(e=>null!=e.label,e=>e.beginChild("label").text(e=>e.label).endChild()).endChild()},WebApp.templateCatalog.BottomSheet=e=>{e.beginChild("div").class(e=>e.className).visible(e=>e.visible).set("enabled",e=>e.enabled).class(e=>e.status).behavoir("attach").if(e=>e.isShowOpener,e=>e.beginChild("button").set("type","button").set("class","opener button-text").on("click",e=>e.toggle()).beginChild("i").set("class","fas fa-caret-up").endChild().endChild()).content(e=>e.content).endChild()},WebApp.templateCatalog.ConsoleView=e=>{e.beginChild("div").class(e=>e.className).visible(e=>e.visible).beginChild("div").set("class","toolbar").beginChild("button").set("type","button").on("click",e=>e.hide()).text("Hide").endChild().beginChild("button").set("type","button").on("click",e=>e.clear()).text("Clear").endChild().endChild().beginChild("div").set("class","body").foreach(e=>e.root.items,e=>e.content(e=>e)).endChild().endChild()},WebApp.templateCatalog.ConsoleMessageView=e=>{e.beginChild("div").set("class","console-item console-message").class(e=>e.type).if(e=>null!=e.content,e=>e.foreach(e=>e.content,e=>e.beginChild("span").text(e=>e).endChild())).endChild()},WebApp.templateCatalog.ConsoleGroupView=e=>{e.beginChild("div").set("class","console-item console-group").beginChild("header").template("ConsoleMessageView",e=>e).endChild().beginChild("section").foreach(e=>e.items,e=>e.content(e=>e)).endChild().endChild()},WebApp.templateCatalog.Container=e=>{e.beginChild("div").class(e=>e.className).visible(e=>e.visible).set("enabled",e=>e.enabled).behavoir("attach").if(e=>null!=e.title,e=>e.beginChild("header").beginChild("label").text(e=>e.title).endChild().endChild()).beginChild("div").set("class","content").class("expanded",e=>e.isExpanded).class("expandible",e=>e.canExpand).if(e=>e.canExpand,e=>e.beginChild("div").set("class","content-wrapper").content(e=>e.content,!0).endChild().if(e=>e.isOverflow,e=>e.beginChild("a").set("class","base-button expand-collapse").on("click",e=>e.toggleExpand()).visible(e=>e.canExpand).behavoir("ripple").beginChild("i").set("class","fas fa-angle-down").endChild().endChild()),e=>e.content(e=>e.content,!0)).endChild().endChild()},WebApp.templateCatalog.ContentView=e=>{e.content(e=>e.content)},WebApp.templateCatalog.ContentViewNested=e=>{e.beginChild("div").class(e=>e.className).visible(e=>e.visible).set("enabled",e=>e.enabled).class(e=>e.status).behavoir("attach").content(e=>e.content).endChild()},WebApp.templateCatalog.ContextMenu=e=>{e.beginChild("ul").class(e=>e.className).foreach(e=>e.actions,e=>e.beginChild("li").content(e=>e).endChild()).endChild()},WebApp.templateCatalog.CounterView=e=>{e.beginChild("div").set("class","action").class(e=>e.className).visible(e=>e.visible).set("enabled",e=>e.enabled).beginChild("label").set("class","title").text(e=>e.title).endChild().beginChild("span").set("class","value").text(e=>e.content).endChild().endChild()},WebApp.templateCatalog.DateEditor=e=>{e.beginChild("input").set("type","date").value(e=>e.textValue).focus(e=>e.hasFocus).class(e=>e.className).visible(e=>e.visible).set("enabled",e=>e.enabled).set("id",e=>e.uid).set("placeholder",e=>e.placeholder).endChild()},WebApp.templateCatalog.DateEditorCombo=e=>{e.beginChild("div").class(e=>e.className).visible(e=>e.visible).set("enabled",e=>e.enabled).beginChild("select").set("class","input-element day").value(e=>e.selectedDay).beginChild("option").set("value","").text("[Giorno]").endChild().foreach(e=>e.days,e=>e.beginChild("option").set("value",e=>e).text(e=>e).endChild()).endChild().beginChild("select").set("class","input-element month").value(e=>e.selectedMonth).beginChild("option").set("value","").text("[Mese]").endChild().foreach(e=>e.months,e=>e.beginChild("option").set("value",e=>e.number).text(e=>e.name).endChild()).endChild().beginChild("select").set("class","input-element year").value(e=>e.selectedYear).beginChild("option").set("value","").text("[Anno]").endChild().foreach(e=>e.years,e=>e.beginChild("option").set("value",e=>e).text(e=>e).endChild()).endChild().endChild()},WebApp.templateCatalog.Drawer=e=>{e.beginChild("div").set("class","drawer-container").class(e=>e.status).beginChild("div").set("class","drawer").if(e=>null!=e.header,e=>e.beginChild("header").content(e=>e.header).endChild()).foreach(e=>e.groups,e=>e.beginChild("section").if(e=>null!=e.label,e=>e.beginChild("label").text(e=>e.label).endChild()).beginChild("ul").set("class","menu").foreach(e=>e.actions,e=>e.beginChild("li").set("class","base-button").on("click",e=>e.executeAsync()).behavoir("ripple").beginChild("div").set("class","action").beginChild("i").set("class","icon").class(e=>e.content.icon).visible(e=>null!=e.content.icon).endChild().beginChild("span").set("class","text").text(e=>e.content.text).endChild().endChild().endChild()).endChild().endChild()).endChild().behavoir("attach").endChild()},WebApp.templateCatalog.FileUploadView=e=>{e.beginChild("div").class(e=>e.className).visible(e=>e.visible).set("enabled",e=>e.enabled).class(e=>e.status).beginChild("div").set("class","content").beginChild("div").set("class","header").beginChild("button").set("type","button").set("class","select button-text").on("click",e=>e.select()).text(e=>e.text).set("enabled",e=>"selected"==e.status||"empty"==e.status).endChild().endChild().beginChild("div").set("class","progress").beginChild("div").set("class","bar").style("width",e=>100*e.progress+"%").endChild().beginChild("div").set("class","text").text(e=>e.progressText).endChild().endChild().endChild().endChild()},WebApp.templateCatalog.Html=e=>{e.beginChild("div").class(e=>e.className).visible(e=>e.visible).set("enabled",e=>e.enabled).html(e=>e.content).endChild()},WebApp.templateCatalog.HtmlNode=e=>{e.appendChild(e.model.content)},WebApp.templateCatalog.Icon=e=>{e.if(e=>null!=e,e=>e.if(e=>"fas "==e.substr(0,4)||"fab "==e.substr(0,4)||"far "==e.substr(0,4)||"fal "==e.substr(0,4)||"fad "==e.substr(0,4),e=>e.beginChild("i").set("class","icon").class(e=>e).endChild(),e=>e.beginChild("img").set("class","icon").set("src",e=>e).endChild()))},WebApp.templateCatalog.IconTextView=e=>{e.beginChild("div").class(e=>e.className).visible(e=>e.visible).set("enabled",e=>e.enabled).class(e=>e.status).if(e=>null!=e.icon,e=>e.template("Icon",e=>e.icon)).if(e=>null!=e.text,e=>e.beginChild("span").set("class","text").text(e=>e.text).endChild()).endChild()},WebApp.templateCatalog.IconTextViewInline=e=>{e.class(e=>e.status).if(e=>null!=e.icon,e=>e.template("Icon",e=>e.icon)).if(e=>null!=e.text,e=>e.beginChild("span").set("class","text").text(e=>e.text).endChild())},WebApp.templateCatalog.ImageInline=e=>{e.beginChild("img").class(e=>e.className).set("src",e=>e.content).visible(e=>e.visible).set("enabled",e=>e.enabled).endChild()},WebApp.templateCatalog.Image=e=>{e.beginChild("div").set("class","image-container").visible(e=>e.visible).set("enabled",e=>e.enabled).beginChild("img").class(e=>e.className).set("src",e=>e.content).endChild().endChild()},WebApp.templateCatalog.ItemView=e=>{e.beginChild("div").class(e=>e.className).visible(e=>e.visible).class(e=>e.status).class("activable",e=>e.canOpen).class("compact",e=>!(e.mainActions&&e.mainActions.length>0)).if(e=>e.mainActions&&e.mainActions.length>0,e=>e.beginChild("div").set("class","body-container").template("ItemViewBody",e=>e).endChild().beginChild("div").set("class","main-actions").foreach(e=>e.mainActions,e=>e.content(e=>e)).endChild(),e=>e.template("ItemViewBody",e=>e)).endChild()},WebApp.templateCatalog.ItemViewBody=e=>{e.class("with-menu",e=>e.hasActions).beginChild("div").on("click",e=>e.open()).class("body",e=>!0).if(e=>e.content.count<=1,e=>e.content(e=>e.content.get(0),!0),e=>e.foreach(e=>e.content,e=>e.content(e=>e))).endChild().if(e=>e.canOpen,e=>e.beginChild("i").set("class","open-icon fas fa-angle-right").endChild()).if(e=>e.hasActions,e=>e.beginChild("a").set("class","menu").on("click",e=>e.showMenu()).beginChild("i").set("class","fas fa-ellipsis-v").endChild().endChild())},WebApp.templateCatalog.ItemsEditor=e=>{e.beginChild("div").class(e=>e.className).visible(e=>e.visible).set("enabled",e=>e.enabled).foreach(e=>e.content,e=>e.beginChild("div").set("class","list-item").content(e=>e,!0).endChild()).if(e=>e.canAdd,e=>e.beginChild("div").set("class","add-item").content(e=>e.addAction).endChild()).endChild()},WebApp.templateCatalog.ItemsView=e=>{e.beginChild("div").class(e=>e.className).visible(e=>e.visible).set("enabled",e=>e.enabled).foreach(e=>e.content,e=>e.content(e=>e)).if(e=>0==e.content.count&&null!=e.emptyView,e=>e.content(e=>e.emptyView)).endChild()},WebApp.templateCatalog.ItemsViewWrapped=e=>{e.beginChild("div").class(e=>e.className).visible(e=>e.visible).set("enabled",e=>e.enabled).beginChild("div").set("class","wrapper").foreach(e=>e.content,e=>e.content(e=>e)).if(e=>0==e.content.count&&null!=e.emptyView,e=>e.content(e=>e.emptyView)).endChild().endChild()},WebApp.templateCatalog.ItemsViewForm=e=>{e.beginChild("form").class(e=>e.className).visible(e=>e.visible).set("enabled",e=>e.enabled).foreach(e=>e.content,e=>e.content(e=>e)).if(e=>0==e.content.count&&null!=e.emptyView,e=>e.content(e=>e.emptyView)).endChild()},WebApp.templateCatalog.ListView=e=>{e.beginChild("div").class(e=>e.className).visible(e=>e.visible).set("enabled",e=>e.enabled).behavoir("scroll-check").class(e=>e.status).foreach(e=>e.header,t=>t.beginChild("header").set("class","header-item").content(e=>e).endChild().if(t=>WebApp.injectProxy(t,"$parent",e.model).showSeparator,e=>e.beginChild("div").set("class","separator").endChild())).if(e=>0==e.content.count&&null!=e.emptyView&&"loaded"==e.status,e=>e.content(e=>e.emptyView)).foreach(e=>e.content,t=>t.beginChild("div").set("class","list-item").content(e=>e,!0).endChild().if(t=>WebApp.injectProxy(t,"$parent",e.model).showSeparator,e=>e.beginChild("div").set("class","separator").endChild())).foreach(e=>e.footer,t=>t.beginChild("footer").set("class","footer-item").content(e=>e).endChild().if(t=>WebApp.injectProxy(t,"$parent",e.model).showSeparator,e=>e.beginChild("div").set("class","separator").endChild())).beginChild("div").set("class","loading-item").beginChild("i").set("class","fas fa-circle-notch fa-spin fa-3x fa-fw").endChild().endChild().endChild()},WebApp.templateCatalog.ListViewInline=e=>{e.beginChild("div").set("class","list-view-inline").class(e=>e.className).visible(e=>e.visible).set("enabled",e=>e.enabled).behavoir("scroll-check").class(e=>e.status).if(e=>e.header.count>0,e=>e.foreach(e=>e.header,e=>e.content(e=>e)).if(e=>e.showSeparator,e=>e.beginChild("div").set("class","separator").endChild())).if(e=>0==e.content.count&&null!=e.emptyView&&"loaded"==e.status,e=>e.content(e=>e.emptyView)).foreach(e=>e.content,t=>t.content(e=>e).if(t=>WebApp.injectProxy(t,"$parent",e.model).showSeparator,e=>e.beginChild("div").set("class","separator").endChild())).if(e=>e.footer.count>0,e=>e.foreach(e=>e.footer,e=>e.content(e=>e)).if(e=>e.showSeparator,e=>e.beginChild("div").set("class","separator").endChild())).beginChild("div").set("class","loading-item").beginChild("i").set("class","fas fa-circle-notch fa-spin fa-3x fa-fw").endChild().endChild().endChild()},WebApp.templateCatalog.LocationView=e=>{e.beginChild("div").class(e=>e.className).visible(e=>e.visible).set("enabled",e=>e.enabled).beginChild("address").if(e=>null!=e.content.name,e=>e.beginChild("label").text(e=>e.content.name).endChild()).beginChild("span").text(e=>e.content.address).endChild().endChild().beginChild("img").set("src",e=>e.map).on("click",e=>e.showMap()).endChild().endChild()},WebApp.templateCatalog.MediaEditor=e=>{e.beginChild("div").class(e=>e.className).visible(e=>e.visible).beginChild("div").set("class","media-container").on("click",e=>e.showMenu()).content(e=>e.mediaView).endChild().content(e=>e.fileUpload).endChild()},WebApp.templateCatalog.MediaView=e=>{e.content(e=>e.activeView)},WebApp.templateCatalog.MessageBox=e=>{e.beginChild("div").class(e=>e.className).beginChild("h5").set("class","title").text(e=>e.title).endChild().beginChild("div").set("class","body").if(e=>null!=e.icon,e=>e.template("Icon",e=>e.icon)).beginChild("div").set("class","text").text(e=>e.message).endChild().endChild().beginChild("div").set("class","actions").foreach(e=>e.actions,e=>e.content(e=>e)).endChild().endChild()},WebApp.templateCatalog.MultiItemPicker=e=>{e.beginChild("div").class(e=>e.className).visible(e=>e.visible).set("enabled",e=>e.enabled).class(e=>e.status).beginChild("div").set("class","items-container").beginChild("i").set("class","loading-item fas fa-circle-notch fa-spin fa-fw").endChild().foreach(e=>e.items,e=>e.content(e=>e)).endChild().content(e=>e.selectAction).endChild()},WebApp.templateCatalog.NavBar=e=>{e.beginChild("div").class(e=>e.className).visible(e=>e.visible).set("enabled",e=>e.enabled).beginChild("nav").set("class","nav").foreach(e=>e.content,e=>e.beginChild("button").set("class","button-text").class(e=>e.status).on("click",e=>e.select()).visible(e=>e.visible).behavoir("ripple").content(e=>e).endChild()).endChild().endChild()},WebApp.templateCatalog.SlidePageHost=e=>{e.beginChild("div").set("class","slide-page-host").class(e=>e.activeTransaction).beginChild("div").set("class","page-container").class(e=>e.pageViews[0].className).content(e=>e.pageViews[0].content).endChild().beginChild("div").set("class","page-container").class(e=>e.pageViews[1].className).content(e=>e.pageViews[1].content).endChild().endChild()},WebApp.templateCatalog.SinglePageHost=e=>{e.beginChild("div").set("class","single-page-host").content(e=>e.current.view).endChild()},WebApp.templateCatalog.PermissionRequestItemView=e=>{e.beginChild("div").class(e=>e.className).beginChild("div").set("class","item-content").beginChild("div").set("class","main").content(e=>e.switchView).endChild().beginChild("span").set("class","right bold uppercase").text(e=>WebApp.Format.action("permission-why")).on("click",e=>e.isShowInfo=!0).class("hidden",e=>e.isShowInfo).endChild().endChild().beginChild("div").set("class","info-message on-surface-smaller").text(e=>WebApp.Format.message(e.value.description)).class("hidden",e=>!e.isShowInfo).endChild().endChild()},WebApp.templateCatalog.PopUpContent=e=>{e.beginChild("div").class(e=>e.className).beginChild("h5").set("class","title").text(e=>e.title).endChild().beginChild("div").set("class","body").content(e=>e.contentView).endChild().beginChild("div").set("class","actions").foreach(e=>e.actions,e=>e.content(e=>e)).endChild().endChild()},WebApp.templateCatalog.ProgressView=e=>{e.beginChild("div").class(e=>e.className).visible(e=>e.visible).set("enabled",e=>e.enabled).class("visible",e=>e.visible).beginChild("i").set("class","spinner fas fa-circle-notch fa-spin fa-3x fa-fw").endChild().endChild()},WebApp.templateCatalog.PropertyView=e=>{e.beginChild("div").set("class","action").class(e=>e.className).visible(e=>e.visible).set("enabled",e=>e.enabled).if(e=>e.showLabel&&null!=e.label,e=>e.beginChild("label").set("for",e=>e.editor.uid).text(e=>e.label).endChild()).if(e=>e.readonly,e=>e.beginChild("div").set("class","display-value").text(e=>e.editor.displayValue).endChild(),e=>e.content(e=>e.editor).if(e=>null!=e.error,e=>e.beginChild("span").set("class","error").text(e=>e.error).endChild())).endChild()},WebApp.templateCatalog.RemovableItemView=e=>{e.beginChild("div").class(e=>e.className).visible(e=>e.visible).class(e=>e.status).beginChild("div").set("class","content").content(e=>e.content).endChild().beginChild("button").set("type","button").set("class","remove button-text").set("href","#!").on("click",e=>e.removeAsync()).beginChild("i").set("class","fas fa-times").endChild().endChild().endChild()},WebApp.templateCatalog.SearchView=e=>{e.if(e=>e.isExpanded,e=>e.beginChild("div").set("class","search-container").class(e=>e.className).visible(e=>e.visible).class(e=>e.status).beginChild("input").set("type","text").focus(e=>e.hasFocus).set("enabled",e=>e.enabled).value(e=>e.searchText).set("placeholder",e=>e.tooltip).endChild().beginChild("i").set("class","loading-item fas fa-circle-notch fa-spin fa-fw").endChild().endChild(),e=>e.template("ActionIcon",e=>e))},WebApp.templateCatalog.SectionEditor=e=>{e.beginChild("div").class(e=>e.className).visible(e=>e.visible).set("enabled",e=>e.enabled).content(e=>e.navBar).if(e=>{var t,i;return null!=(null===(i=null===(t=e.navBar.selectedItem)||void 0===t?void 0:t.content)||void 0===i?void 0:i.editor)},e=>e.content(e=>e.navBar.selectedItem.content.editor)).endChild()},WebApp.templateCatalog.SectionsView=e=>{e.beginChild("div").class(e=>e.className).visible(e=>e.visible).set("enabled",e=>e.enabled).foreach(e=>e.content,e=>e.beginChild("section").beginChild("h5").set("class","header").content(e=>e.header).endChild().beginChild("div").set("class","content").content(e=>e.content).endChild().endChild()).endChild()},WebApp.templateCatalog.SelectableItemView=e=>{e.beginChild("div").class(e=>e.className).visible(e=>e.visible).set("enabled",e=>e.enabled).on("click",e=>e.toggle()).class("selected",e=>e.isSelected).class("checkbox",e=>!0).beginChild("div").set("class","checkbox-container").value(e=>e.isSelected).beginChild("i").set("class","fas fa-check").endChild().endChild().content(e=>e.content).endChild()},WebApp.templateCatalog.SimpleItemView=e=>{e.beginChild("div").class(e=>e.className).visible(e=>e.visible).class(e=>e.status).template("Icon",e=>e.icon).beginChild("div").set("class","details").beginChild("h6").text(e=>e.text).endChild().if(e=>null!=e.subText,e=>e.beginChild("div").set("class","sub-text").text(e=>e.subText).endChild()).endChild().endChild()},WebApp.templateCatalog.SingleItemPicker=e=>{e.beginChild("div").class(e=>e.className).visible(e=>e.visible).set("enabled",e=>e.enabled).class(e=>e.status).beginChild("div").set("class","items-container").beginChild("i").set("class","loading-item fas fa-circle-notch fa-spin fa-fw").endChild().content(e=>e.contentView).endChild().if(e=>null!=e.editValue,e=>e.content(e=>e.clearAction)).content(e=>e.selectAction).endChild()},WebApp.templateCatalog.SelectEditor=e=>{e.beginChild("select").set("class","input-element").focus(e=>e.hasFocus).class(e=>e.className).visible(e=>e.visible).set("enabled",e=>e.enabled).set("id",e=>e.uid).behavoir("attach").if(e=>null!=e.placeholder,e=>e.beginChild("option").set("value","").text(e=>e.placeholder).endChild()).foreach(e=>e.items,e=>e.beginChild("option").text(e=>e.content).endChild()).endChild()},WebApp.templateCatalog.SingleItemSelectorList=e=>{e.beginChild("div").set("class","list-view compact").class(e=>e.className).foreach(e=>e.items,e=>e.content(e=>e)).endChild()},WebApp.templateCatalog.SelectorItemView=e=>{e.beginChild("div").set("class","list-item selectable-item-view").on("click",e=>e.select()).class("selected",e=>e.isSelected).content(e=>e.content,!0).endChild()},WebApp.templateCatalog.SelectorItemCheckBox=e=>{e.beginChild("div").set("class","list-item selectable-item-view single checkbox").on("click",e=>e.select()).class("selected",e=>e.isSelected).beginChild("div").set("class","checkbox-container").value(e=>e.isSelected).beginChild("i").set("class","fas fa-check").endChild().endChild().content(e=>e.content).endChild()},WebApp.templateCatalog.SnackBar=e=>{e.beginChild("div").set("class","snack-bar-container").class(e=>e.status).beginChild("div").class(e=>e.className).beginChild("div").set("class","content").on("click",e=>e.hide(null)).content(e=>e.content).endChild().if(e=>null!=e.action,e=>e.content(e=>e.action)).endChild().endChild()},WebApp.templateCatalog.TextEditor=e=>{e.beginChild("input").behavoir("attach").set("class","input-element").set("type","text").value(e=>e.editValue).focus(e=>e.hasFocus).class(e=>e.className).visible(e=>e.visible).set("enabled",e=>e.enabled).set("id",e=>e.uid).set("placeholder",e=>e.placeholder).set("maxlength",e=>e.maxLength).endChild()},WebApp.templateCatalog.NumberEditor=e=>{e.beginChild("input").behavoir("attach").set("class","input-element").set("inputmode","decimal").set("type","text").set("pattern",e=>WebApp.Strings["decimal-input"]()).set("lang",e=>WebApp.app.language).value(e=>e.editValue).focus(e=>e.hasFocus).class(e=>e.className).visible(e=>e.visible).set("enabled",e=>e.enabled).set("id",e=>e.uid).set("placeholder",e=>e.placeholder).endChild()},WebApp.templateCatalog.PasswordEditor=e=>{e.beginChild("input").behavoir("attach").set("class","input-element").set("type","password").value(e=>e.editValue).focus(e=>e.hasFocus).class(e=>e.className).visible(e=>e.visible).set("enabled",e=>e.enabled).set("id",e=>e.uid).set("placeholder",e=>e.placeholder).set("maxlength",e=>e.maxLength).endChild()},WebApp.templateCatalog.TextEditorMultiLine=e=>{e.beginChild("textarea").set("class","input-element").behavoir("attach").value(e=>e.editValue).focus(e=>e.hasFocus).class(e=>e.className).visible(e=>e.visible).set("enabled",e=>e.enabled).set("id",e=>e.uid).set("cols",e=>e.lineCount).set("placeholder",e=>e.placeholder).set("maxlength",e=>e.maxLength).endChild()},WebApp.templateCatalog.TextContent=e=>{e.beginChild("span").class(e=>e.className).visible(e=>e.visible).set("enabled",e=>e.enabled).text(e=>e.content).endChild()},WebApp.templateCatalog.TextView=e=>{e.beginChild("span").class(e=>e.className).visible(e=>e.visible).set("enabled",e=>e.enabled).text(e=>e.text).endChild()},WebApp.templateCatalog.Text=e=>{e.beginChild("span").text(e=>e).endChild()},WebApp.templateCatalog.ToastContainer=e=>{e.foreach(e=>e,e=>e.content(e=>e))},WebApp.templateCatalog.Toast=e=>{e.beginChild("div").class(e=>e.className).text(e=>e.message).class("visible",e=>e.visible).endChild()},WebApp.templateCatalog.VideoView=e=>{e.beginChild("div").set("class","video-container").visible(e=>e.visible).set("enabled",e=>e.enabled).class(e=>e.className).beginChild("video").set("src",e=>e.content).behavoir("attach").endChild().endChild()},WebApp.templateCatalog.VideoViewInline=e=>{e.beginChild("video").visible(e=>e.visible).set("enabled",e=>e.enabled).class(e=>e.className).set("src",e=>e.content).behavoir("attach").endChild()},WebApp.templateCatalog.WebView=e=>{e.beginChild("iframe").class(e=>e.className).visible(e=>e.visible).set("enabled",e=>e.enabled).set("src",e=>e.content).behavoir("attach").endChild()},WebApp.templateCatalog.WizardView=e=>{e.beginChild("div").class(e=>e.className).visible(e=>e.visible).set("enabled",e=>e.enabled).beginChild("div").set("class","wizard-steps").beginChild("ul").foreach(e=>e.content,t=>t.beginChild("li").text(e=>e.index+1).class("active",e=>e.isActive).class("done",t=>t.index<WebApp.injectProxy(t,"$parent",e.model).currentStepIndex).endChild()).endChild().endChild().if(e=>null!=e.currentView,e=>e.beginChild("h5").set("class","title").text(e=>e.currentView.title).endChild().if(e=>null!=e.currentView.coverImage,e=>e.beginChild("div").set("class","cover-image").template("Icon",e=>e.currentView.coverImage).endChild()).content(e=>e.currentView)).beginChild("div").set("class","actions").content(e=>e.actions.next).content(e=>e.actions.finish).foreach(e=>e.currentView.actions,e=>e.content(e=>e)).endChild().endChild()},function(e){!function(t){let i;!function(t){t.saveState=function(t,i){return __awaiter(this,void 0,void 0,(function*(){let s=yield e.Http.postJsonAsync("~/SaveState/"+t,i);if(!s.isSuccess)throw s.error;return s.data}))},t.loadState=function(t){return __awaiter(this,void 0,void 0,(function*(){let i=yield e.Http.getJsonAsync("~/LoadState/"+t);if(!i.isSuccess)throw i.error;return i.data}))},t.loadStudioData=function(){return __awaiter(this,void 0,void 0,(function*(){return yield e.Http.getJsonAsync("~/StudioData")}))}}(i=t.Api||(t.Api={}))}(e.GeoPlot||(e.GeoPlot={}))}(WebApp||(WebApp={})),function(e){let t;!function(t){t.GeoPlotApplication=class{constructor(){}initServices(){e.Services.httpClient=new e.XHRHttpClient}}}(t=e.GeoPlot||(e.GeoPlot={})),e.app=new t.GeoPlotApplication}(WebApp||(WebApp={})),HTMLCanvasElement.prototype.toBlob||Object.defineProperty(HTMLCanvasElement.prototype,"toBlob",{value:function(e,t,i){let s=this;setTimeout(()=>{const n=atob(s.toDataURL(t,i).split(",")[1]),a=n.length,o=new Uint8Array(a);for(let e=0;e<a;e++)o[e]=n.charCodeAt(e);e(new Blob([o],{type:t||"image/png"}))})}}),window.Chart&&Chart.plugins.register({beforeDraw:function(e){var t=e.ctx;t.fillStyle="white",t.fillRect(0,0,e.width,e.height)}}),function(e){!function(t){t.ConstIndicatorFunction=class{constructor(e){this._value=e}value(t,i,s,n,a){let o=this._value(t,a);if(s)for(var r in s)o=e.MathUtils.sumNull(o,-this.value(s[r],n[r],null,null,a));return o}};t.SimpleIndicatorFunction=class{constructor(e){this._value=e}value(e,t,i,s,n){var a=this._value(e,n);if(t&&(a-=this._value(t,n)),i)for(var o in i)a-=this.value(i[o],s[o],null,null,n);return a}};t.CombineIndicatorFunction=class{constructor(e,t){this._value=t,this._indicators=e}value(e,t,i,s,n){const a={};for(var o in this._indicators)a[o]=this._indicators[o].value(e,t,i,s,n);return this._value(a)}};t.SimpleFactorFunction=class{constructor(e){this._value=e}value(t,i,s,n,a,o){let r;for(var l in t)r=e.MathUtils.sumNull(r,o.value(t[l],i[l],s[l],n[l],a));return this._value(r,t[0],a)}};t.DoubleFactorFunction=class{constructor(e,t){this._value=e,this._factor=t}value(t,i,s,n,a,o){let r,l;for(var c in t)r=e.MathUtils.sumNull(r,o.value(t[c],i[c],s[c],n[c],a)),l=e.MathUtils.sumNull(l,this._factor.value(t[c],i[c],s[c],n[c],a));return this._value(r,l)}};t.IndicatorCalculator=class{constructor(e,t,i){this.data=e,this.dataSet=t,this.geo=i}getDataAtDay(e,t){if(e<0)return;const i=this.data.days[e];if(i){const e=i.values[t];if(e)return e}return this.dataSet.empty}getFactorValue(t){const i=("string"==typeof t.areaOrId?t.areaOrId:t.areaOrId.id).toLowerCase();let s;s=Array.isArray(t.dayNumberOrGroup)?t.dayNumberOrGroup:[t.dayNumberOrGroup];let n=[],a=[],o=[],r=[];for(var l of s)if(n.push(this.getDataAtDay(l,i)),t.isDayDelta&&a.push(this.getDataAtDay(l-1,i)),t.execludedAreas){var c=[],d=[];for(var h of t.execludedAreas)c.push(this.getDataAtDay(l,h.toLowerCase())),t.isDayDelta&&d.push(this.getDataAtDay(l-1,h.toLowerCase()));o.push(c),r.push(d)}const u=e.linq(this.dataSet.factors).first(e=>e.id==t.factorId),p=e.linq(this.dataSet.indicators).first(e=>e.id==t.indicatorId);return u.compute.value(n,a,o,r,this.geo.areas[i],p.compute)}getIndicatorValue(t){const i=("string"==typeof t.areaOrId?t.areaOrId:t.areaOrId.id).toLowerCase(),s=e.linq(this.dataSet.indicators).first(e=>e.id==t.indicatorId);let n,a,o,r=this.getDataAtDay(t.dayNumber,i);if(t.isDayDelta&&(n=this.getDataAtDay(t.dayNumber-1,i)),t.execludedAreas)for(var l of(a=[],o=[],t.execludedAreas))a.push(this.getDataAtDay(t.dayNumber,l.toLowerCase())),t.isDayDelta&&o.push(this.getDataAtDay(t.dayNumber-1,l.toLowerCase()));return s.compute.value(r,n,a,o,this.geo.areas[i])}getSerie(e){const t=[];if(e.groupSize>1){let i=e.groupSize,s=[];for(let n=0+e.startDay;n<this.data.days.length;n++)if(s.push(n),i--,0==i){const a={x:"date"==e.xAxis?new Date(this.data.days[n].date):n,y:this.getFactorValue({dayNumberOrGroup:e.isDelta?s:n,areaOrId:e.areaId,factorId:e.factorId,indicatorId:e.indicatorId,execludedAreas:e.exeludedAreaIds,isDayDelta:e.isDelta})};t.push(a),i=e.groupSize,s=[]}}else for(let i=0+e.startDay;i<this.data.days.length;i++){const s={x:"date"==e.xAxis?new Date(this.data.days[i].date):i,y:this.getFactorValue({dayNumberOrGroup:i,areaOrId:e.areaId,factorId:e.factorId,indicatorId:e.indicatorId,execludedAreas:e.exeludedAreaIds,isDayDelta:e.isDelta})};t.push(s)}return t}}}(e.GeoPlot||(e.GeoPlot={}))}(WebApp||(WebApp={})),function(e){!function(e){let t,i,s;!function(e){e[e.SUm=0]="SUm",e[e.Avg=1]="Avg"}(t=e.AggregationFunc||(e.AggregationFunc={})),function(e){e[e.Continent=0]="Continent",e[e.CountryGroup=1]="CountryGroup",e[e.Country=2]="Country",e[e.State=3]="State",e[e.Region=4]="Region",e[e.District=5]="District",e[e.Municipality=6]="Municipality"}(i=e.GeoAreaType||(e.GeoAreaType={})),function(e){e[e.All=0]="All",e[e.Male=1]="Male",e[e.Female=2]="Female"}(s=e.Gender||(e.Gender={})),e.MATERIAL_COLORS={red:{600:"#f44336"},pink:{600:"#e91e63"},purple:{600:"#9c27b0"},deep_purple:{600:"#673ab7"},indigo:{600:"#3f51b5"},blue:{600:"#2196f3"},light_blue:{600:"#03a9f4"},cyan:{600:"#00bcd4"},teal:{600:"#009688"},green:{600:"#4caf50"},light_green:{600:"#8bc34a"},lime:{600:"#cddc39"},yellow:{600:"#ffeb3b"},amber:{600:"#ffc107"},orange:{600:"#ff9800"},depp_orange:{600:"#ff5722"},brown:{600:"#795548"},grey:{600:"#9e9e9e"},blue_gray:{600:"#607d8b"}}}(e.GeoPlot||(e.GeoPlot={}))}(WebApp||(WebApp={})),function(e){!function(t){t.BaseTreeItem=class{constructor(){this.name=ko.observable(),this.color=ko.observable(),this.canDrag=!1}canReadData(e){return!1}readData(e){}writeData(e){return!1}attachNode(e){this.node=e}remove(){}onParentChanged(){}canAccept(e){return!1}};t.ActionView=class{execute(){}};t.TreeNode=class{constructor(e){this._dargEnterCount=0,this._childLoaded=!1,this.nodes=ko.observableArray(),this.value=ko.observable(),this.isSelected=ko.observable(!1),this.isVisible=ko.observable(!0),this.isExpanded=ko.observable(!1),this.actions=ko.observable(),this.value(e),this.isExpanded.subscribe(e=>__awaiter(this,void 0,void 0,(function*(){e&&!this._childLoaded&&(yield this.loadChildNodes(),this._childLoaded=!0)}))),this.isSelected.subscribe(e=>{e&&this._treeView.select(this)})}loadChildNodes(){return __awaiter(this,void 0,void 0,(function*(){}))}clear(){this._childLoaded=!1,this.nodes.removeAll()}get element(){return this._element}attachNode(t){this._element=t,this._element.id=e.DomUtils.generateId(),this._element.$model=this,this._element.addEventListener("keydown",e=>this.onKeyDown(e));let i=this._element.querySelector("header");i.ondragstart=e=>this.onDrag(e),i.ondragover=e=>this.onDragOver(e),i.ondragenter=e=>this.onDragEnter(e),i.ondragleave=e=>this.onDragLeave(e),i.ondrop=e=>this.onDrop(e)}onKeyDown(e){46==e.keyCode&&"INPUT"!=e.target.tagName&&(e.preventDefault(),this.isSelected()&&this.value().remove())}onDrag(e){if(!this.value().writeData(e.dataTransfer)||!this.value().canDrag)return e.preventDefault(),!1}onDragEnter(e){this._dargEnterCount++}onDragLeave(t){this._dargEnterCount--,0==this._dargEnterCount&&e.DomUtils.removeClass(this._element,"drop")}onDragOver(t){if(t.preventDefault(),1==this._dargEnterCount){let i=!0;this.value().canReadData(t.dataTransfer)||(i=!1),i?(t.ctrlKey?t.dataTransfer.dropEffect="copy":t.dataTransfer.dropEffect="move",e.DomUtils.addClass(this._element,"drop")):t.dataTransfer.dropEffect="move"}}onDrop(t){t.preventDefault(),this._dargEnterCount=0,e.DomUtils.removeClass(this._element,"drop");const i=t.dataTransfer.getData("text/html+id");if(i){const e=document.getElementById(i).$model;if(!this.value().canAccept(e.value()))return;if(!t.ctrlKey){if(e._parentNode==this)return;return e._parentNode.nodes.remove(e),e._parentNode=this,this.nodes.push(e),this.isExpanded(!0),void e.value().onParentChanged()}}else this.value().readData(t.dataTransfer)}remove(){this._parentNode&&this._parentNode.nodes.remove(this),this._treeView.selectedNode()==this&&this._treeView.select(null)}addNode(e){e.attach(this._treeView,this),this.nodes.push(e)}attach(e,t){this._treeView=e,this._parentNode=t;for(let t of this.nodes())t.attach(e)}get parentNode(){return this._parentNode}toggleVisible(){this.isVisible(!this.isVisible())}select(e=!1){if(this.isSelected(!0),this._element&&this._element.focus(),e){let e=this;for(;e;)e.isExpanded(!0),e=e.parentNode}}expandCollapse(){this.isExpanded(!this.isExpanded())}};t.TreeView=class{constructor(){this.root=ko.observable(),this.selectedNode=ko.observable()}select(e){this.selectedNode()!=e&&(this.selectedNode()&&this.selectedNode().isSelected(!1),this.selectedNode(e),this.selectedNode()&&this.selectedNode().isSelected(!0))}setRoot(e){e.attach(this),this.root(e)}}}(e.GeoPlot||(e.GeoPlot={}))}(WebApp||(WebApp={})),function(e){!function(t){class i extends t.BaseTreeItem{constructor(){super(),this._isUpdating=0,this.time=ko.observable(0),this.parameters=ko.observableArray()}createActions(i){i.push(e.apply(new t.ActionView,e=>{e.text=$string("$(delete)"),e.icon="delete",e.execute=()=>this.remove()}))}setState(e){this._isUpdating++,e.name&&this.name(e.name),null!=e.visible&&this.node.isVisible(e.visible),e.color&&this.color(e.color),null!=e.opened&&this.node.isExpanded(e.opened),e.folderId&&(this.folderId=e.folderId),this.setStateWork(e),this.updateGraph(),this.setChildrenStateWork(e),this._isUpdating--}getState(){return{name:this.name(),visible:this.node.isVisible(),folderId:this.folderId,color:this.color(),opened:this.node.isExpanded()}}getVar(e){return this._varsMap[e]}remove(e=!0){this._graphCtx&&(this._graphCtx.calculator.removeExpression({id:this.getGraphId("private")}),this._graphCtx.calculator.removeExpression({id:this.getGraphId("public")})),this.node.remove(),e&&this.children.foreach(e=>e.remove())}attachNode(e){this.node=e,this.node.isVisible.subscribe(e=>this.updateGraphVisibility()),this.node.isSelected.subscribe(e=>{e&&this.onSelected()});const t=[];this.createActions(t),this.node.actions(t)}attachGraph(e){this._graphCtx=e,this._graphCtx.calculator.observe("expressionAnalysis",()=>this.onGraphChanged()),this.color.subscribe(e=>this.updateColor())}isFullVisible(){let e=this.node;for(;e;){if(!e.isVisible())return!1;e=e.parentNode}return!0}updateGraphVisibility(e=!0){const t=this.isFullVisible();return this._graphCtx.setItemVisibile(this.getGraphId("public"),t),this._graphCtx.setItemVisibile(this.getGraphId("private"),t),e&&this.children.foreach(e=>e.updateGraphVisibility()),t}updateGraph(t=!0){if(!this._graphCtx)return;this.folderId||(this.folderId=e.StringUtils.uuidv4()),this._graphCtx.treeItems[this.folderId]=this;const i=this.getExpressions();this._graphCtx.setExpressions(i),this.updateGraphWork(),this.updateGraphVisibility(),this.updateParameters(),t&&this.children.foreach(e=>e.updateGraph(t))}onParentChanged(){this.updateGraphVisibility()}get parent(){return this.node.parentNode.value()}get children(){return e.linq(this.node.nodes()).select(e=>e.value())}replaceVars(e){for(let t in this._varsMap){const i=new RegExp("\\$"+t,"g");e=e.replace(i,this._varsMap[t])}return e}getGraphId(e){return this.folderId+"/"+e}addChildrenWork(e,i=!0){const s=new t.TreeNode(e);return this.node.addNode(s),e.attachNode(s),e.attachGraph(this._graphCtx),i&&e.updateGraph(),e.onParentChanged(),e}createParameters(e){return!1}updateParameters(){const e=[];this.createParameters(e)&&(this.parameters.removeAll(),e.forEach(e=>this.parameters.push(e)))}updateGraphWork(){}setChildrenStateWork(e){}onSelected(){this.mainExpression&&this._graphCtx&&this._graphCtx.setSelectedId(this.mainExpression)}onGraphChanged(){}updateColor(){}}t.BaseStudioItem=i}(e.GeoPlot||(e.GeoPlot={}))}(WebApp||(WebApp={})),function(e){!function(e){class t{constructor(){for(var t in this.isOpened=ko.observable(!1),this.colors=[],e.MATERIAL_COLORS)this.addColor(e.MATERIAL_COLORS[t][600]);this._mouseDown=e=>this.onMouseDown(e)}attachNode(e){this._element=e,document.body.appendChild(this._element)}pick(){return __awaiter(this,void 0,void 0,(function*(){return yield this.open(),new Promise(e=>this._onSelected=e)}))}addColor(e){this.colors.push({value:e,select:()=>{this._onSelected&&this._onSelected(e),this._onSelected=null,this.close()}})}open(){return __awaiter(this,void 0,void 0,(function*(){if(!this.isOpened()){if(this.isOpened(!0),window.event){const e=window.event,t={x:e.pageX,y:e.pageY};this._element.style.left=t.x+"px",this._element.style.top=t.y-this._element.clientHeight+"px"}document.body.addEventListener("mousedown",this._mouseDown)}}))}close(){this.isOpened()&&(this.isOpened(!1),document.body.removeEventListener("mousedown",this._mouseDown))}onMouseDown(e){e.target.parentElement!=this._element&&(this._onSelected&&this._onSelected(void 0),this._onSelected=null,this.close())}}t.instance=new t,e.ColorPicker=t}(e.GeoPlot||(e.GeoPlot={}))}(WebApp||(WebApp={})),function(e){!function(t){class i{constructor(){this._dargEnterCount=0}attachNode(e){this._element=e,e.ondragover=e=>this.onDragOver(e),e.ondrop=e=>this.onDrop(e),e.ondragenter=e=>this.onDragEnter(e),e.ondragleave=e=>this.onDragLeave(e)}onFileDropped(e){}onDragEnter(e){this._dargEnterCount++}onDragLeave(t){this._dargEnterCount--,0==this._dargEnterCount&&e.DomUtils.removeClass(this._element,"drop")}onDragOver(t){t.preventDefault(),1==this._dargEnterCount&&e.DomUtils.addClass(this._element,"drop")}onDrop(t){return __awaiter(this,void 0,void 0,(function*(){if(t.preventDefault(),this._dargEnterCount=0,e.DomUtils.removeClass(this._element,"drop"),1==t.dataTransfer.files.length){if(t.dataTransfer.files[0].name.toLowerCase().endsWith(".csv")){const e=yield t.dataTransfer.files[0].text();return void this.onFileDropped(e)}}M.toast({html:$string("$(msg-not-supported-only-csv)")})}))}}t.FileDragDrop=i;class s{constructor(){this._showCount=0,this.message=ko.observable(),this.percentage=ko.observable(),this.status=ko.observable(),this.status("hidden"),e.Operation.onBegin.add((e,t)=>this.show(t)),e.Operation.onEnd.add((e,t)=>this.hide(t)),e.Operation.onProgress.add((e,t)=>this.update(t.operation,t.progress))}show(e){0==this._showCount&&(this.status("indefinite"),this.percentage(100)),this.message(e.message),this._showCount++}update(e,t){this.message(e.getProgressDescription(t)),null!=t.totCount&&null!=t.current?(this.percentage(Math.min(100,t.current/t.totCount*100)),this.status("show")):(this.status("show"),this.percentage(100))}hide(e){this._showCount--,0==this._showCount&&this.status("hidden")}}t.ProgressViewModel=s;class n{constructor(t){this.alias=ko.observable(),this.type=ko.observable(),this.types=[{text:$string("$(exclude)"),value:e.DaColumnType.Exclude},{text:$string("$(x-axis)"),value:e.DaColumnType.XAxis},{text:$string("$(serie)"),value:e.DaColumnType.Serie},{text:$string("$(group)"),value:e.DaColumnType.Group}],this.value=t,this.type(t.type),this.alias(t.name)}}class a extends t.BaseTreeItem{constructor(e){super(),this.value=e,this.icon="folder",this.itemType="group",this.color("#ffc107"),this.name(e.name)}attachNode(e){super.attachNode(e),e.isVisible.subscribe(e=>{for(var t of this.node.nodes())t.isVisible(e)})}}class o extends t.BaseTreeItem{constructor(e){super(),this.value=e,this.icon="insert_chart",this.itemType="serie",this.color("#4caf50"),this.name(e.name)}}t.DataImportControl=class{constructor(){this.hasHeader=ko.observable(),this.columnSeparator=ko.observable(),this.columns=ko.observable(),this.table=ko.observable(),this.treeView=new t.TreeView,this.progress=new s,this.hasData=ko.observable(!1),this.sourceUrl=ko.observable(),this.fileDrop=new i,this.columnSeparators=[{text:$string("$(tab-key)"),value:"\t"},{text:",",value:","},{text:";",value:";"},{text:$string("$(sapce-key)"),value:" "}],this.treeView.setRoot(new t.TreeNode),this.treeView.selectedNode.subscribe(e=>this.onNodeSelected(e)),this.fileDrop.onFileDropped=e=>this.importText(e)}importText(t,i){return __awaiter(this,void 0,void 0,(function*(){if(M.toast({html:$string("$(msg-start-analysis)")}),this.hasData(!0),yield e.PromiseUtils.delay(0),this._text=t,this._adapter=new e.TextTableDataAdapter,this._options=yield this._adapter.analyzeAsync(this._text,i,5e3),!this._options.columnSeparator||!this._options.rowSeparator||!this._options.columns||this._options.columns.length<2)return!1;this.hasHeader(this._options.hasHeader),this.columnSeparator(this._options.columnSeparator);const s=[];for(let e of this._options.columns){var a=new n(e);s.push(a)}return this.columns(s),yield this.updatePreview(),!0}))}getSelectedData(){return __awaiter(this,void 0,void 0,(function*(){const e=[];return yield this.getSelectedDataWork(this.treeView.root(),[],e),e}))}getSelectedDataWork(e,t,i){return __awaiter(this,void 0,void 0,(function*(){if(e.isVisible())if(e.value()instanceof o){const s=e.value().value,n={type:"data-import",options:this._options,serie:s,groups:t};i.push(n)}else{if(e.isExpanded()||(yield e.loadChildNodes()),e.value()instanceof a){const i=e.value().value;let s=t.slice(0,t.length);s.push({id:i.colId,value:i.name}),t=s}for(let s of e.nodes())yield this.getSelectedDataWork(s,t,i)}}))}executeImport(){return __awaiter(this,void 0,void 0,(function*(){const e=yield this.getSelectedData();this._onGetData&&(this._onGetData(e),this._onGetData=null),this._model.close()}))}applyChanges(){return __awaiter(this,void 0,void 0,(function*(){this._options.hasHeader=this.hasHeader(),this._options.columnSeparator=this.columnSeparator(),this._options.columns.forEach((e,t)=>{e.name=this.columns()[t].alias(),e.type=this.columns()[t].type()}),yield this.updatePreview(!0)}))}updateGroups(){return __awaiter(this,void 0,void 0,(function*(){const e=yield this._adapter.loadGroupAsync(this._text,this._options);let i=new t.TreeNode(new a(e));this.treeView.root().clear(),this.treeView.root().addNode(i),i.value().attachNode(i),this.updateNode(i,e),i.isExpanded(!0)}))}updateNode(i,s){if(i.clear(),s.groups)for(let n of e.linq(s.groups)){let e=new t.TreeNode(new a(n.value));e.loadChildNodes=()=>__awaiter(this,void 0,void 0,(function*(){return this.updateNode(e,n.value)})),i.addNode(e),e.value().attachNode(e)}if(s.series)for(let n of e.linq(s.series)){let e=new t.TreeNode(new o(n.value));i.addNode(e),e.value().attachNode(e)}}updateTable(){return __awaiter(this,void 0,void 0,(function*(){const t=yield this._adapter.loadTableAsync(this._text,this._options,50),i={header:e.linq(this._options.columns).where(t=>t.type!=e.DaColumnType.Exclude).select(e=>e.name).toArray(),rows:e.linq(t).select(t=>e.linq(t).select(e=>this.format(e.value)).toArray()).toArray()};this.table(i)}))}format(t){return"number"==typeof t?formatNumber(t):"boolean"==typeof t?$string(t?"$(yes)":"$(no)"):t instanceof Date?e.DateUtils.format(t,$string("$(date-format)")):t}updatePreview(e=!1){return __awaiter(this,void 0,void 0,(function*(){e||this._options.rowsCount<4999?yield this.updateGroups():this.treeView.root().clear(),yield this.updateTable()}))}onNodeSelected(t){if(t&&t.value()instanceof o){const i=t.value().value,s={header:[e.linq(this._options.columns).where(t=>t.type==e.DaColumnType.XAxis).select(e=>e.name).first(),i.name],rows:e.linq(i.values).take(50).select(e=>[this.format(e.x),this.format(e.y)]).toArray()};this.table(s)}else this.table(null)}show(){return this._model||(this._model=M.Modal.init(document.getElementById("dataImport"),{onCloseEnd:e=>{this._onGetData&&this._onGetData([]),this.reset()}})),this._model.open(),new Promise(e=>this._onGetData=e)}reset(){this._text=null,this._options=null,this._onGetData=null,this.hasData(!1),this.treeView.root().clear(),this.table(null)}importUrl(){return __awaiter(this,void 0,void 0,(function*(){const t=e.Operation.begin($string("$(msg-download-progress)"));try{let e=yield fetch(this.sourceUrl());if(e.ok){const t=yield e.text();if(t)return void this.importText(t)}M.toast({html:$string("$(msg-download-error): "+e.statusText)})}finally{t.end()}}))}}}(e.GeoPlot||(e.GeoPlot={}))}(WebApp||(WebApp={})),function(e){!function(t){t.GraphContext=class{constructor(){this.vars={},this.treeItems={}}setExpressions(t){const i=this.calculator.getState();for(let s of t){const t=e.linq(i.expressions.list).first(e=>e.id==s.id);if(t)for(let e of Object.getOwnPropertyNames(s))t[e]=s[e];else i.expressions.list.push(s)}const s=e.linq(i.expressions.list).where(e=>"folder"!=e.type).groupBy(e=>e.folderId?e.folderId:"").toDictionary(e=>e.key,e=>e.values.toArray()),n=[];for(let t of e.linq(i.expressions.list).where(e=>"folder"==e.type)){n.push(t);const e=s[t.id];if(e)for(let t of e)n.push(t)}const a=s[""];if(a)for(let e of a)n.push(e);i.expressions.list=n,this.calculator.setState(i)}setSelectedId(e){this.calculator.controller.listModel.selectedItem&&this.calculator.controller.listModel.selectedItem.id==e||this.calculator.controller.dispatch({type:"set-selected-id",id:e})}setColor(e,t){this.calculator.controller.dispatch({type:"set-item-color",id:e,color:t})}updateTable(t,i){const s=e.linq(this.calculator.getExpressions()).where(e=>e.id==t).first();s&&(s.columns[0].values=e.linq(i).select(e=>e.x.toString()).toArray(),s.columns[1].values=e.linq(i).select(e=>e.y.toString()).toArray(),this.calculator.setExpression(s))}updateExpression(e){this.calculator.setExpression(e)}updateVariable(e,t,i){t&&this.updateExpression({id:e,latex:t+"="+i.toString()})}expressionZoomFit(e){this.calculator.controller.dispatch({type:"expression-zoom-fit",id:e})}setItemVisibile(e,t){this.updateExpression({id:e,hidden:!t})}generateVars(e){for(let t in e)e[t]||(e[t]=this.generateVar(t))}generateVar(e="a"){return this.vars[e[0]]||(this.vars[e[0]]=0),this.vars[e[0]]++,e[0]+"_{"+this.vars[e[0]]+"}"}}}(e.GeoPlot||(e.GeoPlot={}))}(WebApp||(WebApp={})),function(e){!function(t){class i extends t.BaseStudioItem{constructor(e){super(),this.time=ko.observable(0),this.aggregationMode=ko.observable("none"),this.itemType="project",this.icon="folder",this.optionsTemplateName="ProjectOptionsTemplate",this.aggregationModes=[{text:$string("$(none)"),value:"none"},{text:$string("$(sum)"),value:"sum"},{text:$string("$(average)"),value:"avg"}],this._varsMap={time:null,xagg:null,yagg:null},e&&this.setState(e)}createActions(i){super.createActions(i),i.push(e.apply(new t.ActionView,e=>{e.text=$string("$(update-all-proj)"),e.icon="autorenew",e.execute=()=>this.updateAllSerie()}))}updateAllSerie(){return __awaiter(this,void 0,void 0,(function*(){for(let e of this.children)yield e.updateSerie()}))}canAccept(e){return e instanceof t.StudioSerie}canReadData(e){return-1!=e.types.indexOf("application/json+studio")}readData(e){const i=e.getData("application/json+studio");let s=t.StudioSerie.fromText(i);s&&(this.addSerie(s),this.node.isExpanded(!0))}getExpressions(){return this._graphCtx.generateVars(this._varsMap),[{type:"folder",id:this.getGraphId("public"),title:this.name(),collapsed:!0},{type:"folder",id:this.getGraphId("private"),title:this.name(),secret:!0,collapsed:!0},{type:"expression",folderId:this.getGraphId("public"),id:this.getGraphId("time"),latex:this._varsMap.time+"="+this.time(),slider:{hardMin:!0,hardMax:!0,min:"0",max:"100",step:"1"}},{type:"table",id:this.getGraphId("aggregate"),folderId:this.getGraphId("private"),columns:[{id:this.getGraphId("table/xagg"),latex:this._varsMap.xagg},{id:this.getGraphId("table/yagg"),latex:this._varsMap.yagg,lines:!0,points:!0}]}]}updateAggregate(){const t={},i=this.children.toArray();for(var s of i){const e=parseInt(s.offsetX());for(var n of s.values){const i=n.x+e;i in t?t[i]+=n.y:t[i]=n.y}}const a=e.linq(t).orderBy(e=>e.key).select(e=>({x:e.key,y:e.value})).toArray();this._graphCtx.updateTable(this.getGraphId("aggregate"),a)}updateColor(){this._graphCtx.setColor(this.getGraphId("aggregate"),this.color())}get mainExpression(){return this.getGraphId("aggregate")}createParameters(i){return i.push(e.apply(new t.ParameterViewModel({value:this.time,name:$string("$(day)")}),e=>{e.max(100),e.min(0),e.step(1)})),!0}setStateWork(e){null!=e.time&&this.time(e.time),e.aggregationMode?this.aggregationMode(e.aggregationMode):this.aggregationMode("none")}setChildrenStateWork(e){null!=e.children&&(this.children.foreach(e=>e.remove()),e.children.forEach(e=>{this.addSerie(null,!1).setState(e)})),"none"!=this.aggregationMode()&&this.updateAggregate()}getState(){const e=super.getState();return e.time=this.time(),e.children=this.children.select(e=>e.getState()).toArray(),e.aggregationMode=this.aggregationMode(),e}onGraphChanged(){}attachGraph(e){super.attachGraph(e),this.time.subscribe(e=>this._graphCtx.updateVariable(this.getGraphId("time"),this._varsMap.time,this.time())),this.aggregationMode.subscribe(e=>this.updateAggregate())}addSerie(e,i=!0){return this.addChildrenWork(e instanceof t.StudioSerie?e:new t.StudioSerie(e),i)}}t.StudioProject=i}(e.GeoPlot||(e.GeoPlot={}))}(WebApp||(WebApp={})),function(e){!function(t){function i(e){if(null!=e&&null!=e)return e.toString()}class s{constructor(){this.vars=ko.observable()}select(){}}class n{constructor(){this.curValue=ko.observable(),this.autoCompute=ko.observable(),this.min=ko.observable(),this.max=ko.observable(),this.step=ko.observable()}}class a extends t.BaseStudioItem{constructor(e){super(),this._varsMap={},this.selectedFunction=ko.observable(),this.showIntegration=ko.observable(!0),this.maxDay=ko.observable(),this.endDay=ko.observable(),this._varsMap={fun:null,sum:null,n1:null,n2:null,value:null,time:null,tend:null,xp:null},this.itemType="regression",this.icon="show_chart",this.optionsTemplateName="RegressionOptionsTemplate",this.functions=[],this.addFunction({name:$string("$(log-normal)"),type:"log-normal",value:"$y\\sim $c\\cdot\\frac{ e^ {-\\frac{ \\left(\\ln\\ \\left($x - $a\\right) \\ -$u\\right)^ { 2}} { 2$o^ { 2} }}}{ \\left($x - $a\\right) \\sqrt{ 2\\pi } $o }",vars:[{name:"a",label:$string("$(offset)"),autoCompute:!0,precision:0},{name:"c",label:$string("$(total)"),autoCompute:!0,precision:0},{name:"o",label:$string("$(variance)"),autoCompute:!0,precision:5},{name:"u",label:$string("$(average)"),autoCompute:!0,precision:5}]}),this.addFunction({name:$string("$(normal)"),type:"normal",value:"$y\\sim $c\\cdot\\ \\left(\\frac{1}{\\sqrt{2\\cdot\\pi}\\cdot $o}\\right)\\cdot e^{-\\frac{1}{2}\\cdot\\left(\\frac{\\left($x-$u\\right)}{$o}\\right)^{2}}",vars:[{name:"c",label:$string("$(total)"),autoCompute:!0,precision:0},{name:"o",label:$string("$(variance)"),autoCompute:!0,precision:5},{name:"u",label:$string("$(avg-peak)"),autoCompute:!0,precision:0}]}),this.addFunction({name:$string("$(exponential)"),type:"exponential",value:"$y\\sim $a^{\\left($x-$b\\right)}",vars:[{name:"a",label:$string("$(base)"),autoCompute:!0,precision:5},{name:"b",label:$string("$(offset)"),autoCompute:!0,precision:5}]}),this.addFunction({name:$string("$(linear)"),type:"linear",value:"$y\\sim $a+$m$x",vars:[{name:"a",label:$string("$(offset)"),autoCompute:!0,precision:5},{name:"m",label:$string("$(slope)"),autoCompute:!0,precision:5}]}),this.showIntegration.subscribe(()=>{this._graphCtx.setItemVisibile(this.getGraphId("sum-serie"),this.isFullVisible()&&this.showIntegration()),this._graphCtx.setItemVisibile(this.getGraphId("sum-point"),this.isFullVisible()&&this.showIntegration())}),this.selectedFunction.subscribe(e=>{if(!this.name()&&e)return this.name(e.value.name)}),this.endDay.subscribe(e=>this.updateEndDay()),this.maxDay.subscribe(e=>this.updateEndDay()),this.selectedFunction(this.functions[0]),e&&this.setState(e)}get mainExpression(){return this.getGraphId("main-func")}addFunction(e){const t=new s;t.value=e,t.select=()=>{this.selectedFunction(t),this.name(t.value.name),this.updateGraph()};const i=[];for(let t of e.vars){const e=new n;e.value=t,e.curValue(t.value),e.autoCompute(t.autoCompute),e.min(t.minValue),e.max(t.maxValue),e.step(t.step),e.min.subscribe(e=>t.minValue=e),e.max.subscribe(e=>t.maxValue=e),e.step.subscribe(e=>t.step=e),e.curValue.subscribe(e=>t.value=e),e.autoCompute.subscribe(e=>{t.autoCompute=e,this.updateGraph()}),e.curValue.subscribe(i=>{e.autoCompute()||this._graphCtx.updateVariable(this.getGraphId(t.name+"-value"),this.getVar(t.name),i)}),i.push(e)}return t.vars(i),this.functions.push(t),t}onGraphChanged(){this.updateRegressionVars()}updateRegressionVars(){let t=this._graphCtx.calculator.controller.getItemModel(this.getGraphId("main"));if(t&&t.regressionParameters)for(let i of this.selectedFunction().vars()){const s=this.getVar(i.value.name).replace("{","").replace("}","");let n=t.regressionParameters[s];null!=n&&(null!=i.value.precision&&(n=e.MathUtils.round(n,i.value.precision)),i.curValue(n))}}createParameters(i){return i.push(e.apply(new t.ParameterViewModel({value:this.endDay,name:$string("$(reg-days)")}),e=>{e.max=this.maxDay,e.min(0),e.step(1)})),!0}setStateWork(t){if(t.function){const i=e.linq(this.functions).first(e=>e.value.type==t.function.type);if(i){for(let s of t.function.vars){const t=e.linq(i.vars()).first(e=>e.value.name==s.name);t&&(t.autoCompute(s.autoCompute),t.max(s.maxValue),t.min(s.minValue),t.step(s.step),t.curValue(s.value))}this.selectedFunction(i)}}null!=t.showIntegration&&this.showIntegration(t.showIntegration)}getState(){const e=super.getState();e.function=this.selectedFunction().value,e.showIntegration=this.showIntegration();for(let e of this.selectedFunction().vars())e.value.value=e.curValue(),e.value.maxValue=e.max(),e.value.minValue=e.min(),e.value.step=e.step(),e.value.autoCompute=e.autoCompute();return e}onParentChanged(){super.onParentChanged(),this.color(this.parent.color()),this.maxDay(e.linq(this.parent.values).max(e=>e.x)),null==this.endDay()&&this.endDay(this.maxDay())}updateEndDay(){this._varsMap.tend&&this._graphCtx.updateExpression({type:"expression",id:this.getGraphId("end-day"),latex:this._varsMap.tend+"="+this.endDay(),slider:{min:"0",step:"1",max:this.maxDay().toString()}})}updateColor(){this._graphCtx.setColor(this.getGraphId("main-func"),this.color()),this._graphCtx.setColor(this.getGraphId("sum-serie"),this.color()),this._graphCtx.setColor(this.getGraphId("sum-point"),this.color()),this._graphCtx.setColor(this.getGraphId("end-day-line"),this.color())}updateGraphWork(){this.updateRegressionVars()}getExpressions(){const e=[];e.push({type:"folder",id:this.getGraphId("public"),title:this.parent.name()+" - "+this.name(),collapsed:!0}),e.push({type:"folder",id:this.getGraphId("private"),secret:!0,title:this.parent.name()+" - "+this.name(),collapsed:!0});const t=this.selectedFunction().value;this._varsMap.x="",this._varsMap.y=this.parent.getVar("y"),this._varsMap.time=this.parent.parent.getVar("time");for(let e of t.vars)this._varsMap[e.name]||(this._varsMap[e.name]=null);this._graphCtx.generateVars(this._varsMap),this._varsMap.x=this.getVar("xp"),e.push({type:"expression",id:this.getGraphId("main"),folderId:this.getGraphId("private"),latex:this.replaceVars(t.value),hidden:!0}),e.push({type:"expression",id:this.getGraphId("main-func"),folderId:this.getGraphId("private"),latex:this.replaceVars(t.value.replace("$y\\sim ","$fun\\left(x\\right)=").replace(/\$x/g,"x")),color:this.parent.color(),lineStyle:Desmos.Styles.DASHED}),e.push({type:"expression",id:this.getGraphId("sum-func"),folderId:this.getGraphId("private"),latex:this.replaceVars("$sum\\left(x\\right)=\\sum_{$n1=1}^{x}\\operatorname{round}\\left($fun\\left($n1\\right)\\right)"),hidden:!0}),e.push({type:"expression",id:this.getGraphId("sum-x-time"),folderId:this.getGraphId("private"),latex:this.replaceVars("$n2=\\left[1,...,$time\\right]")}),e.push({type:"expression",id:this.getGraphId("sum-serie"),folderId:this.getGraphId("private"),latex:this.replaceVars("\\left($n2,\\ $sum\\left($n2\\right)\\right)"),color:this.parent.color(),lines:!0,hidden:!this.showIntegration(),lineStyle:Desmos.Styles.SOLID,pointStyle:"NONE",points:!1}),e.push({type:"expression",id:this.getGraphId("sum-value"),folderId:this.getGraphId("public"),latex:this.replaceVars("$value=$sum\\left($time\\right)")}),e.push({type:"expression",id:this.getGraphId("sum-point"),folderId:this.getGraphId("private"),hidden:!this.showIntegration(),latex:this.replaceVars("\\left($time,$value\\right)"),color:this.parent.color(),label:this.parent.name(),dragMode:"XY",showLabel:!0}),e.push({type:"expression",id:this.getGraphId("end-day"),latex:this._varsMap.tend+"="+this.endDay(),folderId:this.getGraphId("public"),label:"Giorni Previsione",slider:{min:(0).toString(),max:this.maxDay().toString(),hardMax:!0,hardMin:!0,step:"1"}}),e.push({type:"expression",id:this.getGraphId("end-day-line"),color:this.color(),latex:"x="+this._varsMap.tend,folderId:this.getGraphId("private"),lines:!0}),e.push({type:"expression",id:this.getGraphId("end-day-serie"),latex:this.replaceVars("$xp=[0,...,$tend]+"+this.parent.getVar("ofs")),folderId:this.getGraphId("private"),hidden:!0});for(let t of this.selectedFunction().vars())t.autoCompute()?this._graphCtx.calculator.removeExpression({id:this.getGraphId(t.value.name+"-value")}):e.push({type:"expression",id:this.getGraphId(t.value.name+"-value"),latex:this.getVar(t.value.name)+"="+(t.curValue()?t.curValue().toString():"0"),folderId:this.getGraphId("public"),label:t.value.name,slider:{min:i(t.value.minValue),max:i(t.value.maxValue),hardMax:!0,hardMin:!0,step:i(t.value.step)}});return e}}t.StudioSerieRegression=a}(e.GeoPlot||(e.GeoPlot={}))}(WebApp||(WebApp={})),function(e){!function(t){class i extends t.BaseStudioItem{constructor(e){super(),this.color=ko.observable(),this.offsetX=ko.observable(0),this.values=[],this.canDrag=!0,this.itemType="serie",this.icon="insert_chart",this.optionsTemplateName="StudioOptionsTemplate",this._varsMap={x:null,y:null,ofs:null,xofs:null},e&&this.setState(e)}importValues(t){if(t&&t.length>0)if(t[0].x instanceof Date){const i=t[0].x;this.values=e.linq(t).select(t=>({x:Math.round(e.DateUtils.diff(t.x,i).totalDays),xLabel:t.x,y:t.y})).toArray()}else{if(isNaN(t[0].x))return void(this.values=e.linq(t).select((e,t)=>({x:t,xLabel:e.x,y:e.y})).toArray());this.values=t}else this.values=[];this.onSerieChanged()}writeData(e){var t={version:1,type:"serieState",state:this.getState()};return e.setData("application/json+studio",JSON.stringify(t)),e.setData("text/html+id",this.node.element.id),!0}createActions(i){super.createActions(i),i.push(e.apply(new t.ActionView,e=>{e.text=$string("$(update)"),e.icon="autorenew",e.execute=()=>this.updateSerie()})),i.push(e.apply(new t.ActionView,e=>{e.text=$string("$(new-regression)"),e.icon="add_box",e.execute=()=>{const e=this.addRegression(null,!1);e.updateGraph(),this.node.isExpanded(!0),e.node.isSelected(!0)}})),i.push(e.apply(new t.ActionView,e=>{e.text=$string("$(zoom)"),e.icon="zoom_in",e.execute=()=>this.zoom()})),i.push(e.apply(new t.ActionView,e=>{e.text=$string("$(align-with-this)"),e.icon="compare_arrows",e.execute=()=>{let e=prompt($string("$(tollerance)"),"10");this.alignOthers(isNaN(e)?10:parseInt(e))}}))}static fromText(e){try{const t=JSON.parse(e);if(t){if("serie"==t.type)return new i({name:t.title,values:t.values,source:t.serie,color:t.color});if("serieState"==t.type)return new i(t.state)}}catch(e){}}getExpressions(){return this.color()||this.color("#0000ff"),this._graphCtx.generateVars(this._varsMap),[{type:"folder",id:this.getGraphId("public"),title:this.parent.name()+" - "+this.name(),collapsed:!0},{type:"folder",id:this.getGraphId("private"),title:this.parent.name()+" - "+this.name(),secret:!0,collapsed:!0},{type:"expression",id:this.getGraphId("offset"),latex:this._varsMap.ofs+"="+this.offsetX(),folderId:this.getGraphId("public"),label:"Scostamento",slider:{min:(-this.values.length).toString(),max:this.values.length.toString(),hardMax:!0,hardMin:!0,step:"1"}},{type:"expression",id:this.getGraphId("offset-x"),latex:this._varsMap.xofs+"="+this._varsMap.x+"+"+this._varsMap.ofs,folderId:this.getGraphId("private")},{type:"expression",id:this.getGraphId("offset-x-serie"),latex:"("+this._varsMap.xofs+","+this._varsMap.y+")",folderId:this.getGraphId("private"),points:!0,lines:!0,color:this.color()},{type:"table",id:this.getGraphId("table"),folderId:this.getGraphId("private"),columns:[{id:this.getGraphId("table/x"),latex:this._varsMap.x},{id:this.getGraphId("table/y"),latex:this._varsMap.y,hidden:!0}]}]}alignOthers(e,...t){t&&0!=t.length||(t=this.parent.children.where(e=>e!=this).toArray());for(let i of t)i.alignWith(this,e)}alignWith(e,t){let i=0,s=Number.NEGATIVE_INFINITY;for(let n=-this.values.length;n<this.values.length;n++){let a=0;for(let i=0;i<this.values.length;i++){const s=i-n;s<0||s>=this.values.length||(i>=e.values.length||Math.abs(this.values[s].y-e.values[i].y)<t&&a++)}a>s&&(s=a,i=n)}e.offsetX(0),this.offsetX(i)}get mainExpression(){return this.getGraphId("offset-x-serie")}createParameters(i){return i.push(e.apply(new t.ParameterViewModel({value:this.offsetX,name:$string("$(shift)")}),e=>{e.max(this.values.length),e.min(-this.values.length),e.step(1)})),!0}updateGraphWork(){this._graphCtx.updateTable(this.getGraphId("table"),this.values)}onGraphChanged(){}onSelected(){super.onSelected()}updateColor(){this._graphCtx.setColor(this.getGraphId("offset-x-serie"),this.color()),this.children.foreach(e=>e.onParentChanged())}attachGraph(e){super.attachGraph(e),this.offsetX.subscribe(e=>{this._graphCtx.updateVariable(this.getGraphId("offset"),this._varsMap.ofs,e),this.onSerieChanged()})}onSerieChanged(){0==this._isUpdating&&this.parent.updateAggregate()}setChildrenStateWork(e){null!=e.children&&(this.children.foreach(e=>e.remove()),e.children.forEach(e=>{this.addRegression(null,!1).setState(e)}))}setStateWork(e){null!=e.offsetX&&this.offsetX(e.offsetX),e.source&&(this.source=this.upgradeSource(e.source)),null!=e.values&&this.importValues(e.values)}upgradeSource(e){if(e.type||(e.type="geoplot"),"geoplot"==e.type&&(e.areaId=this.upgradeAreaId(e.areaId),e.exeludedAreaIds))for(let t=0;t<e.exeludedAreaIds.length;t++)e.exeludedAreaIds[t]=this.upgradeAreaId(e.exeludedAreaIds[t]);return e}upgradeAreaId(e){if(e){if(e.startsWith("R")&&2==e.length)return"R0"+e.substring(1);if(e.startsWith("D")&&2==e.length)return"D00"+e.substring(1);if(e.startsWith("D")&&3==e.length)return"D0"+e.substring(1)}return e}getState(){const e=super.getState();return e.offsetX=this.offsetX(),e.source=this.source,e.values=this.values,e.children=this.children.select(e=>e.getState()).toArray(),e}addRegression(e,i=!0){return this.addChildrenWork(e instanceof t.StudioSerieRegression?e:new t.StudioSerieRegression(e),i)}changeColor(){return __awaiter(this,void 0,void 0,(function*(){const e=yield t.ColorPicker.instance.pick();e&&this.color(e)}))}updateSerie(){return __awaiter(this,void 0,void 0,(function*(){if("geoplot"!=this.source.type&&this.source.type)M.toast({html:$string("$(msg-update-not-supported)")});else{if(!this._graphCtx.serieCalculator){M.toast({html:$string("$(msg-downloading-data)")});const e=yield t.Api.loadStudioData();this._graphCtx.serieCalculator=new t.IndicatorCalculator(e.data,t.InfectionDataSet,e.geo)}this.importValues(this._graphCtx.serieCalculator.getSerie(this.source)),this._graphCtx.updateTable(this.getGraphId("table"),this.values),this.children.foreach(e=>e.onParentChanged()),this.onSerieChanged(),M.toast({html:$string("$(msg-update-complete)")})}}))}zoom(){const t=e.linq(this.values).min(e=>e.x),i=e.linq(this.values).min(e=>e.y),s=e.linq(this.values).max(e=>e.x),n=e.linq(this.values).max(e=>e.y);this._graphCtx.calculator.setMathBounds({top:n+.1*(n-i),right:s+.1*(s-t),bottom:i-.1*(n-i),left:t-.1*(s-t)})}}t.StudioSerie=i}(e.GeoPlot||(e.GeoPlot={}))}(WebApp||(WebApp={})),function(e){e.LinearGradient=class{constructor(...i){i.length>0?"string"==typeof i[0]?this.colors=e.linq(i).select(e=>new t(e)).toArray():this.colors=i:this.colors=[]}valueAt(e){if(e<0)return this.colors[0];e>1&&this.colors[this.colors.length-1];const i=1/(this.colors.length-1),s=Math.floor(e/i),n=Math.ceil(e/i),a=(e-s*i)/i,o=this.colors[s],r=this.colors[n],l=new t;return l.r=o.r+(r.r-o.r)*a,l.g=o.g+(r.g-o.g)*a,l.b=o.b+(r.b-o.b)*a,l}};class t{constructor(e){this.r=0,this.g=0,this.b=0,e&&this.fromHex(e)}fromHex(e){4==e.length?(this.r=parseInt("0x"+e[1]+e[1])/255,this.g=parseInt("0x"+e[2]+e[2])/255,this.b=parseInt("0x"+e[3]+e[3])/255):(this.r=parseInt("0x"+e[1]+e[2])/255,this.g=parseInt("0x"+e[3]+e[4])/255,this.b=parseInt("0x"+e[5]+e[6])/255)}toString(){function e(e){let t=Math.round(255*e).toString(16);return 1==t.length?"0"+t:t}return"#"+e(this.r)+e(this.g)+e(this.b)}}e.RgbColor=t;e.Graphics=class{constructor(e){this._svg=e}setViewPort(e,t,i,s){this._svg.viewBox.baseVal.x=e,this._svg.viewBox.baseVal.y=t,this._svg.viewBox.baseVal.width=i-e,this._svg.viewBox.baseVal.height=s-t}drawPoly(e){var t=document.createElementNS("http://www.w3.org/2000/svg","polygon");t.style.fill=e.fillColor,t.style.stroke=e.strokeColor,t.style.strokeWidth=e.strokeSize+"%",t.id=e.id;for(let i=0;i<e.geometry.points.length;i++){let s=this._svg.createSVGPoint();s.x=e.geometry.points[i].x,s.y=e.geometry.points[i].y,t.points.appendItem(s)}this._svg.appendChild(t)}}}(WebApp||(WebApp={})),function(e){!function(t){t.InfectionDataSet={name:"COVID-19",empty:{currentPositive:void 0,historicDeaths:{2015:void 0,2016:void 0,2017:void 0,2018:void 0,2019:void 0,2020:void 0},toatlTests:void 0,totalDeath:void 0,totalHealed:void 0,totalHospedalized:void 0,totalPositive:void 0,totalSevere:void 0,totalCaseTested:void 0},indicators:[{id:"totalPositive",name:$string("$(total-positive)"),colorLight:"#f44336",colorDark:"#b71c1c",validFor:["region","country","district"],showInFavorites:!0,compute:new t.SimpleIndicatorFunction(e=>e.totalPositive)},{id:"currentPositive",name:$string("$(current-positive)"),validFor:["region","country"],colorLight:"#e91e63",colorDark:"#880e4f",showInFavorites:!0,compute:new t.SimpleIndicatorFunction(e=>e.currentPositive)},{id:"totalDeath",name:$string("$(death)"),validFor:["region","country"],colorLight:"#9c27b0",colorDark:"#4a148c",showInFavorites:!0,compute:new t.SimpleIndicatorFunction(e=>e.totalDeath)},{id:"totalSevere",name:$string("$(severe)"),validFor:["region","country"],colorLight:"#ff9800",colorDark:"#e65100",showInFavorites:!0,compute:new t.SimpleIndicatorFunction(e=>e.totalSevere)},{id:"totalHospedalized",name:$string("$(hospedalized)"),validFor:["region","country"],colorLight:"#fdd835",colorDark:"#fbc02d",showInFavorites:!0,compute:new t.SimpleIndicatorFunction(e=>e.totalHospedalized)},{id:"totalHealed",name:$string("$(healed)"),validFor:["region","country"],colorLight:"#4caf50",colorDark:"#1b5e20",showInFavorites:!0,compute:new t.SimpleIndicatorFunction(e=>e.totalHealed)},{id:"toatlTests",name:$string("$(tested)"),validFor:["region","country"],colorLight:"#03a9f4",colorDark:"#01579b",showInFavorites:!0,compute:new t.SimpleIndicatorFunction(e=>e.toatlTests)},{id:"totalCaseTested",name:$string("$(caseTested)"),validFor:["region","country"],colorLight:"#03a9f4",colorDark:"#01579b",showInFavorites:!0,compute:new t.SimpleIndicatorFunction(e=>e.totalCaseTested)},{id:"surface",name:$string("$(surface) ($(geo))"),validFor:["region","district"],colorLight:"#777",colorDark:"#222",showInFavorites:!1,compute:new t.ConstIndicatorFunction((t,i)=>e.MathUtils.round(i.surface,0))},{id:"density",name:$string("$(density) ($(geo))"),validFor:["region","district"],colorLight:"#777",colorDark:"#222",showInFavorites:!1,compute:new t.ConstIndicatorFunction((t,i)=>e.MathUtils.round(i.demography.total/i.surface,0))},{id:"death2020",name:$string("$(total-death) +60 (2020)*"),validFor:["details"],colorLight:"#9c27b0",colorDark:"#4a148c",showInFavorites:!0,compute:new t.SimpleIndicatorFunction(e=>e.historicDeaths?e.historicDeaths[2020]:void 0)},{id:"death2019",name:$string("$(total-death) +60 (2019)"),validFor:["region","district","details"],colorLight:"#9c27b0",colorDark:"#4a148c",showInFavorites:!0,compute:new t.SimpleIndicatorFunction(e=>e.historicDeaths?e.historicDeaths[2019]:void 0)},{id:"death2018",name:$string("$(total-death) +60 (2018)"),validFor:["region","district","details"],colorLight:"#9c27b0",colorDark:"#4a148c",showInFavorites:!1,compute:new t.SimpleIndicatorFunction(e=>e.historicDeaths?e.historicDeaths[2018]:void 0)},{id:"death2017",name:$string("$(total-death) +60 (2017)"),validFor:["region","district","details"],colorLight:"#9c27b0",colorDark:"#4a148c",showInFavorites:!1,compute:new t.SimpleIndicatorFunction(e=>e.historicDeaths?e.historicDeaths[2017]:void 0)},{id:"death-diff-2020-2019",name:$string("DIff. decessi 2020-19"),validFor:["details"],colorLight:"#f44336",colorDark:"#b71c1c",gradient:new e.LinearGradient("#00c853","#bdbdbd","#ff1744"),canBeNegative:!0,compute:new t.CombineIndicatorFunction({death2019:new t.SimpleIndicatorFunction(e=>e.historicDeaths[2019]),death2020:new t.SimpleIndicatorFunction(e=>e.historicDeaths[2020])},t=>e.MathUtils.isNaNOrNull(t.death2020)||e.MathUtils.isNaNOrNull(t.death2019)?void 0:t.death2020-t.death2019)},{id:"population",name:$string("$(population) ($(geo))"),validFor:["region","district","details","country"],colorLight:"#777",colorDark:"#222",showInFavorites:!1,compute:new t.ConstIndicatorFunction((e,t)=>t.demography.total)},{id:"populationOld",name:$string("$(population) +65 ($(geo))"),validFor:["region","district","country"],colorLight:"#777",colorDark:"#222",showInFavorites:!1,compute:new t.ConstIndicatorFunction((e,t)=>t.demography.over65)}],factors:[{id:"none",name:$string("$(none)"),compute:new t.SimpleFactorFunction((e,t,i)=>e),format:e=>formatNumber(e),reference:(e,t)=>"N/A",description:$string("[indicator]")},{id:"population",validFor:["region","country","details","district"],name:$string("$(population)"),compute:new t.SimpleFactorFunction((t,i,s)=>1e5*e.MathUtils.divideNull(t,s.demography.total)),format:e=>formatNumber(e),reference:(e,t)=>formatNumber(t.demography.total),description:$string("[indicator] $(every-100k)")},{id:"populationOld",validFor:["region","country","district"],name:$string("$(population) +65"),compute:new t.SimpleFactorFunction((t,i,s)=>1e5*e.MathUtils.divideNull(t,s.demography.over65)),format:t=>formatNumber(e.MathUtils.round(t,1)),reference:(e,t)=>formatNumber(t.demography.over65),description:$string("[indicator] $(every-100k) +65")},{id:"density",name:$string("$(density)"),validFor:["region","country","district"],compute:new t.SimpleFactorFunction((t,i,s)=>1e5*e.MathUtils.divideNull(t,e.MathUtils.divideNull(s.demography.total,s.surface))),format:t=>formatNumber(e.MathUtils.round(t,1)),reference:(t,i)=>formatNumber(e.MathUtils.round(i.demography.total/i.surface,1)),description:$string("[indicator] $(over-density)")},{id:"totalPositive",name:$string("$(total-positive)"),validFor:["region","country"],compute:new t.DoubleFactorFunction((t,i)=>e.MathUtils.isNaNOrNull(t)?void 0:t/i*100,new t.SimpleIndicatorFunction(e=>e.totalPositive)),format:t=>e.MathUtils.round(t,1)+"%",reference:(e,t)=>formatNumber(e.totalPositive),description:$string("% [indicator] $(over-total-positive)")},{id:"severe",name:$string("$(severe)"),validFor:["region","country"],compute:new t.DoubleFactorFunction((t,i)=>e.MathUtils.isNaNOrNull(t)?void 0:t/i*100,new t.SimpleIndicatorFunction(e=>e.totalSevere)),format:t=>e.MathUtils.round(t,1)+"%",reference:(e,t)=>formatNumber(e.totalSevere),description:$string("% [indicator] $(over-severe)")},{id:"test",name:$string("$(tested)"),validFor:["region","country"],compute:new t.DoubleFactorFunction((t,i)=>e.MathUtils.isNaNOrNull(t)?void 0:t/i*100,new t.SimpleIndicatorFunction(e=>e.toatlTests)),format:t=>e.MathUtils.round(t,1)+"%",reference:(e,t)=>formatNumber(e.toatlTests),description:$string("% [indicator] $(over-tested)")},{id:"caseTested",name:$string("$(caseTested)"),validFor:["region","country"],compute:new t.DoubleFactorFunction((t,i)=>e.MathUtils.isNaNOrNull(t)?void 0:t/i*100,new t.SimpleIndicatorFunction(e=>e.totalCaseTested)),format:t=>e.MathUtils.round(t,1)+"%",reference:(e,t)=>formatNumber(e.totalCaseTested),description:$string("% [indicator] $(over-case-tested)")},{id:"death2019Perc",name:$string("$(total-death) +60 (2019)"),validFor:["details"],compute:new t.DoubleFactorFunction((t,i)=>e.MathUtils.isNaNOrNull(t)?void 0:t/i*100,new t.SimpleIndicatorFunction(e=>e.historicDeaths[2019])),format:t=>e.MathUtils.isNaNOrNull(t)?"N/A":(t>0?"+":"")+e.MathUtils.round(t,1)+"%",reference:(e,t)=>formatNumber(e.historicDeaths[2019]),description:$string("% [indicator] $(over-tested)")}]}}(e.GeoPlot||(e.GeoPlot={}))}(WebApp||(WebApp={})),function(e){!function(e){e.ViewModes={district:{label:{singular:$string("$(district)"),plural:$string("$(districts)")},mapGroup:"group_district",tab:"districtTab",areaType:e.GeoAreaType.District,validateId:e=>"d"==e[0].toLowerCase()},region:{label:{singular:$string("$(region)"),plural:$string("$(regions)")},mapGroup:"group_region",tab:"regionTab",areaType:e.GeoAreaType.Region,validateId:e=>"r"==e[0].toLowerCase()},country:{label:{singular:$string("$(italian)"),plural:$string("$(italians)")},mapGroup:"group_country",tab:"italyTab",areaType:e.GeoAreaType.Country,validateId:e=>"it"==e.toLowerCase()},details:{label:{singular:$string("$(area-details)"),plural:$string("$(area-details)")},mapGroup:"group_municipality",tab:"detailsTab",areaType:e.GeoAreaType.Municipality,validateId:e=>"m"==e[0].toLowerCase()}}}(e.GeoPlot||(e.GeoPlot={}))}(WebApp||(WebApp={})),window.ko&&(ko.bindingHandlers.attach={init:(e,t,i,s)=>{let n=ko.unwrap(t());if(!0!==n&&null!=n||(n=s.attachNode),"function"!=typeof n)throw"Supplied argument is not a function";setTimeout(()=>n.call(s,e))}}),function(e){let t;!function(e){e[e.Exclude=0]="Exclude",e[e.XAxis=1]="XAxis",e[e.Serie=2]="Serie",e[e.Group=3]="Group"}(t=e.DaColumnType||(e.DaColumnType={}));class i{constructor(){}}e.TextTableDataAdapter=class extends i{constructor(){super()}createIdentifier(e){let t=0,i="";for(let s=0;s<e.length;s++){const n=e[s];switch(t){case 0:i+=n.toLowerCase(),t=1;break;case 1:" "==n||"-"==n||"_"==n?t=2:i+=n;break;case 2:i+=n.toUpperCase(),t=1}}return i}extractHeader(i,s){const n=e.linq(new e.SplitEnumerator(i,s.rowSeparator)).first(),a=e.linq(new e.CsvSplitEnumerator(n,s.columnSeparator)).toArray();let o;if(!1!==s.hasHeader){const t=[];this.analyzeRow(a,t);const i=e.linq(t).sum(e=>e.stringCount),n=e.linq(t).sum(e=>e.emptyCount);i>0&&i+n==a.length&&(s.hasHeader=!0,o=e.linq(a).select((e,t)=>""==e?"col"+t:e).toArray())}o||(s.hasHeader=!1,o=e.linq(a).select((e,t)=>"col"+t).toArray()),s.columns||(s.columns=e.linq(o).select(e=>({id:this.createIdentifier(e),name:e,type:t.Exclude})).toArray())}extractRowSeparator(e,t){if(t.rowSeparator)return;const i=["\r\n","\n"];for(var s of i)if(-1!=e.indexOf(s))return void(t.rowSeparator=s)}extractColumnSeparator(t,i){if(i.columnSeparator)return;const s=["\t",";",","," "],n={},a=e.linq(new e.SplitEnumerator(t,i.rowSeparator)).take(10);for(let t of a)if(0!=t.trim().length)for(let i of s){if(!1===n[i])continue;const s=e.linq(new e.CsvSplitEnumerator(t,i)).count();s>1&&!(i in n)?n[i]=s:n[i]!=s&&(n[i]=!1)}for(var o in n)if(!1!==n[o])return void(i.columnSeparator=o)}analyzeRow(e,t){if(0==t.length)for(let i=0;i<e.length;i++)t.push({values:{},booleanCount:0,dateCount:0,emptyCount:0,numberCount:0,stringCount:0});for(let i=0;i<e.length;i++)this.analyzeColumn(e[i],t[i])}analyzeColumn(e,t){(!t.values||Object.keys(t.values).length<150)&&(e in t.values?t.values[e]++:t.values[e]=1),null==e||0==e.length||0==e.trim().length?t.emptyCount++:isNaN(e)?Date.parse(e)?t.dateCount++:"true"==e||"false"==e?t.booleanCount++:t.stringCount++:t.numberCount++}createParser(e){return e.numberCount>0&&0==e.stringCount?e=>isNaN(e)?null:parseFloat(e):e.booleanCount>0&&0==e.stringCount?e=>"true"==e:e.dateCount>0&&0==e.stringCount?e=>e?new Date(e):null:e.stringCount>0?e=>e?e.startsWith('"')&&e.endsWith('"')?e.substr(1,e.length-2):e:"":e=>null}analyzeAsync(i,s,n){return __awaiter(this,void 0,void 0,(function*(){s||(s={}),this.extractRowSeparator(i,s),this.extractColumnSeparator(i,s),this.extractHeader(i,s);let a=e.linq(new e.SplitEnumerator(i,s.rowSeparator));n&&(a=a.take(n)),s.hasHeader&&(a=a.skip(1));let o=e.Operation.begin("Analazing rows...");const r=[];let l=0;yield a.foreachAsync(t=>__awaiter(this,void 0,void 0,(function*(){l++,this.analyzeRow(e.linq(new e.CsvSplitEnumerator(t,s.columnSeparator)).toArray(),r),l%200==0&&(o.progress={current:l},yield e.PromiseUtils.delay(0))}))),s.rowsCount=l,o.end();const c=e.linq(s.columns);return r.forEach((e,t)=>{s.columns[t].parser||(s.columns[t].parser=this.createParser(e))}),c.any(e=>e.type==t.XAxis)||(c.first(e=>e.type==t.Exclude).type=t.XAxis),c.any(e=>e.type==t.Serie)||r.forEach((e,i)=>{e.numberCount>0&&0==e.stringCount&&(s.columns[i].type=t.Serie)}),c.any(e=>e.type==t.Group)||r.forEach((i,n)=>{if(i.stringCount>0&&0==i.emptyCount){var a=e.linq(i.values);a.count()>1&&a.any(e=>e.value>1)&&(s.columns[n].type=t.Group)}}),s}))}loadTableAsync(i,s,n){return __awaiter(this,void 0,void 0,(function*(){var a=[],o=e.linq(new e.SplitEnumerator(i,s.rowSeparator));for(var r of(s.hasHeader&&(o=o.skip(1)),o)){const i=e.linq(new e.CsvSplitEnumerator(r,s.columnSeparator)).toArray(),o={};for(let e=0;e<i.length;e++){const n=s.columns[e];n.type!=t.Exclude&&(o[n.id]=n.parser(i[e]))}if(a.push(o),n&&a.length>=n)break}return a}))}loadGroupAsync(i,s){return __awaiter(this,void 0,void 0,(function*(){var n={name:$string("$(da-main-group)")},a=e.linq(new e.SplitEnumerator(i,s.rowSeparator));s.hasHeader&&(a=a.skip(1));const o=e.linq(s.columns).where(e=>e.type==t.XAxis).select((e,t)=>t).first();let r=e.Operation.begin("Loading groups..."),l=0;return yield a.foreachAsync(i=>__awaiter(this,void 0,void 0,(function*(){const a=e.linq(new e.CsvSplitEnumerator(i,s.columnSeparator)).toArray(),c=s.columns[o].parser(a[o]);let d=n;for(let e=0;e<a.length;e++){const i=s.columns[e];if(i.type==t.Exclude||i.type==t.XAxis)continue;let n=i.parser(a[e]);i.type==t.Group?(d.groups||(d.groups={}),""===n&&(n=$string("<$(empty)>")),n in d.groups||(d.groups[n]={name:n,colId:i.id}),d=d.groups[n]):i.type==t.Serie&&(d.series||(d.series={}),i.id in d.series||(d.series[i.id]={name:i.name,colId:i.id,values:[]}),d.series[i.id].values.push({x:c,y:n}))}l++,l%200==0&&(r.progress={current:l,totCount:s.rowsCount},yield e.PromiseUtils.delay(0))}))),s.rowsCount=l,r.end(),n}))}};e.JsonDataAdapter=class extends i{constructor(){super()}loadGroupAsync(e,t){return __awaiter(this,void 0,void 0,(function*(){return null}))}loadTableAsync(e,t,i){return __awaiter(this,void 0,void 0,(function*(){return null}))}analyzeAsync(e,t,i){return __awaiter(this,void 0,void 0,(function*(){return null}))}}}(WebApp||(WebApp={})),function(e){!function(e){class t{static project(e){var i={x:0,y:0};return i.x=e.lng*t.OriginShift/180,i.y=Math.log(Math.tan((90+e.lat)*Math.PI/360))/(Math.PI/180),i.y=-i.y*t.OriginShift/180,i.x-=t.OFFSET_X,i.y-=t.OFFSET_Y,i}}t.EarthRadius=6378137,t.OriginShift=2*Math.PI*t.EarthRadius/2,t.OFFSET_X=1263355,t.OFFSET_Y=5543162,e.Geo=t}(e.GeoPlot||(e.GeoPlot={}))}(WebApp||(WebApp={})),function(e){!function(t){class i{constructor(t){this.message=null,this.parentOperation=null,t.type?this._type=t.type:this._type=e.OperationType.Global,this.parentOperation=t.parentOperation}end(){e.Operation.end(this)}get type(){return this._type}get progress(){return this._progress}set progress(t){this._progress=t,this._progress?(console.log(this.getProgressDescription(this._progress)),this._progress.message&&(this.message=this._progress.message),e.Operation.onProgress.raise(this,{operation:this,progress:t})):this.message=void 0}addSubOperation(e){}removeSubOperation(e){}getProgressDescription(e){let t="Progress ("+this.message+"): ";return e.message&&(t+="'"+e.message+"'"),null!=e.current&&null!=e.totCount?t+=" - "+e.current+"/"+e.totCount+" ("+Math.round(100/e.totCount*e.current)+"%)":null!=e.current&&(t+=e.current),t}}t.BaseOperationManager=class{constructor(){this._oprations=[],this.onBegin=e.event(),this.onEnd=e.event(),this.onProgress=e.event()}progress(t){e.TypeCheck.isString(t)&&(t={message:t}),this.current&&(this.current.progress=t)}begin(t){var s;e.TypeCheck.isString(t)&&(t={message:t});let n=new i(t);return console.group("Begin operation: ",$string(null!==(s=n.message)&&void 0!==s?s:"")),n.progress=t,void 0===n.parentOperation&&(n.parentOperation=this.current),this._oprations.push(n),n.parentOperation?n.parentOperation.addSubOperation(n):(n.type,e.OperationType.Global),this.onBegin.raise(this,n),n}end(t){var i;console.groupEnd(),console.log("End operation: ",$string(null!==(i=t.message)&&void 0!==i?i:""));const s=this._oprations.indexOf(t);this._oprations.splice(s,1),t.parentOperation?t.parentOperation.removeSubOperation(t):(t.type,e.OperationType.Global),this.onEnd.raise(this,t)}get current(){return this._oprations.length>0?this._oprations[this._oprations.length-1]:null}get operations(){return this._oprations}}}(e.GeoPlot||(e.GeoPlot={}))}(WebApp||(WebApp={})),function(e){e.Operation=new e.GeoPlot.BaseOperationManager}(WebApp||(WebApp={})),function(e){e.SplitEnumerator=class{constructor(e,t,i=0){this._value=e,this._separator=t,this._startIndex=i}get current(){return this._current||(this._current=this._value.substring(this._currentStartIndex,this._curIndex-this._separator.length)),this._current}moveNext(){if(this._curIndex>this._value.length)return!1;this._currentStartIndex=this._curIndex;var e=this._value.indexOf(this._separator,this._curIndex);return this._curIndex=-1==e?this._value.length+1:e+this._separator.length,this._current=null,!0}reset(){this._curIndex=this._startIndex,this._currentStartIndex=this._curIndex,this._current=null}};e.CsvSplitEnumerator=class{constructor(e,t,i=0){this._state=0,this._wordLength=0,this._value=e,this._separator=t,this._startIndex=i}get current(){return this._current||(this._current=this._value.substr(this._wordStartIndex,this._wordLength),this._hasEscape&&(this._current=this._current.replace('""','"'))),this._current}moveNext(){let e=!1;for(;;){const t=this._curIndex>=this._value.length?"":this._value[this._curIndex];switch(this._state){case 0:'"'==t?(this._state=1,this._hasEscape=!1,this._wordLength=0,this._wordStartIndex=this._curIndex+1):t!=this._separator&&t?(this._state=2,this._wordLength=1,this._wordStartIndex=this._curIndex):(this._wordStartIndex=this._curIndex,this._wordLength=0,e=this._curIndex<=this._value.length);break;case 1:'"'==t?this._state=3:this._wordLength++;break;case 2:t!=this._separator&&t?this._wordLength++:(this._state=0,e=!0);break;case 3:'"'==t?(this._hasEscape=!0,this._wordLength+=2,this._state=1):t!=this._separator&&t?this._state=4:(e=!0,this._state=0);break;case 4:t!=this._separator&&t||(e=!0,this._state=0)}if(this._curIndex++,!t||e)break}return this._current=null,e}reset(){this._hasEscape=!1,this._curIndex=this._startIndex,this._wordStartIndex=this._curIndex,this._wordLength=0,this._current=null,this._state=0}}}(WebApp||(WebApp={})),function(e){class t{constructor(e,t){this.isVisible=ko.observable(!1),this.isTransparent=ko.observable(!1),this.value=e,this._closeAfter=t}dontShowAgain(){}onActionExecuted(){}executeAction(){this.value.showAction&&this.value.showAction(),setTimeout(()=>this.startPulse()),this.onActionExecuted()}startPulse(){if(this._element=document.querySelector(this.value.elementSelector),!this._element)return;let t=e.DomUtils.centerElement(this._element);e.DomUtils.addClass(this._element,"pulse");let i=document.querySelector(".tip-container");t<i.clientTop+i.clientHeight&&this.isTransparent(!0)}stopPulse(){this._element&&(e.DomUtils.removeClass(this._element,"pulse"),this.isTransparent(!1))}next(){}understood(){}onClose(){}close(){clearTimeout(this._closeTimeoutId),this.stopPulse(),this.isVisible(!1),this.onClose()}show(){this._closeTimeoutId&&clearTimeout(this._closeTimeoutId),this.isVisible(!0),this._closeAfter&&(this._closeTimeoutId=setTimeout(()=>this.close(),this._closeAfter))}}e.TipViewModel=t;e.TipManager=class{constructor(e,t,i){this.tip=ko.observable(),this._getPreferences=t,this._tips=e,this.savePreferences=i}get preferences(){return this._getPreferences()}savePreferences(){}markAction(t,i){this.preferences.actions[t]++,this.savePreferences(),window.gtag&&e.safeCall(()=>gtag("event",t,{event_category:"GeoPlot",event_label:i,value:this.preferences.actions[t]}))}markTip(t,i){window.gtag&&e.safeCall(()=>gtag("event",i,{event_category:"GeoPlot/Tip",event_label:t}))}engageUser(){if(null!=this.preferences.showTips&&!this.preferences.showTips)return;const t=e.linq(this._tips).where(e=>e.value.showAfter>0&&0==this.preferences.actions[e.key]).first();this.showTip(t.key,{onClose:()=>this.engageUser(),timeout:t.value.showAfter})||this.engageUser()}showTip(i,s){if(null!=this.preferences.showTips&&!this.preferences.showTips)return!1;if((!s||!s.override)&&this.tip()&&this.tip().isVisible())return!1;if((!s||!s.force)&&this.preferences.actions[i])return!1;const n=this._tips[i],a=new t(n);a.onActionExecuted=()=>{this.markTip(i,"how")},a.dontShowAgain=()=>{this.preferences.showTips=!1,this.savePreferences(),a.close(),this.markTip(i,"dontShowAgain")},a.understood=()=>{this.preferences.actions[i]++,this.savePreferences(),a.close(),this.markTip(i,"understood")},a.onClose=()=>{s&&s.onClose&&s.onClose()};let o=e.linq(this._tips).where(e=>e.value.order>n.order&&0==this.preferences.actions[e.key]).first();return a.next=o?()=>{a.close(),this.preferences.actions[i]++,this.showTip(o.key),this.markTip(i,"next")}:null,this.tip(a),setTimeout(()=>a.show(),s&&s.timeout?1e3*s.timeout:0),!0}}}(WebApp||(WebApp={})),function(e){!function(t){class i{constructor(){this.value=ko.observable()}select(){}}class s{constructor(){this.data=ko.observable(),this.factor=ko.observable(),this.indicator=ko.observable(),this.reference=ko.observable(),this.indicators=ko.observable()}select(){}}t.GeoPlotPage=class{constructor(i){this._topAreasVisible=!1,this._execludedArea=new Map,this._dataSet=t.InfectionDataSet,this._keepState=!1,this._debugMode=!1,this._tips={areaSelected:{order:0,featureName:"Zone",html:"Puoi vedere i dati relativi ad una particolare area selezionadoli sulla mappa.",elementSelector:".card-map .center-align",showAfter:3,showAction:()=>{this.viewMode("region"),this.selectedArea=this._calculator.geo.areas.r10}},indicatorSelected:{order:1,featureName:"Indicatori",html:"Puoi vedere il grafico associato all'indicatore, facendo click sull'indicatore.",elementSelector:".indicators .summary-field",showAfter:15,showAction:()=>{this.currentArea()||this._tips.areaSelected.showAction(),this.selectedIndicator(e.linq(this._dataSet.indicators).first(e=>"totalDeath"==e.id))}},dayChanged:{order:2,featureName:"Cronologia",html:"Puoi vedere gli indicatori dei giorni precedenti muovendo la slide.",elementSelector:".day input[type=range]",showAfter:20,showAction:()=>{this.dayNumber(5)}},indicatorChanged:{order:3,featureName:"Indicatori",html:"Puoi cambiare l'indicatore scegliendolo dal filtro nell'elenco.",elementSelector:".filter-indicator",showAfter:0},viewChanged:{order:4,featureName:"Zone",html:"Puoi vedere gli indicatori a livello regionale, nazionale o provinciale.",elementSelector:"#areaTabs",showAfter:0,showAction:()=>{this.viewMode("district")}},topAreasOpened:{order:5,featureName:"Zone",html:"Puo vedere le zone più colpite di un qualsiasi indicatore scelto.",elementSelector:"#topCases .card-title",showAfter:20,showAction:()=>{"country"==this.viewMode()&&this.viewMode("region"),M.Collapsible.getInstance(document.getElementById("topCases")).open(0)}},deltaSelected:{order:5.5,featureName:"Indicatori",html:"Puoi vedere l'incremento giornaliero dell'indicatore anzichè il valore totale.",elementSelector:".day-delta",showAfter:20,showAction:()=>{this.currentArea()||this._tips.areaSelected.showAction(),this.isDayDelta(!0)}},factorChanged:{order:6,featureName:"Indicatori",html:"Puoi mettere in relazione qualsiasi indicatore a numerosi parametri (es. % Positivi su Tamponi).",elementSelector:".filter-factor",showAfter:30,showAction:()=>{this.currentArea()||this._tips.areaSelected.showAction(),this.selectedIndicator(e.linq(this._dataSet.indicators).first(e=>"totalPositive"==e.id)),this.selectedFactor(e.linq(this._dataSet.factors).first(e=>"population"==e.id))}},groupChanged:{order:7,featureName:"Grafico",html:"Puo raggruppare i dati del grafico in gruppi da 1 a 7 giorni. Puoi anche scegliere la data d'inizio.",elementSelector:".row-chart-group .select-wrapper",showAfter:30,showAction:()=>{this.currentArea()||this._tips.areaSelected.showAction();var e=document.querySelector(".chart-options");e.classList.contains("closed")&&e.classList.remove("closed"),this.groupSize(2),M.FormSelect.init(document.querySelectorAll(".row-chart-group select"))}},chartActionExecuted:{order:8,featureName:"Grafico",html:"Puoi portare il grafico a schermo interno, copiarlo, o copiare la serie numerico e incollarla in excel.",elementSelector:".chart .actions",showAfter:30},scaleChanged:{order:9,featureName:"Grafico",html:"Puoi cambiare da scala logaritmica a scala lineare.",elementSelector:".log-scale",showAfter:210,showAction:()=>{this.isLogScale(!0)}},maxFactorChanged:{order:10,featureName:"Mappa",html:"Puoi cambiare il riferimento rispetto al quale la mappa viene colorata. Normalmente è in base al valore massimo che si ha avuto globalmente.",elementSelector:".max-factor",showAfter:60,showAction:()=>{this.currentArea()||this._tips.areaSelected.showAction(),this.selectedIndicator(e.linq(this._dataSet.indicators).first(e=>"totalPositive"==e.id)),this.autoMaxFactor(!1),this.maxFactor(1e3)}},regionExcluded:{order:11,featureName:"Mappa",html:"Nella vista nazionale puoi escludere dagli indicatori il valore di una o più regioni cliccando sulla mappa.",elementSelector:".card-map .center-align",showAfter:0,showAction:()=>{"country"!=this.viewMode()&&this.viewMode("country"),this._execludedArea.set("R8",this._calculator.geo.areas.r8),this.updateIndicator()}}},this._specialDates={current:{date:void 0,color:"#000",width:.5,label:"Giorno corrente"},dpcm8:{date:new Date(2020,2,7),color:"#000",dash:[5,5],width:1,visible:!0,label:"DPCM 8 Marzo (italia zona rossa)"},dpcm9:{date:new Date(2020,2,9),color:"#000",dash:[5,5],width:1,visible:!0,label:"DPCM 9 Marzo (italia zona rossa)"},dpcm11:{date:new Date(2020,2,11),color:"#000",dash:[5,5],width:1,visible:!0,label:"DPCM 11 Marzo (chiusura attività)"},mds20:{date:new Date(2020,2,20),color:"#070",dash:[5,5],width:1,visible:!1,label:"MDS 20 Marzo (chiura parchi, motoria nelle vicinane)"},dpcm22:{date:new Date(2020,2,21),color:"#000",dash:[5,5],width:1,visible:!0,label:"DPCM 22 Marzo (chiusura ulteriore attività)"},dpcm25:{date:new Date(2020,2,24),color:"#000",dash:[5,5],width:1,visible:!0,label:"DPCM 25 Marzo (maggiori sanzioni)"}},this.dayNumber=ko.observable(0),this.totalDays=ko.observable(0),this.detailsLoading=new e.Signal(!0),this.detailsArea=ko.observable(),this.currentData=ko.observable(),this.currentArea=ko.observable(),this.topAreas=ko.observable(),this.viewMode=ko.observable("district"),this.selectedIndicator=ko.observable(),this.selectedFactor=ko.observable(),this.autoMaxFactor=ko.observable(!0),this.maxFactor=ko.observable(),this.isPlaying=ko.observable(!1),this.isLogScale=ko.observable(!1),this.isDayDelta=ko.observable(!1),this.isZoomChart=ko.observable(!1),this.isShowEnvData=ko.observable(!1),this.groupSize=ko.observable(1),this.startDay=ko.observable(0),this.isNoFactorSelected=ko.computed(()=>this.selectedFactor()&&"none"==this.selectedFactor().id),this.groupDays=[1,2,3,4,5,6,7],this.factorDescription=ko.observable(),this._mainData=i.data,this._mainGeo=i.geo,this._debugMode=i.debugMode,this._calculator=new t.IndicatorCalculator(this._mainData,this._dataSet,this._mainGeo),this.totalDays(this._calculator.data.days.length-1),this.dayNumber.subscribe(e=>{e!=this._calculator.data.days.length-1&&this.tipManager.markAction("dayChanged"),this.updateDayData(),this._specialDates.current.date=new Date(this._calculator.data.days[e].date),this.updateChart()}),this._mapSvg=document.getElementsByTagName("svg").item(0),this._mapSvg.addEventListener("click",e=>this.onMapClick(e,!1)),this._mapSvg.addEventListener("dblclick",e=>this.onMapClick(e,!0)),this.days=[];for(var s=0;s<this._calculator.data.days.length;s++)this.days.push({number:s,value:new Date(this._calculator.data.days[s].date),text:e.DateUtils.format(this._calculator.data.days[s].date,$string("$(date-format-short)"))});M.Tabs.init(document.getElementById("areaTabs")).options.onShow=e=>{this.setViewMode(e.dataset.viewMode)};const n=M.Collapsible.init(document.getElementById("topCases"));n.options.onOpenStart=()=>{this._daysData||this.updateTopAreas(),this._topAreasVisible=!0,this.tipManager.markAction("topAreasOpened")},n.options.onCloseEnd=()=>{this._topAreasVisible=!1},this.indicators=ko.computed(()=>e.linq(this._dataSet.indicators).where(e=>!e.validFor||-1!=e.validFor.indexOf(this.viewMode())).toArray()),this.factors=ko.computed(()=>e.linq(this._dataSet.factors).where(e=>!e.validFor||-1!=e.validFor.indexOf(this.viewMode())).toArray()),this.detailsArea.subscribe(e=>{this.updateDetailsArea()}),this.selectedIndicator.subscribe(e=>{e&&(this.updateIndicator(),"totalPositive"!=e.id&&this.tipManager.markAction("indicatorChanged",e.id))}),this.selectedFactor.subscribe(e=>{e&&(this.updateIndicator(),"none"!=e.id&&this.tipManager.markAction("factorChanged",e.id),setTimeout(()=>M.FormSelect.init(document.querySelectorAll(".row-chart-group select"))))}),this.autoMaxFactor.subscribe(e=>{e&&(this.updateMaxFactor(),this.updateMap()),this.updateUrl()}),this.maxFactor.subscribe(e=>{this.autoMaxFactor()||(this.updateMap(),this.tipManager.markAction("maxFactorChanged",e.toString())),this.updateUrl()}),this.isDayDelta.subscribe(e=>{this.computeStartDayForGroup(),this.updateIndicator(),e&&this.tipManager.markAction("deltaSelected")}),this.isLogScale.subscribe(e=>{this.updateChart(),this.updateUrl(),e&&this.tipManager.markAction("scaleChanged")}),this.isZoomChart.subscribe(e=>{this.updateChart()}),this.groupSize.subscribe(e=>{this.computeStartDayForGroup(),this.updateChart(),this.updateUrl(),e>1&&this.tipManager.markAction("groupChanged",e.toString())}),this.startDay.subscribe(e=>{this.updateChart(),this.updateUrl()});const a=new URLSearchParams(window.location.search),o=a.get("state");let r;this._keepState="true"==a.get("keepState"),this.loadPreferences(),this.tipManager=new e.TipManager(this._tips,()=>this._preferences,()=>this.savePreferences()),this.tipManager.engageUser(),r=o&&this._keepState?JSON.parse(atob(o)):{},setTimeout(()=>this.loadState(r),0),this._debugMode||window.addEventListener("beforeunload",()=>this.savePreferences())}isDefaultState(e){return!(e.day&&e.day!=this._calculator.data.days.length-1||e.view&&"region"!=e.view||e.area||e.indicator&&"totalPositive"!=e.indicator||e.factor&&"none"!=e.factor||e.maxFactor||e.dayDelta||e.logScale||e.showEnvData||e.groupSize&&1!=e.groupSize||null!=e.startDay&&0!=e.startDay||e.excludedArea||e.detailsArea)}loadState(i){if(i.view||(i.view="region"),M.Tabs.getInstance(document.getElementById("areaTabs")).select(t.ViewModes[i.view].tab),document.body.scrollTop=0,null!=i.logScale&&this.isLogScale(i.logScale),i.groupSize&&this.groupSize(i.groupSize),null!=i.startDay&&this.startDay(i.startDay),null!=i.dayDelta&&this.isDayDelta(i.dayDelta),null!=i.showEnvData&&this.isShowEnvData(i.showEnvData),i.maxFactor&&(this.autoMaxFactor(!1),this.maxFactor(i.maxFactor)),this.dayNumber(null!=i.day?i.day:this._calculator.data.days.length-1),i.excludedArea){this._execludedArea.clear();for(let e of i.excludedArea)this._execludedArea.set(e,this._calculator.geo.areas[e.toLowerCase()])}i.indicator&&this.selectedIndicator(e.linq(this._dataSet.indicators).first(e=>e.id==i.indicator)),i.factor&&this.selectedFactor(e.linq(this._dataSet.factors).first(e=>e.id==i.factor)),i.area&&(this.selectedArea=this._calculator.geo.areas[i.area.toLowerCase()]),i.detailsArea&&this.detailsArea(this._calculator.geo.areas[i.detailsArea])}saveStata(){return{view:"region"==this.viewMode()?void 0:this.viewMode(),indicator:this.selectedIndicator()?this.selectedIndicator().id:void 0,factor:this.selectedFactor()?this.selectedFactor().id:void 0,dayDelta:!!this.isDayDelta()||void 0,maxFactor:this.autoMaxFactor()?void 0:this.maxFactor(),day:this.dayNumber()==this._calculator.data.days.length-1?void 0:this.dayNumber(),area:this.selectedArea?this.selectedArea.id:void 0,groupSize:1==this.groupSize()?void 0:this.groupSize(),startDay:0==this.startDay()?void 0:this.startDay(),logScale:!!this.isLogScale()||void 0,excludedArea:this._execludedArea.size>0?e.linq(this._execludedArea.keys()).toArray():void 0,showEnvData:!!this.isShowEnvData()||void 0,detailsArea:this.detailsArea()?this.detailsArea().id:void 0}}loadPreferences(){let e=localStorage.getItem("preferences");if(e){try{this._preferences=JSON.parse(e)}catch(e){}this._preferences&&1==this._preferences.version||(this._preferences=this.getDefaultPreferences(),this._preferences.isFirstView=!1,this._preferences.showTips=!1,this.savePreferences())}else this._preferences=this.getDefaultPreferences()}getDefaultPreferences(){return{isFirstView:!0,showTips:!0,version:1,actions:{areaSelected:0,indicatorSelected:0,indicatorChanged:0,dayChanged:0,viewChanged:0,chartActionExecuted:0,factorChanged:0,groupChanged:0,maxFactorChanged:0,scaleChanged:0,topAreasOpened:0,deltaSelected:0,regionExcluded:0}}}savePreferences(){this._preferences.isFirstView=!1,localStorage.setItem("preferences",JSON.stringify(this._preferences))}toggleChartZoom(){this._preferences.actions.chartActionExecuted++,this.isZoomChart(!this.isZoomChart())}copyMap(){return __awaiter(this,void 0,void 0,(function*(){const e=document.querySelector("svg.map"),t=e.outerHTML,i=new Blob([t],{type:"image/svg+xml"});if(navigator.clipboard&&navigator.clipboard.write){const t=document.createElement("img");t.style.width=e.clientWidth+"px",t.style.height=e.clientHeight+"px",t.onload=function(){const i=document.createElement("canvas");i.width=e.clientWidth,i.height=e.clientHeight;const s=i.getContext("2d");s.fillStyle="white",s.fillRect(0,0,i.width,i.height),s.drawImage(t,0,0),i.toBlob(e=>__awaiter(this,void 0,void 0,(function*(){let t=new ClipboardItem({[e.type]:e});yield navigator.clipboard.write([t]),M.toast({html:$string("$(msg-map-copied)")})})))},t.src=window.URL.createObjectURL(i)}else{const e=document.createElement("a");e.href=window.URL.createObjectURL(i),e.target="_blan",e.download="map.svg",e.click(),M.toast({html:$string("$(msg-no-copy)")})}}))}copyChart(){this._chart.canvas.toBlob(e=>__awaiter(this,void 0,void 0,(function*(){if(navigator.clipboard&&navigator.clipboard.write){let t=new ClipboardItem({[e.type]:e});yield navigator.clipboard.write([t]),M.toast({html:$string("$(msg-chart-copied)")})}else{const t=window.URL.createObjectURL(e),i=document.createElement("a");i.href=t,i.target="_blan",i.download=this._chart.options.title.text+".png",i.click(),M.toast({html:$string("$(msg-no-copy)")})}}))),this.tipManager.markAction("chartActionExecuted","copy")}copySerie(){return __awaiter(this,void 0,void 0,(function*(){const t=this._chart.data.datasets[0].data;let i="";for(let s=0;s<t.length;s++)s>0&&(i+="\n"),i+=e.DateUtils.format(t[s].x,$string("$(date-format)"))+"\t"+s+"\t"+e.MathUtils.round(t[s].y,1);e.DomUtils.copyText(i),M.toast({html:$string("$(msg-serie-copied)")}),this.tipManager.markAction("chartActionExecuted","copySerie")}))}copySerieForStudio(){return __awaiter(this,void 0,void 0,(function*(){let t={type:"serie",version:1,color:this.selectedIndicator().colorLight,serie:{type:"geoplot",areaId:this.selectedArea.id,indicatorId:this.selectedIndicator().id,xAxis:"dayNumber",startDay:this.startDay(),exeludedAreaIds:e.linq(this._execludedArea.keys()).toArray(),factorId:this.selectedFactor().id,groupSize:this.groupSize(),isDelta:this.isDayDelta()},title:this.factorDescription()};t.values=this._calculator.getSerie(t.serie),e.DomUtils.copyText(JSON.stringify(t)),M.toast({html:$string("$(msg-serie-copied-studio)")}),this.tipManager.markAction("chartActionExecuted","copySerieForStudio")}))}play(){this.dayNumber()==this._calculator.data.days.length-1&&this.dayNumber(0),this.isPlaying(!0),this.nextFrame()}pause(){this.isPlaying(!1)}setViewMode(e,i=!1){if(i){M.Tabs.getInstance(document.getElementById("areaTabs")).select(t.ViewModes[e].tab)}"details"==e?this._detailsGeo&&this._detailsData&&(this._calculator.geo=this._detailsGeo,this._calculator.data=this._detailsData,this.totalDays(this._calculator.data.days.length-1)):(this._calculator.geo=this._mainGeo,this._calculator.data=this._mainData),this.totalDays(this._calculator.data.days.length-1),"region"!=e&&this.tipManager.markAction("viewChanged",e),this.viewMode(e);const s=document.getElementById("group_district");"district"==e||"details"==e?s.style.removeProperty("display"):s.style.display="none",this.selectedArea=null,this._chart=null,this._execludedArea.clear(),this.clearMap(),this.updateMaxFactor(),this.updateDayData(),"country"==this.viewMode()?(this.selectedArea=this._calculator.geo.areas.it,this.tipManager.showTip("regionExcluded",{timeout:5})):this._topAreasVisible?this.updateTopAreas():this._daysData=void 0,setTimeout(()=>M.FormSelect.init(document.querySelectorAll(".row-indicator select")))}get selectedArea(){return this._selectedArea}set selectedArea(e){if(e!=this._selectedArea){if(this._selectedArea){const e=document.getElementById(this._selectedArea.id.toUpperCase());e&&e.classList.remove("selected")}if(this._selectedArea=e,this._selectedArea){const e=document.getElementById(this._selectedArea.id.toUpperCase());if(e){e.classList.add("selected");const t=e.parentElement;e.remove(),t.appendChild(e)}}this.changeArea()}}getFactorValue(t,i){return this._calculator.getFactorValue({dayNumberOrGroup:t,areaOrId:i,factorId:this.selectedFactor().id,indicatorId:this.selectedIndicator().id,isDayDelta:this.isDayDelta(),execludedAreas:e.linq(this._execludedArea.keys()).toArray()})}getIndicatorValue(t,i,s){return this._calculator.getIndicatorValue({dayNumber:t,areaOrId:i,indicatorId:s,isDayDelta:this.isDayDelta(),execludedAreas:e.linq(this._execludedArea.keys()).toArray()})}computeStartDayForGroup(){const e=(this.days.length-this.startDay())%this.groupSize();if(0!=e){const t=this.groupSize()-e;this.startDay()-t>=0?this.startDay(this.startDay()-t):this.startDay()+e<this.days.length-1&&this.startDay(this.startDay()+e),M.FormSelect.init(document.querySelectorAll(".row-chart-group select"))}}onMapClick(e,t){const i=e.target.parentElement.id,s=this._calculator.geo.areas[i.toLowerCase()];s&&(t?"region"!=this.viewMode()&&"district"!=this.viewMode()||this.detailsArea(s):("country"==this.viewMode()?(this._execludedArea.has(i)?this._execludedArea.delete(i):(this._execludedArea.set(i,s),M.toast({html:$string("$(msg-region-ex)").replace("[region]",s.name)})),this.updateIndicator()):this.selectedArea=s,this.tipManager.markAction("areaSelected",s.name)))}nextFrame(){this.isPlaying()&&(this.dayNumber()>=this._calculator.data.days.length-1?this.pause():this.dayNumber(parseInt(this.dayNumber().toString())+1),setTimeout(()=>this.nextFrame(),200))}changeArea(){if(null==this._selectedArea)this.currentArea(null);else{var e=!this.currentArea();const t=new s;t.value=this._selectedArea,this.updateArea(t),this.currentArea(t),this.updateFactorDescription(),this.updateAreaIndicators(),this.updateChart(),e&&(M.FormSelect.init(document.querySelectorAll(".row-chart-group select")),M.Tooltip.init(document.querySelectorAll(".row-chart-group .tooltipped")))}this.updateUrl()}updateAreaIndicators(){if(!this.currentArea())return;if(!this.currentArea().indicators()){const e=[];for(let t of this.indicators()){if(!1===t.showInFavorites)continue;let s=new i;s.indicator=t,s.select=()=>{this.tipManager.markAction("indicatorSelected",s.indicator.id),this.selectedIndicator(t),setTimeout(()=>M.FormSelect.init(document.querySelectorAll(".row-indicator select")))},e.push(s)}this.currentArea().indicators(e)}const e=this.currentArea().value.id.toLowerCase();for(let t of this.currentArea().indicators())t.value(this.getIndicatorValue(this.dayNumber(),e,t.indicator.id))}updateFactorDescription(){let e="";if(this.isDayDelta()&&(e="$(new) "),e+=this.selectedFactor().description.replace("[indicator]",this.selectedIndicator().name),this.currentArea()&&(e+=" - "+this.currentArea().value.name),this._execludedArea.size>0){e+=" - $(except) (";let t=0;for(let i of this._execludedArea.keys())t>0&&(e+=", "),e+=this._execludedArea.get(i).name,t++;e+=")"}this.factorDescription($string(e))}updateIndicator(){this.selectedIndicator()&&this.selectedFactor()&&(this.updateFactorDescription(),this.updateMaxFactor(),this.updateDayData(),this.updateChart(),this.updateUrl(),this._topAreasVisible&&this.updateTopAreas())}updateMaxFactor(){if(!this.selectedFactor()||!this.selectedIndicator()||!this.autoMaxFactor())return;let i=Number.NEGATIVE_INFINITY,s=t.ViewModes[this.viewMode()],n=[];for(let t=0;t<this._calculator.data.days.length;t++){const a=this._calculator.data.days[t];for(let o in a.values){if(!s.validateId(o))continue;const a=Math.abs(this.getFactorValue(t,o));!e.MathUtils.isNaNOrNull(a)&&a!=Number.POSITIVE_INFINITY&&a>i&&(i=a),0!=a&&n.push(a)}}this.maxFactor(parseFloat(i.toFixed(1)))}initChart(){const t=document.querySelector("#areaGraph"),i={afterDraw:e=>{const t=e.data.datasets[0].data;if(!t||0==t.length)return;const i=e.scales["x-axis-0"],s=e.ctx;for(let t in this._specialDates){let n=this._specialDates[t];if(!n.date||!1===n.visible)continue;let a=i.getPixelForValue({x:n.date});s.lineWidth=n.width||1,s.beginPath(),s.moveTo(a,e.chartArea.top),s.lineTo(a,e.chartArea.bottom),s.strokeStyle=n.color||"#000",n.dash?s.setLineDash(n.dash):s.setLineDash([]),n.dashOffset&&(s.lineDashOffset=n.dashOffset),s.stroke()}}};this._chart=new Chart(t,{plugins:[i],type:"line",data:{datasets:[{lineTension:0,data:[],borderWidth:1}]},options:{maintainAspectRatio:!1,legend:{display:!0,position:"bottom"},title:{display:!1},tooltips:{callbacks:{label:(t,i)=>t.xLabel+": "+e.MathUtils.round(parseFloat(t.value),1)}},scales:{xAxes:[{type:"time",distribution:"linear",time:{unit:"day",tooltipFormat:"DD/MMM"}}]}}})}updateChart(){if(!this.selectedIndicator()||!this.currentArea()||!this.selectedFactor())return;null==this._chart&&this.initChart();const t=this.currentArea().value;t.id.toLowerCase(),this.selectedIndicator().id;this._chart.data.datasets[0].label=this.factorDescription(),this._chart.options.title.text=this._chart.data.datasets[0].label,this.isLogScale()?this._chart.options.scales.yAxes[0].type="logarithmic":this._chart.options.scales.yAxes[0].type="linear",this._chart.data.datasets[0].borderColor=this.selectedIndicator().colorDark,this._chart.data.datasets[0].backgroundColor=this.selectedIndicator().colorLight,this._chart.data.datasets[0].data=this._calculator.getSerie({type:"geoplot",areaId:t.id,indicatorId:this.selectedIndicator().id,xAxis:"date",startDay:this.startDay(),exeludedAreaIds:e.linq(this._execludedArea.keys()).toArray(),factorId:this.selectedFactor().id,groupSize:this.groupSize(),isDelta:this.isDayDelta()}),this._chart.update()}updateArea(e,t){if(!e||!this.selectedIndicator()||!this.selectedFactor())return;null==t&&(t=this.dayNumber());const i=e.value.id.toLowerCase(),s=e.value;e.data(this._calculator.getDataAtDay(t,i)),e.indicator(this.getIndicatorValue(t,i,this.selectedIndicator().id)),e.factor(this.getFactorValue(t,s)),e.reference(this.selectedFactor().reference(e.data(),s))}updateDetailsArea(){return __awaiter(this,void 0,void 0,(function*(){const t=document.querySelector(".details-map");if(this.detailsArea()){yield this.detailsLoading.waitFor(),this.detailsLoading.reset();try{this.setViewMode("details",!0),yield e.PromiseUtils.delay(0),t.innerHTML="<span class = 'loading'><i class ='material-icons'>loop</i></span>",document.getSelection().empty();const s=JSON.parse(yield(yield fetch(e.app.baseUrl+"AreaData/"+this.detailsArea().id)).text()),n=yield(yield fetch(e.app.baseUrl+"AreaMap/"+this.detailsArea().id)).text();t.innerHTML=n;var i=document.querySelector(".details-map svg");i.addEventListener("click",e=>this.onMapClick(e,!1)),i.querySelector("#group_municipality").classList.add("active"),this._detailsData=s.data,this._detailsGeo=s.geo,this.setViewMode("details",!0)}finally{this.detailsLoading.set()}}else this.setViewMode("region"),t.innerHTML=""}))}updateTopAreas(){this._daysData=[];for(let i=0;i<this._calculator.data.days.length;i++){const n=this._calculator.data.days[i],a={},o=t.ViewModes[this.viewMode()].validateId;a.topAreas=e.linq(n.values).select(e=>({factor:this.getFactorValue(i,e.key),value:e})).where(t=>!e.MathUtils.isNaNOrNull(t.factor)).orderByDesc(e=>e.factor).where(e=>o(e.value.key)).select(e=>{const t=new s;return t.value=this._calculator.geo.areas[e.value.key.toLowerCase()],t.select=()=>this.selectedArea=t.value,this.updateArea(t,i),t}).take(25).toArray(),this._daysData.push(a)}this.topAreas(this._daysData[this.dayNumber()].topAreas)}updateDayData(){const t=this._calculator.data.days[this.dayNumber()];t?(this.currentData(e.DateUtils.format(t.date,$string("$(date-format)"))),this.updateMap(),this.updateArea(this.currentArea()),this.updateAreaIndicators(),this._daysData&&this._topAreasVisible&&this.topAreas(this._daysData[this.dayNumber()].topAreas),this.updateUrl()):console.warn("No day data: "+this.dayNumber())}updateUrl(){if(!this._keepState)return;const t=this.saveStata();let i=e.app.baseUrl+"Overview";this.isDefaultState(t)||(i+="?state="+encodeURIComponent(btoa(JSON.stringify(t)))+"&keepState=true"),history.replaceState(null,null,i)}clearMap(){const e=this._calculator.data.days[this.dayNumber()];if(e&&e.values)for(const t in e.values){const e=document.getElementById(t.toUpperCase());e&&e.style.removeProperty("fill")}else console.warn("No day data: "+this.dayNumber())}updateMap(){if(this.selectedIndicator()&&this.selectedFactor())if("country"!=this.viewMode()){const s=this._calculator.data.days[this.dayNumber()];var i=this.selectedIndicator();const n=i.gradient?i.gradient:new e.LinearGradient("#fff",i.colorDark);for(const a in s.values){const s=document.getElementById(a.toUpperCase());if(s){const o=this._calculator.geo.areas[a];if(o.type!=t.ViewModes[this.viewMode()].areaType)continue;let r=this.getFactorValue(this.dayNumber(),o);if(r==Number.POSITIVE_INFINITY&&(r=NaN),i.canBeNegative?r=.5+r/(2*this.maxFactor()):r/=this.maxFactor(),r=Math.min(1,Math.max(0,r)),e.MathUtils.isNaNOrNull(r))s.classList.contains("valid")&&s.classList.remove("valid"),s.style.removeProperty("fill");else{let t;s.classList.contains("valid")||s.classList.add("valid"),t=i.canBeNegative?e.MathUtils.discretize(r,20):e.MathUtils.discretize(e.MathUtils.exponential(r),20),s.style.fill=n.valueAt(t).toString()}}}}else"details"!=this.viewMode()&&e.linq(document.querySelectorAll(".main-map g.region")).foreach(e=>{this._execludedArea.has(e.id)?e.style.fill="#444":e.style.fill="#FFF"})}}}(e.GeoPlot||(e.GeoPlot={}))}(WebApp||(WebApp={})),function(e){!function(t){t.ParameterViewModel=class{constructor(e){this.min=ko.observable(),this.max=ko.observable(),this.step=ko.observable(),this.isSelected=ko.observable(!0),this.value=e.value,this.name=e.name}};t.StudioPage=class{constructor(i){this.items=new t.TreeView,this.maxX=ko.observable(),this.maxY=ko.observable(),this.dataImport=new t.DataImportControl,this._projectId=i,this._graphCtx=new t.GraphContext,this._graphCtx.calculator=Desmos.GraphingCalculator(document.getElementById("calculator"),{pasteGraphLink:!1,pasteTableData:!1,expressionsCollapsed:!0,restrictedFunctions:!0,administerSecretFolders:!0,authorIDE:!0,advancedStyling:!0}),this._graphCtx.calculator.controller.listModel.onSelectionChanged=e=>this.onGraphSelectionChanged(e);const s=[];s.push(e.apply(new t.ActionView,e=>{e.text=$string("$(new-project)"),e.icon="create_new_folder",e.execute=()=>this.newProject()})),s.push(e.apply(new t.ActionView,e=>{e.text=$string("$(save)"),e.icon="save",e.execute=()=>this.saveState()})),s.push(e.apply(new t.ActionView,e=>{e.text=$string("$(import)"),e.icon="import_export",e.execute=()=>this.import()})),s.push(e.apply(new t.ActionView,e=>{e.text=$string("$(share) Studio"),e.icon="share",e.execute=()=>this.share()})),s.push(e.apply(new t.ActionView,e=>{e.text=$string("$(options)"),e.icon="settings",e.execute=()=>this.showOptions()}));const n=new t.TreeNode;n.actions(s),this.items.setRoot(n),document.body.addEventListener("paste",e=>__awaiter(this,void 0,void 0,(function*(){"INPUT"!=e.target.tagName&&(yield this.onPaste(e.clipboardData))&&e.preventDefault()}))),M.Modal.init(document.getElementById("options"),{onCloseEnd:()=>this.updateOptions()}),setTimeout(()=>this.init())}onGraphSelectionChanged(e){if(!e||!e.folderId)return;const t=e.folderId.split("/")[0],i=this._graphCtx.treeItems[t];i&&i.node.select(!0)}updateOptions(){const e=parseInt(this.maxX()),t=parseInt(this.maxY());this._graphCtx.calculator.setMathBounds({bottom:-t/10,left:-e/10,right:e,top:t})}share(){return __awaiter(this,void 0,void 0,(function*(){const i=e.StringUtils.uuidv4();yield t.Api.saveState(i,this.getState());const s=e.Uri.absolute("~/"+$language.split("-")[0]+"/Studio/"+i);yield e.DomUtils.copyText(s),M.toast({html:$string("$(msg-shared)")})}))}showOptions(){const e=this._graphCtx.calculator.graphpaperBounds;this.maxX(Math.round(e.mathCoordinates.width)),this.maxY(Math.round(e.mathCoordinates.height)),M.Modal.getInstance(document.getElementById("options")).open()}getSelectedProject(){if(!this.items.selectedNode())return;const e=this.items.selectedNode().value();return"project"==e.itemType?e:"serie"==e.itemType?e.parent:"regression"==e.itemType?e.parent.parent:void 0}newProject(){const e=this.addProject({name:"Project "+(this.projects.count()+1)});return e.node.isSelected(!0),e}addProject(e,i=!0){const s=new t.StudioProject(e),n=new t.TreeNode(s);return this.items.root().addNode(n),s.attachNode(n),s.attachGraph(this._graphCtx),i&&s.updateGraph(),s}getState(){const e={version:2};return e.graphState=this._graphCtx.calculator.getState(),e.vars=this._graphCtx.vars,e.projects=this.projects.select(e=>e.getState()).toArray(),e}setState(e){e&&(e.graphState&&(e.graphState.expressions.list=[],this._graphCtx.calculator.setState(e.graphState)),null!=e.projects&&(this.projects.toArray().forEach(e=>e.remove()),e.projects.forEach(e=>{this.addProject(null,!1).setState(e)})))}loadState(){return __awaiter(this,void 0,void 0,(function*(){if(this._projectId){let e=yield t.Api.loadState(this._projectId);this.setState(e)}else{const e=localStorage.getItem("studio");e&&this.setState(JSON.parse(e))}}))}saveState(){return __awaiter(this,void 0,void 0,(function*(){this._projectId?(yield t.Api.saveState(this._projectId,this.getState()),M.toast({html:$string("$(msg-saved)")})):(localStorage.setItem("studio",JSON.stringify(this.getState())),M.toast({html:$string("$(msg-saved-device)")}))}))}demo(){const e=this.addProject({name:"Project 1"});this.addProject({name:"Project 2"}),this.addProject({name:"Project 3"}),e.addSerie({name:"Serie 1"})}onPaste(e){return __awaiter(this,void 0,void 0,(function*(){const t=e.getData("text/plain").toString();return!!t&&(yield this.importText(t))}))}import(){return __awaiter(this,void 0,void 0,(function*(){let e=this.getSelectedProject();const t=yield this.dataImport.show();return this.addImportedData(t,e),!0}))}importText(e){return __awaiter(this,void 0,void 0,(function*(){let i=this.getSelectedProject();if(i||this.projects.any()||(i=this.newProject()),!i)return M.toast({html:$string("$(msg-select-project)")}),!1;const s=t.StudioSerie.fromText(e);if(s){i.addSerie(s),i.node.isExpanded(!0),s.node.isExpanded(!0),s.zoom();const e=s.addRegression(null,!1);return e.updateGraph(),e.node.isSelected(!0),!0}try{(yield this.dataImport.importText(e))&&(yield this.import())}catch(e){console.error(e)}return M.toast({html:$string("$(msg-format-not-reconized)")}),!1}))}addImportedData(e,i){if(1==e.length&&this.items.selectedNode()&&this.items.selectedNode().value()instanceof t.StudioSerie&&confirm($string("$(msg-replace-serie)"))){const t=this.items.selectedNode().value();return t.source=e[0],t.importValues(e[0].serie.values),t.updateGraph(!0),!0}i.node.isExpanded(!0);for(let s of e){const e=new t.StudioSerie({name:s.serie.name,values:s.serie.values,source:s});i.addSerie(e),e.node.isExpanded(!0);const n=e.addRegression(null,!1);n.updateGraph(),n.node.isSelected(!0)}}get projects(){return e.linq(function*(){for(let e of this.items.root().nodes())yield e.value()}.apply(this))}init(){return __awaiter(this,void 0,void 0,(function*(){this.loadState()}))}}}(e.GeoPlot||(e.GeoPlot={}))}(WebApp||(WebApp={}));